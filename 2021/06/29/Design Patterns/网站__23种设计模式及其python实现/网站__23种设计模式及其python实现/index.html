<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="地址 : &lt;a href=&quot;https://www.cnblogs.com/Liqiongyu/p/5916710.html&quot;&gt;https://www.cnblogs.com/Liqiongyu/p/5916710.html&lt;/a&gt;"><link rel="stylesheet" type="text/css" href="/css/normalize.css"><link rel="stylesheet" type="text/css" href="/css/highlight.css"><link rel="stylesheet" type="text/css" href="/css/noise.css"><title>23种设计模式及其python实现 | 凉薄的自动书记人偶</title><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><meta name="generator" content="Hexo 5.4.0"></head><body><article class="wrapper"><div class="post-main"><div class="nav"><nav class="container"><a class="sidebar-nav-item active" href="/">Home</a><a class="sidebar-nav-item" href="/archives">Tags</a><a class="sidebar-nav-item" href="/About">About</a></nav><div class="container post-meta"><div class="post-tags"><a class="post-tag-link" href="/tags/Design-Patterns/" rel="tag">Design Patterns</a></div><div class="post-time">2021-06-29</div></div></div><div class="container post-header"><h1>23种设计模式及其python实现</h1></div><div class="container post-toc"><details class="toc"><summary class="toc-accordion">Table of Contents</summary><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E7%A7%8D%E6%9C%80%E5%9F%BA%E6%9C%AC%E7%9A%84%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.</span> <span class="toc-text">三种最基本的设计模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%9E%8B"><span class="toc-number">2.</span> <span class="toc-text">创建型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-Factory-Method%EF%BC%88%E5%B7%A5%E5%8E%82%E6%96%B9%E6%B3%95%EF%BC%89"><span class="toc-number">3.</span> <span class="toc-text">1. Factory Method（工厂方法）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-Abstract-Factory%EF%BC%88%E6%8A%BD%E8%B1%A1%E5%B7%A5%E5%8E%82%EF%BC%89"><span class="toc-number">4.</span> <span class="toc-text">2. Abstract Factory（抽象工厂）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-Builder%EF%BC%88%E5%BB%BA%E9%80%A0%E8%80%85%EF%BC%89"><span class="toc-number">5.</span> <span class="toc-text">3. Builder（建造者）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-Prototype%EF%BC%88%E5%8E%9F%E5%9E%8B%EF%BC%89"><span class="toc-number">6.</span> <span class="toc-text">4. Prototype（原型）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-Singleton%EF%BC%88%E5%8D%95%E4%BE%8B%EF%BC%89"><span class="toc-number">7.</span> <span class="toc-text">5. Singleton（单例）</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BB%93%E6%9E%84%E5%9E%8B"><span class="toc-number"></span> <span class="toc-text">结构型</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#6-Adapter-Class-Object%EF%BC%88%E9%80%82%E9%85%8D%E5%99%A8%EF%BC%89"><span class="toc-number">1.</span> <span class="toc-text">6. Adapter Class&#x2F;Object（适配器）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-Bridge%EF%BC%88%E6%A1%A5%E6%8E%A5%EF%BC%89"><span class="toc-number">2.</span> <span class="toc-text">7. Bridge（桥接）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-Composite%EF%BC%88%E7%BB%84%E5%90%88%EF%BC%89"><span class="toc-number">3.</span> <span class="toc-text">8. Composite（组合）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-Decorator%EF%BC%88%E8%A3%85%E9%A5%B0%EF%BC%89"><span class="toc-number">4.</span> <span class="toc-text">9. Decorator（装饰）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-Facade%EF%BC%88%E5%A4%96%E8%A7%82%EF%BC%89"><span class="toc-number">5.</span> <span class="toc-text">10. Facade（外观）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11-Flyweight%EF%BC%88%E4%BA%AB%E5%85%83%EF%BC%89"><span class="toc-number">6.</span> <span class="toc-text">11. Flyweight（享元）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#12-Proxy%EF%BC%88%E4%BB%A3%E7%90%86%EF%BC%89"><span class="toc-number">7.</span> <span class="toc-text">12. Proxy（代理）</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%A1%8C%E4%B8%BA%E5%9E%8B"><span class="toc-number"></span> <span class="toc-text">行为型</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#13-Interpreter%EF%BC%88%E8%A7%A3%E9%87%8A%E5%99%A8%EF%BC%89"><span class="toc-number">1.</span> <span class="toc-text">13. Interpreter（解释器）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#14-Template-Method%EF%BC%88%E6%A8%A1%E6%9D%BF%E6%96%B9%E6%B3%95%EF%BC%89"><span class="toc-number">2.</span> <span class="toc-text">14. Template Method（模板方法）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#15-Chain-of-Responsibility%EF%BC%88%E8%B4%A3%E4%BB%BB%E9%93%BE%EF%BC%89"><span class="toc-number">3.</span> <span class="toc-text">15. Chain of Responsibility（责任链）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#16-Command%EF%BC%88%E5%91%BD%E4%BB%A4%EF%BC%89"><span class="toc-number">4.</span> <span class="toc-text">16. Command（命令）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#17-Iterator%EF%BC%88%E8%BF%AD%E4%BB%A3%E5%99%A8%EF%BC%89"><span class="toc-number">5.</span> <span class="toc-text">17. Iterator（迭代器）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#18-Mediator%EF%BC%88%E4%B8%AD%E4%BB%8B%E8%80%85%EF%BC%89"><span class="toc-number">6.</span> <span class="toc-text">18. Mediator（中介者）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#19-Memento%EF%BC%88%E5%A4%87%E5%BF%98%E5%BD%95%EF%BC%89"><span class="toc-number">7.</span> <span class="toc-text">19. Memento（备忘录）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#20-Observer%EF%BC%88%E8%A7%82%E5%AF%9F%E8%80%85%EF%BC%89"><span class="toc-number">8.</span> <span class="toc-text">20. Observer（观察者）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#21-State%EF%BC%88%E7%8A%B6%E6%80%81%EF%BC%89"><span class="toc-number">9.</span> <span class="toc-text">21. State（状态）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#22-Strategy%EF%BC%88%E7%AD%96%E7%95%A5%EF%BC%89"><span class="toc-number">10.</span> <span class="toc-text">22. Strategy（策略）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#23-Visitor%EF%BC%88%E8%AE%BF%E9%97%AE%E8%80%85%EF%BC%89"><span class="toc-number">11.</span> <span class="toc-text">23. Visitor（访问者）</span></a></li></ol></details></div><div class="container post-content"><p>地址 : <a target="_blank" rel="noopener" href="https://www.cnblogs.com/Liqiongyu/p/5916710.html">https://www.cnblogs.com/Liqiongyu/p/5916710.html</a></p>
<h2 id="三种最基本的设计模式"><a href="#三种最基本的设计模式" class="headerlink" title="三种最基本的设计模式"></a>三种最基本的设计模式</h2><ol>
<li>创建模式，<strong>提供实例化的方法</strong>，为适合的状况提供相应的对象创建方法。</li>
<li>结构化模式，通常用来<strong>处理实体之间的关系</strong>，使得这些实体能够更好地协同工作。</li>
<li>行为模式，用于<strong>在不同的实体建进行通信</strong>，为实体之间的通信提供更容易，更灵活的通信方法。</li>
</ol>
<p>创建型</p>
<ol>
<li><p>Factory Method（工厂方法）</p>
</li>
<li><p>Abstract Factory（抽象工厂）</p>
</li>
<li><p>Builder（建造者）</p>
</li>
<li><p>Prototype（原型）</p>
</li>
<li><p>Singleton（单例）</p>
</li>
</ol>
<p>结构型</p>
<ol start="6">
<li><p>Adapter Class/Object（适配器）</p>
</li>
<li><p>Bridge（桥接）</p>
</li>
<li><p>Composite（组合）</p>
</li>
<li><p>Decorator（装饰）</p>
</li>
<li><p>Facade（外观）</p>
</li>
<li><p>Flyweight（享元）</p>
</li>
<li><p>Proxy（代理）</p>
</li>
</ol>
<p>行为型</p>
<ol start="13">
<li><p>Interpreter（解释器）</p>
</li>
<li><p>Template Method（模板方法）</p>
</li>
<li><p>Chain of Responsibility（责任链）</p>
</li>
<li><p>Command（命令）</p>
</li>
<li><p>Iterator（迭代器）</p>
</li>
<li><p>Mediator（中介者）</p>
</li>
<li><p>Memento（备忘录）</p>
</li>
<li><p>Observer（观察者）</p>
</li>
<li><p>State（状态）</p>
</li>
<li><p>Strategy（策略）</p>
</li>
<li><p>Visitor（访问者）</p>
</li>
</ol>
<h2 id="创建型"><a href="#创建型" class="headerlink" title="创建型"></a>创建型</h2><h2 id="1-Factory-Method（工厂方法）"><a href="#1-Factory-Method（工厂方法）" class="headerlink" title="1. Factory Method（工厂方法）"></a>1. Factory Method（工厂方法）</h2><p><img src="/images/824579-20160928141135485-1986044710-4869325.gif" alt="img"></p>
<p><strong>意图：</strong></p>
<p>定义一个用于创建对象的接口，让子类决定实例化哪一个类。Factory Method 使<strong>一</strong>个类的实例化延迟到其子类。</p>
<p><strong>适用性：</strong></p>
<p>当一个类不知道它所必须创建的对象的类的时候。</p>
<p>当一个类希望由它的子类来指定它所创建的对象的时候。</p>
<p>当类将创建对象的职责委托给多个帮助子类中的某一个，并且你希望将哪一个帮助子类是代理者这一信息局部化的时候。</p>
<p><strong>实现：</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment">#coding:utf8</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">Factory Method</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ChinaGetter</span>:</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;A simple localizer a la gettext&quot;&quot;&quot;</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.trans = <span class="built_in">dict</span>(dog=<span class="string">u&quot;小狗&quot;</span>, cat=<span class="string">u&quot;小猫&quot;</span>)</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self, msgid</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;We&#x27;ll punt if we don&#x27;t have a translation&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">return</span> self.trans[msgid]</span><br><span class="line">        <span class="keyword">except</span> KeyError:</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">str</span>(msgid)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">EnglishGetter</span>:</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;Simply echoes the msg ids&quot;&quot;&quot;</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span>(<span class="params">self, msgid</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">str</span>(msgid)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_localizer</span>(<span class="params">language=<span class="string">&quot;English&quot;</span></span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;The factory method&quot;&quot;&quot;</span></span><br><span class="line">    languages = <span class="built_in">dict</span>(English=EnglishGetter, China=ChinaGetter)</span><br><span class="line">    <span class="keyword">return</span> languages[language]()</span><br><span class="line"> </span><br><span class="line"><span class="comment"># Create our localizers</span></span><br><span class="line">e, g = get_localizer(<span class="string">&quot;English&quot;</span>), get_localizer(<span class="string">&quot;China&quot;</span>)</span><br><span class="line"><span class="comment"># Localize some text</span></span><br><span class="line"><span class="keyword">for</span> msgid <span class="keyword">in</span> <span class="string">&quot;dog parrot cat bear&quot;</span>.split():</span><br><span class="line">    <span class="built_in">print</span>(e.get(msgid), g.get(msgid))</span><br></pre></td></tr></table></figure>

<p>　　</p>
<h2 id="2-Abstract-Factory（抽象工厂）"><a href="#2-Abstract-Factory（抽象工厂）" class="headerlink" title="2. Abstract Factory（抽象工厂）"></a>2. Abstract Factory（抽象工厂）</h2><p><img src="/images/824579-20160928181031672-1073974804-4869325.gif" alt="img"></p>
<p><strong>意图：</strong></p>
<p>提供一个创建一系列相关或相互依赖对象的接口，而无需指定它们具体的类。<br><strong>适用性：</strong></p>
<p> 一个系统要独立于它的产品的创建、组合和表示时。</p>
<p> 一个系统要由多个产品系列中的一个来配置时。</p>
<p> 当你要强调一系列相关的产品对象的设计以便进行联合使用时。</p>
<p> 当你提供一个产品类库，而只想显示它们的接口而不是实现时。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment">#coding:utf8</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">Abstract Factory</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PetShop</span>:</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;A pet shop&quot;&quot;&quot;</span></span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, animal_factory=<span class="literal">None</span></span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;pet_factory is our abstract factory.</span></span><br><span class="line"><span class="string">        We can set it at will.&quot;&quot;&quot;</span></span><br><span class="line"> </span><br><span class="line">        self.pet_factory = animal_factory</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">show_pet</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;Creates and shows a pet using the</span></span><br><span class="line"><span class="string">        abstract factory&quot;&quot;&quot;</span></span><br><span class="line"> </span><br><span class="line">        pet = self.pet_factory.get_pet()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;This is a lovely&quot;</span>, <span class="built_in">str</span>(pet))</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;It says&quot;</span>, pet.speak())</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;It eats&quot;</span>, self.pet_factory.get_food())</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment"># Stuff that our factory makes</span></span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dog</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">speak</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;woof&quot;</span></span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Dog&quot;</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Cat</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">speak</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;meow&quot;</span></span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Cat&quot;</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment"># Factory classes</span></span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DogFactory</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_pet</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> Dog()</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_food</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;dog food&quot;</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CatFactory</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_pet</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> Cat()</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_food</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;cat food&quot;</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment"># Create the proper family</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_factory</span>():</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;Let&#x27;s be dynamic!&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> random.choice([DogFactory, CatFactory])()</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment"># Show pets with various factories</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    shop = PetShop()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">        shop.pet_factory = get_factory()</span><br><span class="line">        shop.show_pet()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span> * <span class="number">20</span>)</span><br></pre></td></tr></table></figure>

<p>　　</p>
<h2 id="3-Builder（建造者）"><a href="#3-Builder（建造者）" class="headerlink" title="3. Builder（建造者）"></a>3. Builder（建造者）</h2><p><strong>意图：</strong></p>
<p>将一个复杂对象的构建与它的表示分离，使得同样的构建过程可以创建不同的表示。</p>
<p><strong>适用性：</strong></p>
<p>当创建复杂对象的算法应该独立于该对象的组成部分以及它们的装配方式时。</p>
<p>当构造过程必须允许被构造的对象有不同的表示时。</p>
<p><img src="/images/824579-20160928195334656-2085921203.gif" alt="img"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment">#coding:utf8</span></span><br><span class="line"> </span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Builder</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># Director</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Director</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.builder = <span class="literal">None</span></span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">construct_building</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.builder.new_building()</span><br><span class="line">        self.builder.build_floor()</span><br><span class="line">        self.builder.build_size()</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_building</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.builder.building</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment"># Abstract Builder</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Builder</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.building = <span class="literal">None</span></span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">new_building</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.building = Building()</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment"># Concrete Builder</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BuilderHouse</span>(<span class="params">Builder</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">build_floor</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.building.floor = <span class="string">&#x27;One&#x27;</span></span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">build_size</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.building.size = <span class="string">&#x27;Big&#x27;</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BuilderFlat</span>(<span class="params">Builder</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">build_floor</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.building.floor = <span class="string">&#x27;More than One&#x27;</span></span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">build_size</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.building.size = <span class="string">&#x27;Small&#x27;</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment"># Product</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Building</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.floor = <span class="literal">None</span></span><br><span class="line">        self.size = <span class="literal">None</span></span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;Floor: %s | Size: %s&#x27;</span> % (self.floor, self.size)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment"># Client</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    director = Director()</span><br><span class="line">    director.builder = BuilderHouse()</span><br><span class="line">    director.construct_building()</span><br><span class="line">    building = director.get_building()</span><br><span class="line">    <span class="built_in">print</span>(building)</span><br><span class="line">    director.builder = BuilderFlat()</span><br><span class="line">    director.construct_building()</span><br><span class="line">    building = director.get_building()</span><br><span class="line">    <span class="built_in">print</span>(building)</span><br></pre></td></tr></table></figure>

<p>　　</p>
<h2 id="4-Prototype（原型）"><a href="#4-Prototype（原型）" class="headerlink" title="4. Prototype（原型）"></a>4. Prototype（原型）</h2><p><strong>意图：</strong></p>
<p>用原型实例指定创建对象的种类，并且通过拷贝这些原型创建新的对象。</p>
<p><strong>适用性：</strong></p>
<p>当要实例化的类是在运行时刻指定时，例如，通过动态装载；或者为了避免创建一个与产品类层次平行的工厂类层次时；或者当一个类的实例只能有几个不同状态组合中的一种时。建立相应数目的原型并克隆它们可能比每次用合适的状态手工实例化该类更方便一些。</p>
<p><img src="/images/824579-20160928194103188-1537654983.gif" alt="img"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment">#coding:utf8</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">Prototype</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> copy</span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Prototype</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        self._objects = &#123;&#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">register_object</span>(<span class="params">self, name, obj</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;Register an object&quot;&quot;&quot;</span></span><br><span class="line">        self._objects[name] = obj</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">unregister_object</span>(<span class="params">self, name</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;Unregister an object&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">del</span> self._objects[name]</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">clone</span>(<span class="params">self, name, **attr</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;Clone a registered object and update inner attributes dictionary&quot;&quot;&quot;</span></span><br><span class="line">        obj = copy.deepcopy(self._objects.get(name))</span><br><span class="line">        obj.__dict__.update(attr)</span><br><span class="line">        <span class="keyword">return</span> obj</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">A</span>:</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">__str__</span>(<span class="params">self</span>):</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;I am A&quot;</span></span><br><span class="line"> </span><br><span class="line">    a = A()</span><br><span class="line">    prototype = Prototype()</span><br><span class="line">    prototype.register_object(<span class="string">&#x27;a&#x27;</span>, a)</span><br><span class="line">    b = prototype.clone(<span class="string">&#x27;a&#x27;</span>, a=<span class="number">1</span>, b=<span class="number">2</span>, c=<span class="number">3</span>)</span><br><span class="line"> </span><br><span class="line">    <span class="built_in">print</span>(a)</span><br><span class="line">    <span class="built_in">print</span>(b.a, b.b, b.c)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<p>　　</p>
<h2 id="5-Singleton（单例）"><a href="#5-Singleton（单例）" class="headerlink" title="5. Singleton（单例）"></a>5. Singleton（单例）</h2><p><strong>意图：</strong></p>
<p>保证一个类仅有一个实例，并提供一个访问它的全局访问点。</p>
<p><strong>适用性：</strong></p>
<p>当类只能有一个实例而且客户可以从一个众所周知的访问点访问它时。</p>
<p>当这个唯一实例应该是通过子类化可扩展的，并且客户应该无需更改代码就能使用一个扩展的实例时。</p>
<p><img src="/images/824579-20160928194345281-610274391.gif" alt="img"></p>
<p>实现：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment">#coding:utf8</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">Singleton</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Singleton</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;&#x27;&#x27; A python style singleton &#x27;&#x27;&#x27;</span></span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__new__</span>(<span class="params">cls, *args, **kw</span>):</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">hasattr</span>(cls, <span class="string">&#x27;_instance&#x27;</span>):</span><br><span class="line">            org = <span class="built_in">super</span>(Singleton, cls)</span><br><span class="line">            cls._instance = org.__new__(cls, *args, **kw)</span><br><span class="line">        <span class="keyword">return</span> cls._instance</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">SingleSpam</span>(<span class="params">Singleton</span>):</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, s</span>):</span></span><br><span class="line">            self.s = s</span><br><span class="line"> </span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">__str__</span>(<span class="params">self</span>):</span></span><br><span class="line">            <span class="keyword">return</span> self.s</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">    s1 = SingleSpam(<span class="string">&#x27;spam&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span> <span class="built_in">id</span>(s1), s1</span><br><span class="line">    s2 = SingleSpam(<span class="string">&#x27;spa&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span> <span class="built_in">id</span>(s2), s2</span><br><span class="line">    <span class="built_in">print</span> <span class="built_in">id</span>(s1), s1</span><br></pre></td></tr></table></figure>

<p>　　</p>
<h1 id="结构型"><a href="#结构型" class="headerlink" title="结构型"></a>结构型</h1><h2 id="6-Adapter-Class-Object（适配器）"><a href="#6-Adapter-Class-Object（适配器）" class="headerlink" title="6. Adapter Class/Object（适配器）"></a>6. Adapter Class/Object（适配器）</h2><p><img src="/images/824579-20160930081507250-268482079.gif" alt="img"></p>
<p><strong>意图：</strong></p>
<p> 将一个类的接口转换成客户希望的另外一个接口。Adapter 模式使得原本由于接口不兼容而不能一起工作的那些类可以一起工作。 </p>
<p><strong>适用性：</strong></p>
<p> 你想使用一个已经存在的类，而它的接口不符合你的需求。</p>
<p>你想创建一个可以复用的类，该类可以与其他不相关的类或不可预见的类（即那些接口可能不一定兼容的类）协同工作。</p>
<p>（仅适用于对象Adapter ）你想使用一些已经存在的子类，但是不可能对每一个都进行子类化以匹配它们的接口。对象适配器可以适配它的父类接口。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment">#coding:utf8</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">Adapter</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dog</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.name = <span class="string">&quot;Dog&quot;</span></span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">bark</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;woof!&quot;</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Cat</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.name = <span class="string">&quot;Cat&quot;</span></span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">meow</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;meow!&quot;</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Human</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.name = <span class="string">&quot;Human&quot;</span></span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">speak</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&#x27;hello&#x27;&quot;</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Car</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.name = <span class="string">&quot;Car&quot;</span></span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">make_noise</span>(<span class="params">self, octane_level</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;vroom%s&quot;</span> % (<span class="string">&quot;!&quot;</span> * octane_level)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Adapter</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Adapts an object by replacing methods.</span></span><br><span class="line"><span class="string">    Usage:</span></span><br><span class="line"><span class="string">    dog = Dog</span></span><br><span class="line"><span class="string">    dog = Adapter(dog, dict(make_noise=dog.bark))</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, obj, adapted_methods</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;We set the adapted methods in the object&#x27;s dict&quot;&quot;&quot;</span></span><br><span class="line">        self.obj = obj</span><br><span class="line">        self.__dict__.update(adapted_methods)</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__getattr__</span>(<span class="params">self, attr</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;All non-adapted calls are passed to the object&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">getattr</span>(self.obj, attr)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    objects = []</span><br><span class="line">    dog = Dog()</span><br><span class="line">    objects.append(Adapter(dog, <span class="built_in">dict</span>(make_noise=dog.bark)))</span><br><span class="line">    cat = Cat()</span><br><span class="line">    objects.append(Adapter(cat, <span class="built_in">dict</span>(make_noise=cat.meow)))</span><br><span class="line">    human = Human()</span><br><span class="line">    objects.append(Adapter(human, <span class="built_in">dict</span>(make_noise=human.speak)))</span><br><span class="line">    car = Car()</span><br><span class="line">    car_noise = <span class="keyword">lambda</span>: car.make_noise(<span class="number">3</span>)</span><br><span class="line">    objects.append(Adapter(car, <span class="built_in">dict</span>(make_noise=car_noise)))</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">for</span> obj <span class="keyword">in</span> objects:</span><br><span class="line">        <span class="built_in">print</span> <span class="string">&quot;A&quot;</span>, obj.name, <span class="string">&quot;goes&quot;</span>, obj.make_noise()</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<p>　　</p>
<h2 id="7-Bridge（桥接）"><a href="#7-Bridge（桥接）" class="headerlink" title="7. Bridge（桥接）"></a>7. Bridge（桥接）</h2><p><img src="/images/824579-20160930082905203-1507021924.gif" alt="img"></p>
<p>意图：</p>
<p> 将抽象部分与它的实现部分分离，使它们都可以独立地变化。</p>
<p> 适用性：</p>
<p> 你不希望在抽象和它的实现部分之间有一个固定的绑定关系。例如这种情况可能是因为，在程序运行时刻实现部分应可以被选择或者切换。</p>
<p> 类的抽象以及它的实现都应该可以通过生成子类的方法加以扩充。这时Bridge模式使你可以对不同的抽象接口和实现部分进行组合，并分别对它们进行扩充。</p>
<p> 对一个抽象的实现部分的修改应对客户不产生影响，即客户的代码不必重新编译。</p>
<p> （C++）你想对客户完全隐藏抽象的实现部分。在C++中，类的表示在类接口中是可见的。</p>
<p> 有许多类要生成。这样一种类层次结构说明你必须将一个对象分解成两个部分。Rumbaugh 称这种类层次结构为“嵌套的普化”（nested generalizations ）。</p>
<p> 你想在多个对象间共享实现（可能使用引用计数），但同时要求客户并不知道这一点。一个简单的例子便是Coplien 的String 类[ Cop92 ]，在这个类中多个对象可以共享同一个字符串表示（StringRep）。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment">#coding:utf8</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">Bridge</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment"># ConcreteImplementor 1/2</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DrawingAPI1</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">draw_circle</span>(<span class="params">self, x, y, radius</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;API1.circle at &#123;&#125;:&#123;&#125; radius &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(x, y, radius))</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment"># ConcreteImplementor 2/2</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DrawingAPI2</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">draw_circle</span>(<span class="params">self, x, y, radius</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;API2.circle at &#123;&#125;:&#123;&#125; radius &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(x, y, radius))</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment"># Refined Abstraction</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CircleShape</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, x, y, radius, drawing_api</span>):</span></span><br><span class="line">        self._x = x</span><br><span class="line">        self._y = y</span><br><span class="line">        self._radius = radius</span><br><span class="line">        self._drawing_api = drawing_api</span><br><span class="line"> </span><br><span class="line">    <span class="comment"># low-level i.e. Implementation specific</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">draw</span>(<span class="params">self</span>):</span></span><br><span class="line">        self._drawing_api.draw_circle(self._x, self._y, self._radius)</span><br><span class="line"> </span><br><span class="line">    <span class="comment"># high-level i.e. Abstraction specific</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">scale</span>(<span class="params">self, pct</span>):</span></span><br><span class="line">        self._radius *= pct</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    shapes = (</span><br><span class="line">        CircleShape(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, DrawingAPI1()),</span><br><span class="line">        CircleShape(<span class="number">5</span>, <span class="number">7</span>, <span class="number">11</span>, DrawingAPI2())</span><br><span class="line">    )</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">for</span> shape <span class="keyword">in</span> shapes:</span><br><span class="line">        shape.scale(<span class="number">2.5</span>)</span><br><span class="line">        shape.draw()</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<p>　　</p>
<h2 id="8-Composite（组合）"><a href="#8-Composite（组合）" class="headerlink" title="8. Composite（组合）"></a>8. Composite（组合）</h2><p><img src="/images/824579-20160930112848610-861983607.gif" alt="img"></p>
<p><strong>意图：</strong></p>
<p> 将对象组合成树形结构以表示“部分-整体”的层次结构。C o m p o s i t e 使得用户对单个对象和组合对象的使用具有一致性。 </p>
<p><strong>适用性：</strong></p>
<p> 你想表示对象的部分-整体层次结构。</p>
<p>你希望用户忽略组合对象与单个对象的不同，用户将统一地使用组合结构中的所有对象。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment">#coding:utf8</span></span><br><span class="line"> </span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">Composite</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Component</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self,strName</span>):</span></span><br><span class="line">        self.m_strName = strName</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">Add</span>(<span class="params">self,com</span>):</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">Display</span>(<span class="params">self,nDepth</span>):</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Leaf</span>(<span class="params">Component</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">Add</span>(<span class="params">self,com</span>):</span></span><br><span class="line">        <span class="built_in">print</span> <span class="string">&quot;leaf can&#x27;t add&quot;</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">Display</span>(<span class="params">self,nDepth</span>):</span></span><br><span class="line">        strtemp = <span class="string">&quot;-&quot;</span> * nDepth</span><br><span class="line">        strtemp=strtemp+self.m_strName</span><br><span class="line">        <span class="built_in">print</span> strtemp</span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Composite</span>(<span class="params">Component</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self,strName</span>):</span></span><br><span class="line">        self.m_strName = strName</span><br><span class="line">        self.c = []</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">Add</span>(<span class="params">self,com</span>):</span></span><br><span class="line">        self.c.append(com)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">Display</span>(<span class="params">self,nDepth</span>):</span></span><br><span class="line">        strtemp = <span class="string">&quot;-&quot;</span>*nDepth</span><br><span class="line">        strtemp=strtemp+self.m_strName</span><br><span class="line">        <span class="built_in">print</span> strtemp</span><br><span class="line">        <span class="keyword">for</span> com <span class="keyword">in</span> self.c:</span><br><span class="line">            com.Display(nDepth+<span class="number">2</span>)</span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    p = Composite(<span class="string">&quot;Wong&quot;</span>)</span><br><span class="line">    p.Add(Leaf(<span class="string">&quot;Lee&quot;</span>))</span><br><span class="line">    p.Add(Leaf(<span class="string">&quot;Zhao&quot;</span>))</span><br><span class="line">    p1 = Composite(<span class="string">&quot;Wu&quot;</span>)</span><br><span class="line">    p1.Add(Leaf(<span class="string">&quot;San&quot;</span>))</span><br><span class="line">    p.Add(p1)</span><br><span class="line">    p.Display(<span class="number">1</span>);</span><br></pre></td></tr></table></figure>

<p>　　</p>
<h2 id="9-Decorator（装饰）"><a href="#9-Decorator（装饰）" class="headerlink" title="9. Decorator（装饰）"></a>9. Decorator（装饰）</h2><p><img src="/images/824579-20160930115007891-1984670176.gif" alt="img"></p>
<p>**意图：<br>**动态地给一个对象添加一些额外的职责。就增加功能来说，Decorator 模式相比生成子类更为灵活。<br><strong>适用性：</strong></p>
<p> 在不影响其他对象的情况下，以动态、透明的方式给单个对象添加职责。</p>
<p> 处理那些可以撤消的职责。</p>
<p>当不能采用生成子类的方法进行扩充时。一种情况是，可能有大量独立的扩展，为支持每一种组合将产生大量的子类，使得子类数目呈爆炸性增长。另一种情况可能是因为类定义被隐藏，或类定义不能用于生成子类。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment">#coding:utf8</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">Decorator</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">foo</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">f1</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;original f1&quot;</span>)</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">f2</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;original f2&quot;</span>)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">foo_decorator</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, decoratee</span>):</span></span><br><span class="line">        self._decoratee = decoratee</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">f1</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;decorated f1&quot;</span>)</span><br><span class="line">        self._decoratee.f1()</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__getattr__</span>(<span class="params">self, name</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">getattr</span>(self._decoratee, name)</span><br><span class="line"> </span><br><span class="line">u = foo()</span><br><span class="line">v = foo_decorator(u)</span><br><span class="line">v.f1()</span><br><span class="line">v.f2()</span><br></pre></td></tr></table></figure>

<p>　　</p>
<h2 id="10-Facade（外观）"><a href="#10-Facade（外观）" class="headerlink" title="10. Facade（外观）"></a>10. Facade（外观）</h2><p><img src="/images/824579-20161001085208891-1109181708.gif" alt="img"></p>
<p><strong>意图：</strong></p>
<p> 为子系统中的一组接口提供一个一致的界面，Facade模式定义了一个高层接口，这个接口使得这一子系统更加容易使用。</p>
<p><strong>适用性：</strong></p>
<p>当你要为一个复杂子系统提供一个简单接口时。子系统往往因为不断演化而变得越来越复杂。大多数模式使用时都会产生更多更小的类。这使得子系统更具可重用性，也更容易对子系统进行定制，但这也给那些不需要定制子系统的用户带来一些使用上的困难。Facade 可以提供一个简单的缺省视图，这一视图对大多数用户来说已经足够，而那些需要更多的可定制性的用户可以越过facade层。</p>
<p>客户程序与抽象类的实现部分之间存在着很大的依赖性。引入facade 将这个子系统与客户以及其他的子系统分离，可以提高子系统的独立性和可移植性。</p>
<p>当你需要构建一个层次结构的子系统时，使用facade模式定义子系统中每层的入口点。如果子系统之间是相互依赖的，你可以让它们仅通过facade进行通讯，从而简化了它们之间的依赖关系。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment">#coding:utf8</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">Decorator</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"> </span><br><span class="line">SLEEP = <span class="number">0.5</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># Complex Parts</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TC1</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;###### In Test 1 ######&quot;</span>)</span><br><span class="line">        time.sleep(SLEEP)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Setting up&quot;</span>)</span><br><span class="line">        time.sleep(SLEEP)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Running test&quot;</span>)</span><br><span class="line">        time.sleep(SLEEP)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Tearing down&quot;</span>)</span><br><span class="line">        time.sleep(SLEEP)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Test Finished\n&quot;</span>)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TC2</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;###### In Test 2 ######&quot;</span>)</span><br><span class="line">        time.sleep(SLEEP)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Setting up&quot;</span>)</span><br><span class="line">        time.sleep(SLEEP)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Running test&quot;</span>)</span><br><span class="line">        time.sleep(SLEEP)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Tearing down&quot;</span>)</span><br><span class="line">        time.sleep(SLEEP)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Test Finished\n&quot;</span>)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TC3</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">run</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;###### In Test 3 ######&quot;</span>)</span><br><span class="line">        time.sleep(SLEEP)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Setting up&quot;</span>)</span><br><span class="line">        time.sleep(SLEEP)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Running test&quot;</span>)</span><br><span class="line">        time.sleep(SLEEP)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Tearing down&quot;</span>)</span><br><span class="line">        time.sleep(SLEEP)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Test Finished\n&quot;</span>)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment"># Facade</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestRunner</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.tc1 = TC1()</span><br><span class="line">        self.tc2 = TC2()</span><br><span class="line">        self.tc3 = TC3()</span><br><span class="line">        self.tests = [i <span class="keyword">for</span> i <span class="keyword">in</span> (self.tc1, self.tc2, self.tc3)]</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">runAll</span>(<span class="params">self</span>):</span></span><br><span class="line">        [i.run() <span class="keyword">for</span> i <span class="keyword">in</span> self.tests]</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment"># Client</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    testrunner = TestRunner()</span><br><span class="line">    testrunner.runAll()</span><br></pre></td></tr></table></figure>

<p>　　</p>
<h2 id="11-Flyweight（享元）"><a href="#11-Flyweight（享元）" class="headerlink" title="11. Flyweight（享元）"></a>11. Flyweight（享元）</h2><p><img src="/images/824579-20161001085622719-40480507.gif" alt="img"></p>
<p><strong>意图：</strong></p>
<p>运用共享技术有效地支持大量细粒度的对象。</p>
<p><strong>适用性：</strong></p>
<p>一个应用程序使用了大量的对象。</p>
<p>完全由于使用大量的对象，造成很大的存储开销。</p>
<p>对象的大多数状态都可变为外部状态。</p>
<p>如果删除对象的外部状态，那么可以用相对较少的共享对象取代很多组对象。 </p>
<p>应用程序不依赖于对象标识。由于Flyweight 对象可以被共享，对于概念上明显有别的对象，标识测试将返回真值。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment">#coding:utf8</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">Flyweight</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> weakref </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Card</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;The object pool. Has builtin reference counting&quot;&quot;&quot;</span></span><br><span class="line">    _CardPool = weakref.WeakValueDictionary()</span><br><span class="line"> </span><br><span class="line">    <span class="string">&quot;&quot;&quot;Flyweight implementation. If the object exists in the</span></span><br><span class="line"><span class="string">    pool just return it (instead of creating a new one)&quot;&quot;&quot;</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__new__</span>(<span class="params">cls, value, suit</span>):</span>        </span><br><span class="line">        obj = Card._CardPool.get(value + suit, <span class="literal">None</span>)        </span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> obj:            </span><br><span class="line">            obj = <span class="built_in">object</span>.__new__(cls)            </span><br><span class="line">            Card._CardPool[value + suit] = obj            </span><br><span class="line">            obj.value, obj.suit = value, suit         </span><br><span class="line">        <span class="keyword">return</span> obj</span><br><span class="line"> </span><br><span class="line">    <span class="comment"># def __init__(self, value, suit):        </span></span><br><span class="line">    <span class="comment">#     self.value, self.suit = value, suit     </span></span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span>(<span class="params">self</span>):</span>        </span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&lt;Card: %s%s&gt;&quot;</span> % (self.value, self.suit)     </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="comment"># comment __new__ and uncomment __init__ to see the difference</span></span><br><span class="line">    c1 = Card(<span class="string">&#x27;9&#x27;</span>, <span class="string">&#x27;h&#x27;</span>)</span><br><span class="line">    c2 = Card(<span class="string">&#x27;9&#x27;</span>, <span class="string">&#x27;h&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(c1, c2)</span><br><span class="line">    <span class="built_in">print</span>(c1 == c2)</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">id</span>(c1), <span class="built_in">id</span>(c2))</span><br></pre></td></tr></table></figure>

<p>　　</p>
<h2 id="12-Proxy（代理）"><a href="#12-Proxy（代理）" class="headerlink" title="12. Proxy（代理）"></a>12. Proxy（代理）</h2><p><img src="/images/824579-20161001085925641-1480548759.gif" alt="img"></p>
<p><strong>意图：</strong></p>
<p>为其他对象提供一种代理以控制对这个对象的访问。</p>
<p><strong>适用性：</strong></p>
<p> 在需要用比较通用和复杂的对象指针代替简单的指针的时候，使用Proxy模式。下面是一 些可以使用Proxy 模式常见情况： </p>
<ol>
<li>远程代理（Remote Proxy ）为一个对象在不同的地址空间提供局部代表。 NEXTSTEP[Add94] 使用NXProxy 类实现了这一目的。Coplien[Cop92] 称这种代理为“大使” （Ambassador ）。<br>2 )虚代理（Virtual Proxy ）根据需要创建开销很大的对象。在动机一节描述的ImageProxy 就是这样一种代理的例子。 </li>
<li>保护代理（Protection Proxy ）控制对原始对象的访问。保护代理用于对象应该有不同 的访问权限的时候。例如，在Choices 操作系统[ CIRM93]中KemelProxies为操作系统对象提供 了访问保护。<br>4 )智能指引（Smart Reference ）取代了简单的指针，它在访问对象时执行一些附加操作。 它的典型用途包括：对指向实际对象的引用计数，这样当该对象没有引用时，可以自动释放它(也称为SmartPointers[Ede92 ] )。</li>
</ol>
<p> 当第一次引用一个持久对象时，将它装入内存。</p>
<p> 在访问一个实际对象前，检查是否已经锁定了它，以确保其他对象不能改变它。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment">#coding:utf8</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">Proxy</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SalesManager</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">work</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Sales Manager working...&quot;</span>)</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">talk</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Sales Manager ready to talk&quot;</span>)</span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Proxy</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.busy = <span class="string">&#x27;No&#x27;</span></span><br><span class="line">        self.sales = <span class="literal">None</span></span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">work</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Proxy checking for Sales Manager availability&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> self.busy == <span class="string">&#x27;No&#x27;</span>:</span><br><span class="line">            self.sales = SalesManager()</span><br><span class="line">            time.sleep(<span class="number">2</span>)</span><br><span class="line">            self.sales.talk()</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            time.sleep(<span class="number">2</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Sales Manager is busy&quot;</span>)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    p = Proxy()</span><br><span class="line">    p.work()</span><br><span class="line">    p.busy = <span class="string">&#x27;Yes&#x27;</span></span><br><span class="line">    p.work()</span><br></pre></td></tr></table></figure>

<p>　　</p>
<h1 id="行为型"><a href="#行为型" class="headerlink" title="行为型"></a>行为型</h1><h2 id="13-Interpreter（解释器）"><a href="#13-Interpreter（解释器）" class="headerlink" title="13. Interpreter（解释器）"></a>13. Interpreter（解释器）</h2><p><img src="/images/824579-20161001090812703-551743707.gif" alt="img"></p>
<p><strong>意图：</strong></p>
<p>给定一个语言，定义它的文法的一种表示，并定义一个解释器，这个解释器使用该表示来解释语言中的句子。</p>
<p><strong>适用性：</strong></p>
<p>当有一个语言需要解释执行, 并且你可将该语言中的句子表示为一个抽象语法树时，可使用解释器模式。而当存在以下情况时该模式效果最好：</p>
<p>该文法简单对于复杂的文法, 文法的类层次变得庞大而无法管理。此时语法分析程序生成器这样的工具是更好的选择。它们无需构建抽象语法树即可解释表达式, 这样可以节省空间而且还可能节省时间。</p>
<p>效率不是一个关键问题最高效的解释器通常不是通过直接解释语法分析树实现的, 而是首先将它们转换成另一种形式。例如，正则表达式通常被转换成状态机。但即使在这种情况下, 转换器仍可用解释器模式实现, 该模式仍是有用的。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment">#coding:utf8</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">Interpreter</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Context</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.<span class="built_in">input</span>=<span class="string">&quot;&quot;</span></span><br><span class="line">        self.output=<span class="string">&quot;&quot;</span></span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AbstractExpression</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">Interpret</span>(<span class="params">self,context</span>):</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Expression</span>(<span class="params">AbstractExpression</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">Interpret</span>(<span class="params">self,context</span>):</span></span><br><span class="line">        <span class="built_in">print</span> <span class="string">&quot;terminal interpret&quot;</span></span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NonterminalExpression</span>(<span class="params">AbstractExpression</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">Interpret</span>(<span class="params">self,context</span>):</span></span><br><span class="line">        <span class="built_in">print</span> <span class="string">&quot;Nonterminal interpret&quot;</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    context= <span class="string">&quot;&quot;</span></span><br><span class="line">    c = []</span><br><span class="line">    c = c + [Expression()]</span><br><span class="line">    c = c + [NonterminalExpression()]</span><br><span class="line">    c = c + [Expression()]</span><br><span class="line">    c = c + [Expression()]</span><br><span class="line">    <span class="keyword">for</span> a <span class="keyword">in</span> c:</span><br><span class="line">        a.Interpret(context)</span><br></pre></td></tr></table></figure>

<p>　　</p>
<h2 id="14-Template-Method（模板方法）"><a href="#14-Template-Method（模板方法）" class="headerlink" title="14. Template Method（模板方法）"></a>14. Template Method（模板方法）</h2><p><img src="/images/824579-20161001091921547-1734506577.gif" alt="img"></p>
<p><strong>意图：</strong></p>
<p>定义一个操作中的算法的骨架，而将一些步骤延迟到子类中。TemplateMethod 使得子类可以不改变一个算法的结构即可重定义该算法的某些特定步骤。</p>
<p><strong>适用性：</strong></p>
<p>一次性实现一个算法的不变的部分，并将可变的行为留给子类来实现。</p>
<p>各子类中公共的行为应被提取出来并集中到一个公共父类中以避免代码重复。这是Opdyke 和Johnson所描述过的“重分解以一般化”的一个很好的例子[ OJ93 ]。首先识别现有代码中的不同之处，并且将不同之处分离为新的操作。最后，用一个调用这些新的操作的模板方法来替换这些不同的代码。</p>
<p>控制子类扩展。模板方法只在特定点调用“hook ”操作（参见效果一节），这样就只允许在这些点进行扩展。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment">#coding:utf8</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">Template Method</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"> </span><br><span class="line">ingredients = <span class="string">&quot;spam eggs apple&quot;</span></span><br><span class="line">line = <span class="string">&#x27;-&#x27;</span> * <span class="number">10</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># Skeletons</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">iter_elements</span>(<span class="params">getter, action</span>):</span>    </span><br><span class="line">    <span class="string">&quot;&quot;&quot;Template skeleton that iterates items&quot;&quot;&quot;</span>     </span><br><span class="line">    <span class="keyword">for</span> element <span class="keyword">in</span> getter():        </span><br><span class="line">        action(element)    </span><br><span class="line">        <span class="built_in">print</span>(line) </span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">rev_elements</span>(<span class="params">getter, action</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;Template skeleton that iterates items in reverse order&quot;&quot;&quot;</span>     </span><br><span class="line">    <span class="keyword">for</span> element <span class="keyword">in</span> getter()[::-<span class="number">1</span>]:        </span><br><span class="line">        action(element)    </span><br><span class="line">        <span class="built_in">print</span>(line) </span><br><span class="line"> </span><br><span class="line"><span class="comment"># Getters</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_list</span>():</span>    </span><br><span class="line">    <span class="keyword">return</span> ingredients.split() </span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_lists</span>():</span></span><br><span class="line">    <span class="keyword">return</span> [<span class="built_in">list</span>(x) <span class="keyword">for</span> x <span class="keyword">in</span> ingredients.split()] </span><br><span class="line"> </span><br><span class="line"><span class="comment"># Actions</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">print_item</span>(<span class="params">item</span>):</span>    </span><br><span class="line">    <span class="built_in">print</span>(item) </span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">reverse_item</span>(<span class="params">item</span>):</span></span><br><span class="line">    <span class="built_in">print</span>(item[::-<span class="number">1</span>]) </span><br><span class="line"> </span><br><span class="line"><span class="comment"># Makes templates</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">make_template</span>(<span class="params">skeleton, getter, action</span>):</span>    </span><br><span class="line">    <span class="string">&quot;&quot;&quot;Instantiate a template method with getter and action&quot;&quot;&quot;</span>    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">template</span>():</span>        </span><br><span class="line">        skeleton(getter, action)    </span><br><span class="line">    <span class="keyword">return</span> template </span><br><span class="line"> </span><br><span class="line"><span class="comment"># Create our template functions</span></span><br><span class="line">templates = [make_template(s, g, a)             </span><br><span class="line">             <span class="keyword">for</span> g <span class="keyword">in</span> (get_list, get_lists)             </span><br><span class="line">             <span class="keyword">for</span> a <span class="keyword">in</span> (print_item, reverse_item)             </span><br><span class="line">             <span class="keyword">for</span> s <span class="keyword">in</span> (iter_elements, rev_elements)] </span><br><span class="line"> </span><br><span class="line"><span class="comment"># Execute them</span></span><br><span class="line"><span class="keyword">for</span> template <span class="keyword">in</span> templates:    </span><br><span class="line">    template()</span><br></pre></td></tr></table></figure>

<p>　　</p>
<h2 id="15-Chain-of-Responsibility（责任链）"><a href="#15-Chain-of-Responsibility（责任链）" class="headerlink" title="15. Chain of Responsibility（责任链）"></a>15. Chain of Responsibility（责任链）</h2><p><img src="/images/824579-20161001092311094-692760233.gif" alt="img"></p>
<p><strong>意图：</strong></p>
<p> 使多个对象都有机会处理请求，从而避免请求的发送者和接收者之间的耦合关系。将这些对象连成一条链，并沿着这条链传递该请求，直到有一个对象处理它为止。</p>
<p> <strong>适用性：</strong></p>
<p> 有多个的对象可以处理一个请求，哪个对象处理该请求运行时刻自动确定。</p>
<p> 你想在不明确指定接收者的情况下，向多个对象中的一个提交一个请求。</p>
<p> 可处理一个请求的对象集合应被动态指定。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment">#coding:utf8</span></span><br><span class="line"> </span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">Chain</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Handler</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">successor</span>(<span class="params">self, successor</span>):</span></span><br><span class="line">        self.successor = successor</span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteHandler1</span>(<span class="params">Handler</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">handle</span>(<span class="params">self, request</span>):</span></span><br><span class="line">        <span class="keyword">if</span> request &gt; <span class="number">0</span> <span class="keyword">and</span> request &lt;= <span class="number">10</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;in handler1&quot;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.successor.handle(request)</span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteHandler2</span>(<span class="params">Handler</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">handle</span>(<span class="params">self, request</span>):</span></span><br><span class="line">        <span class="keyword">if</span> request &gt; <span class="number">10</span> <span class="keyword">and</span> request &lt;= <span class="number">20</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;in handler2&quot;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.successor.handle(request)</span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConcreteHandler3</span>(<span class="params">Handler</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">handle</span>(<span class="params">self, request</span>):</span></span><br><span class="line">        <span class="keyword">if</span> request &gt; <span class="number">20</span> <span class="keyword">and</span> request &lt;= <span class="number">30</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;in handler3&quot;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;end of chain, no handler for &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(request))</span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Client</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        h1 = ConcreteHandler1()</span><br><span class="line">        h2 = ConcreteHandler2()</span><br><span class="line">        h3 = ConcreteHandler3()</span><br><span class="line"> </span><br><span class="line">        h1.successor(h2)</span><br><span class="line">        h2.successor(h3)</span><br><span class="line"> </span><br><span class="line">        requests = [<span class="number">2</span>, <span class="number">5</span>, <span class="number">14</span>, <span class="number">22</span>, <span class="number">18</span>, <span class="number">3</span>, <span class="number">35</span>, <span class="number">27</span>, <span class="number">20</span>]</span><br><span class="line">        <span class="keyword">for</span> request <span class="keyword">in</span> requests:</span><br><span class="line">            h1.handle(request)</span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    client = Client()</span><br></pre></td></tr></table></figure>

<p>　　</p>
<h2 id="16-Command（命令）"><a href="#16-Command（命令）" class="headerlink" title="16. Command（命令）"></a>16. Command（命令）</h2><p><img src="/images/824579-20161001093244063-1060485648.gif" alt="img"></p>
<p><strong>意图：</strong></p>
<p>将一个请求封装为一个对象，从而使你可用不同的请求对客户进行参数化；对请求排队或记录请求日志，以及支持可撤消的操作。</p>
<p><strong>适用性：</strong></p>
<p>抽象出待执行的动作以参数化某对象，你可用过程语言中的回调（call back）函数表达这种参数化机制。所谓回调函数是指函数先在某处注册，而它将在稍后某个需要的时候被调用。Command 模式是回调机制的一个面向对象的替代品。</p>
<p>在不同的时刻指定、排列和执行请求。一个Command对象可以有一个与初始请求无关的生存期。如果一个请求的接收者可用一种与地址空间无关的方式表达，那么就可将负责该请求的命令对象传送给另一个不同的进程并在那儿实现该请求。</p>
<p>支持取消操作。Command的Excute 操作可在实施操作前将状态存储起来，在取消操作时这个状态用来消除该操作的影响。Command 接口必须添加一个Unexecute操作，该操作取消上一次Execute调用的效果。执行的命令被存储在一个历史列表中。可通过向后和向前遍历这一列表并分别调用Unexecute和Execute来实现重数不限的“取消”和“重做”。</p>
<p>支持修改日志，这样当系统崩溃时，这些修改可以被重做一遍。在Command接口中添加装载操作和存储操作，可以用来保持变动的一个一致的修改日志。从崩溃中恢复的过程包括从磁盘中重新读入记录下来的命令并用Execute操作重新执行它们。</p>
<p>用构建在原语操作上的高层操作构造一个系统。这样一种结构在支持事务( transaction)的信息系统中很常见。一个事务封装了对数据的一组变动。Command模式提供了对事务进行建模的方法。Command有一个公共的接口，使得你可以用同一种方式调用所有的事务。同时使用该模式也易于添加新事务以扩展系统。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment">#coding:utf8</span></span><br><span class="line"> </span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">Command</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MoveFileCommand</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, src, dest</span>):</span></span><br><span class="line">        self.src = src</span><br><span class="line">        self.dest = dest</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">execute</span>(<span class="params">self</span>):</span></span><br><span class="line">        self()</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__call__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;renaming &#123;&#125; to &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(self.src, self.dest))</span><br><span class="line">        os.rename(self.src, self.dest)</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">undo</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;renaming &#123;&#125; to &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(self.dest, self.src))</span><br><span class="line">        os.rename(self.dest, self.src)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    command_stack = []</span><br><span class="line"> </span><br><span class="line">    <span class="comment"># commands are just pushed into the command stack</span></span><br><span class="line">    command_stack.append(MoveFileCommand(<span class="string">&#x27;foo.txt&#x27;</span>, <span class="string">&#x27;bar.txt&#x27;</span>))</span><br><span class="line">    command_stack.append(MoveFileCommand(<span class="string">&#x27;bar.txt&#x27;</span>, <span class="string">&#x27;baz.txt&#x27;</span>))</span><br><span class="line"> </span><br><span class="line">    <span class="comment"># they can be executed later on</span></span><br><span class="line">    <span class="keyword">for</span> cmd <span class="keyword">in</span> command_stack:</span><br><span class="line">        cmd.execute()</span><br><span class="line"> </span><br><span class="line">    <span class="comment"># and can also be undone at will</span></span><br><span class="line">    <span class="keyword">for</span> cmd <span class="keyword">in</span> <span class="built_in">reversed</span>(command_stack):</span><br><span class="line">        cmd.undo()</span><br></pre></td></tr></table></figure>

<p>　　</p>
<h2 id="17-Iterator（迭代器）"><a href="#17-Iterator（迭代器）" class="headerlink" title="17. Iterator（迭代器）"></a>17. Iterator（迭代器）</h2><p><img src="/images/824579-20161001094329172-309095903.gif" alt="img"></p>
<p><strong>意图：</strong></p>
<p>提供一种方法顺序访问一个聚合对象中各个元素, 而又不需暴露该对象的内部表示。</p>
<p><strong>适用性：</strong></p>
<p>访问一个聚合对象的内容而无需暴露它的内部表示。</p>
<p>支持对聚合对象的多种遍历。</p>
<p>为遍历不同的聚合结构提供一个统一的接口(即, 支持多态迭代)。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment">#coding:utf8</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">Interator</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">count_to</span>(<span class="params">count</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;Counts by word numbers, up to a maximum of five&quot;&quot;&quot;</span></span><br><span class="line">    numbers = [<span class="string">&quot;one&quot;</span>, <span class="string">&quot;two&quot;</span>, <span class="string">&quot;three&quot;</span>, <span class="string">&quot;four&quot;</span>, <span class="string">&quot;five&quot;</span>]</span><br><span class="line">    <span class="comment"># enumerate() returns a tuple containing a count (from start which</span></span><br><span class="line">    <span class="comment"># defaults to 0) and the values obtained from iterating over sequence</span></span><br><span class="line">    <span class="keyword">for</span> pos, number <span class="keyword">in</span> <span class="built_in">zip</span>(<span class="built_in">range</span>(count), numbers):</span><br><span class="line">        <span class="keyword">yield</span> number</span><br><span class="line"> </span><br><span class="line"><span class="comment"># Test the generator</span></span><br><span class="line">count_to_two = <span class="keyword">lambda</span>: count_to(<span class="number">2</span>)</span><br><span class="line">count_to_five = <span class="keyword">lambda</span>: count_to(<span class="number">5</span>)</span><br><span class="line"> </span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Counting to two...&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> number <span class="keyword">in</span> count_to_two():</span><br><span class="line">    <span class="built_in">print</span> number</span><br><span class="line"> </span><br><span class="line"><span class="built_in">print</span> <span class="string">&quot; &quot;</span></span><br><span class="line"> </span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;Counting to five...&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> number <span class="keyword">in</span> count_to_five():</span><br><span class="line">    <span class="built_in">print</span> number</span><br><span class="line"> </span><br><span class="line"><span class="built_in">print</span> <span class="string">&quot; &quot;</span></span><br></pre></td></tr></table></figure>

<p>　　</p>
<h2 id="18-Mediator（中介者）"><a href="#18-Mediator（中介者）" class="headerlink" title="18. Mediator（中介者）"></a>18. Mediator（中介者）</h2><p><img src="/images/824579-20161001094749000-380429958.gif" alt="img"></p>
<p><strong>意图：</strong></p>
<p>用一个中介对象来封装一系列的对象交互。中介者使各对象不需要显式地相互引用，从而使其耦合松散，而且可以独立地改变它们之间的交互。</p>
<p><strong>适用性：</strong></p>
<p>一组对象以定义良好但是复杂的方式进行通信。产生的相互依赖关系结构混乱且难以理解。</p>
<p>一个对象引用其他很多对象并且直接与这些对象通信,导致难以复用该对象。</p>
<p>想定制一个分布在多个类中的行为，而又不想生成太多的子类。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment">#coding:utf8</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">Mediator</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;http://dpip.testingperspective.com/?p=28&quot;&quot;&quot;</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TC</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        self._tm = tm</span><br><span class="line">        self._bProblem = <span class="number">0</span></span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setup</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Setting up the Test&quot;</span>)</span><br><span class="line">        time.sleep(<span class="number">1</span>)</span><br><span class="line">        self._tm.prepareReporting()</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">execute</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> self._bProblem:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Executing the test&quot;</span>)</span><br><span class="line">            time.sleep(<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Problem in setup. Test not executed.&quot;</span>)</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">tearDown</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> self._bProblem:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Tearing down&quot;</span>)</span><br><span class="line">            time.sleep(<span class="number">1</span>)</span><br><span class="line">            self._tm.publishReport()</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Test not executed. No tear down required.&quot;</span>)</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setTM</span>(<span class="params">self, TM</span>):</span></span><br><span class="line">        self._tm = tm</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setProblem</span>(<span class="params">self, value</span>):</span></span><br><span class="line">        self._bProblem = value</span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Reporter</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        self._tm = <span class="literal">None</span></span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">prepare</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Reporter Class is preparing to report the results&quot;</span>)</span><br><span class="line">        time.sleep(<span class="number">1</span>)</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">report</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Reporting the results of Test&quot;</span>)</span><br><span class="line">        time.sleep(<span class="number">1</span>)</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setTM</span>(<span class="params">self, TM</span>):</span></span><br><span class="line">        self._tm = tm</span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DB</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        self._tm = <span class="literal">None</span></span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">insert</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Inserting the execution begin status in the Database&quot;</span>)</span><br><span class="line">        time.sleep(<span class="number">1</span>)</span><br><span class="line">        <span class="comment">#Following code is to simulate a communication from DB to TC</span></span><br><span class="line">        <span class="keyword">import</span> random</span><br><span class="line">        <span class="keyword">if</span> random.randrange(<span class="number">1</span>, <span class="number">4</span>) == <span class="number">3</span>:</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span></span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">update</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Updating the test results in Database&quot;</span>)</span><br><span class="line">        time.sleep(<span class="number">1</span>)</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setTM</span>(<span class="params">self, TM</span>):</span></span><br><span class="line">        self._tm = tm</span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestManager</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        self._reporter = <span class="literal">None</span></span><br><span class="line">        self._db = <span class="literal">None</span></span><br><span class="line">        self._tc = <span class="literal">None</span></span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">prepareReporting</span>(<span class="params">self</span>):</span></span><br><span class="line">        rvalue = self._db.insert()</span><br><span class="line">        <span class="keyword">if</span> rvalue == -<span class="number">1</span>:</span><br><span class="line">            self._tc.setProblem(<span class="number">1</span>)</span><br><span class="line">            self._reporter.prepare()</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setReporter</span>(<span class="params">self, reporter</span>):</span></span><br><span class="line">        self._reporter = reporter</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setDB</span>(<span class="params">self, db</span>):</span></span><br><span class="line">        self._db = db</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">publishReport</span>(<span class="params">self</span>):</span></span><br><span class="line">        self._db.update()</span><br><span class="line">        rvalue = self._reporter.report()</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setTC</span>(<span class="params">self, tc</span>):</span></span><br><span class="line">        self._tc = tc</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    reporter = Reporter()</span><br><span class="line">    db = DB()</span><br><span class="line">    tm = TestManager()</span><br><span class="line">    tm.setReporter(reporter)</span><br><span class="line">    tm.setDB(db)</span><br><span class="line">    reporter.setTM(tm)</span><br><span class="line">    db.setTM(tm)</span><br><span class="line">    <span class="comment"># For simplification we are looping on the same test.</span></span><br><span class="line">    <span class="comment"># Practically, it could be about various unique test classes and their</span></span><br><span class="line">    <span class="comment"># objects</span></span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">True</span>):</span><br><span class="line">        tc = TC()</span><br><span class="line">        tc.setTM(tm)</span><br><span class="line">        tm.setTC(tc)</span><br><span class="line">        tc.setup()</span><br><span class="line">        tc.execute()</span><br><span class="line">        tc.tearDown()</span><br></pre></td></tr></table></figure>

<p>　　</p>
<h2 id="19-Memento（备忘录）"><a href="#19-Memento（备忘录）" class="headerlink" title="19. Memento（备忘录）"></a>19. Memento（备忘录）</h2><p><img src="/images/824579-20161001095443000-87266383.gif" alt="img"></p>
<p><strong>意图：</strong></p>
<p>在不破坏封装性的前提下，捕获一个对象的内部状态，并在该对象之外保存这个状态。这样以后就可将该对象恢复到原先保存的状态。</p>
<p><strong>适用性：</strong></p>
<p>必须保存一个对象在某一个时刻的(部分)状态, 这样以后需要时它才能恢复到先前的状态。</p>
<p>如果一个用接口来让其它对象直接得到这些状态，将会暴露对象的实现细节并破坏对象的封装性。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment">#coding:utf8</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">Memento</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> copy</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Memento</span>(<span class="params">obj, deep=<span class="literal">False</span></span>):</span></span><br><span class="line">    state = (copy.copy, copy.deepcopy)[<span class="built_in">bool</span>(deep)](obj.__dict__)</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">Restore</span>():</span></span><br><span class="line">        obj.__dict__.clear()</span><br><span class="line">        obj.__dict__.update(state)</span><br><span class="line">    <span class="keyword">return</span> Restore</span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Transaction</span>:</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;A transaction guard. This is really just</span></span><br><span class="line"><span class="string">      syntactic suggar arount a memento closure.</span></span><br><span class="line"><span class="string">      &quot;&quot;&quot;</span></span><br><span class="line">    deep = <span class="literal">False</span></span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, *targets</span>):</span></span><br><span class="line">        self.targets = targets</span><br><span class="line">        self.Commit()</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">Commit</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.states = [Memento(target, self.deep) <span class="keyword">for</span> target <span class="keyword">in</span> self.targets]</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">Rollback</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">for</span> st <span class="keyword">in</span> self.states:</span><br><span class="line">            st()</span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">transactional</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;Adds transactional semantics to methods. Methods decorated  with</span></span><br><span class="line"><span class="string">    @transactional will rollback to entry state upon exceptions.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, method</span>):</span></span><br><span class="line">        self.method = method</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__get__</span>(<span class="params">self, obj, T</span>):</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">transaction</span>(<span class="params">*args, **kwargs</span>):</span></span><br><span class="line">            state = Memento(obj)</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="keyword">return</span> self.method(obj, *args, **kwargs)</span><br><span class="line">            <span class="keyword">except</span>:</span><br><span class="line">                state()</span><br><span class="line">                <span class="keyword">raise</span></span><br><span class="line">        <span class="keyword">return</span> transaction</span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NumObj</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, value</span>):</span></span><br><span class="line">        self.value = value</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;&lt;%s: %r&gt;&#x27;</span> % (self.__class__.__name__, self.value)</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">Increment</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.value += <span class="number">1</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">    @transactional</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">DoStuff</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.value = <span class="string">&#x27;1111&#x27;</span>  <span class="comment"># &lt;- invalid value</span></span><br><span class="line">        self.Increment()     <span class="comment"># &lt;- will fail and rollback</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    n = NumObj(-<span class="number">1</span>)</span><br><span class="line">    <span class="built_in">print</span>(n)</span><br><span class="line">    t = Transaction(n)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">            n.Increment()</span><br><span class="line">            <span class="built_in">print</span>(n)</span><br><span class="line">        t.Commit()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;-- commited&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">            n.Increment()</span><br><span class="line">            <span class="built_in">print</span>(n)</span><br><span class="line">        n.value += <span class="string">&#x27;x&#x27;</span>  <span class="comment"># will fail</span></span><br><span class="line">        <span class="built_in">print</span>(n)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        t.Rollback()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;-- rolled back&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(n)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;-- now doing stuff ...&#x27;</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        n.DoStuff()</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;-&gt; doing stuff failed!&#x27;</span>)</span><br><span class="line">        <span class="keyword">import</span> traceback</span><br><span class="line">        traceback.print_exc(<span class="number">0</span>)</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="built_in">print</span>(n)</span><br></pre></td></tr></table></figure>

<h2 id="20-Observer（观察者）"><a href="#20-Observer（观察者）" class="headerlink" title="20. Observer（观察者）"></a>20. Observer（观察者）</h2><p><img src="/images/824579-20161001095725391-893775521.gif" alt="img"></p>
<p><strong>意图：</strong></p>
<p>定义对象间的一种一对多的依赖关系,当一个对象的状态发生改变时, 所有依赖于它的对象都得到通知并被自动更新。</p>
<p><strong>适用性：</strong></p>
<p>当一个抽象模型有两个方面, 其中一个方面依赖于另一方面。将这二者封装在独立的对象中以使它们可以各自独立地改变和复用。</p>
<p>当对一个对象的改变需要同时改变其它对象, 而不知道具体有多少对象有待改变。</p>
<p>当一个对象必须通知其它对象，而它又不能假定其它对象是谁。换言之, 你不希望这些对象是紧密耦合的。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment">#coding:utf8</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">Observer</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Subject</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        self._observers = []</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">attach</span>(<span class="params">self, observer</span>):</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> observer <span class="keyword">in</span> self._observers:</span><br><span class="line">            self._observers.append(observer)</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">detach</span>(<span class="params">self, observer</span>):</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            self._observers.remove(observer)</span><br><span class="line">        <span class="keyword">except</span> ValueError:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">notify</span>(<span class="params">self, modifier=<span class="literal">None</span></span>):</span></span><br><span class="line">        <span class="keyword">for</span> observer <span class="keyword">in</span> self._observers:</span><br><span class="line">            <span class="keyword">if</span> modifier != observer:</span><br><span class="line">                observer.update(self)</span><br><span class="line"> </span><br><span class="line"><span class="comment"># Example usage</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Data</span>(<span class="params">Subject</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name=<span class="string">&#x27;&#x27;</span></span>):</span></span><br><span class="line">        Subject.__init__(self)</span><br><span class="line">        self.name = name</span><br><span class="line">        self._data = <span class="number">0</span></span><br><span class="line"> </span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">data</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self._data</span><br><span class="line"> </span><br><span class="line"><span class="meta">    @data.setter</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">data</span>(<span class="params">self, value</span>):</span></span><br><span class="line">        self._data = value</span><br><span class="line">        self.notify()</span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HexViewer</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">update</span>(<span class="params">self, subject</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;HexViewer: Subject %s has data 0x%x&#x27;</span> %</span><br><span class="line">              (subject.name, subject.data))</span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DecimalViewer</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">update</span>(<span class="params">self, subject</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;DecimalViewer: Subject %s has data %d&#x27;</span> %</span><br><span class="line">              (subject.name, subject.data))</span><br><span class="line"> </span><br><span class="line"><span class="comment"># Example usage...</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    data1 = Data(<span class="string">&#x27;Data 1&#x27;</span>)</span><br><span class="line">    data2 = Data(<span class="string">&#x27;Data 2&#x27;</span>)</span><br><span class="line">    view1 = DecimalViewer()</span><br><span class="line">    view2 = HexViewer()</span><br><span class="line">    data1.attach(view1)</span><br><span class="line">    data1.attach(view2)</span><br><span class="line">    data2.attach(view2)</span><br><span class="line">    data2.attach(view1)</span><br><span class="line"> </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Setting Data 1 = 10&quot;</span>)</span><br><span class="line">    data1.data = <span class="number">10</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Setting Data 2 = 15&quot;</span>)</span><br><span class="line">    data2.data = <span class="number">15</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Setting Data 1 = 3&quot;</span>)</span><br><span class="line">    data1.data = <span class="number">3</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Setting Data 2 = 5&quot;</span>)</span><br><span class="line">    data2.data = <span class="number">5</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Detach HexViewer from data1 and data2.&quot;</span>)</span><br><span class="line">    data1.detach(view2)</span><br><span class="line">    data2.detach(view2)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Setting Data 1 = 10&quot;</span>)</span><br><span class="line">    data1.data = <span class="number">10</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Setting Data 2 = 15&quot;</span>)</span><br><span class="line">    data2.data = <span class="number">15</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

<p>　　</p>
<h2 id="21-State（状态）"><a href="#21-State（状态）" class="headerlink" title="21. State（状态）"></a>21. State（状态）</h2><p><img src="/images/824579-20161001100150906-852963744.gif" alt="img"></p>
<p><strong>意图：</strong></p>
<p> 允许一个对象在其内部状态改变时改变它的行为。对象看起来似乎修改了它的类。</p>
<p> <strong>适用性：</strong></p>
<p> 一个对象的行为取决于它的状态, 并且它必须在运行时刻根据状态改变它的行为。</p>
<p> 一个操作中含有庞大的多分支的条件语句，且这些分支依赖于该对象的状态。这个状态通常用一个或多个枚举常量表示。通常, 有多个操作包含这一相同的条件结构。State模式将每一个条件分支放入一个独立的类中。这使得你可以根据对象自身的情况将对象的状态作为一个对象，这一对象可以不依赖于其他对象而独立变化。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment">#coding:utf8</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">State</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">State</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;Base state. This is to share functionality&quot;&quot;&quot;</span></span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">scan</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;Scan the dial to the next station&quot;&quot;&quot;</span></span><br><span class="line">        self.pos += <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> self.pos == <span class="built_in">len</span>(self.stations):</span><br><span class="line">            self.pos = <span class="number">0</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Scanning... Station is&quot;</span>, self.stations[self.pos], self.name)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AmState</span>(<span class="params">State</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, radio</span>):</span></span><br><span class="line">        self.radio = radio</span><br><span class="line">        self.stations = [<span class="string">&quot;1250&quot;</span>, <span class="string">&quot;1380&quot;</span>, <span class="string">&quot;1510&quot;</span>]</span><br><span class="line">        self.pos = <span class="number">0</span></span><br><span class="line">        self.name = <span class="string">&quot;AM&quot;</span></span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">toggle_amfm</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Switching to FM&quot;</span>)</span><br><span class="line">        self.radio.state = self.radio.fmstate</span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FmState</span>(<span class="params">State</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, radio</span>):</span></span><br><span class="line">        self.radio = radio</span><br><span class="line">        self.stations = [<span class="string">&quot;81.3&quot;</span>, <span class="string">&quot;89.1&quot;</span>, <span class="string">&quot;103.9&quot;</span>]</span><br><span class="line">        self.pos = <span class="number">0</span></span><br><span class="line">        self.name = <span class="string">&quot;FM&quot;</span></span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">toggle_amfm</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Switching to AM&quot;</span>)</span><br><span class="line">        self.radio.state = self.radio.amstate</span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Radio</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;A radio.     It has a scan button, and an AM/FM toggle switch.&quot;&quot;&quot;</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;We have an AM state and an FM state&quot;&quot;&quot;</span></span><br><span class="line">        self.amstate = AmState(self)</span><br><span class="line">        self.fmstate = FmState(self)</span><br><span class="line">        self.state = self.amstate</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">toggle_amfm</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.state.toggle_amfm()</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">scan</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.state.scan()</span><br><span class="line"> </span><br><span class="line"><span class="comment"># Test our radio out</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    radio = Radio()</span><br><span class="line">    actions = [radio.scan] * <span class="number">2</span> + [radio.toggle_amfm] + [radio.scan] * <span class="number">2</span></span><br><span class="line">    actions = actions * <span class="number">2</span></span><br><span class="line"> </span><br><span class="line">    <span class="keyword">for</span> action <span class="keyword">in</span> actions:</span><br><span class="line">        action()</span><br></pre></td></tr></table></figure>

<p>　　</p>
<h2 id="22-Strategy（策略）"><a href="#22-Strategy（策略）" class="headerlink" title="22. Strategy（策略）"></a>22. Strategy（策略）</h2><p><img src="/images/824579-20161001100423828-707061510.gif" alt="img"></p>
<p><strong>意图：</strong></p>
<p> 定义一系列的算法,把它们一个个封装起来, 并且使它们可相互替换。本模式使得算法可独立于使用它的客户而变化。</p>
<p> <strong>适用性：</strong></p>
<p> 许多相关的类仅仅是行为有异。“策略”提供了一种用多个行为中的一个行为来配置一个类的方法。</p>
<p> 需要使用一个算法的不同变体。例如，你可能会定义一些反映不同的空间/时间权衡的算法。当这些变体实现为一个算法的类层次时[H087] ,可以使用策略模式。</p>
<p> 算法使用客户不应该知道的数据。可使用策略模式以避免暴露复杂的、与算法相关的数据结构。</p>
<p> 一个类定义了多种行为, 并且这些行为在这个类的操作中以多个条件语句的形式出现。将相关的条件分支移入它们各自的Strategy类中以代替这些条件语句。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment">#coding:utf8</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">Strategy</span></span><br><span class="line"><span class="string">In most of other languages Strategy pattern is implemented via creating some base strategy interface/abstract class and</span></span><br><span class="line"><span class="string">subclassing it with a number of concrete strategies (as we can see at http://en.wikipedia.org/wiki/Strategy_pattern),</span></span><br><span class="line"><span class="string">however Python supports higher-order functions and allows us to have only one class and inject functions into it&#x27;s</span></span><br><span class="line"><span class="string">instances, as shown in this example.</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">import</span> types</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StrategyExample</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, func=<span class="literal">None</span></span>):</span></span><br><span class="line">        self.name = <span class="string">&#x27;Strategy Example 0&#x27;</span>        </span><br><span class="line">        <span class="keyword">if</span> func <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            self.execute = types.MethodType(func, self)     </span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">execute</span>(<span class="params">self</span>):</span>        </span><br><span class="line">        <span class="built_in">print</span>(self.name)  </span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">execute_replacement1</span>(<span class="params">self</span>):</span></span><br><span class="line">    <span class="built_in">print</span>(self.name + <span class="string">&#x27; from execute 1&#x27;</span>)  </span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">execute_replacement2</span>(<span class="params">self</span>):</span></span><br><span class="line">    <span class="built_in">print</span>(self.name + <span class="string">&#x27; from execute 2&#x27;</span>) </span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    strat0 = StrategyExample()    </span><br><span class="line"> </span><br><span class="line">    strat1 = StrategyExample(execute_replacement1)</span><br><span class="line">    strat1.name = <span class="string">&#x27;Strategy Example 1&#x27;</span>    </span><br><span class="line"> </span><br><span class="line">    strat2 = StrategyExample(execute_replacement2)</span><br><span class="line">    strat2.name = <span class="string">&#x27;Strategy Example 2&#x27;</span></span><br><span class="line"> </span><br><span class="line">    strat0.execute()</span><br><span class="line">    strat1.execute()    </span><br><span class="line">    strat2.execute()</span><br></pre></td></tr></table></figure>

<p>　　</p>
<h2 id="23-Visitor（访问者）"><a href="#23-Visitor（访问者）" class="headerlink" title="23. Visitor（访问者）"></a>23. Visitor（访问者）</h2><p><img src="/images/824579-20161001100727844-1430710049.gif" alt="img"></p>
<p><strong>意图：</strong></p>
<p> 定义一个操作中的算法的骨架，而将一些步骤延迟到子类中。TemplateMethod 使得子类可以不改变一个算法的结构即可重定义该算法的某些特定步骤。</p>
<p> <strong>适用性：</strong></p>
<p> 一次性实现一个算法的不变的部分，并将可变的行为留给子类来实现。</p>
<p> 各子类中公共的行为应被提取出来并集中到一个公共父类中以避免代码重复。这是Opdyke和Johnson所描述过的“重分解以一般化”的一个很好的例子[OJ93]。首先识别现有代码中的不同之处，并且将不同之处分离为新的操作。最后，用一个调用这些新的操作的模板方法来替换这些不同的代码。</p>
<p> 控制子类扩展。模板方法只在特定点调用“hook ”操作（参见效果一节），这样就只允许在这些点进行扩展。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment">#coding:utf8</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">Visitor</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Node</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>(<span class="params">Node</span>):</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span>(<span class="params">Node</span>):</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span>(<span class="params">A, B</span>):</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Visitor</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">visit</span>(<span class="params">self, node, *args, **kwargs</span>):</span></span><br><span class="line">        meth = <span class="literal">None</span></span><br><span class="line">        <span class="keyword">for</span> cls <span class="keyword">in</span> node.__class__.__mro__:</span><br><span class="line">            meth_name = <span class="string">&#x27;visit_&#x27;</span>+cls.__name__</span><br><span class="line">            meth = <span class="built_in">getattr</span>(self, meth_name, <span class="literal">None</span>)</span><br><span class="line">            <span class="keyword">if</span> meth:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"> </span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> meth:</span><br><span class="line">            meth = self.generic_visit</span><br><span class="line">        <span class="keyword">return</span> meth(node, *args, **kwargs)</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">generic_visit</span>(<span class="params">self, node, *args, **kwargs</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;generic_visit &#x27;</span>+node.__class__.__name__)</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">visit_B</span>(<span class="params">self, node, *args, **kwargs</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;visit_B &#x27;</span>+node.__class__.__name__)</span><br><span class="line"> </span><br><span class="line">a = A()</span><br><span class="line">b = B()</span><br><span class="line">c = C()</span><br><span class="line">visitor = Visitor()</span><br><span class="line">visitor.visit(a)</span><br><span class="line">visitor.visit(b)</span><br><span class="line">visitor.visit(c)</span><br></pre></td></tr></table></figure>

<p>以上　　</p>
</div></div></article><link rel="stylesheet" type="text/css" href="/css/font.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.css"><script src="//cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script><script src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script>$(document).ready(function() {
  $(".fancybox").fancybox();
});
</script></body></html>
<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content=" id=&quot;ES-API&quot;&gt;&lt;a href=&quot;#ES-API&quot; class=&quot;headerlink&quot; title=&quot;ES API&quot;&gt;&lt;/a&gt;ES API&lt;/h2&gt;&lt;p&gt;以下示例使用&lt;code&gt;curl&lt;/code&gt;演示。"><link rel="stylesheet" type="text/css" href="/css/normalize.css"><link rel="stylesheet" type="text/css" href="/css/highlight.css"><link rel="stylesheet" type="text/css" href="/css/noise.css"><title>Elastic Search 搜索引擎详解 | 凉薄的自动书记人偶</title><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><meta name="generator" content="Hexo 5.4.0"></head><body><article class="wrapper"><div class="post-main"><div class="nav"><nav class="container"><a class="sidebar-nav-item active" href="/">Home</a></nav><div class="container post-meta"><div class="post-tags"><a class="post-tag-none-link" href="/tags/ElasticSearch/" rel="tag">ElasticSearch</a></div><div class="post-time">2021-03-17</div></div></div><div class="container post-header"><h1>Elastic Search 搜索引擎详解</h1></div><div class="container post-toc"><details class="toc"><summary class="toc-accordion">Table of Contents</summary><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#ES-API"><span class="toc-number">1.</span> <span class="toc-text">ES API</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E5%81%A5%E5%BA%B7%E7%8A%B6%E6%80%81"><span class="toc-number">1.1.</span> <span class="toc-text">查看健康状态</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E5%BD%93%E5%89%8Des%E9%9B%86%E7%BE%A4%E4%B8%AD%E6%89%80%E6%9C%89%E7%9A%84indices"><span class="toc-number">1.2.</span> <span class="toc-text">查询当前es集群中所有的indices</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E7%B4%A2%E5%BC%95"><span class="toc-number">1.3.</span> <span class="toc-text">创建索引</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E7%B4%A2%E5%BC%95"><span class="toc-number">1.4.</span> <span class="toc-text">删除索引</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8F%92%E5%85%A5%E8%AE%B0%E5%BD%95"><span class="toc-number">1.5.</span> <span class="toc-text">插入记录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A3%80%E7%B4%A2"><span class="toc-number">1.6.</span> <span class="toc-text">检索</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Go%E6%93%8D%E4%BD%9CElasticsearch"><span class="toc-number">2.</span> <span class="toc-text">Go操作Elasticsearch</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%80%92%E6%8E%92%E7%B4%A2%E5%BC%95"><span class="toc-number">3.</span> <span class="toc-text">倒排索引</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E6%9F%A5%E7%9C%8B"><span class="toc-number">4.</span> <span class="toc-text">简单查看</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E7%9A%84%E4%B8%A4%E7%A7%8D%E6%96%B9%E5%BC%8F"><span class="toc-number">5.</span> <span class="toc-text">查询的两种方式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E5%AD%97%E7%AC%A6%E4%B8%B2-query-string"><span class="toc-number">5.1.</span> <span class="toc-text">查询字符串(query string)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%93%E6%9E%84%E5%8C%96%E6%9F%A5%E8%AF%A2-Query-DSL"><span class="toc-number">5.2.</span> <span class="toc-text">结构化查询(Query DSL)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#term%E5%92%8Cmatch%E6%9F%A5%E8%AF%A2"><span class="toc-number">6.</span> <span class="toc-text">term和match查询</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#match"><span class="toc-number">6.1.</span> <span class="toc-text">match</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#match-all%EF%BC%88%E6%9F%A5%E8%AF%A2%E5%85%A8%E9%83%A8%EF%BC%89"><span class="toc-number">6.2.</span> <span class="toc-text">match_all（查询全部）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#match-phrase%EF%BC%88%E7%9F%AD%E8%AF%AD%E6%9F%A5%E8%AF%A2%EF%BC%89"><span class="toc-number">6.3.</span> <span class="toc-text">match_phrase（短语查询）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#match-phrase-prefix%EF%BC%88%E6%9C%80%E5%B7%A6%E5%89%8D%E7%BC%80%E6%9F%A5%E8%AF%A2%EF%BC%89"><span class="toc-number">6.4.</span> <span class="toc-text">match_phrase_prefix（最左前缀查询）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#multi-match%EF%BC%88%E5%A4%9A%E5%AD%97%E6%AE%B5%E6%9F%A5%E8%AF%A2%EF%BC%89"><span class="toc-number">6.5.</span> <span class="toc-text">multi_match（多字段查询）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#term%E6%9F%A5%E8%AF%A2%EF%BC%88%E7%B2%BE%E7%A1%AE%E6%9F%A5%E8%AF%A2%EF%BC%89"><span class="toc-number">6.6.</span> <span class="toc-text">term查询（精确查询）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%B9%E9%87%8F%E6%8F%92%E5%85%A5"><span class="toc-number">6.7.</span> <span class="toc-text">批量插入</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8E%92%E5%BA%8F%E6%9F%A5%E8%AF%A2"><span class="toc-number">7.</span> <span class="toc-text">排序查询</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2"><span class="toc-number">8.</span> <span class="toc-text">分页查询</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%83%E5%B0%94%E6%9F%A5%E8%AF%A2"><span class="toc-number">9.</span> <span class="toc-text">布尔查询</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#must%EF%BC%8Cshould"><span class="toc-number">9.1.</span> <span class="toc-text">must，should</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#must-not"><span class="toc-number">9.2.</span> <span class="toc-text">must_not</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#filter"><span class="toc-number">9.3.</span> <span class="toc-text">filter</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#filter%E5%92%8Cmust-should%E7%9A%84%E4%BC%98%E5%85%88%E7%BA%A7"><span class="toc-number">9.3.1.</span> <span class="toc-text">filter和must&#x2F;should的优先级</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#filter%E5%BF%85%E9%A1%BB%E5%B7%A5%E4%BD%9C%E4%BA%8Ebool%E6%9F%A5%E8%AF%A2%E5%86%85"><span class="toc-number">9.3.2.</span> <span class="toc-text">filter必须工作于bool查询内</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E7%BB%93%E6%9E%9C%E8%BF%87%E6%BB%A4"><span class="toc-number">10.</span> <span class="toc-text">查询结果过滤</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%AB%98%E4%BA%AE%E6%9F%A5%E8%AF%A2"><span class="toc-number">11.</span> <span class="toc-text">高亮查询</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E9%AB%98%E4%BA%AE%E6%98%BE%E7%A4%BA"><span class="toc-number">11.1.</span> <span class="toc-text">自定义高亮显示</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%81%9A%E5%90%88%E5%87%BD%E6%95%B0"><span class="toc-number">12.</span> <span class="toc-text">聚合函数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E7%BB%84%E6%9F%A5%E8%AF%A2"><span class="toc-number">12.1.</span> <span class="toc-text">分组查询</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Mappings"><span class="toc-number">13.</span> <span class="toc-text">Mappings</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">13.1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%98%A0%E5%B0%84%E6%98%AF%E4%BB%80%E4%B9%88"><span class="toc-number">13.2.</span> <span class="toc-text">映射是什么</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%98%A0%E5%B0%84%E7%B1%BB%E5%9E%8B"><span class="toc-number">13.3.</span> <span class="toc-text">映射类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%97%E6%AE%B5%E7%9A%84%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-number">13.4.</span> <span class="toc-text">字段的数据类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%98%A0%E5%B0%84%E7%BA%A6%E6%9D%9F"><span class="toc-number">13.5.</span> <span class="toc-text">映射约束</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84%E6%98%A0%E5%B0%84%E7%A4%BA%E4%BE%8B"><span class="toc-number">13.6.</span> <span class="toc-text">一个简单的映射示例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#dynamic%E7%9A%84%E4%B8%89%E7%A7%8D%E7%8A%B6%E6%80%81"><span class="toc-number">13.7.</span> <span class="toc-text">dynamic的三种状态</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8A%A8%E6%80%81%E6%98%A0%E5%B0%84%EF%BC%88dynamic%EF%BC%9Atrue%EF%BC%89"><span class="toc-number">13.7.1.</span> <span class="toc-text">动态映射（dynamic：true）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9D%99%E6%80%81%E6%98%A0%E5%B0%84%EF%BC%88dynamic%EF%BC%9Afalse%EF%BC%89"><span class="toc-number">13.7.2.</span> <span class="toc-text">静态映射（dynamic：false）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%A5%E6%A0%BC%E6%A8%A1%E5%BC%8F%EF%BC%88dynamic%EF%BC%9Astrict%EF%BC%89"><span class="toc-number">13.7.3.</span> <span class="toc-text">严格模式（dynamic：strict）</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Mappings%E7%9A%84%E5%85%B6%E4%BB%96%E8%AE%BE%E7%BD%AE"><span class="toc-number">13.8.</span> <span class="toc-text">Mappings的其他设置</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#ignore-above%E5%B1%9E%E6%80%A7"><span class="toc-number">13.8.1.</span> <span class="toc-text">ignore_above属性</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#index%E5%B1%9E%E6%80%A7"><span class="toc-number">13.8.2.</span> <span class="toc-text">index属性</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#copy-to%E5%B1%9E%E6%80%A7"><span class="toc-number">13.8.3.</span> <span class="toc-text">copy_to属性</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AF%B9%E8%B1%A1%E5%9E%8B%E5%AD%97%E6%AE%B5"><span class="toc-number">13.8.4.</span> <span class="toc-text">对象型字段</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#settings%E8%AE%BE%E7%BD%AE"><span class="toc-number">13.8.5.</span> <span class="toc-text">settings设置</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%86%E6%9E%90%E8%BF%87%E7%A8%8B"><span class="toc-number">14.</span> <span class="toc-text">分析过程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E6%9E%90%E5%99%A8"><span class="toc-number">14.1.</span> <span class="toc-text">分析器</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A0%87%E5%87%86%E5%88%86%E6%9E%90%E5%99%A8%EF%BC%9Astandard-analyzer"><span class="toc-number">14.1.1.</span> <span class="toc-text">标准分析器：standard analyzer</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E5%88%86%E6%9E%90%E5%99%A8%EF%BC%9Asimple-analyzer"><span class="toc-number">14.1.2.</span> <span class="toc-text">简单分析器：simple analyzer</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A9%BA%E7%99%BD%E5%88%86%E6%9E%90%E5%99%A8%EF%BC%9Awhitespace-analyzer"><span class="toc-number">14.1.3.</span> <span class="toc-text">空白分析器：whitespace analyzer</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%81%9C%E7%94%A8%E8%AF%8D%E5%88%86%E6%9E%90%E5%99%A8%EF%BC%9Astop-analyzer"><span class="toc-number">14.1.4.</span> <span class="toc-text">停用词分析器：stop analyzer</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B3%E9%94%AE%E8%AF%8D%E5%88%86%E6%9E%90%E5%99%A8%EF%BC%9Akeyword-analyzer"><span class="toc-number">14.1.5.</span> <span class="toc-text">关键词分析器：keyword analyzer</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A8%A1%E5%BC%8F%E5%88%86%E6%9E%90%E5%99%A8%EF%BC%9Apattern-analyzer"><span class="toc-number">14.1.6.</span> <span class="toc-text">模式分析器：pattern analyzer</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%AD%E8%A8%80%E5%92%8C%E5%A4%9A%E8%AF%AD%E8%A8%80%E5%88%86%E6%9E%90%E5%99%A8%EF%BC%9Achinese"><span class="toc-number">14.1.7.</span> <span class="toc-text">语言和多语言分析器：chinese</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9B%AA%E7%90%83%E5%88%86%E6%9E%90%E5%99%A8%EF%BC%9Asnowball-analyzer"><span class="toc-number">14.1.8.</span> <span class="toc-text">雪球分析器：snowball analyzer</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E8%BF%87%E6%BB%A4%E5%99%A8"><span class="toc-number">14.2.</span> <span class="toc-text">字符过滤器</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#HTML%E5%AD%97%E7%AC%A6%E8%BF%87%E6%BB%A4%E5%99%A8"><span class="toc-number">14.2.1.</span> <span class="toc-text">HTML字符过滤器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%98%A0%E5%B0%84%E5%AD%97%E7%AC%A6%E8%BF%87%E6%BB%A4%E5%99%A8"><span class="toc-number">14.2.2.</span> <span class="toc-text">映射字符过滤器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A8%A1%E5%BC%8F%E6%9B%BF%E6%8D%A2%E8%BF%87%E6%BB%A4%E5%99%A8"><span class="toc-number">14.2.3.</span> <span class="toc-text">模式替换过滤器</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E8%AF%8D%E5%99%A8"><span class="toc-number">14.3.</span> <span class="toc-text">分词器</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A0%87%E5%87%86%E5%88%86%E8%AF%8D%E5%99%A8%EF%BC%9Astandard-tokenizer"><span class="toc-number">14.3.1.</span> <span class="toc-text">标准分词器：standard tokenizer</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B3%E9%94%AE%E8%AF%8D%E5%88%86%E8%AF%8D%E5%99%A8%EF%BC%9Akeyword-tokenizer"><span class="toc-number">14.3.2.</span> <span class="toc-text">关键词分词器：keyword tokenizer</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AD%97%E6%AF%8D%E5%88%86%E8%AF%8D%E5%99%A8%EF%BC%9Aletter-tokenizer"><span class="toc-number">14.3.3.</span> <span class="toc-text">字母分词器：letter tokenizer</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B0%8F%E5%86%99%E5%88%86%E8%AF%8D%E5%99%A8%EF%BC%9Alowercase-tokenizer"><span class="toc-number">14.3.4.</span> <span class="toc-text">小写分词器：lowercase tokenizer</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A9%BA%E7%99%BD%E5%88%86%E8%AF%8D%E5%99%A8%EF%BC%9Awhitespace-tokenizer"><span class="toc-number">14.3.5.</span> <span class="toc-text">空白分词器：whitespace tokenizer</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A8%A1%E5%BC%8F%E5%88%86%E8%AF%8D%E5%99%A8%EF%BC%9Apattern-tokenizer"><span class="toc-number">14.3.6.</span> <span class="toc-text">模式分词器：pattern tokenizer</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#UAX-URL%E7%94%B5%E5%AD%90%E9%82%AE%E4%BB%B6%E5%88%86%E8%AF%8D%E5%99%A8%EF%BC%9AUAX-RUL-email-tokenizer"><span class="toc-number">14.3.7.</span> <span class="toc-text">UAX URL电子邮件分词器：UAX RUL email tokenizer</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%B7%AF%E5%BE%84%E5%B1%82%E6%AC%A1%E5%88%86%E8%AF%8D%E5%99%A8%EF%BC%9Apath-hierarchy-tokenizer"><span class="toc-number">14.3.8.</span> <span class="toc-text">路径层次分词器：path hierarchy tokenizer</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E8%AF%8D%E8%BF%87%E6%BB%A4%E5%99%A8"><span class="toc-number">14.4.</span> <span class="toc-text">分词过滤器</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E5%88%86%E8%AF%8D%E8%BF%87%E6%BB%A4%E5%99%A8"><span class="toc-number">14.4.1.</span> <span class="toc-text">常见分词过滤器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E5%88%86%E8%AF%8D%E8%BF%87%E6%BB%A4%E5%99%A8"><span class="toc-number">14.4.2.</span> <span class="toc-text">自定义分词过滤器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%9A%E4%B8%AA%E5%88%86%E8%AF%8D%E8%BF%87%E6%BB%A4%E5%99%A8"><span class="toc-number">14.4.3.</span> <span class="toc-text">多个分词过滤器</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%87%AA%E7%84%B6%E8%AF%AD%E8%A8%80%E5%A4%84%E7%90%86%E4%B8%8E%E4%B8%AD%E6%96%87%E5%88%86%E8%AF%8D"><span class="toc-number">15.</span> <span class="toc-text">自然语言处理与中文分词</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E%E8%AF%8D%E5%85%B8%E5%88%86%E8%AF%8D%E7%AE%97%E6%B3%95"><span class="toc-number">15.1.</span> <span class="toc-text">基于词典分词算法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E%E7%90%86%E8%A7%A3%E7%9A%84%E5%88%86%E8%AF%8D%E6%96%B9%E6%B3%95"><span class="toc-number">15.2.</span> <span class="toc-text">基于理解的分词方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E%E7%BB%9F%E8%AE%A1%E7%9A%84%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E7%AE%97%E6%B3%95"><span class="toc-number">15.3.</span> <span class="toc-text">基于统计的机器学习算法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%AE%E5%89%8D%E5%B8%B8%E8%A7%81%E7%9A%84%E4%B8%AD%E6%96%87%E5%88%86%E8%AF%8D%E5%88%86%E7%B1%BB%E5%99%A8"><span class="toc-number">15.4.</span> <span class="toc-text">目前常见的中文分词分类器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E8%AF%8D%E5%99%A8%E7%9B%AE%E5%89%8D%E5%AD%98%E5%9C%A8%E7%9A%84%E9%97%AE%E9%A2%98"><span class="toc-number">15.5.</span> <span class="toc-text">分词器目前存在的问题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ik%E5%88%86%E8%AF%8D%E5%99%A8"><span class="toc-number">16.</span> <span class="toc-text">ik分词器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ik%E7%9B%AE%E5%BD%95%E7%AE%80%E4%BB%8B"><span class="toc-number">16.1.</span> <span class="toc-text">ik目录简介</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#For-Python"><span class="toc-number">17.</span> <span class="toc-text">For Python</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#hello-world"><span class="toc-number">17.1.</span> <span class="toc-text">hello world</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%93%E6%9E%9C%E8%BF%87%E6%BB%A4"><span class="toc-number">17.2.</span> <span class="toc-text">结果过滤</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Elasticsearch%EF%BC%88es%E5%AF%B9%E8%B1%A1%EF%BC%89"><span class="toc-number">17.3.</span> <span class="toc-text">Elasticsearch（es对象）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Indices%EF%BC%88es-indices%EF%BC%89"><span class="toc-number">17.4.</span> <span class="toc-text">Indices（es.indices）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Cluster%EF%BC%88%E9%9B%86%E7%BE%A4%E7%9B%B8%E5%85%B3%EF%BC%89"><span class="toc-number">17.5.</span> <span class="toc-text">Cluster（集群相关）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Node%EF%BC%88%E8%8A%82%E7%82%B9%E7%9B%B8%E5%85%B3%EF%BC%89"><span class="toc-number">17.6.</span> <span class="toc-text">Node（节点相关）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Cat%EF%BC%88%E4%B8%80%E7%A7%8D%E6%9F%A5%E8%AF%A2%E6%96%B9%E5%BC%8F%EF%BC%89"><span class="toc-number">17.7.</span> <span class="toc-text">Cat（一种查询方式）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Snapshot%EF%BC%88%E5%BF%AB%E7%85%A7%E7%9B%B8%E5%85%B3%EF%BC%89"><span class="toc-number">17.8.</span> <span class="toc-text">Snapshot（快照相关）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Task%EF%BC%88%E4%BB%BB%E5%8A%A1%E7%9B%B8%E5%85%B3%EF%BC%89"><span class="toc-number">17.9.</span> <span class="toc-text">Task（任务相关）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BB%BA%E8%AE%AE%E5%99%A8%E7%AE%80%E4%BB%8B"><span class="toc-number">18.</span> <span class="toc-text">建议器简介</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E7%A4%BA%E4%BE%8B"><span class="toc-number">18.1.</span> <span class="toc-text">简单示例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E7%BB%84%E5%BB%BA%E8%AE%AE%E5%99%A8"><span class="toc-number">18.2.</span> <span class="toc-text">多组建议器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A3%E5%B8%B8%E6%9F%A5%E8%AF%A2%E5%92%8C%E5%BB%BA%E8%AE%AE%E8%81%94%E7%94%A8"><span class="toc-number">18.3.</span> <span class="toc-text">正常查询和建议联用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%9B%E7%A7%8D%E5%BB%BA%E8%AE%AE%E5%99%A8"><span class="toc-number">18.4.</span> <span class="toc-text">四种建议器</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#term-suggester"><span class="toc-number">18.4.1.</span> <span class="toc-text">term suggester</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%8D%E6%9D%A1%E5%BB%BA%E8%AE%AE%E5%99%A8%E6%98%AF%E5%A6%82%E4%BD%95%E8%BF%90%E4%BD%9C"><span class="toc-number">18.4.1.0.1.</span> <span class="toc-text">词条建议器是如何运作</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#phrase-suggester"><span class="toc-number">18.4.2.</span> <span class="toc-text">phrase suggester</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#completion-suggester"><span class="toc-number">18.4.3.</span> <span class="toc-text">completion suggester</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#context-suggester"><span class="toc-number">18.4.4.</span> <span class="toc-text">context suggester</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Index-Templates"><span class="toc-number">19.</span> <span class="toc-text">Index Templates</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81%E7%B4%A2%E5%BC%95%E6%A8%A1%E6%9D%BF%EF%BC%9F"><span class="toc-number">19.1.</span> <span class="toc-text">为什么需要索引模板？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E7%B4%A2%E5%BC%95%E6%A8%A1%E6%9D%BF"><span class="toc-number">19.2.</span> <span class="toc-text">创建索引模板</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E7%B4%A2%E5%BC%95%E6%A8%A1%E6%9D%BF"><span class="toc-number">19.3.</span> <span class="toc-text">查看索引模板</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E6%A8%A1%E6%9D%BF%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">19.4.</span> <span class="toc-text">索引模板的使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E6%A8%A1%E6%9D%BF%E5%8C%B9%E9%85%8D"><span class="toc-number">19.5.</span> <span class="toc-text">多模板匹配</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E7%B4%A2%E5%BC%95%E6%A8%A1%E6%9D%BF"><span class="toc-number">19.6.</span> <span class="toc-text">删除索引模板</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Routing"><span class="toc-number">20.</span> <span class="toc-text">Routing</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E8%B7%AF%E7%94%B1"><span class="toc-number">20.1.</span> <span class="toc-text">自定义路由</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%9A%E8%BF%87%E8%B7%AF%E7%94%B1%E6%9F%A5%E8%AF%A2%E6%96%87%E6%A1%A3"><span class="toc-number">20.2.</span> <span class="toc-text">通过路由查询文档</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E6%96%87%E6%A1%A3"><span class="toc-number">20.3.</span> <span class="toc-text">删除文档</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E5%A4%9A%E4%B8%AA%E8%B7%AF%E7%94%B1"><span class="toc-number">20.4.</span> <span class="toc-text">查询多个路由</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BF%98%E4%BA%86%E8%B7%AF%E7%94%B1%E5%80%BC%E6%80%8E%E4%B9%88%E5%8A%9E%EF%BC%9F"><span class="toc-number">20.5.</span> <span class="toc-text">忘了路由值怎么办？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E8%B7%AF%E7%94%B1%E5%94%AF%E4%B8%80ID"><span class="toc-number">20.6.</span> <span class="toc-text">自定义路由唯一ID</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E5%88%B0%E7%B4%A2%E5%BC%95%E5%88%86%E5%8C%BA"><span class="toc-number">20.7.</span> <span class="toc-text">路由到索引分区</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Index-Aliases"><span class="toc-number">21.</span> <span class="toc-text">Index Aliases</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%AB%E5%90%8D%E8%A7%A3%E5%86%B3%E4%BA%86%E5%93%AA%E4%BA%9B%E9%97%AE%E9%A2%98%EF%BC%9F"><span class="toc-number">21.1.</span> <span class="toc-text">别名解决了哪些问题？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%AB%E5%90%8D%E7%9A%84%E7%9B%B8%E5%85%B3%E6%93%8D%E4%BD%9C"><span class="toc-number">21.2.</span> <span class="toc-text">别名的相关操作</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%87%86%E5%A4%87%E6%95%B0%E6%8D%AE"><span class="toc-number">21.2.1.</span> <span class="toc-text">准备数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%88%AB%E5%90%8D"><span class="toc-number">21.2.2.</span> <span class="toc-text">创建别名</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E5%88%AB%E5%90%8D"><span class="toc-number">21.2.3.</span> <span class="toc-text">查看别名</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E5%88%AB%E5%90%8D"><span class="toc-number">21.2.4.</span> <span class="toc-text">删除别名</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%87%8D%E5%91%BD%E5%90%8D%E5%88%AB%E5%90%8D"><span class="toc-number">21.2.5.</span> <span class="toc-text">重命名别名</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%BA%E5%A4%9A%E4%B8%AA%E7%B4%A2%E5%BC%95%E6%8C%87%E5%90%91%E5%90%8C%E6%A0%B7%E7%9A%84%E5%88%AB%E5%90%8D"><span class="toc-number">21.2.6.</span> <span class="toc-text">为多个索引指向同样的别名</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8indices%E6%95%B0%E7%BB%84%E8%AF%AD%E6%B3%95%E5%9C%A8%E4%B8%80%E4%B8%AA%E6%93%8D%E4%BD%9C%E4%B8%AD%E4%B8%BA%E5%A4%9A%E4%B8%AA%E7%B4%A2%E5%BC%95%E6%8C%87%E5%90%91%E5%90%8C%E4%B8%80%E4%B8%AA%E5%88%AB%E5%90%8D"><span class="toc-number">21.2.7.</span> <span class="toc-text">使用indices数组语法在一个操作中为多个索引指向同一个别名</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%AB%E5%90%8D%E4%BA%A4%E6%8D%A2"><span class="toc-number">21.2.8.</span> <span class="toc-text">别名交换</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%87%E6%BB%A4%E5%99%A8%E5%88%AB%E5%90%8D"><span class="toc-number">21.2.9.</span> <span class="toc-text">过滤器别名</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%8E%E8%B7%AF%E7%94%B1%E8%BF%9E%E7%94%A8"><span class="toc-number">21.2.10.</span> <span class="toc-text">与路由连用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%86%99%E7%B4%A2%E5%BC%95"><span class="toc-number">21.2.11.</span> <span class="toc-text">写索引</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E5%8D%95%E4%B8%AA%E5%88%AB%E5%90%8D"><span class="toc-number">21.2.12.</span> <span class="toc-text">添加单个别名</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%B4%A2%E5%BC%95%E6%9C%9F%E9%97%B4%E6%8C%87%E5%AE%9A%E5%88%AB%E5%90%8D"><span class="toc-number">21.2.13.</span> <span class="toc-text">索引期间指定别名</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E5%88%AB%E5%90%8D-1"><span class="toc-number">21.2.14.</span> <span class="toc-text">删除别名</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A3%80%E7%B4%A2%E7%8E%B0%E6%9C%89%E5%88%AB%E5%90%8D"><span class="toc-number">21.2.15.</span> <span class="toc-text">检索现有别名</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#HEAD"><span class="toc-number">21.2.16.</span> <span class="toc-text">HEAD</span></a></li></ol></li></ol></li></ol></details></div><div class="container post-content"><h2 id="ES-API"><a href="#ES-API" class="headerlink" title="ES API"></a>ES API</h2><p>以下示例使用<code>curl</code>演示。</p>
<h3 id="查看健康状态"><a href="#查看健康状态" class="headerlink" title="查看健康状态"></a>查看健康状态</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET 127.0.0.1:9200/_cat/health?v</span><br></pre></td></tr></table></figure>

<p>输出：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">epoch      timestamp cluster       status node.total node.data shards pri relo init unassign pending_tasks max_task_wait_time active_shards_percent</span><br><span class="line">1564726309 06:11:49  elasticsearch yellow          1         1      3   3    0    0        1             0                  -                 75.0%</span><br></pre></td></tr></table></figure>



<h3 id="查询当前es集群中所有的indices"><a href="#查询当前es集群中所有的indices" class="headerlink" title="查询当前es集群中所有的indices"></a>查询当前es集群中所有的indices</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET 127.0.0.1:9200/_cat/indices?v</span><br></pre></td></tr></table></figure>

<p>输出：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">health status index                uuid                   pri rep docs.count docs.deleted store.size pri.store.size</span><br><span class="line">green  open   .kibana_task_manager LUo-IxjDQdWeAbR-SYuYvQ   1   0          2            0     45.5kb         45.5kb</span><br><span class="line">green  open   .kibana_1            PLvyZV1bRDWex05xkOrNNg   1   0          4            1     23.9kb         23.9kb</span><br><span class="line">yellow open   user                 o42mIpDeSgSWZ6eARWUfKw   1   1          0            0       283b           283b</span><br></pre></td></tr></table></figure>



<h3 id="创建索引"><a href="#创建索引" class="headerlink" title="创建索引"></a>创建索引</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -X PUT 127.0.0.1:9200/www</span><br></pre></td></tr></table></figure>

<p>输出：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">&quot;acknowledged&quot;</span>:<span class="literal">true</span>,<span class="string">&quot;shards_acknowledged&quot;</span>:<span class="literal">true</span>,<span class="string">&quot;index&quot;</span>:<span class="string">&quot;www&quot;</span>&#125;</span><br></pre></td></tr></table></figure>



<h3 id="删除索引"><a href="#删除索引" class="headerlink" title="删除索引"></a>删除索引</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -X DELETE 127.0.0.1:9200/www</span><br></pre></td></tr></table></figure>

<p>输出：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">&quot;acknowledged&quot;</span>:<span class="literal">true</span>&#125;</span><br></pre></td></tr></table></figure>



<h3 id="插入记录"><a href="#插入记录" class="headerlink" title="插入记录"></a>插入记录</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">curl -H <span class="string">&quot;ContentType:application/json&quot;</span> -X POST 127.0.0.1:9200/user/person -d <span class="string">&#x27;</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">	&quot;name&quot;: &quot;dsb&quot;,</span></span><br><span class="line"><span class="string">	&quot;age&quot;: 9000,</span></span><br><span class="line"><span class="string">	&quot;married&quot;: true</span></span><br><span class="line"><span class="string">&#125;&#x27;</span></span><br></pre></td></tr></table></figure>

<p>输出：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;_index&quot;</span>: <span class="string">&quot;user&quot;</span>,</span><br><span class="line">    <span class="string">&quot;_type&quot;</span>: <span class="string">&quot;person&quot;</span>,</span><br><span class="line">    <span class="string">&quot;_id&quot;</span>: <span class="string">&quot;MLcwUWwBvEa8j5UrLZj4&quot;</span>,</span><br><span class="line">    <span class="string">&quot;_version&quot;</span>: 1,</span><br><span class="line">    <span class="string">&quot;result&quot;</span>: <span class="string">&quot;created&quot;</span>,</span><br><span class="line">    <span class="string">&quot;_shards&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;total&quot;</span>: 2,</span><br><span class="line">        <span class="string">&quot;successful&quot;</span>: 1,</span><br><span class="line">        <span class="string">&quot;failed&quot;</span>: 0</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;_seq_no&quot;</span>: 3,</span><br><span class="line">    <span class="string">&quot;_primary_term&quot;</span>: 1</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>也可以使用PUT方法，但是需要传入id</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">curl -H <span class="string">&quot;ContentType:application/json&quot;</span> -X PUT 127.0.0.1:9200/user/person/4 -d <span class="string">&#x27;</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">	&quot;name&quot;: &quot;sb&quot;,</span></span><br><span class="line"><span class="string">	&quot;age&quot;: 9,</span></span><br><span class="line"><span class="string">	&quot;married&quot;: false</span></span><br><span class="line"><span class="string">&#125;&#x27;</span></span><br></pre></td></tr></table></figure>



<h3 id="检索"><a href="#检索" class="headerlink" title="检索"></a>检索</h3><p>Elasticsearch的检索语法比较特别，使用GET方法携带JSON格式的查询条件。</p>
<p>全检索：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET 127.0.0.1:9200/user/person/_search</span><br></pre></td></tr></table></figure>

<p>按条件检索：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">curl -H <span class="string">&quot;ContentType:application/json&quot;</span> -X PUT 127.0.0.1:9200/user/person/4 -d <span class="string">&#x27;</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">	&quot;query&quot;:&#123;</span></span><br><span class="line"><span class="string">		&quot;match&quot;: &#123;&quot;name&quot;: &quot;sb&quot;&#125;</span></span><br><span class="line"><span class="string">	&#125;	</span></span><br><span class="line"><span class="string">&#125;&#x27;</span></span><br></pre></td></tr></table></figure>

<p>ElasticSearch默认一次最多返回10条结果，可以像下面的示例通过size字段来设置返回结果的数目。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">curl -H <span class="string">&quot;ContentType:application/json&quot;</span> -X PUT 127.0.0.1:9200/user/person/4 -d <span class="string">&#x27;</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">	&quot;query&quot;:&#123;</span></span><br><span class="line"><span class="string">		&quot;match&quot;: &#123;&quot;name&quot;: &quot;sb&quot;&#125;,</span></span><br><span class="line"><span class="string">		&quot;size&quot;: 2</span></span><br><span class="line"><span class="string">	&#125;	</span></span><br><span class="line"><span class="string">&#125;&#x27;</span></span><br></pre></td></tr></table></figure>



<h2 id="Go操作Elasticsearch"><a href="#Go操作Elasticsearch" class="headerlink" title="Go操作Elasticsearch"></a>Go操作Elasticsearch</h2><p>我们使用第三方库<a target="_blank" rel="noopener" href="https://github.com/olivere/elastic%E6%9D%A5%E8%BF%9E%E6%8E%A5ES%E5%B9%B6%E8%BF%9B%E8%A1%8C%E6%93%8D%E4%BD%9C%E3%80%82">https://github.com/olivere/elastic来连接ES并进行操作。</a></p>
<p>注意下载与你的ES相同版本的client，例如我们这里使用的ES是7.2.1的版本，那么我们下载的client也要与之对应为<code>github.com/olivere/elastic/v7</code>。</p>
<p>使用<code>go.mod</code>来管理依赖：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">require (</span><br><span class="line">    github.com/olivere/elastic/v7 v7<span class="number">.0</span><span class="number">.4</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>简单示例：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;context&quot;</span></span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line">	<span class="string">&quot;github.com/olivere/elastic/v7&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Elasticsearch demo</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Person <span class="keyword">struct</span> &#123;</span><br><span class="line">	Name    <span class="keyword">string</span> <span class="string">`json:&quot;name&quot;`</span></span><br><span class="line">	Age     <span class="keyword">int</span>    <span class="string">`json:&quot;age&quot;`</span></span><br><span class="line">	Married <span class="keyword">bool</span>   <span class="string">`json:&quot;married&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	client, err := elastic.NewClient(elastic.SetURL(<span class="string">&quot;http://192.168.1.7:9200&quot;</span>))</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="comment">// Handle error</span></span><br><span class="line">		<span class="built_in">panic</span>(err)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	fmt.Println(<span class="string">&quot;connect to es success&quot;</span>)</span><br><span class="line">	p1 := Person&#123;Name: <span class="string">&quot;rion&quot;</span>, Age: <span class="number">22</span>, Married: <span class="literal">false</span>&#125;</span><br><span class="line">	put1, err := client.Index().</span><br><span class="line">		Index(<span class="string">&quot;user&quot;</span>).</span><br><span class="line">		BodyJson(p1).</span><br><span class="line">		Do(context.Background())</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="comment">// Handle error</span></span><br><span class="line">		<span class="built_in">panic</span>(err)</span><br><span class="line">	&#125;</span><br><span class="line">	fmt.Printf(<span class="string">&quot;Indexed user %s to index %s, type %s\n&quot;</span>, put1.Id, put1.Index, put1.Type)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="倒排索引"><a href="#倒排索引" class="headerlink" title="倒排索引"></a>倒排索引</h2><ul>
<li>倒排索引的结构：一个索引由文档中所有不重复的列表构成，对于每一个词，都有一个包含它的文档列表。</li>
<li>倒排列表（Posting List）记录了词条对应的文档集合，由倒排索引项（Posting）组成。</li>
</ul>
<p>倒排索引项主要包含如下信息：</p>
<ul>
<li>文档id，用于获取原始信息。</li>
<li>词条频率（TF，Term Frequency），记录该词条在文档中出现的次数，用于后续相关性算分。</li>
<li>位置（Position），记录词条在文档中的分词位置（多个），用于做短语搜索（Phrase Query）。</li>
<li>偏移（Offset），记录词条在文档的开始和结束位置，用于做高亮显示。</li>
</ul>
<p>以<code>搜索引擎</code>为例：</p>
<table>
<thead>
<tr>
<th>文档id</th>
<th>文档内容</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>elasticsearch是最流行的搜索引擎</td>
</tr>
<tr>
<td>2</td>
<td>Python是世界上最好的语言</td>
</tr>
<tr>
<td>3</td>
<td>搜索引擎是如何诞生的</td>
</tr>
</tbody></table>
<p>上述文档的倒排索引列表是这样的：</p>
<table>
<thead>
<tr>
<th>DocID</th>
<th>TF</th>
<th>Position</th>
<th>Offset</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>1</td>
<td>2</td>
<td>&lt;18,22&gt;</td>
</tr>
<tr>
<td>3</td>
<td>1</td>
<td>0</td>
<td>&lt;0,4&gt;</td>
</tr>
</tbody></table>
<p>关于文档1，</p>
<ul>
<li><code>DocID</code>是1无需多说，</li>
<li><code>TF</code>是1表示<code>搜索引擎</code>在文档内容中出现一次，</li>
<li><code>Position</code>指的是分词后的位置，首先要说文档内容会被分为<code>elasticsearch</code>、<code>最流行</code>、<code>搜索引擎</code>3部分，从0开始计算，<code>搜索引擎</code>的<code>Position</code>是2；</li>
<li><code>Offset</code>是<code>搜索引擎</code>这个字符在文档中的位置。</li>
</ul>
<p>文档3中</p>
<ul>
<li><code>搜索引擎</code>在文档中出现一次（TF:1），</li>
<li>并且出现在文档的开始位置（Position：0），</li>
<li>那么<code>Offset</code>的位置就是<code>&lt;0,4&gt;</code>无疑了。</li>
</ul>
<p>再比如说，现在有两个文档， 每个文档包含如下内容：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Study every day, good good up to forever		# 文档1包含的内容</span><br><span class="line">To forever, study every day, good good up	# 文档2包含的内容</span><br></pre></td></tr></table></figure>

<p>为了创建倒排索引，我们首先要将每个文档拆分成独立的词（或称为词条或者tokens），然后创建一个包含所有不重复的词条的排序列表，然后列出每个词条出现在哪个文档：</p>
<table>
<thead>
<tr>
<th align="left">term</th>
<th align="left">doc_1</th>
<th align="left">doc_2</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Study</td>
<td align="left">√</td>
<td align="left">×</td>
</tr>
<tr>
<td align="left">To</td>
<td align="left">×</td>
<td align="left">√</td>
</tr>
<tr>
<td align="left">every</td>
<td align="left">√</td>
<td align="left">√</td>
</tr>
<tr>
<td align="left">forever</td>
<td align="left">√</td>
<td align="left">√</td>
</tr>
<tr>
<td align="left">day</td>
<td align="left">√</td>
<td align="left">√</td>
</tr>
<tr>
<td align="left">study</td>
<td align="left">×</td>
<td align="left">√</td>
</tr>
<tr>
<td align="left">good</td>
<td align="left">√</td>
<td align="left">√</td>
</tr>
<tr>
<td align="left">every</td>
<td align="left">√</td>
<td align="left">√</td>
</tr>
<tr>
<td align="left">to</td>
<td align="left">√</td>
<td align="left">×</td>
</tr>
<tr>
<td align="left">up</td>
<td align="left">√</td>
<td align="left">√</td>
</tr>
</tbody></table>
<p>现在，我们试图搜索<code>to forever</code>，只需要查看包含每个词条的文档：</p>
<table>
<thead>
<tr>
<th align="left">term</th>
<th align="left">doc_1</th>
<th align="left">doc_2</th>
</tr>
</thead>
<tbody><tr>
<td align="left">to</td>
<td align="left">√</td>
<td align="left">×</td>
</tr>
<tr>
<td align="left">forever</td>
<td align="left">√</td>
<td align="left">√</td>
</tr>
<tr>
<td align="left">total</td>
<td align="left">2</td>
<td align="left">1</td>
</tr>
</tbody></table>
<p>两个文档都匹配，但是第一个文档比第二个匹配程度更高。如果没有别的条件，现在，这两个包含关键字的文档都将返回。</p>
<p>再来看一个示例，比如我们通过博客标签来搜索博客文章。那么倒排索引列表就是这样的一个结构：</p>
<p><a target="_blank" rel="noopener" href="https://img2018.cnblogs.com/blog/1168165/201903/1168165-20190321171817630-251324277.png"><img src="/images/13bca60c-1168165-20190321171817630-251324277.png" alt="img"></a></p>
<p>如果要搜索含有<code>python</code>标签的文章，那相对于查找所有原始数据而言，查找倒排索引后的数据将会快的多。只需要查看标签这一栏，然后获取相关的文章ID即可。</p>
<h2 id="简单查看"><a href="#简单查看" class="headerlink" title="简单查看"></a>简单查看</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"># 查看映射</span><br><span class="line">GET /mydoc/_mapping</span><br><span class="line"></span><br><span class="line"># 查看配置</span><br><span class="line">GET /mydoc/_settings</span><br><span class="line"></span><br><span class="line"># 查看别名</span><br><span class="line">GET /mydoc/_alias</span><br><span class="line"></span><br><span class="line"># 查看上述三个</span><br><span class="line">GET /mydoc</span><br><span class="line"></span><br><span class="line"># 查看所有节点</span><br><span class="line">GET /_cat/nodes</span><br><span class="line"></span><br><span class="line"># 查看es健康状况</span><br><span class="line">GET /_cat/health</span><br><span class="line"></span><br><span class="line"># 查看主节点</span><br><span class="line">GET /_cat/master</span><br><span class="line"></span><br><span class="line"># 查看所有索引</span><br><span class="line">GET /_cat/indices</span><br></pre></td></tr></table></figure>



<h2 id="查询的两种方式"><a href="#查询的两种方式" class="headerlink" title="查询的两种方式"></a><a target="_blank" rel="noopener" href="https://www.cnblogs.com/Neeo/articles/10576402.html">查询的两种方式</a></h2><h3 id="查询字符串-query-string"><a href="#查询字符串-query-string" class="headerlink" title="查询字符串(query string)"></a>查询字符串(query string)</h3><p>就像是像传递URL参数一样去传递查询语句，被称为简单搜索或查询字符串(query string)搜索。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">GET /mydoc/_search?q=name:heyingliang</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  &quot;took&quot; : 15,</span><br><span class="line">  &quot;timed_out&quot; : false,</span><br><span class="line">  &quot;_shards&quot; : &#123;</span><br><span class="line">    &quot;total&quot; : 1,</span><br><span class="line">    &quot;successful&quot; : 1,</span><br><span class="line">    &quot;skipped&quot; : 0,</span><br><span class="line">    &quot;failed&quot; : 0</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;hits&quot; : &#123;</span><br><span class="line">    &quot;total&quot; : &#123;</span><br><span class="line">      &quot;value&quot; : 0,</span><br><span class="line">      &quot;relation&quot; : &quot;eq&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;max_score&quot; : null,</span><br><span class="line">    &quot;hits&quot; : [ ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="结构化查询-Query-DSL"><a href="#结构化查询-Query-DSL" class="headerlink" title="结构化查询(Query DSL)"></a>结构化查询(Query DSL)</h3><p>DSL是Elasticsearch提供的一种丰富且灵活的查询语言，该语言以json请求体的形式出现，通过restful请求与Elasticsearch进行交互。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">GET /mydoc/doc/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;:&#123;</span><br><span class="line">    &quot;match&quot;:&#123;</span><br><span class="line">      &quot;age&quot;:22</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 也可以写成如下，字符串22会在内部做转换</span><br><span class="line">GET /mydoc/doc/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;:&#123;</span><br><span class="line">    &quot;match&quot;:&#123;</span><br><span class="line">      &quot;age&quot;:“22”</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="term和match查询"><a href="#term和match查询" class="headerlink" title="term和match查询"></a><a target="_blank" rel="noopener" href="https://www.cnblogs.com/Neeo/articles/10578482.html">term和match查询</a></h2><ul>
<li>match：返回所有匹配的分词。</li>
<li>match_all：查询全部。</li>
<li>match_phrase：短语查询，在match的基础上进一步查询词组，可以指定<code>slop</code>分词间隔。</li>
<li>match_phrase_prefix：前缀查询，根据短语中最后一个词组做前缀匹配，可以应用于搜索提示，但注意和<code>max_expanions</code>搭配。其实默认是50…….</li>
<li>multi_match：多字段查询，使用相当的灵活，可以完成<code>match_phrase</code>和<code>match_phrase_prefix</code>的工作。</li>
<li>term：查询没有经过分析的查询关键字。</li>
</ul>
<h3 id="match"><a href="#match" class="headerlink" title="match"></a>match</h3><p> <code>match</code>则是查询所有<code>name</code>字段的值中含有<code>he</code>的结果就会返回。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">GET /mydoc/doc/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;:&#123;</span><br><span class="line">    &quot;match&quot;:&#123;</span><br><span class="line">      &quot;name&quot;:“he”</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="match-all（查询全部）"><a href="#match-all（查询全部）" class="headerlink" title="match_all（查询全部）"></a>match_all（查询全部）</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">GET /mydoc/doc/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;:&#123;</span><br><span class="line">    &quot;match_all&quot;:&#123;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="match-phrase（短语查询）"><a href="#match-phrase（短语查询）" class="headerlink" title="match_phrase（短语查询）"></a>match_phrase（短语查询）</h3><p>match查询的是散列映射，包含了我们希望搜索的字段和字符串。也就说，只要文档中只要有我们希望的那个关键字，但也因此带来了一些问题。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">PUT t1/doc/1</span><br><span class="line">&#123;</span><br><span class="line">  &quot;title&quot;: &quot;中国是世界上人口最多的国家&quot;</span><br><span class="line">&#125;</span><br><span class="line">PUT t1/doc/2</span><br><span class="line">&#123;</span><br><span class="line">  &quot;title&quot;: &quot;美国是世界上军事实力最强大的国家&quot;</span><br><span class="line">&#125;</span><br><span class="line">PUT t1/doc/3</span><br><span class="line">&#123;</span><br><span class="line">  &quot;title&quot;: &quot;北京是中国的首都&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">GET t1/doc/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match&quot;: &#123;</span><br><span class="line">      &quot;title&quot;: &quot;中国&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">输出如下:</span><br><span class="line">&#123;</span><br><span class="line">  &quot;took&quot; : 1,</span><br><span class="line">  &quot;timed_out&quot; : false,</span><br><span class="line">  &quot;_shards&quot; : &#123;</span><br><span class="line">    &quot;total&quot; : 5,</span><br><span class="line">    &quot;successful&quot; : 5,</span><br><span class="line">    &quot;skipped&quot; : 0,</span><br><span class="line">    &quot;failed&quot; : 0</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;hits&quot; : &#123;</span><br><span class="line">    &quot;total&quot; : 3,</span><br><span class="line">    &quot;max_score&quot; : 0.68324494,</span><br><span class="line">    &quot;hits&quot; : [</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;_index&quot; : &quot;t1&quot;,</span><br><span class="line">        &quot;_type&quot; : &quot;doc&quot;,</span><br><span class="line">        &quot;_id&quot; : &quot;1&quot;,</span><br><span class="line">        &quot;_score&quot; : 0.68324494,</span><br><span class="line">        &quot;_source&quot; : &#123;</span><br><span class="line">          &quot;title&quot; : &quot;中国是世界上人口最多的国家&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;_index&quot; : &quot;t1&quot;,</span><br><span class="line">        &quot;_type&quot; : &quot;doc&quot;,</span><br><span class="line">        &quot;_id&quot; : &quot;3&quot;,</span><br><span class="line">        &quot;_score&quot; : 0.5753642,</span><br><span class="line">        &quot;_source&quot; : &#123;</span><br><span class="line">          &quot;title&quot; : &quot;北京是中国的首都&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;_index&quot; : &quot;t1&quot;,</span><br><span class="line">        &quot;_type&quot; : &quot;doc&quot;,</span><br><span class="line">        &quot;_id&quot; : &quot;2&quot;,</span><br><span class="line">        &quot;_score&quot; : 0.39556286,</span><br><span class="line">        &quot;_source&quot; : &#123;</span><br><span class="line">          &quot;title&quot; : &quot;美国是世界上军事实力最强大的国家&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>虽然如期的返回了<code>中国</code>的文档。但是却把和<code>美国</code>的文档也返回了，这并不是我们想要的。是怎么回事呢？</p>
<p>因为这是elasticsearch在内部对文档做分词的时候，对于中文来说，就是一个字一个字分的，所以，我们搜<code>中国</code>，<code>中</code>和<code>国</code>都符合条件，返回，而美国的<code>国</code>也符合。而我们认为<code>中国</code>是个短语，是一个有具体含义的词。所以elasticsearch在处理中文分词方面比较弱势。后面会讲针对中文的插件。但目前我们还有办法解决，那就是使用短语查询：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">GET t1/doc/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match_phrase&quot;: &#123;</span><br><span class="line">      &quot;title&quot;: &#123;</span><br><span class="line">        &quot;query&quot;: &quot;中国&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">GET t1/doc/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match_phrase&quot;: &#123;</span><br><span class="line">      &quot;title&quot;: &quot;中国世界&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">输出为空</span><br></pre></td></tr></table></figure>

<ul>
<li>返回结果也是空的，因为没有<code>中国世界</code>这个短语。</li>
<li>我们搜索<code>中国</code>和<code>世界</code>这两个指定词组时，但又不清楚两个词组之间有多少别的词间隔。那么在搜的时候就要留有一些余地。这时就要用到了<code>slop</code>了。</li>
<li>相当于正则中的<code>中国.*?世界</code>。这个间隔默认为0，导致我们刚才没有搜到,现在我们指定一个间隔。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">GET t1/doc/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match_phrase&quot;: &#123;</span><br><span class="line">      &quot;title&quot;: &#123;</span><br><span class="line">        &quot;query&quot;: &quot;中国世界&quot;,</span><br><span class="line">        &quot;slop&quot;: 2</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>现在，两个词组之间<strong>最多可以有</strong>2个词的间隔，这个时候，就可以查询到结果了：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;took&quot; : 1,</span><br><span class="line">  &quot;timed_out&quot; : false,</span><br><span class="line">  &quot;_shards&quot; : &#123;</span><br><span class="line">    &quot;total&quot; : 5,</span><br><span class="line">    &quot;successful&quot; : 5,</span><br><span class="line">    &quot;skipped&quot; : 0,</span><br><span class="line">    &quot;failed&quot; : 0</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;hits&quot; : &#123;</span><br><span class="line">    &quot;total&quot; : 1,</span><br><span class="line">    &quot;max_score&quot; : 0.7445889,</span><br><span class="line">    &quot;hits&quot; : [</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;_index&quot; : &quot;t1&quot;,</span><br><span class="line">        &quot;_type&quot; : &quot;doc&quot;,</span><br><span class="line">        &quot;_id&quot; : &quot;1&quot;,</span><br><span class="line">        &quot;_score&quot; : 0.7445889,</span><br><span class="line">        &quot;_source&quot; : &#123;</span><br><span class="line">          &quot;title&quot; : &quot;中国是世界上人口最多的国家&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="match-phrase-prefix（最左前缀查询）"><a href="#match-phrase-prefix（最左前缀查询）" class="headerlink" title="match_phrase_prefix（最左前缀查询）"></a>match_phrase_prefix（最左前缀查询）</h3><p>功能：查询以<code>bea</code>开头的词：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">PUT t3/doc/1</span><br><span class="line">&#123;</span><br><span class="line">  &quot;title&quot;: &quot;maggie&quot;,</span><br><span class="line">  &quot;desc&quot;: &quot;beautiful girl you are beautiful so&quot;</span><br><span class="line">&#125;</span><br><span class="line">PUT t3/doc/2</span><br><span class="line">&#123;</span><br><span class="line">  &quot;title&quot;: &quot;sun and beach&quot;,</span><br><span class="line">  &quot;desc&quot;: &quot;I like basking on the beach&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">GET t3/doc/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match_phrase_prefix&quot;: &#123;</span><br><span class="line">      &quot;desc&quot;: &quot;bea&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>前缀查询是短语查询类似，但前缀查询可以更进一步的搜索词组，只不过它是和词组中最后一个词条进行前缀匹配（如搜这样的<code>you are bea</code>）。</li>
<li>应用也非常的广泛，比如搜索框的提示信息，当使用这种行为进行搜索时，最好通过<code>max_expansions</code>来设置最大的前缀扩展数量，因为产生的结果会是一个很大的集合，不加限制的话，影响查询性能。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">GET t3/doc/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match_phrase_prefix&quot;: &#123;</span><br><span class="line">      &quot;desc&quot;: &#123;</span><br><span class="line">        &quot;query&quot;: &quot;bea&quot;,</span><br><span class="line">        &quot;max_expansions&quot;: 1</span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>但是，如果此时你去尝试加上<code>max_expansions</code>测试后，你会发现并没有如你想想的一样，仅返回一条数据，而是返回了多条数据。</p>
<blockquote>
<p><code>max_expansions</code>执行的是搜索的编辑（Levenshtein）距离。</p>
<p>那什么是编辑距离呢？</p>
<ul>
<li>编辑距离是一种计算两个字符串间的差异程度的字符串度量（string metric）。我们可以认为编辑距离就是从一个字符串修改到另一个字符串时，其中编辑单个字符（比如修改、插入、删除）所需要的最少次数。</li>
<li>引用elasticsearch官网的一段话：<strong>该max_expansions设置定义了在停止搜索之前模糊查询将匹配的最大术语数，也可以对模糊查询的性能产生显着影响。但是，减少查询字词会产生负面影响，因为查询提前终止可能无法找到某些有效结果。重要的是要理解max_expansions查询限制在分片级别工作，这意味着即使设置为1，多个术语可能匹配，所有术语都来自不同的分片。此行为可能使其看起来好像max_expansions没有生效，因此请注意，计算返回的唯一术语不是确定是否有效的有效方法max_expansions。</strong><br>我想你也没看懂这句话是啥意思，但我们只需知道该参数工作于分片层，也就是Lucene部分，超出我们的研究范围了。<br>我们快刀斩乱麻的记住，<strong>使用前缀查询会非常的影响性能，要对结果集进行限制，就加上这个参数。</strong></li>
</ul>
</blockquote>
<h3 id="multi-match（多字段查询）"><a href="#multi-match（多字段查询）" class="headerlink" title="multi_match（多字段查询）"></a>multi_match（多字段查询）</h3><p>现在，我们有一个50个字段的索引，我们要在多个字段中查询同一个关键字，该怎么做呢？</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">PUT t3/doc/1</span><br><span class="line">&#123;</span><br><span class="line">  &quot;title&quot;: &quot;maggie is beautiful girl&quot;,</span><br><span class="line">  &quot;desc&quot;: &quot;beautiful girl you are beautiful so&quot;</span><br><span class="line">&#125;</span><br><span class="line">PUT t3/doc/2</span><br><span class="line">&#123;</span><br><span class="line">  &quot;title&quot;: &quot;beautiful beach&quot;,</span><br><span class="line">  &quot;desc&quot;: &quot;I like basking on the beach,and you? beautiful girl&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">// 先用原来的方法查询：</span><br><span class="line">GET t3/doc/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;bool&quot;: &#123;</span><br><span class="line">      &quot;must&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">          &quot;match&quot;: &#123;</span><br><span class="line">            &quot;title&quot;: &quot;beautiful&quot;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          &quot;match&quot;: &#123;</span><br><span class="line">            &quot;desc&quot;: &quot;beautiful&quot;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用<code>must</code>来限制两个字段（值）中必须同时含有关键字。</p>
<p>这样虽然能达到目的，但是当有很多的字段呢，我们可以用<code>multi_match</code>来做：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">GET t3/doc/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;multi_match&quot;: &#123;</span><br><span class="line">      &quot;query&quot;: &quot;beautiful&quot;,</span><br><span class="line">      &quot;fields&quot;: [&quot;title&quot;, &quot;desc&quot;]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>除此之外，<code>multi_match</code>甚至可以当做<code>match_phrase</code>和<code>match_phrase_prefix</code>使用，只需要指定<code>type</code>类型即可：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">GET t3/doc/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;multi_match&quot;: &#123;</span><br><span class="line">      &quot;query&quot;: &quot;gi&quot;,</span><br><span class="line">      &quot;fields&quot;: [&quot;title&quot;],</span><br><span class="line">      &quot;type&quot;: &quot;phrase_prefix&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">GET t3/doc/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;multi_match&quot;: &#123;</span><br><span class="line">      &quot;query&quot;: &quot;girl&quot;,</span><br><span class="line">      &quot;fields&quot;: [&quot;title&quot;],</span><br><span class="line">      &quot;type&quot;: &quot;phrase&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="term查询（精确查询）"><a href="#term查询（精确查询）" class="headerlink" title="term查询（精确查询）"></a>term查询（精确查询）</h3><p>elasticsearch在对文档分析期间（将文档分词后保存到倒排索引中），会对文档进行分词，比如默认的标准分析器会对文档进行：</p>
<ul>
<li>删除大多数的标点符号。</li>
<li>将文档分解为单个词条，我们称为token。</li>
<li>将token转为小写。</li>
</ul>
<p>完事再保存到倒排索引上，当然，原文件还是要保存一分的，而倒排索引使用来查询的。</p>
<p>例如<code>Beautiful girl!</code>，在经过分析后是这样的了：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">POST _analyze</span><br><span class="line">&#123;</span><br><span class="line">  &quot;analyzer&quot;: &quot;standard&quot;,</span><br><span class="line">  &quot;text&quot;: &quot;Beautiful girl!&quot;</span><br><span class="line">&#125;</span><br><span class="line"># 结果</span><br><span class="line">[&quot;beautiful&quot;, &quot;girl&quot;]</span><br></pre></td></tr></table></figure>

<blockquote>
<p>关于分析：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/Neeo/articles/10593037.html">https://www.cnblogs.com/Neeo/articles/10593037.html</a></p>
</blockquote>
<p>也就是对查询关键字<code>Beautiful girl!</code>进行分析，得到<code>[&quot;beautiful&quot;, &quot;girl&quot;]</code>，然后分别将这两个单独的token去索引<code>w10</code>中进行查询，结果就是将两篇文档都返回。</p>
<p>这在有些情况下是非常好用的，但是，如果我们想查询确切的词怎么办？也就是精确查询，将<code>Beautiful girl!</code>当成一个token而<strong>不是分词后的两个token</strong>。</p>
<blockquote>
<p>注意：<strong>不要使用term对类型是text的字段进行查询</strong>，要查询text类型的字段，请改用match查询。</p>
<p>因为text自动会被分词解析，就算是使用term去全量匹配，一样也是匹配不了的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">PUT t1/doc/1</span><br><span class="line">&#123;</span><br><span class="line">  &quot;title&quot;: &quot;中国是世界上人口最多的国家&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 如下执行返回null</span><br><span class="line">GET /t1/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;:&#123;</span><br><span class="line">    &quot;term&quot;: &#123;</span><br><span class="line">      &quot;title&quot;: &quot;中国是世界上人口最多的国家&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<p>text类型进行模糊匹配：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">GET /t1/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;:&#123;</span><br><span class="line">    &quot;match&quot;: &#123;</span><br><span class="line">      &quot;title&quot;: &quot;中国&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>text类型进行精确匹配，不能使用term，使用field.keyword</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">GET /t1/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;:&#123;</span><br><span class="line">    &quot;match&quot;: &#123;</span><br><span class="line">      &quot;title.keyword&quot;: &quot;中国&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>注意es的text分词解析会转成小写：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">PUT w10</span><br><span class="line">&#123;</span><br><span class="line">  &quot;mappings&quot;: &#123;</span><br><span class="line">    &quot;doc&quot;:&#123;</span><br><span class="line">      &quot;properties&quot;:&#123;</span><br><span class="line">        &quot;t1&quot;:&#123;</span><br><span class="line">          &quot;type&quot;: &quot;text&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">PUT w10/doc/1</span><br><span class="line">&#123;</span><br><span class="line">  &quot;t1&quot;: &quot;Beautiful girl!&quot;</span><br><span class="line">&#125;</span><br><span class="line">PUT w10/doc/2</span><br><span class="line">&#123;</span><br><span class="line">  &quot;t1&quot;: &quot;sexy girl!&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">GET w10/doc/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;term&quot;: &#123;</span><br><span class="line">      &quot;t1&quot;: &quot;Beautiful&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>答案是，没有结果返回！因为elasticsearch在对文档进行分析时，会经过小写！人家倒排索引上存的是小写的<code>beautiful</code>，而我们查询的是大写的<code>Beautiful</code>。</p>
<h3 id="批量插入"><a href="#批量插入" class="headerlink" title="批量插入"></a>批量插入</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">POST customer/external/_bulk</span><br><span class="line">&#123;</span><br><span class="line">  &quot;index&quot;: &#123;</span><br><span class="line">    &quot;_id&quot;: 1</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#123;</span><br><span class="line">  &quot;name&quot;: &quot;榨干&quot;</span><br><span class="line">&#125;</span><br><span class="line">&#123;</span><br><span class="line">  &quot;index&quot;: &#123;</span><br><span class="line">    &quot;_id&quot;: 2</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#123;</span><br><span class="line">  &quot;name&quot;: &quot;你瞅啥&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="排序查询"><a href="#排序查询" class="headerlink" title="排序查询"></a><a target="_blank" rel="noopener" href="https://www.cnblogs.com/Neeo/articles/10578456.html">排序查询</a></h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">GET zhifou/doc/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match&quot;: &#123;</span><br><span class="line">      &quot;from&quot;: &quot;gu&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;sort&quot;:[</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;age&quot;:&#123;</span><br><span class="line">        &quot;order&quot;:&quot;desc&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;score&quot;:&#123;</span><br><span class="line">        &quot;order&quot;:&quot;asc&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意：在排序的过程中，只能使用可排序的属性进行排序。那么可以排序的属性有哪些呢？</p>
<ul>
<li>数字</li>
<li>日期</li>
</ul>
<p>其他的都不行！</p>
<h2 id="分页查询"><a href="#分页查询" class="headerlink" title="分页查询"></a><a target="_blank" rel="noopener" href="https://www.cnblogs.com/Neeo/articles/10578453.html">分页查询</a></h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">GET zhifou/doc/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;:&#123;</span><br><span class="line">    &quot;match_all&quot;: &#123;&#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;sort&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;age&quot;:&#123;</span><br><span class="line">        &quot;order&quot;: &quot;desc&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  &quot;from&quot;:0,</span><br><span class="line">  &quot;size&quot;: 20</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>学到这里，我们也可以看到，我们的查询条件越来越多，开始仅是简单查询，慢慢增加条件查询，增加排序，对返回结果进行限制。所以，我们可以说：<strong>对于<code>elasticsearch</code>来说，所有的条件都是可插拔的，彼此之间用<code>,</code>分割</strong>。</p>
</blockquote>
<h2 id="布尔查询"><a href="#布尔查询" class="headerlink" title="布尔查询"></a><a target="_blank" rel="noopener" href="https://www.cnblogs.com/Neeo/articles/10578625.html">布尔查询</a></h2><p>布尔查询是最常用的组合查询，根据子查询的规则，只有当文档满足所有子查询条件时，elasticsearch引擎才将结果返回。布尔查询支持的子查询条件共4中：</p>
<ul>
<li>must（and）</li>
<li>should（or）</li>
<li>must_not（not）</li>
<li>filter</li>
</ul>
<h3 id="must，should"><a href="#must，should" class="headerlink" title="must，should"></a>must，should</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">GET /zhifou/doc/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;:&#123;</span><br><span class="line">    &quot;bool&quot;: &#123;</span><br><span class="line">      &quot;must&quot;:[</span><br><span class="line">        &#123;</span><br><span class="line">          &quot;match&quot;: &#123;</span><br><span class="line">            &quot;age&quot;: 25</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          &quot;match&quot;: &#123;</span><br><span class="line">            &quot;tags&quot;: &quot;闭月&quot;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>should同理</p>
<h3 id="must-not"><a href="#must-not" class="headerlink" title="must_not"></a>must_not</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">GET zhifou/doc/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;bool&quot;: &#123;</span><br><span class="line">      &quot;must_not&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">          &quot;match&quot;: &#123;</span><br><span class="line">            &quot;from&quot;: &quot;gu&quot;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          &quot;match&quot;: &#123;</span><br><span class="line">            &quot;tags&quot;: &quot;可爱&quot;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          &quot;match&quot;: &#123;</span><br><span class="line">            &quot;age&quot;: 18</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="filter"><a href="#filter" class="headerlink" title="filter"></a>filter</h3><p>查询年龄处于10-20，tags包含白，name包含大娘子的文档</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">GET /zhifou/doc/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;:&#123;</span><br><span class="line">    &quot;bool&quot;: &#123;</span><br><span class="line">      &quot;filter&quot;: &#123;</span><br><span class="line">        &quot;range&quot;: &#123;</span><br><span class="line">          &quot;age&quot;: &#123;</span><br><span class="line">            &quot;gte&quot;: 10,</span><br><span class="line">            &quot;lte&quot;: 20</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;must&quot;:[</span><br><span class="line">        &#123;</span><br><span class="line">          &quot;match&quot;:&#123;</span><br><span class="line">            &quot;tags&quot;: &quot;白&quot;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          &quot;match&quot;: &#123;</span><br><span class="line">            &quot;name&quot;:&quot;大娘子&quot;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>查询<code>age</code>小于<code>25</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">GET zhifou/doc/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;bool&quot;: &#123;</span><br><span class="line">      &quot;filter&quot;: &#123;</span><br><span class="line">        &quot;range&quot;: &#123;</span><br><span class="line">          &quot;age&quot;: &#123;</span><br><span class="line">            &quot;lt&quot;: 25</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="filter和must-should的优先级"><a href="#filter和must-should的优先级" class="headerlink" title="filter和must/should的优先级"></a>filter和must/should的优先级</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">GET zhifou/doc/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;bool&quot;: &#123;</span><br><span class="line">      &quot;should&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">          &quot;match&quot;: &#123;</span><br><span class="line">            &quot;from&quot;: &quot;sheng&quot;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ],</span><br><span class="line">      &quot;filter&quot;: &#123;</span><br><span class="line">        &quot;range&quot;: &#123;</span><br><span class="line">          &quot;age&quot;: &#123;</span><br><span class="line">            &quot;lte&quot;: 25</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>输出hits</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;_index&quot; : &quot;zhifou&quot;,</span><br><span class="line">        &quot;_type&quot; : &quot;doc&quot;,</span><br><span class="line">        &quot;_id&quot; : &quot;2&quot;,</span><br><span class="line">        &quot;_score&quot; : 0.6931472,</span><br><span class="line">        &quot;_source&quot; : &#123;</span><br><span class="line">          &quot;name&quot; : &quot;大娘子&quot;,</span><br><span class="line">          &quot;age&quot; : 18,</span><br><span class="line">          &quot;from&quot; : &quot;sheng&quot;,</span><br><span class="line">          &quot;desc&quot; : &quot;肤白貌美，娇憨可爱&quot;,</span><br><span class="line">          &quot;tags&quot; : [</span><br><span class="line">            &quot;白&quot;,</span><br><span class="line">            &quot;富&quot;,</span><br><span class="line">            &quot;美&quot;</span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;_index&quot; : &quot;zhifou&quot;,</span><br><span class="line">        &quot;_type&quot; : &quot;doc&quot;,</span><br><span class="line">        &quot;_id&quot; : &quot;3&quot;,</span><br><span class="line">        &quot;_score&quot; : 0.0,</span><br><span class="line">        &quot;_source&quot; : &#123;</span><br><span class="line">          &quot;name&quot; : &quot;龙套偏房&quot;,</span><br><span class="line">          &quot;age&quot; : 22,</span><br><span class="line">          &quot;from&quot; : &quot;gu&quot;,</span><br><span class="line">          &quot;desc&quot; : &quot;mmp，没怎么看，不知道怎么形容&quot;,</span><br><span class="line">          &quot;tags&quot; : [</span><br><span class="line">            &quot;造数据&quot;,</span><br><span class="line">            &quot;真&quot;,</span><br><span class="line">            &quot;难&quot;</span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br></pre></td></tr></table></figure>

<p>结果有点出乎意料，因为龙套偏房和魏行首不属于盛家，但也被查询出来了。</p>
<p>这是因为在查询过程中，<strong>优先经过<code>filter</code>过滤</strong>，因为<code>should</code>是或关系，龙套偏房和魏行首的年龄符合了<code>filter</code>过滤条件，也就被放行了！</p>
<p>所以，<strong>如果在<code>filter</code>过滤条件中使用<code>should</code>的话，结果可能不会尽如人意！建议使用<code>must</code>代替</strong>。</p>
<h4 id="filter必须工作于bool查询内"><a href="#filter必须工作于bool查询内" class="headerlink" title="filter必须工作于bool查询内"></a><strong><code>filter</code>必须工作于<code>bool</code>查询内</strong></h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">GET zhifou/doc/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;bool&quot;: &#123;</span><br><span class="line">      &quot;must&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">          &quot;match&quot;: &#123;</span><br><span class="line">            &quot;from&quot;: &quot;sheng&quot;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;filter&quot;: &#123;</span><br><span class="line">      &quot;range&quot;： &#123;</span><br><span class="line">        &quot;age&quot;: &#123;</span><br><span class="line">          &quot;lte&quot;: 25</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;error&quot;: &#123;</span><br><span class="line">    &quot;root_cause&quot;: [</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;type&quot;: &quot;parsing_exception&quot;,</span><br><span class="line">        &quot;reason&quot;: &quot;[bool] malformed query, expected [END_OBJECT] but found [FIELD_NAME]&quot;,</span><br><span class="line">        &quot;line&quot;: 12,</span><br><span class="line">        &quot;col&quot;: 5</span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    &quot;type&quot;: &quot;parsing_exception&quot;,</span><br><span class="line">    &quot;reason&quot;: &quot;[bool] malformed query, expected [END_OBJECT] but found [FIELD_NAME]&quot;,</span><br><span class="line">    &quot;line&quot;: 12,</span><br><span class="line">    &quot;col&quot;: 5</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;status&quot;: 400</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="查询结果过滤"><a href="#查询结果过滤" class="headerlink" title="查询结果过滤"></a><a target="_blank" rel="noopener" href="https://www.cnblogs.com/Neeo/articles/10578522.html">查询结果过滤</a></h2><p>需要查看<code>name</code>和<code>age</code>两个属性</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">GET zhifou/doc/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match&quot;: &#123;</span><br><span class="line">      &quot;name&quot;: &quot;顾老二&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;_source&quot;: [&quot;name&quot;, &quot;age&quot;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="高亮查询"><a href="#高亮查询" class="headerlink" title="高亮查询"></a><a target="_blank" rel="noopener" href="https://www.cnblogs.com/Neeo/articles/10584089.html">高亮查询</a></h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">GET zhifou/doc/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match&quot;: &#123;</span><br><span class="line">      &quot;name&quot;: &quot;石头&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;highlight&quot;: &#123;</span><br><span class="line">    &quot;fields&quot;: &#123;</span><br><span class="line">      &quot;name&quot;: &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="自定义高亮显示"><a href="#自定义高亮显示" class="headerlink" title="自定义高亮显示"></a>自定义高亮显示</h3><p>在<code>highlight</code>中，<code>pre_tags</code>用来实现我们的自定义标签的前半部分，在这里，我们也可以为自定义的标签添加属性和样式。<code>post_tags</code>实现标签的后半部分，组成一个完整的标签。至于标签中的内容，则还是交给<code>fields</code>来完成。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">GET zhifou/chengyuan/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match&quot;: &#123;</span><br><span class="line">      &quot;from&quot;: &quot;gu&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;highlight&quot;: &#123;</span><br><span class="line">    &quot;pre_tags&quot;: &quot;&lt;b class=&#x27;key&#x27; style=&#x27;color:red&#x27;&gt;&quot;,</span><br><span class="line">    &quot;post_tags&quot;: &quot;&lt;/b&gt;&quot;,</span><br><span class="line">    &quot;fields&quot;: &#123;</span><br><span class="line">      &quot;from&quot;: &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>自定义标签中属性或样式中的逗号一律用英文状态的单引号表示，应该与外部<code>elasticsearch</code>语法的双引号区分开</strong>。</p>
<h2 id="聚合函数"><a href="#聚合函数" class="headerlink" title="聚合函数"></a><a target="_blank" rel="noopener" href="https://www.cnblogs.com/Neeo/articles/10584374.html">聚合函数</a></h2><ul>
<li>avg</li>
<li>max</li>
<li>min</li>
<li>sum</li>
</ul>
<p>查询<code>from</code>是<code>gu</code>的人的平均年龄。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">GET zhifou/doc/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match&quot;: &#123;</span><br><span class="line">      &quot;from&quot;: &quot;gu&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;aggs&quot;: &#123;</span><br><span class="line">    &quot;my_avg&quot;: &#123;</span><br><span class="line">      &quot;avg&quot;: &#123;</span><br><span class="line">        &quot;field&quot;: &quot;age&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;_source&quot;: [&quot;name&quot;, &quot;age&quot;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>聚合函数：其语法被封装在<code>aggs</code>中，而<code>my_avg</code>则是为查询结果起个别名，封装了计算出的平均值。</p>
<h3 id="分组查询"><a href="#分组查询" class="headerlink" title="分组查询"></a>分组查询</h3><p>使用range分组。</p>
<p>查询所有人的年龄段，并且按照<code>15~20，20~25,25~30</code>分组，并且算出每组的平均年龄。</p>
<ul>
<li><p>使用<code>range</code>来做分组：按照<code>15~20，20~25,25~30</code>分组</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">GET zhifou/doc/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;size&quot;: 0, </span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match_all&quot;: &#123;&#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;aggs&quot;: &#123;</span><br><span class="line">    &quot;my_age_group&quot;: &#123;</span><br><span class="line">      &quot;range&quot;: &#123;</span><br><span class="line">        &quot;field&quot;: &quot;age&quot;,</span><br><span class="line">        &quot;ranges&quot;: [</span><br><span class="line">          &#123;</span><br><span class="line">            &quot;from&quot;: 15,</span><br><span class="line">            &quot;to&quot;: 20</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            &quot;from&quot;: 20,</span><br><span class="line">            &quot;to&quot;: 25</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            &quot;from&quot;: 25,</span><br><span class="line">            &quot;to&quot;: 30</span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>使用<code>aggs</code>来聚合：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">GET zhifou/doc/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;size&quot;: 0, </span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match_all&quot;: &#123;&#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;aggs&quot;: &#123;</span><br><span class="line">    &quot;my_age_group&quot;: &#123;</span><br><span class="line">      &quot;range&quot;: &#123;</span><br><span class="line">        &quot;field&quot;: &quot;age&quot;,</span><br><span class="line">        &quot;ranges&quot;: [</span><br><span class="line">          &#123;</span><br><span class="line">            &quot;from&quot;: 15,</span><br><span class="line">            &quot;to&quot;: 20</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            &quot;from&quot;: 20,</span><br><span class="line">            &quot;to&quot;: 25</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            &quot;from&quot;: 25,</span><br><span class="line">            &quot;to&quot;: 30</span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;aggs&quot;: &#123;</span><br><span class="line">        &quot;my_avg&quot;: &#123;</span><br><span class="line">          &quot;avg&quot;: &#123;</span><br><span class="line">            &quot;field&quot;: &quot;age&quot;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<blockquote>
<p><strong>聚合函数的使用，一定是先查出结果，然后对结果使用聚合函数做处理</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">GET zhifou/doc/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match&quot;: &#123;</span><br><span class="line">      &quot;from&quot;: &quot;gu&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;aggs&quot;: &#123;</span><br><span class="line">    &quot;my_avg&quot;: &#123;</span><br><span class="line">      &quot;avg&quot;: &#123;</span><br><span class="line">        &quot;field&quot;: &quot;age&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;_source&quot;: [&quot;name&quot;, &quot;age&quot;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如上，可以简化如下。aggs就是对上面的query进行聚合的。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	&quot;query&quot;:&#123;&#125;,</span><br><span class="line">	&quot;aggs&quot;:&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>示例二</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">GET zhifou/doc/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;size&quot;: 0, </span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match_all&quot;: &#123;&#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;aggs&quot;: &#123;</span><br><span class="line">    &quot;my_age_group&quot;: &#123;</span><br><span class="line">      &quot;range&quot;: &#123;</span><br><span class="line">        &quot;field&quot;: &quot;age&quot;,</span><br><span class="line">        &quot;ranges&quot;: [</span><br><span class="line">          &#123;</span><br><span class="line">            &quot;from&quot;: 15,</span><br><span class="line">            &quot;to&quot;: 20</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            &quot;from&quot;: 20,</span><br><span class="line">            &quot;to&quot;: 25</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            &quot;from&quot;: 25,</span><br><span class="line">            &quot;to&quot;: 30</span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;aggs&quot;: &#123;</span><br><span class="line">        &quot;my_avg&quot;: &#123;</span><br><span class="line">          &quot;avg&quot;: &#123;</span><br><span class="line">            &quot;field&quot;: &quot;age&quot;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以简化成：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	&quot;query&quot;:&#123;&#125;,</span><br><span class="line">	&quot;aggs&quot;:&#123;</span><br><span class="line">		“range&quot;:&#123;&#125;</span><br><span class="line">		&quot;aggs&quot;:&#123;&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>range返回一个query，然后<code>&quot;aggs&quot;:&#123;&#125;</code>再对这个query做一个聚合</p>
</blockquote>
<h2 id="Mappings"><a href="#Mappings" class="headerlink" title="Mappings"></a><a target="_blank" rel="noopener" href="https://www.cnblogs.com/Neeo/articles/10585039.html">Mappings</a></h2><h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">PUT t1/doc/1</span><br><span class="line">&#123;</span><br><span class="line">  &quot;name&quot;: &quot;小黑&quot;</span><br><span class="line">&#125;</span><br><span class="line">PUT t1/doc/2</span><br><span class="line">&#123;</span><br><span class="line">  &quot;name&quot;: &quot;小白&quot;,</span><br><span class="line">  &quot;age&quot;: 18</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>文档的字段可以是任意的，原本都是<code>name</code>字段，突然来个<code>age</code>。还要elasticsearch自动去猜，哦，可能是个<code>long</code>类型，然后加个映射！</p>
<p>当我们执行上述第一条<code>PUT</code>命令后，elasticsearch到底是怎么做的：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET t1</span><br></pre></td></tr></table></figure>

<p>输出：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;t1&quot;</span> : &#123;</span><br><span class="line">    <span class="attr">&quot;aliases&quot;</span> : &#123; &#125;,</span><br><span class="line">    <span class="attr">&quot;mappings&quot;</span> : &#123;</span><br><span class="line">      <span class="attr">&quot;doc&quot;</span> : &#123;</span><br><span class="line">        <span class="attr">&quot;properties&quot;</span> : &#123;</span><br><span class="line">          <span class="attr">&quot;name&quot;</span> : &#123;</span><br><span class="line">            <span class="attr">&quot;type&quot;</span> : <span class="string">&quot;text&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;fields&quot;</span> : &#123;</span><br><span class="line">              <span class="attr">&quot;keyword&quot;</span> : &#123;</span><br><span class="line">                <span class="attr">&quot;type&quot;</span> : <span class="string">&quot;keyword&quot;</span>,</span><br><span class="line">                <span class="attr">&quot;ignore_above&quot;</span> : <span class="number">256</span></span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">&quot;settings&quot;</span> : &#123;</span><br><span class="line">      <span class="attr">&quot;index&quot;</span> : &#123;</span><br><span class="line">        <span class="attr">&quot;creation_date&quot;</span> : <span class="string">&quot;1553334893136&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;number_of_shards&quot;</span> : <span class="string">&quot;5&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;number_of_replicas&quot;</span> : <span class="string">&quot;1&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;uuid&quot;</span> : <span class="string">&quot;lHfujZBbRA2K7QDdsX4_wA&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;version&quot;</span> : &#123;</span><br><span class="line">          <span class="attr">&quot;created&quot;</span> : <span class="string">&quot;6050499&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;provided_name&quot;</span> : <span class="string">&quot;t1&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面输出分成三部分：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;t1&quot; : &#123;</span><br><span class="line">    &quot;aliases&quot; : &#123; &#125;,</span><br><span class="line">    &quot;mappings&quot; : &#123; &#125;,</span><br><span class="line">    &quot;settings&quot; : &#123; &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>该索引是否有别名<code>aliases</code>，</li>
<li><code>mappings</code>信息，包括索引类型<code>doc</code>，<strong>各字段的详细映射关系都收集在<code>properties</code>中。</strong></li>
<li><code>settings</code>设置。包括该索引的创建时间，主副分片的信息，UUID等等。</li>
</ul>
<p>再执行第二条<code>PUT</code>命令，再查看该索引是否有什么变化，返回结果如下：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;t1&quot;</span> : &#123;</span><br><span class="line">    <span class="attr">&quot;aliases&quot;</span> : &#123; &#125;,</span><br><span class="line">    <span class="attr">&quot;mappings&quot;</span> : &#123;</span><br><span class="line">      <span class="attr">&quot;doc&quot;</span> : &#123;</span><br><span class="line">        <span class="attr">&quot;properties&quot;</span> : &#123;</span><br><span class="line">          <span class="attr">&quot;age&quot;</span> : &#123;</span><br><span class="line">            <span class="attr">&quot;type&quot;</span> : <span class="string">&quot;long&quot;</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="attr">&quot;name&quot;</span> : &#123;</span><br><span class="line">            <span class="attr">&quot;type&quot;</span> : <span class="string">&quot;text&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;fields&quot;</span> : &#123;</span><br><span class="line">              <span class="attr">&quot;keyword&quot;</span> : &#123;</span><br><span class="line">                <span class="attr">&quot;type&quot;</span> : <span class="string">&quot;keyword&quot;</span>,</span><br><span class="line">                <span class="attr">&quot;ignore_above&quot;</span> : <span class="number">256</span></span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">&quot;settings&quot;</span> : &#123;</span><br><span class="line">      <span class="attr">&quot;index&quot;</span> : &#123;</span><br><span class="line">        <span class="attr">&quot;creation_date&quot;</span> : <span class="string">&quot;1553334893136&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;number_of_shards&quot;</span> : <span class="string">&quot;5&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;number_of_replicas&quot;</span> : <span class="string">&quot;1&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;uuid&quot;</span> : <span class="string">&quot;lHfujZBbRA2K7QDdsX4_wA&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;version&quot;</span> : &#123;</span><br><span class="line">          <span class="attr">&quot;created&quot;</span> : <span class="string">&quot;6050499&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;provided_name&quot;</span> : <span class="string">&quot;t1&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>由返回结果可以看到，<code>settings</code>没有变化，只是<code>mappings</code>中多了一条关于<code>age</code>的映射关系</p>
<h3 id="映射是什么"><a href="#映射是什么" class="headerlink" title="映射是什么"></a>映射是什么</h3><p><code>elasticsearch</code>中的映射用来定义一个文档及其包含的字段如何存储和索引的过程。</p>
<p>例如，我们可以使用映射来定义：</p>
<ul>
<li>哪些字符串应该被视为全文字段。</li>
<li>哪些字段包含数字、日期或者地理位置。</li>
<li>定义日期的格式。</li>
<li>自定义的规则，用来控制动态添加字段的的映射。</li>
</ul>
<h3 id="映射类型"><a href="#映射类型" class="headerlink" title="映射类型"></a>映射类型</h3><p>6.x版本后，每个索引都有一个映射类型，它决定了文档将如何被索引。</p>
<p>映射类型有：</p>
<ul>
<li>元字段（meta-fields）：元字段用于自定义如何处理文档关联的元数据，例如包括文档的<code>_index</code>、<code>_type</code>、<code>_id</code>和<code>_source</code>字段。</li>
<li>字段或属性（field or properties）：映射类型包含与文档相关的字段或者属性的列表。</li>
</ul>
<h3 id="字段的数据类型"><a href="#字段的数据类型" class="headerlink" title="字段的数据类型"></a>字段的数据类型</h3><ul>
<li>简单类型，如文本（<code>text</code>）、关键字（<code>keyword</code>）、日期（<code>date</code>）、整形（<code>long</code>）、双精度（<code>double</code>）、布尔（<code>boolean</code>）或<code>ip</code>。</li>
<li>可以是支持<code>JSON</code>的层次结构性质的类型，如对象或嵌套。</li>
<li>或者一种特殊类型，如<code>geo_point</code>、<code>geo_shape</code>或<code>completion</code>。</li>
</ul>
<h3 id="映射约束"><a href="#映射约束" class="headerlink" title="映射约束"></a>映射约束</h3><p>在索引中定义太多的字段有可能导致映射<strong>爆炸</strong>！因为这可能会导致内存不足以及难以恢复的情况，为此。我们可以手动或动态的创建字段映射的数量：</p>
<ul>
<li>index.mapping.total_fields.limit：索引中的最大字段数。字段和对象映射以及字段别名都计入此限制。默认值为1000。</li>
<li>index.mapping.depth.limit：字段的最大深度，以内部对象的数量来衡量。例如，如果所有字段都在根对象级别定义，则深度为1.如果有一个子对象映射，则深度为2，等等。默认值为20。</li>
<li>index.mapping.nested_fields.limit：索引中嵌套字段的最大数量，默认为50.索引1个包含100个嵌套字段的文档实际上索引101个文档，因为每个嵌套文档都被索引为单独的隐藏文档。</li>
</ul>
<h3 id="一个简单的映射示例"><a href="#一个简单的映射示例" class="headerlink" title="一个简单的映射示例"></a>一个简单的映射示例</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">PUT mapping_test1</span><br><span class="line">&#123;</span><br><span class="line">  &quot;mappings&quot;: &#123;</span><br><span class="line">    &quot;test1&quot;:&#123;</span><br><span class="line">      &quot;properties&quot;:&#123;</span><br><span class="line">        &quot;name&quot;:&#123;&quot;type&quot;: &quot;text&quot;&#125;,</span><br><span class="line">        &quot;age&quot;:&#123;&quot;type&quot;:&quot;long&quot;&#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="dynamic的三种状态"><a href="#dynamic的三种状态" class="headerlink" title="dynamic的三种状态"></a><a target="_blank" rel="noopener" href="https://www.cnblogs.com/Neeo/articles/10585035.html">dynamic的三种状态</a></h3><p>一般的，<code>mapping</code>则又可以分为：</p>
<ul>
<li>动态映射（dynamic：true）：动态添加新的字段（或缺省）。</li>
<li>静态映射（dynamic：false）：忽略新的字段。在原有的映射基础上，当有新的字段时，不会主动的添加新的映射关系，只作为查询结果出现在查询中。</li>
<li>严格模式（dynamic： strict）：如果遇到新的字段，就抛出异常。</li>
</ul>
<h4 id="动态映射（dynamic：true）"><a href="#动态映射（dynamic：true）" class="headerlink" title="动态映射（dynamic：true）"></a>动态映射（dynamic：true）</h4><p>当 Elasticsearch 遇到文档中以前未遇到的字段，它用动态映射来确定字段的数据类型并自动把新的字段添加到类型映射。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">PUT m1</span><br><span class="line">&#123;</span><br><span class="line">  &quot;mappings&quot;: &#123;</span><br><span class="line">    &quot;doc&quot;:&#123;</span><br><span class="line">      &quot;properties&quot;: &#123;</span><br><span class="line">        &quot;name&quot;: &#123;</span><br><span class="line">          &quot;type&quot;: &quot;text&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;age&quot;: &#123;</span><br><span class="line">          &quot;type&quot;: &quot;long&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>添加一些数据，并且新增一个<code>sex</code>字段：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">PUT m1/doc/1</span><br><span class="line">&#123;</span><br><span class="line">  &quot;name&quot;: &quot;小黑&quot;,</span><br><span class="line">  &quot;age&quot;: 18,</span><br><span class="line">  &quot;sex&quot;: &quot;不详&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>执行成功的原因就是因为dynamic：true</p>
<p>其实创建索引的时候，是这样的：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">PUT m1</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;mappings&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;doc&quot;</span>:&#123;</span><br><span class="line">      <span class="attr">&quot;dynamic&quot;</span>:<span class="literal">true</span>,</span><br><span class="line">      <span class="attr">&quot;properties&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;name&quot;</span>: &#123;</span><br><span class="line">          <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;age&quot;</span>: &#123;</span><br><span class="line">          <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;long&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="静态映射（dynamic：false）"><a href="#静态映射（dynamic：false）" class="headerlink" title="静态映射（dynamic：false）"></a>静态映射（dynamic：false）</h4><p>将<code>dynamic</code>值设置为<code>false</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">PUT m2</span><br><span class="line">&#123;</span><br><span class="line">  &quot;mappings&quot;: &#123;</span><br><span class="line">    &quot;doc&quot;:&#123;</span><br><span class="line">      &quot;dynamic&quot;:false,</span><br><span class="line">      &quot;properties&quot;: &#123;</span><br><span class="line">        &quot;name&quot;: &#123;</span><br><span class="line">          &quot;type&quot;: &quot;text&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;age&quot;: &#123;</span><br><span class="line">          &quot;type&quot;: &quot;long&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>插入数据：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">PUT m2/doc/1</span><br><span class="line">&#123;</span><br><span class="line">  &quot;name&quot;: &quot;小黑&quot;,</span><br><span class="line">  &quot;age&quot;:18</span><br><span class="line">&#125;</span><br><span class="line">PUT m2/doc/2</span><br><span class="line">&#123;</span><br><span class="line">  &quot;name&quot;: &quot;小白&quot;,</span><br><span class="line">  &quot;age&quot;: 16,</span><br><span class="line">  &quot;sex&quot;: &quot;不详&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意，虽然是静态映射，但是第二条数据依然可以创建。只是会把sex字段自动抛弃</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">GET m2/doc/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match&quot;: &#123;</span><br><span class="line">      &quot;sex&quot;: &quot;不详&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">输出：</span><br><span class="line">&#123;</span><br><span class="line">  &quot;took&quot; : 0,</span><br><span class="line">  &quot;timed_out&quot; : false,</span><br><span class="line">  &quot;_shards&quot; : &#123;</span><br><span class="line">    &quot;total&quot; : 5,</span><br><span class="line">    &quot;successful&quot; : 5,</span><br><span class="line">    &quot;skipped&quot; : 0,</span><br><span class="line">    &quot;failed&quot; : 0</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;hits&quot; : &#123;</span><br><span class="line">    &quot;total&quot; : 0,</span><br><span class="line">    &quot;max_score&quot; : null,</span><br><span class="line">    &quot;hits&quot; : [ ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>因为<code>dynamic:false</code>的关系，会忽略该字段，但是仍会存储该字段。</p>
</blockquote>
<h4 id="严格模式（dynamic：strict）"><a href="#严格模式（dynamic：strict）" class="headerlink" title="严格模式（dynamic：strict）"></a>严格模式（dynamic：strict）</h4><p>将<code>dynamic</code>的状态改为<code>strict</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">PUT m3</span><br><span class="line">&#123;</span><br><span class="line">  &quot;mappings&quot;: &#123;</span><br><span class="line">    &quot;doc&quot;: &#123;</span><br><span class="line">      &quot;dynamic&quot;: &quot;strict&quot;, </span><br><span class="line">      &quot;properties&quot;: &#123;</span><br><span class="line">        &quot;name&quot;: &#123;</span><br><span class="line">          &quot;type&quot;: &quot;text&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;age&quot;: &#123;</span><br><span class="line">          &quot;type&quot;: &quot;long&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>添加数据：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">PUT m3/doc/1</span><br><span class="line">&#123;</span><br><span class="line">  &quot;name&quot;: &quot;小黑&quot;,</span><br><span class="line">  &quot;age&quot;: 18</span><br><span class="line">&#125;</span><br><span class="line">PUT m3/doc/2</span><br><span class="line">&#123;</span><br><span class="line">  &quot;name&quot;: &quot;小白&quot;,</span><br><span class="line">  &quot;age&quot;: 18,</span><br><span class="line">  &quot;sex&quot;: &quot;不详&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>添加第二条数据的时候报错</p>
<blockquote>
<p>当<code>dynamic:strict</code>的时候，elasticsearch如果遇到新字段，会抛出异常。</p>
</blockquote>
<ul>
<li>一般<strong>静态映射用的较多</strong>。就像<code>HTML</code>的<code>img</code>标签一样，<code>src</code>为自带的属性，你可以在需要的时候添加<code>id</code>或者<code>class</code>属性。</li>
<li>当然，如果你非常非常了解你的数据，并且未来很长一段时间不会改变，<code>strict</code>不失为一个好选择。</li>
</ul>
<h3 id="Mappings的其他设置"><a href="#Mappings的其他设置" class="headerlink" title="Mappings的其他设置"></a><a target="_blank" rel="noopener" href="https://www.cnblogs.com/Neeo/articles/10395524.html">Mappings的其他设置</a></h3><h4 id="ignore-above属性"><a href="#ignore-above属性" class="headerlink" title="ignore_above属性"></a>ignore_above属性</h4><ul>
<li>长度超过<code>ignore_above</code>设置的字符串将不会被索引或存储（个人认为会存储，但不会为该字段建立索引，也就是该字段不能被检索）。 </li>
<li>对于字符串数组，<code>ignore_above</code>将分别应用于每个数组元素，并且不会索引或存储比<code>ignore_above</code>更长的字符串元素。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">PUT w1</span><br><span class="line">&#123;</span><br><span class="line">  &quot;mappings&quot;: &#123;</span><br><span class="line">    &quot;doc&quot;:&#123;</span><br><span class="line">      &quot;properties&quot;:&#123;</span><br><span class="line">        &quot;t1&quot;:&#123;</span><br><span class="line">          &quot;type&quot;:&quot;keyword&quot;,</span><br><span class="line">          &quot;ignore_above&quot;: 5</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;t2&quot;:&#123;</span><br><span class="line">          &quot;type&quot;:&quot;keyword&quot;,</span><br><span class="line">          &quot;ignore_above&quot;: 10   ①</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">PUT w1/doc/1</span><br><span class="line">&#123;</span><br><span class="line">  &quot;t1&quot;:&quot;elk&quot;,          ②</span><br><span class="line">  &quot;t2&quot;:&quot;elasticsearch&quot;  ③</span><br><span class="line">&#125;</span><br><span class="line">GET w1/doc/_search   ④</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;:&#123;</span><br><span class="line">    &quot;term&quot;: &#123;</span><br><span class="line">      &quot;t1&quot;: &quot;elk&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">GET w1/doc/_search  ⑤</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;term&quot;: &#123;</span><br><span class="line">      &quot;t2&quot;: &quot;elasticsearch&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>①，该字段将忽略任何超过10个字符的字符串。<br>②，此文档已成功建立索引，也就是说能被查询，并且有结果返回。<br>③，该字段将不会建立索引，也就是说，以该字段作为查询条件，将不会有结果返回。<br>④，有结果返回。<br>⑤，则将不会有结果返回，因为<code>t2</code>字段对应的值长度超过了<code>ignove_above</code>设置的值。</p>
<h4 id="index属性"><a href="#index属性" class="headerlink" title="index属性"></a>index属性</h4><p><code>index</code>属性默认为<code>true</code>，如果该属性设置为<code>false</code>，那么，<code>elasticsearch</code>不会为该属性创建索引，也就是说无法当做主查询条件。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">PUT m4</span><br><span class="line">&#123;</span><br><span class="line">  &quot;mappings&quot;: &#123;</span><br><span class="line">    &quot;doc&quot;: &#123;</span><br><span class="line">      &quot;dynamic&quot;: false,</span><br><span class="line">      &quot;properties&quot;: &#123;</span><br><span class="line">        &quot;name&quot;: &#123;</span><br><span class="line">          &quot;type&quot;: &quot;text&quot;,</span><br><span class="line">          &quot;index&quot;: true</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;age&quot;: &#123;</span><br><span class="line">          &quot;type&quot;: &quot;long&quot;,</span><br><span class="line">          &quot;index&quot;: false</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">PUT m4/doc/1</span><br><span class="line">&#123;</span><br><span class="line">  &quot;name&quot;: &quot;小黑&quot;,</span><br><span class="line">  &quot;age&quot;: 18</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">GET m4/doc/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match&quot;: &#123;</span><br><span class="line">      &quot;name&quot;: &quot;小黑&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// error occurre</span><br><span class="line">GET m4/doc/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match&quot;: &#123;</span><br><span class="line">      &quot;age&quot;: 18</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="copy-to属性"><a href="#copy-to属性" class="headerlink" title="copy_to属性"></a>copy_to属性</h4><p>该属性允许我们将多个字段的值复制到组字段中，然后将组字段作为单个字段进行查询。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">PUT m5</span><br><span class="line">&#123;</span><br><span class="line">  &quot;mappings&quot;: &#123;</span><br><span class="line">    &quot;dynamic&quot;:false,</span><br><span class="line">    &quot;properties&quot;: &#123;</span><br><span class="line">      &quot;first_name&quot;:&#123;</span><br><span class="line">        &quot;type&quot;: &quot;text&quot;,</span><br><span class="line">        &quot;copy_to&quot;: &quot;full_name&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;last_name&quot;: &#123;</span><br><span class="line">        &quot;type&quot;: &quot;text&quot;,</span><br><span class="line">        &quot;copy_to&quot;: &quot;full_name&quot;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;full_name&quot;: &#123;</span><br><span class="line">        &quot;type&quot;: &quot;text&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">PUT m5/_doc/1</span><br><span class="line">&#123;</span><br><span class="line">  &quot;first_name&quot;:&quot;tom&quot;,</span><br><span class="line">  &quot;last_name&quot;:&quot;ben&quot;</span><br><span class="line">&#125;</span><br><span class="line">PUT m5/_doc/2</span><br><span class="line">&#123;</span><br><span class="line">  &quot;first_name&quot;:&quot;john&quot;,</span><br><span class="line">  &quot;last_name&quot;:&quot;smith&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">GET m5/_doc/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match&quot;: &#123;</span><br><span class="line">      &quot;first_name&quot;: &quot;tom&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">GET m5/_doc/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match&quot;: &#123;</span><br><span class="line">      &quot;full_name&quot;: &quot;tom&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上例中，我们将<code>first_name</code>和<code>last_name</code>都复制到<code>full_name</code>中。并且使用<code>full_name</code>查询也返回了结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&quot;hits&quot; : [</span><br><span class="line">  &#123;</span><br><span class="line">    &quot;_index&quot; : &quot;m5&quot;,</span><br><span class="line">    &quot;_type&quot; : &quot;doc&quot;,</span><br><span class="line">    &quot;_id&quot; : &quot;1&quot;,</span><br><span class="line">    &quot;_score&quot; : 0.2876821,</span><br><span class="line">    &quot;_source&quot; : &#123;</span><br><span class="line">      &quot;first_name&quot; : &quot;tom&quot;,</span><br><span class="line">      &quot;last_name&quot; : &quot;ben&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>



<p>那么想要查询<code>tom</code>或者<code>smith</code>该怎么办？</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">GET m5/doc/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match&quot;: &#123;</span><br><span class="line">      &quot;full_name&quot;: &#123;</span><br><span class="line">        &quot;query&quot;: &quot;tom smith&quot;,</span><br><span class="line">        &quot;operator&quot;: &quot;or&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><code>operator</code>参数为多个条件的查询关系也可以是<code>and</code>，也有简写方式：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">GET m5/doc/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match&quot;: &#123;</span><br><span class="line">      &quot;full_name&quot;: &quot;tom smith&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><code>copy_to</code>还支持将相同的属性值复制给不同的字段。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">PUT m6</span><br><span class="line">&#123;</span><br><span class="line">  &quot;mappings&quot;: &#123;</span><br><span class="line">    &quot;doc&quot;: &#123;</span><br><span class="line">      &quot;dynamic&quot;:false,</span><br><span class="line">      &quot;properties&quot;: &#123;</span><br><span class="line">        &quot;first_name&quot;:&#123;</span><br><span class="line">          &quot;type&quot;: &quot;text&quot;,</span><br><span class="line">          &quot;copy_to&quot;: &quot;full_name&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;last_name&quot;: &#123;</span><br><span class="line">          &quot;type&quot;: &quot;text&quot;,</span><br><span class="line">          &quot;copy_to&quot;: [&quot;field1&quot;, &quot;field2&quot;]</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;field1&quot;: &#123;</span><br><span class="line">          &quot;type&quot;: &quot;text&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;field2&quot;: &#123;</span><br><span class="line">          &quot;type&quot;: &quot;text&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>现在，无论是通过<code>field1</code>还是<code>field2</code>都可以查询。</p>
<h4 id="对象型字段"><a href="#对象型字段" class="headerlink" title="对象型字段"></a>对象型字段</h4><p>现在，有一个个人信息文档如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">PUT m7/doc/1</span><br><span class="line">&#123;</span><br><span class="line">  &quot;name&quot;:&quot;tom&quot;,</span><br><span class="line">  &quot;age&quot;:18,</span><br><span class="line">  &quot;info&quot;:&#123;</span><br><span class="line">    &quot;addr&quot;:&quot;北京&quot;,</span><br><span class="line">    &quot;tel&quot;:&quot;10010&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>首先，这样嵌套多层的<code>mappings</code>该如何设计呢？</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">PUT m7</span><br><span class="line">&#123;</span><br><span class="line">  &quot;mappings&quot;: &#123;</span><br><span class="line">    &quot;doc&quot;: &#123;</span><br><span class="line">      &quot;dynamic&quot;: false,</span><br><span class="line">      &quot;properties&quot;: &#123;</span><br><span class="line">        &quot;name&quot;: &#123;</span><br><span class="line">          &quot;type&quot;: &quot;text&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;age&quot;: &#123;</span><br><span class="line">          &quot;type&quot;: &quot;text&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;info&quot;: &#123;</span><br><span class="line">          &quot;properties&quot;: &#123;</span><br><span class="line">            &quot;addr&quot;: &#123;</span><br><span class="line">              &quot;type&quot;: &quot;text&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;tel&quot;: &#123;</span><br><span class="line">              &quot;type&quot; : &quot;text&quot;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>以<code>info</code>中的<code>tel</code>为条件怎么写查询语句</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">GET mapping_test9/doc/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match&quot;: &#123;</span><br><span class="line">      &quot;info.tel&quot;: &quot;10086&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>info</code>既是一个属性，也是一个对象，我们称为<code>info</code>这类字段为对象型字段。</p>
<h4 id="settings设置"><a href="#settings设置" class="headerlink" title="settings设置"></a>settings设置</h4><p>设置主、复制分片</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">PUT s1</span><br><span class="line">&#123;</span><br><span class="line">  &quot;mappings&quot;: &#123;</span><br><span class="line">    &quot;doc&quot;: &#123;</span><br><span class="line">      &quot;properties&quot;: &#123;</span><br><span class="line">        &quot;name&quot;: &#123;</span><br><span class="line">          &quot;type&quot;: &quot;text&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, </span><br><span class="line">  &quot;settings&quot;: &#123;</span><br><span class="line">    &quot;number_of_replicas&quot;: 1,</span><br><span class="line">    &quot;number_of_shards&quot;: 5</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>number_of_shards</code>是主分片数量（每个索引默认5个主分片），</li>
<li>而<code>number_of_replicas</code>是复制分片，默认一个主分片搭配一个复制分片。</li>
</ul>
<h2 id="分析过程"><a href="#分析过程" class="headerlink" title="分析过程"></a><a target="_blank" rel="noopener" href="https://www.cnblogs.com/Neeo/articles/10593037.html">分析过程</a></h2><p>当数据被发送到<code>elasticsearch</code>后并加入到倒排索引之前，<code>elasticsearch</code>会对该文档的进行一系列的处理步骤：</p>
<ol>
<li>字符过滤：使用字符过滤器转变字符。</li>
<li>分词：将文本（档）分为单个或多个分词。</li>
<li>分词过滤：使用分词过滤器转变每个分词。</li>
<li>分词索引：最终将分词存储在Lucene倒排索引中。</li>
</ol>
<p>整体流程如下图所示：</p>
<p><img src="/images/1168165-20190325122716354-856391461.bmp" alt="img"></p>
<p>接下来简要的介绍<code>elasticsearch</code>中的分析器、分词器和分词过滤器。</p>
<h3 id="分析器"><a href="#分析器" class="headerlink" title="分析器"></a>分析器</h3><p>在elasticsearch中，一个分析器可以包括：</p>
<ul>
<li>可选的字符过滤器</li>
<li>一个分词器</li>
<li>0个或多个分词过滤器</li>
</ul>
<h4 id="标准分析器：standard-analyzer"><a href="#标准分析器：standard-analyzer" class="headerlink" title="标准分析器：standard analyzer"></a>标准分析器：standard analyzer</h4><p>标准分析器（standard analyzer）：是elasticsearch的默认分析器，该分析器综合了大多数欧洲语言来说合理的默认模块，包括标准分词器、标准分词过滤器、小写转换分词过滤器和停用词分词过滤器。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">POST _analyze</span><br><span class="line">&#123;</span><br><span class="line">  &quot;analyzer&quot;: &quot;standard&quot;,</span><br><span class="line">  &quot;text&quot;:&quot;To be or not to be,  That is a question ———— 莎士比亚&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;tokens&quot; : [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;to&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 0,</span><br><span class="line">      &quot;end_offset&quot; : 2,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;ALPHANUM&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 0</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;be&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 3,</span><br><span class="line">      &quot;end_offset&quot; : 5,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;ALPHANUM&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 1</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;or&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 6,</span><br><span class="line">      &quot;end_offset&quot; : 8,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;ALPHANUM&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 2</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;not&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 9,</span><br><span class="line">      &quot;end_offset&quot; : 12,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;ALPHANUM&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 3</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;to&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 13,</span><br><span class="line">      &quot;end_offset&quot; : 15,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;ALPHANUM&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 4</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;be&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 16,</span><br><span class="line">      &quot;end_offset&quot; : 18,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;ALPHANUM&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 5</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;that&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 21,</span><br><span class="line">      &quot;end_offset&quot; : 25,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;ALPHANUM&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 6</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;is&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 26,</span><br><span class="line">      &quot;end_offset&quot; : 28,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;ALPHANUM&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 7</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;a&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 29,</span><br><span class="line">      &quot;end_offset&quot; : 30,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;ALPHANUM&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 8</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;question&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 31,</span><br><span class="line">      &quot;end_offset&quot; : 39,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;ALPHANUM&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 9</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;莎&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 45,</span><br><span class="line">      &quot;end_offset&quot; : 46,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;IDEOGRAPHIC&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 10</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;士&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 46,</span><br><span class="line">      &quot;end_offset&quot; : 47,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;IDEOGRAPHIC&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 11</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;比&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 47,</span><br><span class="line">      &quot;end_offset&quot; : 48,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;IDEOGRAPHIC&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 12</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;亚&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 48,</span><br><span class="line">      &quot;end_offset&quot; : 49,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;IDEOGRAPHIC&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 13</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="简单分析器：simple-analyzer"><a href="#简单分析器：simple-analyzer" class="headerlink" title="简单分析器：simple analyzer"></a>简单分析器：simple analyzer</h4><p>简单分析器（simple analyzer）：简单分析器仅使用了小写转换分词，这意味着在非字母处进行分词，并将分词自动转换为小写。这个分词器对于亚种语言来说效果不佳，因为亚洲语言不是根据空白来分词的，所以一般用于欧洲言中。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">POST _analyze</span><br><span class="line">&#123;</span><br><span class="line">  &quot;analyzer&quot;: &quot;simple&quot;,</span><br><span class="line">  &quot;text&quot;:&quot;To be or not to be,  That is a question ———— 莎士比亚&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;tokens&quot; : [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;to&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 0,</span><br><span class="line">      &quot;end_offset&quot; : 2,</span><br><span class="line">      &quot;type&quot; : &quot;word&quot;,</span><br><span class="line">      &quot;position&quot; : 0</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;be&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 3,</span><br><span class="line">      &quot;end_offset&quot; : 5,</span><br><span class="line">      &quot;type&quot; : &quot;word&quot;,</span><br><span class="line">      &quot;position&quot; : 1</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;or&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 6,</span><br><span class="line">      &quot;end_offset&quot; : 8,</span><br><span class="line">      &quot;type&quot; : &quot;word&quot;,</span><br><span class="line">      &quot;position&quot; : 2</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;not&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 9,</span><br><span class="line">      &quot;end_offset&quot; : 12,</span><br><span class="line">      &quot;type&quot; : &quot;word&quot;,</span><br><span class="line">      &quot;position&quot; : 3</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;to&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 13,</span><br><span class="line">      &quot;end_offset&quot; : 15,</span><br><span class="line">      &quot;type&quot; : &quot;word&quot;,</span><br><span class="line">      &quot;position&quot; : 4</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;be&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 16,</span><br><span class="line">      &quot;end_offset&quot; : 18,</span><br><span class="line">      &quot;type&quot; : &quot;word&quot;,</span><br><span class="line">      &quot;position&quot; : 5</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;that&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 21,</span><br><span class="line">      &quot;end_offset&quot; : 25,</span><br><span class="line">      &quot;type&quot; : &quot;word&quot;,</span><br><span class="line">      &quot;position&quot; : 6</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;is&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 26,</span><br><span class="line">      &quot;end_offset&quot; : 28,</span><br><span class="line">      &quot;type&quot; : &quot;word&quot;,</span><br><span class="line">      &quot;position&quot; : 7</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;a&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 29,</span><br><span class="line">      &quot;end_offset&quot; : 30,</span><br><span class="line">      &quot;type&quot; : &quot;word&quot;,</span><br><span class="line">      &quot;position&quot; : 8</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;question&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 31,</span><br><span class="line">      &quot;end_offset&quot; : 39,</span><br><span class="line">      &quot;type&quot; : &quot;word&quot;,</span><br><span class="line">      &quot;position&quot; : 9</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;莎士比亚&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 45,</span><br><span class="line">      &quot;end_offset&quot; : 49,</span><br><span class="line">      &quot;type&quot; : &quot;word&quot;,</span><br><span class="line">      &quot;position&quot; : 10</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="空白分析器：whitespace-analyzer"><a href="#空白分析器：whitespace-analyzer" class="headerlink" title="空白分析器：whitespace analyzer"></a>空白分析器：whitespace analyzer</h4><p>空白分析器（whitespace analyzer）：这玩意儿只是根据空白将文本切分为若干分词，真是有够偷懒！</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">POST _analyze</span><br><span class="line">&#123;</span><br><span class="line">  &quot;analyzer&quot;: &quot;whitespace&quot;,</span><br><span class="line">  &quot;text&quot;:&quot;To be or not to be,  That is a question ———— 莎士比亚&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;tokens&quot;</span> : [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;token&quot;</span> : <span class="string">&quot;To&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;start_offset&quot;</span> : <span class="number">0</span>,</span><br><span class="line">      <span class="attr">&quot;end_offset&quot;</span> : <span class="number">2</span>,</span><br><span class="line">      <span class="attr">&quot;type&quot;</span> : <span class="string">&quot;word&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;position&quot;</span> : <span class="number">0</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;token&quot;</span> : <span class="string">&quot;be&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;start_offset&quot;</span> : <span class="number">3</span>,</span><br><span class="line">      <span class="attr">&quot;end_offset&quot;</span> : <span class="number">5</span>,</span><br><span class="line">      <span class="attr">&quot;type&quot;</span> : <span class="string">&quot;word&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;position&quot;</span> : <span class="number">1</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;token&quot;</span> : <span class="string">&quot;or&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;start_offset&quot;</span> : <span class="number">6</span>,</span><br><span class="line">      <span class="attr">&quot;end_offset&quot;</span> : <span class="number">8</span>,</span><br><span class="line">      <span class="attr">&quot;type&quot;</span> : <span class="string">&quot;word&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;position&quot;</span> : <span class="number">2</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;token&quot;</span> : <span class="string">&quot;not&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;start_offset&quot;</span> : <span class="number">9</span>,</span><br><span class="line">      <span class="attr">&quot;end_offset&quot;</span> : <span class="number">12</span>,</span><br><span class="line">      <span class="attr">&quot;type&quot;</span> : <span class="string">&quot;word&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;position&quot;</span> : <span class="number">3</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;token&quot;</span> : <span class="string">&quot;to&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;start_offset&quot;</span> : <span class="number">13</span>,</span><br><span class="line">      <span class="attr">&quot;end_offset&quot;</span> : <span class="number">15</span>,</span><br><span class="line">      <span class="attr">&quot;type&quot;</span> : <span class="string">&quot;word&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;position&quot;</span> : <span class="number">4</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;token&quot;</span> : <span class="string">&quot;be,&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;start_offset&quot;</span> : <span class="number">16</span>,</span><br><span class="line">      <span class="attr">&quot;end_offset&quot;</span> : <span class="number">19</span>,</span><br><span class="line">      <span class="attr">&quot;type&quot;</span> : <span class="string">&quot;word&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;position&quot;</span> : <span class="number">5</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;token&quot;</span> : <span class="string">&quot;That&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;start_offset&quot;</span> : <span class="number">21</span>,</span><br><span class="line">      <span class="attr">&quot;end_offset&quot;</span> : <span class="number">25</span>,</span><br><span class="line">      <span class="attr">&quot;type&quot;</span> : <span class="string">&quot;word&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;position&quot;</span> : <span class="number">6</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;token&quot;</span> : <span class="string">&quot;is&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;start_offset&quot;</span> : <span class="number">26</span>,</span><br><span class="line">      <span class="attr">&quot;end_offset&quot;</span> : <span class="number">28</span>,</span><br><span class="line">      <span class="attr">&quot;type&quot;</span> : <span class="string">&quot;word&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;position&quot;</span> : <span class="number">7</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;token&quot;</span> : <span class="string">&quot;a&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;start_offset&quot;</span> : <span class="number">29</span>,</span><br><span class="line">      <span class="attr">&quot;end_offset&quot;</span> : <span class="number">30</span>,</span><br><span class="line">      <span class="attr">&quot;type&quot;</span> : <span class="string">&quot;word&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;position&quot;</span> : <span class="number">8</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;token&quot;</span> : <span class="string">&quot;question&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;start_offset&quot;</span> : <span class="number">31</span>,</span><br><span class="line">      <span class="attr">&quot;end_offset&quot;</span> : <span class="number">39</span>,</span><br><span class="line">      <span class="attr">&quot;type&quot;</span> : <span class="string">&quot;word&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;position&quot;</span> : <span class="number">9</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;token&quot;</span> : <span class="string">&quot;————&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;start_offset&quot;</span> : <span class="number">40</span>,</span><br><span class="line">      <span class="attr">&quot;end_offset&quot;</span> : <span class="number">44</span>,</span><br><span class="line">      <span class="attr">&quot;type&quot;</span> : <span class="string">&quot;word&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;position&quot;</span> : <span class="number">10</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;token&quot;</span> : <span class="string">&quot;莎士比亚&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;start_offset&quot;</span> : <span class="number">45</span>,</span><br><span class="line">      <span class="attr">&quot;end_offset&quot;</span> : <span class="number">49</span>,</span><br><span class="line">      <span class="attr">&quot;type&quot;</span> : <span class="string">&quot;word&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;position&quot;</span> : <span class="number">11</span></span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="停用词分析器：stop-analyzer"><a href="#停用词分析器：stop-analyzer" class="headerlink" title="停用词分析器：stop analyzer"></a>停用词分析器：stop analyzer</h4><p><a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E5%81%9C%E7%94%A8%E8%AF%8D/4531676">停用词</a>分析（stop analyzer）和简单分析器的行为很像，只是在分词流中额外的过滤了停用词。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">POST _analyze</span><br><span class="line">&#123;</span><br><span class="line">  &quot;analyzer&quot;: &quot;stop&quot;,</span><br><span class="line">  &quot;text&quot;:&quot;To be or not to be,  That is a question ———— 莎士比亚&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;tokens&quot; : [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;question&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 31,</span><br><span class="line">      &quot;end_offset&quot; : 39,</span><br><span class="line">      &quot;type&quot; : &quot;word&quot;,</span><br><span class="line">      &quot;position&quot; : 9</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;莎士比亚&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 45,</span><br><span class="line">      &quot;end_offset&quot; : 49,</span><br><span class="line">      &quot;type&quot; : &quot;word&quot;,</span><br><span class="line">      &quot;position&quot; : 10</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="关键词分析器：keyword-analyzer"><a href="#关键词分析器：keyword-analyzer" class="headerlink" title="关键词分析器：keyword analyzer"></a>关键词分析器：keyword analyzer</h4><p>关键词分析器（keyword analyzer）将整个字段当做单独的分词，如无必要，我们不在映射中使用关键词分析器。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">POST _analyze</span><br><span class="line">&#123;</span><br><span class="line">  &quot;analyzer&quot;: &quot;keyword&quot;,</span><br><span class="line">  &quot;text&quot;:&quot;To be or not to be,  That is a question ———— 莎士比亚&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>结果如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;tokens&quot; : [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;To be or not to be,  That is a question ———— 莎士比亚&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 0,</span><br><span class="line">      &quot;end_offset&quot; : 49,</span><br><span class="line">      &quot;type&quot; : &quot;word&quot;,</span><br><span class="line">      &quot;position&quot; : 0</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>说的一点没错，分析结果是将整段当做单独的分词。</p>
<h4 id="模式分析器：pattern-analyzer"><a href="#模式分析器：pattern-analyzer" class="headerlink" title="模式分析器：pattern analyzer"></a>模式分析器：pattern analyzer</h4><p>模式分析器（pattern analyzer）允许我们指定一个分词切分模式。但是通常更佳的方案是使用定制的分析器，组合现有的模式分词器和所需要的分词过滤器更加合适。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">POST _analyze</span><br><span class="line">&#123;</span><br><span class="line">  &quot;analyzer&quot;: &quot;pattern&quot;,</span><br><span class="line">  &quot;explain&quot;: false, </span><br><span class="line">  &quot;text&quot;:&quot;To be or not to be,  That is a question ———— 莎士比亚&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>结果如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;tokens&quot; : [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;to&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 0,</span><br><span class="line">      &quot;end_offset&quot; : 2,</span><br><span class="line">      &quot;type&quot; : &quot;word&quot;,</span><br><span class="line">      &quot;position&quot; : 0</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;be&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 3,</span><br><span class="line">      &quot;end_offset&quot; : 5,</span><br><span class="line">      &quot;type&quot; : &quot;word&quot;,</span><br><span class="line">      &quot;position&quot; : 1</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;or&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 6,</span><br><span class="line">      &quot;end_offset&quot; : 8,</span><br><span class="line">      &quot;type&quot; : &quot;word&quot;,</span><br><span class="line">      &quot;position&quot; : 2</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;not&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 9,</span><br><span class="line">      &quot;end_offset&quot; : 12,</span><br><span class="line">      &quot;type&quot; : &quot;word&quot;,</span><br><span class="line">      &quot;position&quot; : 3</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;to&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 13,</span><br><span class="line">      &quot;end_offset&quot; : 15,</span><br><span class="line">      &quot;type&quot; : &quot;word&quot;,</span><br><span class="line">      &quot;position&quot; : 4</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;be&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 16,</span><br><span class="line">      &quot;end_offset&quot; : 18,</span><br><span class="line">      &quot;type&quot; : &quot;word&quot;,</span><br><span class="line">      &quot;position&quot; : 5</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;that&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 21,</span><br><span class="line">      &quot;end_offset&quot; : 25,</span><br><span class="line">      &quot;type&quot; : &quot;word&quot;,</span><br><span class="line">      &quot;position&quot; : 6</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;is&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 26,</span><br><span class="line">      &quot;end_offset&quot; : 28,</span><br><span class="line">      &quot;type&quot; : &quot;word&quot;,</span><br><span class="line">      &quot;position&quot; : 7</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;a&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 29,</span><br><span class="line">      &quot;end_offset&quot; : 30,</span><br><span class="line">      &quot;type&quot; : &quot;word&quot;,</span><br><span class="line">      &quot;position&quot; : 8</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;question&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 31,</span><br><span class="line">      &quot;end_offset&quot; : 39,</span><br><span class="line">      &quot;type&quot; : &quot;word&quot;,</span><br><span class="line">      &quot;position&quot; : 9</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们来自定制一个模式分析器，比如我们写匹配邮箱的正则。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">PUT pattern_test</span><br><span class="line">&#123;</span><br><span class="line">  &quot;settings&quot;: &#123;</span><br><span class="line">    &quot;analysis&quot;: &#123;</span><br><span class="line">      &quot;analyzer&quot;: &#123;</span><br><span class="line">        &quot;my_email_analyzer&quot;:&#123;</span><br><span class="line">          &quot;type&quot;:&quot;pattern&quot;,</span><br><span class="line">          &quot;pattern&quot;:&quot;\\W|_&quot;,</span><br><span class="line">          &quot;lowercase&quot;:true</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上例中，我们在创建一条索引的时候，配置分析器为自定义的分析器。</p>
<p>需要注意的是，在<code>json</code>字符串中，正则的斜杠需要转义。</p>
<p>我们使用自定义的分析器来查询。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">POST pattern_test/_analyze</span><br><span class="line">&#123;</span><br><span class="line">  &quot;analyzer&quot;: &quot;my_email_analyzer&quot;,</span><br><span class="line">  &quot;text&quot;: &quot;John_Smith@foo-bar.com&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>结果如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;tokens&quot; : [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;john&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 0,</span><br><span class="line">      &quot;end_offset&quot; : 4,</span><br><span class="line">      &quot;type&quot; : &quot;word&quot;,</span><br><span class="line">      &quot;position&quot; : 0</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;smith&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 5,</span><br><span class="line">      &quot;end_offset&quot; : 10,</span><br><span class="line">      &quot;type&quot; : &quot;word&quot;,</span><br><span class="line">      &quot;position&quot; : 1</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;foo&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 11,</span><br><span class="line">      &quot;end_offset&quot; : 14,</span><br><span class="line">      &quot;type&quot; : &quot;word&quot;,</span><br><span class="line">      &quot;position&quot; : 2</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;bar&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 15,</span><br><span class="line">      &quot;end_offset&quot; : 18,</span><br><span class="line">      &quot;type&quot; : &quot;word&quot;,</span><br><span class="line">      &quot;position&quot; : 3</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;com&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 19,</span><br><span class="line">      &quot;end_offset&quot; : 22,</span><br><span class="line">      &quot;type&quot; : &quot;word&quot;,</span><br><span class="line">      &quot;position&quot; : 4</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="语言和多语言分析器：chinese"><a href="#语言和多语言分析器：chinese" class="headerlink" title="语言和多语言分析器：chinese"></a>语言和多语言分析器：chinese</h4><p>elasticsearch为很多世界流行语言提供良好的、简单的、开箱即用的语言分析器集合：阿拉伯语、亚美尼亚语、巴斯克语、巴西语、保加利亚语、加泰罗尼亚语、中文、捷克语、丹麦、荷兰语、英语、芬兰语、法语、加里西亚语、德语、希腊语、北印度语、匈牙利语、印度尼西亚、爱尔兰语、意大利语、日语、韩国语、库尔德语、挪威语、波斯语、葡萄牙语、罗马尼亚语、俄语、西班牙语、瑞典语、土耳其语和泰语。</p>
<p>我们可以指定其中之一的语言来指定特定的语言分析器，但必须是小写的名字！如果你要分析的语言不在上述集合中，可能还需要搭配相应的插件支持。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">POST _analyze</span><br><span class="line">&#123;</span><br><span class="line">  &quot;analyzer&quot;: &quot;chinese&quot;,</span><br><span class="line">  &quot;text&quot;:&quot;To be or not to be,  That is a question ———— 莎士比亚&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>结果如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;tokens&quot; : [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;question&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 31,</span><br><span class="line">      &quot;end_offset&quot; : 39,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;ALPHANUM&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 9</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;莎&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 45,</span><br><span class="line">      &quot;end_offset&quot; : 46,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;IDEOGRAPHIC&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 10</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;士&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 46,</span><br><span class="line">      &quot;end_offset&quot; : 47,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;IDEOGRAPHIC&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 11</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;比&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 47,</span><br><span class="line">      &quot;end_offset&quot; : 48,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;IDEOGRAPHIC&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 12</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;亚&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 48,</span><br><span class="line">      &quot;end_offset&quot; : 49,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;IDEOGRAPHIC&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 13</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>也可以是别语言：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">POST _analyze</span><br><span class="line">&#123;</span><br><span class="line">  &quot;analyzer&quot;: &quot;french&quot;,</span><br><span class="line">  &quot;text&quot;:&quot;Je suis ton père&quot;</span><br><span class="line">&#125;</span><br><span class="line">POST _analyze</span><br><span class="line">&#123;</span><br><span class="line">  &quot;analyzer&quot;: &quot;german&quot;,</span><br><span class="line">  &quot;text&quot;:&quot;Ich bin dein vater&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="雪球分析器：snowball-analyzer"><a href="#雪球分析器：snowball-analyzer" class="headerlink" title="雪球分析器：snowball analyzer"></a>雪球分析器：snowball analyzer</h4><p>雪球分析器（snowball analyzer）除了使用标准的分词和分词过滤器（和标准分析器一样）也是用了小写分词过滤器和停用词过滤器，除此之外，它还是用了雪球词干器对文本进行<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E8%AF%8D%E5%B9%B2">词干</a>提取。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">POST _analyze</span><br><span class="line">&#123;</span><br><span class="line">  &quot;analyzer&quot;: &quot;snowball&quot;,</span><br><span class="line">  &quot;text&quot;:&quot;To be or not to be,  That is a question ———— 莎士比亚&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>结果如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;tokens&quot; : [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;question&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 31,</span><br><span class="line">      &quot;end_offset&quot; : 39,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;ALPHANUM&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 9</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;莎&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 45,</span><br><span class="line">      &quot;end_offset&quot; : 46,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;IDEOGRAPHIC&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 10</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;士&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 46,</span><br><span class="line">      &quot;end_offset&quot; : 47,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;IDEOGRAPHIC&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 11</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;比&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 47,</span><br><span class="line">      &quot;end_offset&quot; : 48,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;IDEOGRAPHIC&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 12</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;亚&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 48,</span><br><span class="line">      &quot;end_offset&quot; : 49,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;IDEOGRAPHIC&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 13</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="字符过滤器"><a href="#字符过滤器" class="headerlink" title="字符过滤器"></a>字符过滤器</h3><p>字符过滤器在<code>&lt;charFilter&gt;</code>属性中定义，它是对字符流进行处理。字符过滤器种类不多。elasticearch只提供了三种字符过滤器：</p>
<ul>
<li>HTML字符过滤器（HTML Strip Char Filter）</li>
<li>映射字符过滤器（Mapping Char Filter）</li>
<li>模式替换过滤器（Pattern Replace Char Filter）</li>
</ul>
<h4 id="HTML字符过滤器"><a href="#HTML字符过滤器" class="headerlink" title="HTML字符过滤器"></a>HTML字符过滤器</h4><p>HTML字符过滤器（HTML Strip Char Filter）从文本中去除HTML元素。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">POST _analyze</span><br><span class="line">&#123;</span><br><span class="line">  &quot;tokenizer&quot;: &quot;keyword&quot;,</span><br><span class="line">  &quot;char_filter&quot;: [&quot;html_strip&quot;],</span><br><span class="line">  &quot;text&quot;:&quot;&lt;p&gt;I&amp;apos;m so &lt;b&gt;happy&lt;/b&gt;!&lt;/p&gt;&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>结果如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;tokens&quot; : [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;&quot;&quot;</span><br><span class="line"></span><br><span class="line">I&#x27;m so happy!</span><br><span class="line"></span><br><span class="line">&quot;&quot;&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 0,</span><br><span class="line">      &quot;end_offset&quot; : 32,</span><br><span class="line">      &quot;type&quot; : &quot;word&quot;,</span><br><span class="line">      &quot;position&quot; : 0</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="映射字符过滤器"><a href="#映射字符过滤器" class="headerlink" title="映射字符过滤器"></a>映射字符过滤器</h4><p>映射字符过滤器（Mapping Char Filter）接收键值的映射，每当遇到与键相同的字符串时，它就用该键关联的值替换它们。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">PUT pattern_test4</span><br><span class="line">&#123;</span><br><span class="line">  &quot;settings&quot;: &#123;</span><br><span class="line">    &quot;analysis&quot;: &#123;</span><br><span class="line">      &quot;analyzer&quot;: &#123;</span><br><span class="line">        &quot;my_analyzer&quot;:&#123;</span><br><span class="line">          &quot;tokenizer&quot;:&quot;keyword&quot;,</span><br><span class="line">          &quot;char_filter&quot;:[&quot;my_char_filter&quot;]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;char_filter&quot;:&#123;</span><br><span class="line">          &quot;my_char_filter&quot;:&#123;</span><br><span class="line">            &quot;type&quot;:&quot;mapping&quot;,</span><br><span class="line">            &quot;mappings&quot;:[&quot;苍井空 =&gt; 666&quot;,&quot;武藤兰 =&gt; 888&quot;]</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上例中，我们自定义了一个分析器，其内的分词器使用关键字分词器，字符过滤器则是自定制的，将字符中的苍井空替换为666，武藤兰替换为888。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">POST pattern_test4/_analyze</span><br><span class="line">&#123;</span><br><span class="line">  &quot;analyzer&quot;: &quot;my_analyzer&quot;,</span><br><span class="line">  &quot;text&quot;: &quot;苍井空热爱武藤兰，可惜后来苍井空结婚了&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>结果如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;tokens&quot; : [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;666热爱888，可惜后来666结婚了&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 0,</span><br><span class="line">      &quot;end_offset&quot; : 19,</span><br><span class="line">      &quot;type&quot; : &quot;word&quot;,</span><br><span class="line">      &quot;position&quot; : 0</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="模式替换过滤器"><a href="#模式替换过滤器" class="headerlink" title="模式替换过滤器"></a>模式替换过滤器</h4><p>模式替换过滤器（Pattern Replace Char Filter）使用正则表达式匹配并替换字符串中的字符。但要小心你写的抠脚的正则表达式。因为这可能导致性能变慢！</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">PUT pattern_test5</span><br><span class="line">&#123;</span><br><span class="line">  &quot;settings&quot;: &#123;</span><br><span class="line">    &quot;analysis&quot;: &#123;</span><br><span class="line">      &quot;analyzer&quot;: &#123;</span><br><span class="line">        &quot;my_analyzer&quot;: &#123;</span><br><span class="line">          &quot;tokenizer&quot;: &quot;standard&quot;,</span><br><span class="line">          &quot;char_filter&quot;: [</span><br><span class="line">            &quot;my_char_filter&quot;</span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;char_filter&quot;: &#123;</span><br><span class="line">        &quot;my_char_filter&quot;: &#123;</span><br><span class="line">          &quot;type&quot;: &quot;pattern_replace&quot;,</span><br><span class="line">          &quot;pattern&quot;: &quot;(\\d+)-(?=\\d)&quot;,</span><br><span class="line">          &quot;replacement&quot;: &quot;$1_&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上例中，我们自定义了一个正则规则。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">POST pattern_test5/_analyze</span><br><span class="line">&#123;</span><br><span class="line">  &quot;analyzer&quot;: &quot;my_analyzer&quot;,</span><br><span class="line">  &quot;text&quot;: &quot;My credit card is 123-456-789&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>结果如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;tokens&quot; : [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;My&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 0,</span><br><span class="line">      &quot;end_offset&quot; : 2,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;ALPHANUM&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 0</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;credit&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 3,</span><br><span class="line">      &quot;end_offset&quot; : 9,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;ALPHANUM&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 1</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;card&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 10,</span><br><span class="line">      &quot;end_offset&quot; : 14,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;ALPHANUM&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 2</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;is&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 15,</span><br><span class="line">      &quot;end_offset&quot; : 17,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;ALPHANUM&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 3</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;123_456_789&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 18,</span><br><span class="line">      &quot;end_offset&quot; : 29,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;NUM&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 4</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们大致的了解elasticsearch分析处理数据的流程。但可以看到的是，我们极少地在例子中演示中文处理。因为elasticsearch内置的分析器处理起来中文不是很好。所以，后续会介绍一个重量级的插件就是elasticsearch analysis ik（一般习惯称呼为ik分词器）。</p>
<h3 id="分词器"><a href="#分词器" class="headerlink" title="分词器"></a>分词器</h3><p>分词器，顾名思义，主要的操作是将文本字符串分解为小块，而这些小块这被称为分词<code>token</code>。</p>
<h4 id="标准分词器：standard-tokenizer"><a href="#标准分词器：standard-tokenizer" class="headerlink" title="标准分词器：standard tokenizer"></a>标准分词器：standard tokenizer</h4><p>标准分词器（standard tokenizer）是一个基于语法的分词器，对于大多数欧洲语言来说还是不错的，它同时还处理了Unicode文本的分词，但分词默认的最大长度是255字节，它也移除了逗号和句号这样的标点符号。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">POST _analyze</span><br><span class="line">&#123;</span><br><span class="line">  &quot;tokenizer&quot;: &quot;standard&quot;,</span><br><span class="line">  &quot;text&quot;:&quot;To be or not to be,  That is a question ———— 莎士比亚&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>结果如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;tokens&quot; : [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;To&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 0,</span><br><span class="line">      &quot;end_offset&quot; : 2,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;ALPHANUM&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 0</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;be&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 3,</span><br><span class="line">      &quot;end_offset&quot; : 5,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;ALPHANUM&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 1</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;or&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 6,</span><br><span class="line">      &quot;end_offset&quot; : 8,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;ALPHANUM&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 2</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;not&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 9,</span><br><span class="line">      &quot;end_offset&quot; : 12,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;ALPHANUM&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 3</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;to&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 13,</span><br><span class="line">      &quot;end_offset&quot; : 15,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;ALPHANUM&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 4</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;be&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 16,</span><br><span class="line">      &quot;end_offset&quot; : 18,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;ALPHANUM&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 5</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;That&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 21,</span><br><span class="line">      &quot;end_offset&quot; : 25,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;ALPHANUM&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 6</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;is&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 26,</span><br><span class="line">      &quot;end_offset&quot; : 28,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;ALPHANUM&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 7</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;a&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 29,</span><br><span class="line">      &quot;end_offset&quot; : 30,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;ALPHANUM&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 8</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;question&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 31,</span><br><span class="line">      &quot;end_offset&quot; : 39,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;ALPHANUM&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 9</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;莎&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 45,</span><br><span class="line">      &quot;end_offset&quot; : 46,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;IDEOGRAPHIC&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 10</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;士&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 46,</span><br><span class="line">      &quot;end_offset&quot; : 47,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;IDEOGRAPHIC&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 11</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;比&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 47,</span><br><span class="line">      &quot;end_offset&quot; : 48,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;IDEOGRAPHIC&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 12</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;亚&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 48,</span><br><span class="line">      &quot;end_offset&quot; : 49,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;IDEOGRAPHIC&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 13</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="关键词分词器：keyword-tokenizer"><a href="#关键词分词器：keyword-tokenizer" class="headerlink" title="关键词分词器：keyword tokenizer"></a>关键词分词器：keyword tokenizer</h4><p>关键词分词器（keyword tokenizer）是一种简单的分词器，将整个文本作为单个的分词，提供给分词过滤器，当你只想用分词过滤器，而不做分词操作时，它是不错的选择。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">POST _analyze</span><br><span class="line">&#123;</span><br><span class="line">  &quot;tokenizer&quot;: &quot;keyword&quot;,</span><br><span class="line">  &quot;text&quot;:&quot;To be or not to be,  That is a question ———— 莎士比亚&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>结果如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;tokens&quot; : [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;To be or not to be,  That is a question ———— 莎士比亚&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 0,</span><br><span class="line">      &quot;end_offset&quot; : 49,</span><br><span class="line">      &quot;type&quot; : &quot;word&quot;,</span><br><span class="line">      &quot;position&quot; : 0</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="字母分词器：letter-tokenizer"><a href="#字母分词器：letter-tokenizer" class="headerlink" title="字母分词器：letter tokenizer"></a>字母分词器：letter tokenizer</h4><p>字母分词器（letter tokenizer）根据非字母的符号，将文本切分成分词。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">POST _analyze</span><br><span class="line">&#123;</span><br><span class="line">  &quot;tokenizer&quot;: &quot;letter&quot;,</span><br><span class="line">  &quot;text&quot;:&quot;To be or not to be,  That is a question ———— 莎士比亚&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>结果如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;tokens&quot; : [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;To&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 0,</span><br><span class="line">      &quot;end_offset&quot; : 2,</span><br><span class="line">      &quot;type&quot; : &quot;word&quot;,</span><br><span class="line">      &quot;position&quot; : 0</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;be&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 3,</span><br><span class="line">      &quot;end_offset&quot; : 5,</span><br><span class="line">      &quot;type&quot; : &quot;word&quot;,</span><br><span class="line">      &quot;position&quot; : 1</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;or&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 6,</span><br><span class="line">      &quot;end_offset&quot; : 8,</span><br><span class="line">      &quot;type&quot; : &quot;word&quot;,</span><br><span class="line">      &quot;position&quot; : 2</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;not&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 9,</span><br><span class="line">      &quot;end_offset&quot; : 12,</span><br><span class="line">      &quot;type&quot; : &quot;word&quot;,</span><br><span class="line">      &quot;position&quot; : 3</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;to&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 13,</span><br><span class="line">      &quot;end_offset&quot; : 15,</span><br><span class="line">      &quot;type&quot; : &quot;word&quot;,</span><br><span class="line">      &quot;position&quot; : 4</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;be&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 16,</span><br><span class="line">      &quot;end_offset&quot; : 18,</span><br><span class="line">      &quot;type&quot; : &quot;word&quot;,</span><br><span class="line">      &quot;position&quot; : 5</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;That&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 21,</span><br><span class="line">      &quot;end_offset&quot; : 25,</span><br><span class="line">      &quot;type&quot; : &quot;word&quot;,</span><br><span class="line">      &quot;position&quot; : 6</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;is&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 26,</span><br><span class="line">      &quot;end_offset&quot; : 28,</span><br><span class="line">      &quot;type&quot; : &quot;word&quot;,</span><br><span class="line">      &quot;position&quot; : 7</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;a&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 29,</span><br><span class="line">      &quot;end_offset&quot; : 30,</span><br><span class="line">      &quot;type&quot; : &quot;word&quot;,</span><br><span class="line">      &quot;position&quot; : 8</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;question&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 31,</span><br><span class="line">      &quot;end_offset&quot; : 39,</span><br><span class="line">      &quot;type&quot; : &quot;word&quot;,</span><br><span class="line">      &quot;position&quot; : 9</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;莎士比亚&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 45,</span><br><span class="line">      &quot;end_offset&quot; : 49,</span><br><span class="line">      &quot;type&quot; : &quot;word&quot;,</span><br><span class="line">      &quot;position&quot; : 10</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="小写分词器：lowercase-tokenizer"><a href="#小写分词器：lowercase-tokenizer" class="headerlink" title="小写分词器：lowercase tokenizer"></a>小写分词器：lowercase tokenizer</h4><p>小写分词器（lowercase tokenizer）结合了常规的字母分词器和小写分词过滤器（跟你想的一样，就是将所有的分词转化为小写）的行为。通过一个单独的分词器来实现的主要原因是，一次进行两项操作会获得更好的性能。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">POST _analyze</span><br><span class="line">&#123;</span><br><span class="line">  &quot;tokenizer&quot;: &quot;lowercase&quot;,</span><br><span class="line">  &quot;text&quot;:&quot;To be or not to be,  That is a question ———— 莎士比亚&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>结果如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;tokens&quot; : [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;to&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 0,</span><br><span class="line">      &quot;end_offset&quot; : 2,</span><br><span class="line">      &quot;type&quot; : &quot;word&quot;,</span><br><span class="line">      &quot;position&quot; : 0</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;be&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 3,</span><br><span class="line">      &quot;end_offset&quot; : 5,</span><br><span class="line">      &quot;type&quot; : &quot;word&quot;,</span><br><span class="line">      &quot;position&quot; : 1</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;or&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 6,</span><br><span class="line">      &quot;end_offset&quot; : 8,</span><br><span class="line">      &quot;type&quot; : &quot;word&quot;,</span><br><span class="line">      &quot;position&quot; : 2</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;not&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 9,</span><br><span class="line">      &quot;end_offset&quot; : 12,</span><br><span class="line">      &quot;type&quot; : &quot;word&quot;,</span><br><span class="line">      &quot;position&quot; : 3</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;to&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 13,</span><br><span class="line">      &quot;end_offset&quot; : 15,</span><br><span class="line">      &quot;type&quot; : &quot;word&quot;,</span><br><span class="line">      &quot;position&quot; : 4</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;be&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 16,</span><br><span class="line">      &quot;end_offset&quot; : 18,</span><br><span class="line">      &quot;type&quot; : &quot;word&quot;,</span><br><span class="line">      &quot;position&quot; : 5</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;that&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 21,</span><br><span class="line">      &quot;end_offset&quot; : 25,</span><br><span class="line">      &quot;type&quot; : &quot;word&quot;,</span><br><span class="line">      &quot;position&quot; : 6</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;is&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 26,</span><br><span class="line">      &quot;end_offset&quot; : 28,</span><br><span class="line">      &quot;type&quot; : &quot;word&quot;,</span><br><span class="line">      &quot;position&quot; : 7</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;a&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 29,</span><br><span class="line">      &quot;end_offset&quot; : 30,</span><br><span class="line">      &quot;type&quot; : &quot;word&quot;,</span><br><span class="line">      &quot;position&quot; : 8</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;question&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 31,</span><br><span class="line">      &quot;end_offset&quot; : 39,</span><br><span class="line">      &quot;type&quot; : &quot;word&quot;,</span><br><span class="line">      &quot;position&quot; : 9</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;莎士比亚&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 45,</span><br><span class="line">      &quot;end_offset&quot; : 49,</span><br><span class="line">      &quot;type&quot; : &quot;word&quot;,</span><br><span class="line">      &quot;position&quot; : 10</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="空白分词器：whitespace-tokenizer"><a href="#空白分词器：whitespace-tokenizer" class="headerlink" title="空白分词器：whitespace tokenizer"></a>空白分词器：whitespace tokenizer</h4><p>空白分词器（whitespace tokenizer）通过空白来分隔不同的分词，空白包括空格、制表符、换行等。但是，我们需要注意的是，空白分词器不会删除任何标点符号。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">POST _analyze</span><br><span class="line">&#123;</span><br><span class="line">  &quot;tokenizer&quot;: &quot;whitespace&quot;,</span><br><span class="line">  &quot;text&quot;:&quot;To be or not to be,  That is a question ———— 莎士比亚&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>结果如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;tokens&quot; : [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;To&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 0,</span><br><span class="line">      &quot;end_offset&quot; : 2,</span><br><span class="line">      &quot;type&quot; : &quot;word&quot;,</span><br><span class="line">      &quot;position&quot; : 0</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;be&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 3,</span><br><span class="line">      &quot;end_offset&quot; : 5,</span><br><span class="line">      &quot;type&quot; : &quot;word&quot;,</span><br><span class="line">      &quot;position&quot; : 1</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;or&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 6,</span><br><span class="line">      &quot;end_offset&quot; : 8,</span><br><span class="line">      &quot;type&quot; : &quot;word&quot;,</span><br><span class="line">      &quot;position&quot; : 2</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;not&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 9,</span><br><span class="line">      &quot;end_offset&quot; : 12,</span><br><span class="line">      &quot;type&quot; : &quot;word&quot;,</span><br><span class="line">      &quot;position&quot; : 3</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;to&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 13,</span><br><span class="line">      &quot;end_offset&quot; : 15,</span><br><span class="line">      &quot;type&quot; : &quot;word&quot;,</span><br><span class="line">      &quot;position&quot; : 4</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;be,&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 16,</span><br><span class="line">      &quot;end_offset&quot; : 19,</span><br><span class="line">      &quot;type&quot; : &quot;word&quot;,</span><br><span class="line">      &quot;position&quot; : 5</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;That&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 21,</span><br><span class="line">      &quot;end_offset&quot; : 25,</span><br><span class="line">      &quot;type&quot; : &quot;word&quot;,</span><br><span class="line">      &quot;position&quot; : 6</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;is&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 26,</span><br><span class="line">      &quot;end_offset&quot; : 28,</span><br><span class="line">      &quot;type&quot; : &quot;word&quot;,</span><br><span class="line">      &quot;position&quot; : 7</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;a&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 29,</span><br><span class="line">      &quot;end_offset&quot; : 30,</span><br><span class="line">      &quot;type&quot; : &quot;word&quot;,</span><br><span class="line">      &quot;position&quot; : 8</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;question&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 31,</span><br><span class="line">      &quot;end_offset&quot; : 39,</span><br><span class="line">      &quot;type&quot; : &quot;word&quot;,</span><br><span class="line">      &quot;position&quot; : 9</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;————&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 40,</span><br><span class="line">      &quot;end_offset&quot; : 44,</span><br><span class="line">      &quot;type&quot; : &quot;word&quot;,</span><br><span class="line">      &quot;position&quot; : 10</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;莎士比亚&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 45,</span><br><span class="line">      &quot;end_offset&quot; : 49,</span><br><span class="line">      &quot;type&quot; : &quot;word&quot;,</span><br><span class="line">      &quot;position&quot; : 11</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="模式分词器：pattern-tokenizer"><a href="#模式分词器：pattern-tokenizer" class="headerlink" title="模式分词器：pattern tokenizer"></a>模式分词器：pattern tokenizer</h4><p>模式分词器（pattern tokenizer）允许指定一个任意的模式，将文本切分为分词。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">POST _analyze</span><br><span class="line">&#123;</span><br><span class="line">  &quot;tokenizer&quot;: &quot;pattern&quot;,</span><br><span class="line">  &quot;text&quot;:&quot;To be or not to be,  That is a question ———— 莎士比亚&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>现在让我们手动定制一个以逗号分隔的分词器。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">PUT pattern_test2</span><br><span class="line">&#123;</span><br><span class="line">  &quot;settings&quot;: &#123;</span><br><span class="line">    &quot;analysis&quot;: &#123;</span><br><span class="line">      &quot;analyzer&quot;: &#123;</span><br><span class="line">        &quot;my_analyzer&quot;:&#123;</span><br><span class="line">          &quot;tokenizer&quot;:&quot;my_tokenizer&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;tokenizer&quot;: &#123;</span><br><span class="line">        &quot;my_tokenizer&quot;:&#123;</span><br><span class="line">          &quot;type&quot;:&quot;pattern&quot;,</span><br><span class="line">          &quot;pattern&quot;:&quot;,&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上例中，在settings下的自定义分析器my_analyzer中，自定义的模式分词器名叫my_tokenizer；在与自定义分析器同级，为新建的自定义模式分词器设置一些属性，比如以逗号分隔。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">POST pattern_test2/_analyze</span><br><span class="line">&#123;</span><br><span class="line">  &quot;tokenizer&quot;: &quot;my_tokenizer&quot;,</span><br><span class="line">  &quot;text&quot;:&quot;To be or not to be,  That is a question ———— 莎士比亚&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>结果如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;tokens&quot; : [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;To be or not to be&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 0,</span><br><span class="line">      &quot;end_offset&quot; : 18,</span><br><span class="line">      &quot;type&quot; : &quot;word&quot;,</span><br><span class="line">      &quot;position&quot; : 0</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;  That is a question ———— 莎士比亚&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 19,</span><br><span class="line">      &quot;end_offset&quot; : 49,</span><br><span class="line">      &quot;type&quot; : &quot;word&quot;,</span><br><span class="line">      &quot;position&quot; : 1</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>根据结果可以看到，文档被逗号分割为两部分。</p>
<h4 id="UAX-URL电子邮件分词器：UAX-RUL-email-tokenizer"><a href="#UAX-URL电子邮件分词器：UAX-RUL-email-tokenizer" class="headerlink" title="UAX URL电子邮件分词器：UAX RUL email tokenizer"></a>UAX URL电子邮件分词器：UAX RUL email tokenizer</h4><p>在处理单个的英文单词的情况下，标准分词器是个非常好的选择，但是现在很多的网站以网址或电子邮件作为结尾，比如我们现在有这样的一个文本：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">作者：张开</span><br><span class="line">来源：未知 </span><br><span class="line">原文：https://www.cnblogs.com/Neeo/articles/10402742.html</span><br><span class="line">邮箱：xxxxxxx@xx.com</span><br><span class="line">版权声明：本文为博主原创文章，转载请附上博文链接！</span><br></pre></td></tr></table></figure>

<p>现在让我们使用标准分词器查看一下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">POST _analyze</span><br><span class="line">&#123;</span><br><span class="line">  &quot;tokenizer&quot;: &quot;standard&quot;,</span><br><span class="line">  &quot;text&quot;:&quot;作者：张开来源：未知原文：https://www.cnblogs.com/Neeo/articles/10402742.html邮箱：xxxxxxx@xx.com版权声明：本文为博主原创文章，转载请附上博文链接！&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>结果很长：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;tokens&quot; : [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;作&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 0,</span><br><span class="line">      &quot;end_offset&quot; : 1,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;IDEOGRAPHIC&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 0</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;者&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 1,</span><br><span class="line">      &quot;end_offset&quot; : 2,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;IDEOGRAPHIC&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 1</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;张&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 3,</span><br><span class="line">      &quot;end_offset&quot; : 4,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;IDEOGRAPHIC&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 2</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;开&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 4,</span><br><span class="line">      &quot;end_offset&quot; : 5,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;IDEOGRAPHIC&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 3</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;来&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 5,</span><br><span class="line">      &quot;end_offset&quot; : 6,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;IDEOGRAPHIC&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 4</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;源&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 6,</span><br><span class="line">      &quot;end_offset&quot; : 7,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;IDEOGRAPHIC&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 5</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;未&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 8,</span><br><span class="line">      &quot;end_offset&quot; : 9,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;IDEOGRAPHIC&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 6</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;知&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 9,</span><br><span class="line">      &quot;end_offset&quot; : 10,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;IDEOGRAPHIC&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 7</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;原&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 10,</span><br><span class="line">      &quot;end_offset&quot; : 11,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;IDEOGRAPHIC&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 8</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;文&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 11,</span><br><span class="line">      &quot;end_offset&quot; : 12,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;IDEOGRAPHIC&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 9</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;https&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 13,</span><br><span class="line">      &quot;end_offset&quot; : 18,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;ALPHANUM&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 10</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;www.cnblogs.com&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 21,</span><br><span class="line">      &quot;end_offset&quot; : 36,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;ALPHANUM&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 11</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;Neeo&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 37,</span><br><span class="line">      &quot;end_offset&quot; : 41,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;ALPHANUM&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 12</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;articles&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 42,</span><br><span class="line">      &quot;end_offset&quot; : 50,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;ALPHANUM&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 13</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;10402742&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 51,</span><br><span class="line">      &quot;end_offset&quot; : 59,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;NUM&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 14</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;html&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 60,</span><br><span class="line">      &quot;end_offset&quot; : 64,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;ALPHANUM&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 15</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;邮&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 64,</span><br><span class="line">      &quot;end_offset&quot; : 65,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;IDEOGRAPHIC&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 16</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;箱&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 65,</span><br><span class="line">      &quot;end_offset&quot; : 66,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;IDEOGRAPHIC&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 17</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;xxxxxxx&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 67,</span><br><span class="line">      &quot;end_offset&quot; : 74,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;ALPHANUM&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 18</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;xx.com&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 75,</span><br><span class="line">      &quot;end_offset&quot; : 81,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;ALPHANUM&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 19</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;版&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 81,</span><br><span class="line">      &quot;end_offset&quot; : 82,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;IDEOGRAPHIC&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 20</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;权&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 82,</span><br><span class="line">      &quot;end_offset&quot; : 83,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;IDEOGRAPHIC&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 21</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;声&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 83,</span><br><span class="line">      &quot;end_offset&quot; : 84,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;IDEOGRAPHIC&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 22</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;明&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 84,</span><br><span class="line">      &quot;end_offset&quot; : 85,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;IDEOGRAPHIC&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 23</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;本&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 86,</span><br><span class="line">      &quot;end_offset&quot; : 87,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;IDEOGRAPHIC&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 24</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;文&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 87,</span><br><span class="line">      &quot;end_offset&quot; : 88,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;IDEOGRAPHIC&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 25</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;为&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 88,</span><br><span class="line">      &quot;end_offset&quot; : 89,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;IDEOGRAPHIC&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 26</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;博&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 89,</span><br><span class="line">      &quot;end_offset&quot; : 90,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;IDEOGRAPHIC&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 27</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;主&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 90,</span><br><span class="line">      &quot;end_offset&quot; : 91,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;IDEOGRAPHIC&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 28</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;原&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 91,</span><br><span class="line">      &quot;end_offset&quot; : 92,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;IDEOGRAPHIC&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 29</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;创&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 92,</span><br><span class="line">      &quot;end_offset&quot; : 93,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;IDEOGRAPHIC&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 30</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;文&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 93,</span><br><span class="line">      &quot;end_offset&quot; : 94,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;IDEOGRAPHIC&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 31</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;章&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 94,</span><br><span class="line">      &quot;end_offset&quot; : 95,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;IDEOGRAPHIC&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 32</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;转&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 96,</span><br><span class="line">      &quot;end_offset&quot; : 97,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;IDEOGRAPHIC&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 33</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;载&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 97,</span><br><span class="line">      &quot;end_offset&quot; : 98,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;IDEOGRAPHIC&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 34</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;请&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 98,</span><br><span class="line">      &quot;end_offset&quot; : 99,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;IDEOGRAPHIC&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 35</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;附&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 99,</span><br><span class="line">      &quot;end_offset&quot; : 100,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;IDEOGRAPHIC&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 36</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;上&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 100,</span><br><span class="line">      &quot;end_offset&quot; : 101,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;IDEOGRAPHIC&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 37</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;博&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 101,</span><br><span class="line">      &quot;end_offset&quot; : 102,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;IDEOGRAPHIC&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 38</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;文&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 102,</span><br><span class="line">      &quot;end_offset&quot; : 103,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;IDEOGRAPHIC&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 39</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;链&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 103,</span><br><span class="line">      &quot;end_offset&quot; : 104,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;IDEOGRAPHIC&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 40</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;接&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 104,</span><br><span class="line">      &quot;end_offset&quot; : 105,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;IDEOGRAPHIC&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 41</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>无论如何，这个结果不符合我们的预期，因为把我们的邮箱和网址分的乱七八糟！那么针对这种情况，我们应该使用UAX URL电子邮件分词器（UAX RUL email tokenizer），该分词器将电子邮件和URL都作为单独的分词进行保留。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">POST _analyze</span><br><span class="line">&#123;</span><br><span class="line">  &quot;tokenizer&quot;: &quot;uax_url_email&quot;,</span><br><span class="line">  &quot;text&quot;:&quot;作者：张开来源：未知原文：https://www.cnblogs.com/Neeo/articles/10402742.html邮箱：xxxxxxx@xx.com版权声明：本文为博主原创文章，转载请附上博文链接！&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>结果如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;tokens&quot; : [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;作&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 0,</span><br><span class="line">      &quot;end_offset&quot; : 1,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;IDEOGRAPHIC&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 0</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;者&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 1,</span><br><span class="line">      &quot;end_offset&quot; : 2,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;IDEOGRAPHIC&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 1</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;张&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 3,</span><br><span class="line">      &quot;end_offset&quot; : 4,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;IDEOGRAPHIC&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 2</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;开&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 4,</span><br><span class="line">      &quot;end_offset&quot; : 5,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;IDEOGRAPHIC&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 3</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;来&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 5,</span><br><span class="line">      &quot;end_offset&quot; : 6,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;IDEOGRAPHIC&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 4</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;源&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 6,</span><br><span class="line">      &quot;end_offset&quot; : 7,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;IDEOGRAPHIC&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 5</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;未&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 8,</span><br><span class="line">      &quot;end_offset&quot; : 9,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;IDEOGRAPHIC&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 6</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;知&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 9,</span><br><span class="line">      &quot;end_offset&quot; : 10,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;IDEOGRAPHIC&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 7</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;原&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 10,</span><br><span class="line">      &quot;end_offset&quot; : 11,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;IDEOGRAPHIC&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 8</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;文&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 11,</span><br><span class="line">      &quot;end_offset&quot; : 12,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;IDEOGRAPHIC&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 9</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;https://www.cnblogs.com/Neeo/articles/10402742.html&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 13,</span><br><span class="line">      &quot;end_offset&quot; : 64,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;URL&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 10</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;邮&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 64,</span><br><span class="line">      &quot;end_offset&quot; : 65,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;IDEOGRAPHIC&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 11</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;箱&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 65,</span><br><span class="line">      &quot;end_offset&quot; : 66,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;IDEOGRAPHIC&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 12</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;xxxxxxx@xx.com&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 67,</span><br><span class="line">      &quot;end_offset&quot; : 81,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;EMAIL&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 13</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;版&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 81,</span><br><span class="line">      &quot;end_offset&quot; : 82,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;IDEOGRAPHIC&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 14</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;权&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 82,</span><br><span class="line">      &quot;end_offset&quot; : 83,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;IDEOGRAPHIC&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 15</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;声&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 83,</span><br><span class="line">      &quot;end_offset&quot; : 84,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;IDEOGRAPHIC&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 16</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;明&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 84,</span><br><span class="line">      &quot;end_offset&quot; : 85,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;IDEOGRAPHIC&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 17</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;本&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 86,</span><br><span class="line">      &quot;end_offset&quot; : 87,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;IDEOGRAPHIC&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 18</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;文&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 87,</span><br><span class="line">      &quot;end_offset&quot; : 88,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;IDEOGRAPHIC&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 19</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;为&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 88,</span><br><span class="line">      &quot;end_offset&quot; : 89,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;IDEOGRAPHIC&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 20</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;博&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 89,</span><br><span class="line">      &quot;end_offset&quot; : 90,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;IDEOGRAPHIC&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 21</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;主&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 90,</span><br><span class="line">      &quot;end_offset&quot; : 91,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;IDEOGRAPHIC&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 22</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;原&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 91,</span><br><span class="line">      &quot;end_offset&quot; : 92,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;IDEOGRAPHIC&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 23</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;创&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 92,</span><br><span class="line">      &quot;end_offset&quot; : 93,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;IDEOGRAPHIC&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 24</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;文&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 93,</span><br><span class="line">      &quot;end_offset&quot; : 94,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;IDEOGRAPHIC&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 25</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;章&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 94,</span><br><span class="line">      &quot;end_offset&quot; : 95,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;IDEOGRAPHIC&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 26</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;转&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 96,</span><br><span class="line">      &quot;end_offset&quot; : 97,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;IDEOGRAPHIC&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 27</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;载&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 97,</span><br><span class="line">      &quot;end_offset&quot; : 98,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;IDEOGRAPHIC&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 28</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;请&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 98,</span><br><span class="line">      &quot;end_offset&quot; : 99,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;IDEOGRAPHIC&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 29</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;附&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 99,</span><br><span class="line">      &quot;end_offset&quot; : 100,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;IDEOGRAPHIC&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 30</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;上&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 100,</span><br><span class="line">      &quot;end_offset&quot; : 101,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;IDEOGRAPHIC&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 31</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;博&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 101,</span><br><span class="line">      &quot;end_offset&quot; : 102,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;IDEOGRAPHIC&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 32</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;文&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 102,</span><br><span class="line">      &quot;end_offset&quot; : 103,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;IDEOGRAPHIC&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 33</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;链&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 103,</span><br><span class="line">      &quot;end_offset&quot; : 104,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;IDEOGRAPHIC&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 34</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;接&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 104,</span><br><span class="line">      &quot;end_offset&quot; : 105,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;IDEOGRAPHIC&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 35</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="路径层次分词器：path-hierarchy-tokenizer"><a href="#路径层次分词器：path-hierarchy-tokenizer" class="headerlink" title="路径层次分词器：path hierarchy tokenizer"></a>路径层次分词器：path hierarchy tokenizer</h4><p>路径层次分词器（path hierarchy tokenizer）允许以特定的方式索引文件系统的路径，这样在搜索时，共享同样路径的文件将被作为结果返回。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">POST _analyze</span><br><span class="line">&#123;</span><br><span class="line">  &quot;tokenizer&quot;: &quot;path_hierarchy&quot;,</span><br><span class="line">  &quot;text&quot;:&quot;/usr/local/python/python2.7&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>返回结果如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;tokens&quot; : [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;/usr&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 0,</span><br><span class="line">      &quot;end_offset&quot; : 4,</span><br><span class="line">      &quot;type&quot; : &quot;word&quot;,</span><br><span class="line">      &quot;position&quot; : 0</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;/usr/local&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 0,</span><br><span class="line">      &quot;end_offset&quot; : 10,</span><br><span class="line">      &quot;type&quot; : &quot;word&quot;,</span><br><span class="line">      &quot;position&quot; : 0</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;/usr/local/python&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 0,</span><br><span class="line">      &quot;end_offset&quot; : 17,</span><br><span class="line">      &quot;type&quot; : &quot;word&quot;,</span><br><span class="line">      &quot;position&quot; : 0</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;/usr/local/python/python2.7&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 0,</span><br><span class="line">      &quot;end_offset&quot; : 27,</span><br><span class="line">      &quot;type&quot; : &quot;word&quot;,</span><br><span class="line">      &quot;position&quot; : 0</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="分词过滤器"><a href="#分词过滤器" class="headerlink" title="分词过滤器"></a>分词过滤器</h3><p>es内置很多（真是变态多啊！但一般用不到）的分词过滤器。其中包含分词过滤器和字符过滤器。</p>
<h4 id="常见分词过滤器"><a href="#常见分词过滤器" class="headerlink" title="常见分词过滤器"></a>常见分词过滤器</h4><ul>
<li>标准分词过滤器（Standard Token Filter）在6.5.0版本弃用。此筛选器已被弃用，将在下一个主要版本中删除。在之前的版本中其实也没干啥，甚至在更老版本的<code>Lucene</code>中，它用于去除单词结尾的<code>s</code>字符，还有不必要的句点字符，但是现在， 连这些小功能都被其他的分词器和分词过滤器顺手干了，真可怜！</li>
<li>ASCII折叠分词过滤器（ASCII Folding Token Filter）将前127个ASCII字符(基本拉丁语的Unicode块)中不包含的字母、数字和符号Unicode字符转换为对应的ASCII字符(如果存在的话）。</li>
<li>扁平图形分词过滤器（Flatten Graph Token Filter）接受任意图形标记流。例如由同义词图形标记过滤器生成的标记流，并将其展平为适合索引的单个线性标记链。这是一个有损的过程，因为单独的侧路径被压扁在彼此之上，但是如果在索引期间使用图形令牌流是必要的，因为Lucene索引当前不能表示图形。 出于这个原因，最好只在搜索时应用图形分析器，因为这样可以保留完整的图形结构，并为邻近查询提供正确的匹配。该功能在Lucene中为实验性功能。</li>
<li>长度标记过滤器（Length Token Filter）会移除分词流中太长或者太短的标记，它是可配置的，我们可以在settings中设置。</li>
<li>小写分词过滤器（Lowercase Token Filter）将分词规范化为小写，它通过<code>language</code>参数支持希腊语、爱尔兰语和土耳其语小写标记过滤器。</li>
<li>大写分词过滤器（Uppercase Token Filter）将分词规范为大写。</li>
</ul>
<h4 id="自定义分词过滤器"><a href="#自定义分词过滤器" class="headerlink" title="自定义分词过滤器"></a>自定义分词过滤器</h4><p>接下来我们简单的来学习自定义两个分词过滤器。首先是长度分词过滤器。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">PUT pattern_test3</span><br><span class="line">&#123;</span><br><span class="line">  &quot;settings&quot;: &#123;</span><br><span class="line">    &quot;analysis&quot;: &#123;</span><br><span class="line">      &quot;filter&quot;: &#123;</span><br><span class="line">        &quot;my_test_length&quot;:&#123;</span><br><span class="line">          &quot;type&quot;:&quot;length&quot;,</span><br><span class="line">          &quot;max&quot;:8,</span><br><span class="line">          &quot;min&quot;:2</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上例中，我们自定义了一个长度过滤器，过滤掉长度大于8和小于2的分词。需要补充的是，max参数表示最大分词长度。默认为Integer.MAX_VALUE，就是2147483647（231−1231−1），而min则表示最小长度，默认为0。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">POST pattern_test3/_analyze</span><br><span class="line">&#123;</span><br><span class="line">  &quot;tokenizer&quot;: &quot;standard&quot;,</span><br><span class="line">  &quot;filter&quot;: [&quot;my_test_length&quot;],</span><br><span class="line">  &quot;text&quot;:&quot;a Small word and a longerword&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>结果如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;tokens&quot; : [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;Small&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 2,</span><br><span class="line">      &quot;end_offset&quot; : 7,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;ALPHANUM&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 1</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;word&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 8,</span><br><span class="line">      &quot;end_offset&quot; : 12,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;ALPHANUM&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 2</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;and&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 13,</span><br><span class="line">      &quot;end_offset&quot; : 16,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;ALPHANUM&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 3</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>自定义一个小写分词过滤器，过滤希腊文：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">PUT lowercase_example</span><br><span class="line">&#123;</span><br><span class="line">  &quot;settings&quot;: &#123;</span><br><span class="line">    &quot;analysis&quot;: &#123;</span><br><span class="line">      &quot;analyzer&quot;: &#123;</span><br><span class="line">        &quot;standard_lowercase_example&quot;: &#123;</span><br><span class="line">          &quot;type&quot;: &quot;custom&quot;,</span><br><span class="line">          &quot;tokenizer&quot;: &quot;standard&quot;,</span><br><span class="line">          &quot;filter&quot;: [&quot;lowercase&quot;]</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;greek_lowercase_example&quot;: &#123;</span><br><span class="line">          &quot;type&quot;: &quot;custom&quot;,</span><br><span class="line">          &quot;tokenizer&quot;: &quot;standard&quot;,</span><br><span class="line">          &quot;filter&quot;: [&quot;greek_lowercase&quot;]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &quot;filter&quot;: &#123;</span><br><span class="line">        &quot;greek_lowercase&quot;: &#123;</span><br><span class="line">          &quot;type&quot;: &quot;lowercase&quot;,</span><br><span class="line">          &quot;language&quot;: &quot;greek&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>过滤内容是：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">POST lowercase_example/_analyze</span><br><span class="line">&#123;</span><br><span class="line">  &quot;tokenizer&quot;: &quot;standard&quot;,</span><br><span class="line">  &quot;filter&quot;: [&quot;greek_lowercase&quot;],</span><br><span class="line">  &quot;text&quot;:&quot;Ένα φίλτρο διακριτικού τύπου πεζά s ομαλοποιεί το κείμενο διακριτικού σε χαμηλότερη θήκη&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>结果如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;tokens&quot; : [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;ενα&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 0,</span><br><span class="line">      &quot;end_offset&quot; : 3,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;ALPHANUM&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 0</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;φιλτρο&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 4,</span><br><span class="line">      &quot;end_offset&quot; : 10,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;ALPHANUM&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 1</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;διακριτικου&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 11,</span><br><span class="line">      &quot;end_offset&quot; : 22,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;ALPHANUM&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 2</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;τυπου&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 23,</span><br><span class="line">      &quot;end_offset&quot; : 28,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;ALPHANUM&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 3</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;πεζα&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 29,</span><br><span class="line">      &quot;end_offset&quot; : 33,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;ALPHANUM&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 4</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;s&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 34,</span><br><span class="line">      &quot;end_offset&quot; : 35,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;ALPHANUM&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 5</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;ομαλοποιει&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 36,</span><br><span class="line">      &quot;end_offset&quot; : 46,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;ALPHANUM&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 6</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;το&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 47,</span><br><span class="line">      &quot;end_offset&quot; : 49,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;ALPHANUM&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 7</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;κειμενο&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 50,</span><br><span class="line">      &quot;end_offset&quot; : 57,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;ALPHANUM&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 8</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;διακριτικου&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 58,</span><br><span class="line">      &quot;end_offset&quot; : 69,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;ALPHANUM&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 9</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;σε&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 70,</span><br><span class="line">      &quot;end_offset&quot; : 72,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;ALPHANUM&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 10</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;χαμηλοτερη&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 73,</span><br><span class="line">      &quot;end_offset&quot; : 83,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;ALPHANUM&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 11</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;θηκη&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 84,</span><br><span class="line">      &quot;end_offset&quot; : 88,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;ALPHANUM&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 12</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="多个分词过滤器"><a href="#多个分词过滤器" class="headerlink" title="多个分词过滤器"></a>多个分词过滤器</h4><p>除此之外，我们可以使用多个分词过滤器。例如我们在使用长度过滤器时，可以同时使用小写分词过滤器或者更多。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">POST _analyze</span><br><span class="line">&#123;</span><br><span class="line">  &quot;tokenizer&quot;: &quot;standard&quot;,</span><br><span class="line">  &quot;filter&quot;: [&quot;length&quot;,&quot;lowercase&quot;],</span><br><span class="line">  &quot;text&quot;:&quot;a Small word and a longerword&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上例中，我们用列表来管理多个分词过滤器。结果如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;tokens&quot; : [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;a&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 0,</span><br><span class="line">      &quot;end_offset&quot; : 1,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;ALPHANUM&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 0</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;small&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 2,</span><br><span class="line">      &quot;end_offset&quot; : 7,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;ALPHANUM&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 1</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;word&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 8,</span><br><span class="line">      &quot;end_offset&quot; : 12,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;ALPHANUM&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 2</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;and&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 13,</span><br><span class="line">      &quot;end_offset&quot; : 16,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;ALPHANUM&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 3</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;a&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 17,</span><br><span class="line">      &quot;end_offset&quot; : 18,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;ALPHANUM&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 4</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;token&quot; : &quot;longerword&quot;,</span><br><span class="line">      &quot;start_offset&quot; : 19,</span><br><span class="line">      &quot;end_offset&quot; : 29,</span><br><span class="line">      &quot;type&quot; : &quot;&lt;ALPHANUM&gt;&quot;,</span><br><span class="line">      &quot;position&quot; : 5</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h2 id="自然语言处理与中文分词"><a href="#自然语言处理与中文分词" class="headerlink" title="自然语言处理与中文分词"></a><a target="_blank" rel="noopener" href="https://www.cnblogs.com/Neeo/articles/10552936.html">自然语言处理与中文分词</a></h2><p>人工智能、机器学习、深度学习的关系：</p>
<p><img src="/images/1168165-20190318163424282-774752221.png" alt="img"></p>
<ul>
<li>机器学习：一种实现人工智能的方法</li>
<li>深度学习：一种实现机器学习的技术</li>
</ul>
<h3 id="基于词典分词算法"><a href="#基于词典分词算法" class="headerlink" title="基于词典分词算法"></a>基于词典分词算法</h3><p>基于词典分词算法，也称为字符串匹配分词算法。该算法是按照一定的策略将待匹配的字符串和一个已经建立好的”充分大的”词典中的词进行匹配，若找到某个词条，则说明匹配成功，识别了该词。常见的基于词典的分词算法为一下几种：</p>
<ul>
<li>正向最大匹配算法。</li>
<li>逆向最大匹配法。</li>
<li>最少切分法。</li>
<li>双向匹配分词法。</li>
</ul>
<p>基于词典的分词算法是应用最广泛，分词速度最快的，很长一段时间内研究者在对对基于字符串匹配方法进行优化，比如最大长度设定，字符串存储和查找方法以及对于词表的组织结构，比如采用TRIE索引树，哈希索引等。</p>
<p>这类算法的优点：速度快，都是O(n)的时间复杂度，实现简单，效果尚可。</p>
<p>算法的缺点：对歧义和未登录的词处理不好。</p>
<h3 id="基于理解的分词方法"><a href="#基于理解的分词方法" class="headerlink" title="基于理解的分词方法"></a>基于理解的分词方法</h3><p>这种分词方法是通过让计算机模拟人对句子的理解，达到识别词的效果，其基本思想就是在分词的同时进行句法、语义分析，利用句法信息和语义信息来处理歧义现象，它通常包含三个部分：分词系统，句法语义子系统，总控部分，在总控部分的协调下，分词系统可以获得有关词，句子等的句法和语义信息来对分词歧义进行判断，它模拟来人对句子的理解过程，这种分词方法需要大量的语言知识和信息，由于汉语言知识的笼统、复杂性，难以将各种语言信息组成及其可以直接读取的形式，因此目前基于理解的分词系统还在试验阶段。</p>
<h3 id="基于统计的机器学习算法"><a href="#基于统计的机器学习算法" class="headerlink" title="基于统计的机器学习算法"></a>基于统计的机器学习算法</h3><p>这类目前常用的算法是HMM，CRF，SVM，深度学习等算法，比如stanford，Hanlp分词工具是基于CRF算法。以CRF为例，基本思路是对汉字进行标注训练，不仅考虑了词语出现的频率，还考虑上下文，具备良好的学习能力，因此对歧义词和未登录词的识别都具有良好的效果。</p>
<p>Nianwen Xue在其论文中《<a target="_blank" rel="noopener" href="http://www.aclweb.org/anthology/W/W02/W02-1815.pdf">Combining Classifier for Chinese Word Segmentation</a>》中首次提出对每个字符进行标注，通过机器学习算法训练分类器进行分词，在论文《<a target="_blank" rel="noopener" href="https://www.aclweb.org/anthology/O03-4002">Chinese word segmentation as character tagging</a>》中较为详细地阐述了基于字标注的分词法。</p>
<p>算法优点：能很好处理歧义和未登录词问题，效果比前一类效果好</p>
<p>算法缺点: 需要大量的人工标注数据，以及较慢的分词速度</p>
<h3 id="目前常见的中文分词分类器"><a href="#目前常见的中文分词分类器" class="headerlink" title="目前常见的中文分词分类器"></a>目前常见的中文分词分类器</h3><p>现在，常见的分词器都是使用机器学习算法和词典相结合的算法，一方面能够提高分词准确率，另一方面能够改善领域适应性。</p>
<p>随着深度学习的兴起，也出现了基于神经网络的分词器，例如有研究人员尝试使用双向LSTM＋CRF实现分词器，其本质上是序列标注，所以有通用性，命名实体识别等都可以使用该模型，据报道其分词器字符准确率可以高达97.5%,算法框架的思路与论文《<a target="_blank" rel="noopener" href="https://www.aclweb.org/anthology/N16-1030">Neural Architectures for Named Entity Recogintion</a>》类似，利用该框架可以实现中文分词</p>
<h3 id="分词器目前存在的问题"><a href="#分词器目前存在的问题" class="headerlink" title="分词器目前存在的问题"></a>分词器目前存在的问题</h3><p>目前中文分词难点主要有三个：</p>
<ul>
<li>分词标准：比如人名，在哈工大的标准中姓和名是分开的，但是在Hanlp中是合在一起的，这需要根据不同的需求制定不同的分词标准。</li>
<li>歧义：对于同一个待切分字符串存在多个分词结果。歧义又分为组合歧义，交集型歧义和真歧义三种分类。<ul>
<li>组合型歧义：分词是有不同的粒度的，指某个词条中的一部分也可以切分未一个独立的词条，比如“中华人民共和国”，粗粒度的分词就是“中华人民共和国”，细粒度的分词可能是<code>中华/人民/共和国</code></li>
<li>交集型歧义：在<code>郑州天和服装厂</code>中，<code>天和</code>是厂名，是一个专有名词，<code>和服</code>也是一个词，它们共用了<code>和</code>字</li>
<li>真歧义：本身的语法和语义都没有问题，即便采用人工切分也会产生同样的歧义，只有通过上下文的语义环境才能给出正确的切分结果，例如：对于句子<code>美国会通过对台售武法案</code>，既可以切分成<code>美国/会/通过台售武法案</code>也可以切分成<code>美/国会/通过台售武法案</code>。</li>
</ul>
</li>
<li>新词：也称未被词典收录的词，该问题的解决依赖于人们对分词技术和汉语语言结构进一步认识。</li>
</ul>
<p>一般在搜索引擎中,构建索引时和查询时会使用不同的分词算法，常用的方案是，在索引的时候，使用细粒度的分词以保证召回，在查询的时候使用粗粒度的分词以保证精度。</p>
<h2 id="ik分词器"><a href="#ik分词器" class="headerlink" title="ik分词器"></a><a target="_blank" rel="noopener" href="https://www.cnblogs.com/Neeo/articles/10613793.html">ik分词器</a></h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">GET _analyze</span><br><span class="line">&#123;</span><br><span class="line">  &quot;analyzer&quot;: &quot;ik_max_word&quot;,</span><br><span class="line">  &quot;text&quot;: &quot;上海自来水来自海上&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;tokens&quot;</span> : [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;token&quot;</span> : <span class="string">&quot;上海&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;start_offset&quot;</span> : <span class="number">0</span>,</span><br><span class="line">      <span class="attr">&quot;end_offset&quot;</span> : <span class="number">2</span>,</span><br><span class="line">      <span class="attr">&quot;type&quot;</span> : <span class="string">&quot;CN_WORD&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;position&quot;</span> : <span class="number">0</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;token&quot;</span> : <span class="string">&quot;自来水&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;start_offset&quot;</span> : <span class="number">2</span>,</span><br><span class="line">      <span class="attr">&quot;end_offset&quot;</span> : <span class="number">5</span>,</span><br><span class="line">      <span class="attr">&quot;type&quot;</span> : <span class="string">&quot;CN_WORD&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;position&quot;</span> : <span class="number">1</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;token&quot;</span> : <span class="string">&quot;自来&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;start_offset&quot;</span> : <span class="number">2</span>,</span><br><span class="line">      <span class="attr">&quot;end_offset&quot;</span> : <span class="number">4</span>,</span><br><span class="line">      <span class="attr">&quot;type&quot;</span> : <span class="string">&quot;CN_WORD&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;position&quot;</span> : <span class="number">2</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;token&quot;</span> : <span class="string">&quot;水&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;start_offset&quot;</span> : <span class="number">4</span>,</span><br><span class="line">      <span class="attr">&quot;end_offset&quot;</span> : <span class="number">5</span>,</span><br><span class="line">      <span class="attr">&quot;type&quot;</span> : <span class="string">&quot;CN_CHAR&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;position&quot;</span> : <span class="number">3</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;token&quot;</span> : <span class="string">&quot;来自&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;start_offset&quot;</span> : <span class="number">5</span>,</span><br><span class="line">      <span class="attr">&quot;end_offset&quot;</span> : <span class="number">7</span>,</span><br><span class="line">      <span class="attr">&quot;type&quot;</span> : <span class="string">&quot;CN_WORD&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;position&quot;</span> : <span class="number">4</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;token&quot;</span> : <span class="string">&quot;海上&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;start_offset&quot;</span> : <span class="number">7</span>,</span><br><span class="line">      <span class="attr">&quot;end_offset&quot;</span> : <span class="number">9</span>,</span><br><span class="line">      <span class="attr">&quot;type&quot;</span> : <span class="string">&quot;CN_WORD&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;position&quot;</span> : <span class="number">5</span></span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="ik目录简介"><a href="#ik目录简介" class="headerlink" title="ik目录简介"></a>ik目录简介</h3><p>我们简要的介绍一下ik分词配置文件：</p>
<ul>
<li>IKAnalyzer.cfg.xml，用来配置自定义的词库</li>
<li>main.dic，ik原生内置的中文词库，大约有27万多条，只要是这些单词，都会被分在一起。</li>
<li>surname.dic，中国的姓氏。</li>
<li>suffix.dic，特殊（后缀）名词，例如<code>乡、江、所、省</code>等等。</li>
<li>preposition.dic，中文介词，例如<code>不、也、了、仍</code>等等。</li>
<li>stopword.dic，英文停用词库，例如<code>a、an、and、the</code>等。</li>
<li>quantifier.dic，单位名词，如<code>厘米、件、倍、像素</code>等。</li>
</ul>
<h2 id="For-Python"><a href="#For-Python" class="headerlink" title="For Python"></a><a target="_blank" rel="noopener" href="https://www.cnblogs.com/Neeo/articles/10615615.html">For Python</a></h2><h3 id="hello-world"><a href="#hello-world" class="headerlink" title="hello world"></a>hello world</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install elasticsearch</span><br></pre></td></tr></table></figure>



<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> elasticsearch <span class="keyword">import</span>  Elasticsearch</span><br><span class="line"><span class="comment"># es = Elasticsearch()    # 默认连接本地elasticsearch</span></span><br><span class="line"><span class="comment"># es = Elasticsearch([&#x27;127.0.0.1:9200&#x27;])  # 连接本地9200端口</span></span><br><span class="line">es = Elasticsearch(</span><br><span class="line">    [<span class="string">&quot;192.168.1.10&quot;</span>, <span class="string">&quot;192.168.1.11&quot;</span>, <span class="string">&quot;192.168.1.12&quot;</span>], <span class="comment"># 连接集群，以列表的形式存放各节点的IP地址</span></span><br><span class="line">    sniff_on_start=<span class="literal">True</span>,    <span class="comment"># 连接前测试</span></span><br><span class="line">    sniff_on_connection_fail=<span class="literal">True</span>,  <span class="comment"># 节点无响应时刷新节点</span></span><br><span class="line">    sniff_timeout=<span class="number">60</span>    <span class="comment"># 设置超时时间</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>



<p>示例</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> elasticsearch <span class="keyword">import</span>  Elasticsearch</span><br><span class="line">es = Elasticsearch()    <span class="comment"># 默认连接本地elasticsearch</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 第1个print为创建py2索引，并插入一条数据，第2个print查询指定文档。</span></span><br><span class="line"><span class="built_in">print</span>(es.index(index=<span class="string">&#x27;py2&#x27;</span>, doc_type=<span class="string">&#x27;doc&#x27;</span>, <span class="built_in">id</span>=<span class="number">1</span>, body=&#123;<span class="string">&#x27;name&#x27;</span>: <span class="string">&quot;张开&quot;</span>, <span class="string">&quot;age&quot;</span>: <span class="number">18</span>&#125;))</span><br><span class="line"><span class="built_in">print</span>(es.get(index=<span class="string">&#x27;py2&#x27;</span>, doc_type=<span class="string">&#x27;doc&#x27;</span>, <span class="built_in">id</span>=<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出:</span></span><br><span class="line">&#123;<span class="string">&#x27;_index&#x27;</span>: <span class="string">&#x27;py2&#x27;</span>, <span class="string">&#x27;_type&#x27;</span>: <span class="string">&#x27;doc&#x27;</span>, <span class="string">&#x27;_id&#x27;</span>: <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;_version&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;result&#x27;</span>: <span class="string">&#x27;created&#x27;</span>, <span class="string">&#x27;_shards&#x27;</span>: &#123;<span class="string">&#x27;total&#x27;</span>: <span class="number">2</span>, <span class="string">&#x27;successful&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;failed&#x27;</span>: <span class="number">0</span>&#125;, <span class="string">&#x27;_seq_no&#x27;</span>: <span class="number">0</span>, <span class="string">&#x27;_primary_term&#x27;</span>: <span class="number">1</span>&#125;</span><br><span class="line">&#123;<span class="string">&#x27;_index&#x27;</span>: <span class="string">&#x27;py2&#x27;</span>, <span class="string">&#x27;_type&#x27;</span>: <span class="string">&#x27;doc&#x27;</span>, <span class="string">&#x27;_id&#x27;</span>: <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;_version&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;found&#x27;</span>: <span class="literal">True</span>, <span class="string">&#x27;_source&#x27;</span>: &#123;<span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;张开&#x27;</span>, <span class="string">&#x27;age&#x27;</span>: <span class="number">18</span>&#125;&#125;</span><br></pre></td></tr></table></figure>



<p>Python中关于elasticsearch的操作，主要集中一下几个方面：</p>
<ul>
<li>结果过滤，对于返回结果做过滤，主要是优化返回内容。</li>
<li>直接操作elasticsearch对象，处理一些简单的索引信息。一下几个方面都是建立在es对象的基础上。</li>
<li>Indices，关于索引的细节操作，比如创建自定义的<code>mappings</code>。</li>
<li>Cluster，关于集群的相关操作。</li>
<li>Nodes，关于节点的相关操作。</li>
<li>Cat API，换一种查询方式，一般的返回都是json类型的，cat提供了简洁的返回结果。</li>
<li>Snapshot，快照相关，快照是从正在运行的Elasticsearch集群中获取的备份。我们可以拍摄单个索引或整个群集的快照，并将其存储在共享文件系统的存储库中，并且有一些插件支持S3，HDFS，Azure，Google云存储等上的远程存储库。</li>
<li>Task Management API，任务管理API是新的，仍应被视为测试版功能。API可能以不向后兼容的方式更改。</li>
</ul>
<h3 id="结果过滤"><a href="#结果过滤" class="headerlink" title="结果过滤"></a>结果过滤</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(es.search(index=<span class="string">&#x27;py2&#x27;</span>, filter_path=[<span class="string">&#x27;hits.total&#x27;</span>, <span class="string">&#x27;hits.hits._source&#x27;</span>]))    <span class="comment"># 可以省略type类型</span></span><br><span class="line"><span class="built_in">print</span>(es.search(index=<span class="string">&#x27;w2&#x27;</span>, doc_type=<span class="string">&#x27;doc&#x27;</span>))        <span class="comment"># 可以指定type类型</span></span><br><span class="line"><span class="built_in">print</span>(es.search(index=<span class="string">&#x27;w2&#x27;</span>, doc_type=<span class="string">&#x27;doc&#x27;</span>, filter_path=[<span class="string">&#x27;hits.total&#x27;</span>]))</span><br></pre></td></tr></table></figure>

<p><strong><code>filter_path</code>参数用于减少elasticsearch返回的响应，比如仅返回<code>hits.total</code>和<code>hits.hits._source</code>内容。</strong><br>除此之外，<code>filter_path</code>参数还支持<code>*</code>通配符以匹配字段名称、任何字段或者字段部分：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(es.search(index=<span class="string">&#x27;py2&#x27;</span>, filter_path=[<span class="string">&#x27;hits.*&#x27;</span>]))</span><br><span class="line"><span class="built_in">print</span>(es.search(index=<span class="string">&#x27;py2&#x27;</span>, filter_path=[<span class="string">&#x27;hits.hits._*&#x27;</span>]))</span><br><span class="line"><span class="built_in">print</span>(es.search(index=<span class="string">&#x27;py2&#x27;</span>, filter_path=[<span class="string">&#x27;hits.to*&#x27;</span>]))  <span class="comment"># 仅返回响应数据的total</span></span><br><span class="line"><span class="built_in">print</span>(es.search(index=<span class="string">&#x27;w2&#x27;</span>, doc_type=<span class="string">&#x27;doc&#x27;</span>, filter_path=[<span class="string">&#x27;hits.hits._*&#x27;</span>]))        <span class="comment"># 可以加上可选的type类型</span></span><br></pre></td></tr></table></figure>



<h3 id="Elasticsearch（es对象）"><a href="#Elasticsearch（es对象）" class="headerlink" title="Elasticsearch（es对象）"></a>Elasticsearch（es对象）</h3><ul>
<li><strong>es.index，向指定索引添加或更新文档，如果索引不存在，首先会创建该索引，然后再执行添加或者更新操作。</strong></li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># print(es.index(index=&#x27;w2&#x27;, doc_type=&#x27;doc&#x27;, id=&#x27;4&#x27;, body=&#123;&quot;name&quot;:&quot;可可&quot;, &quot;age&quot;: 18&#125;))    # 正常</span></span><br><span class="line"><span class="comment"># print(es.index(index=&#x27;w2&#x27;, doc_type=&#x27;doc&#x27;, id=5, body=&#123;&quot;name&quot;:&quot;卡卡西&quot;, &quot;age&quot;:22&#125;))     # 正常</span></span><br><span class="line"><span class="comment"># print(es.index(index=&#x27;w2&#x27;, id=6, body=&#123;&quot;name&quot;: &quot;鸣人&quot;, &quot;age&quot;: 22&#125;))  # 会报错，TypeError: index() missing 1 required positional argument: &#x27;doc_type&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(es.index(index=<span class="string">&#x27;w2&#x27;</span>, doc_type=<span class="string">&#x27;doc&#x27;</span>, body=&#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;鸣人&quot;</span>, <span class="string">&quot;age&quot;</span>: <span class="number">22</span>&#125;))  <span class="comment"># 可以不指定id，默认生成一个id</span></span><br></pre></td></tr></table></figure>

<ul>
<li><strong>es.get，查询索引中指定文档。</strong></li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(es.get(index=<span class="string">&#x27;w2&#x27;</span>, doc_type=<span class="string">&#x27;doc&#x27;</span>, <span class="built_in">id</span>=<span class="number">5</span>))  <span class="comment"># 正常</span></span><br><span class="line"><span class="built_in">print</span>(es.get(index=<span class="string">&#x27;w2&#x27;</span>, doc_type=<span class="string">&#x27;doc&#x27;</span>))  <span class="comment"># TypeError: get() missing 1 required positional argument: &#x27;id&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(es.get(index=<span class="string">&#x27;w2&#x27;</span>,  <span class="built_in">id</span>=<span class="number">5</span>))  <span class="comment"># TypeError: get() missing 1 required positional argument: &#x27;doc_type&#x27;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>es.search，执行搜索查询并获取与查询匹配的搜索匹配。这个用的最多，可以跟复杂的查询条件。<ul>
<li><code>index</code>要搜索的以逗号分隔的索引名称列表; 使用_all 或空字符串对所有索引执行操作。</li>
<li><code>doc_type</code> 要搜索的以逗号分隔的文档类型列表; 留空以对所有类型执行操作。</li>
<li><code>body</code> 使用Query DSL（QueryDomain Specific Language查询表达式）的搜索定义。</li>
<li><code>_source</code> 返回<code>_source</code>字段的true或false，或返回的字段列表，返回指定字段。</li>
<li><code>_source_exclude</code>要从返回的<code>_source</code>字段中排除的字段列表，返回的所有字段中，排除哪些字段。</li>
<li><code>_source_include</code>从<code>_source</code>字段中提取和返回的字段列表，跟<code>_source</code>差不多。</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(es.search(index=<span class="string">&#x27;py3&#x27;</span>, doc_type=<span class="string">&#x27;doc&#x27;</span>, body=&#123;<span class="string">&quot;query&quot;</span>: &#123;<span class="string">&quot;match&quot;</span>:&#123;<span class="string">&quot;age&quot;</span>: <span class="number">20</span>&#125;&#125;&#125;))  <span class="comment"># 一般查询</span></span><br><span class="line"><span class="built_in">print</span>(es.search(index=<span class="string">&#x27;py3&#x27;</span>, doc_type=<span class="string">&#x27;doc&#x27;</span>, body=&#123;<span class="string">&quot;query&quot;</span>: &#123;<span class="string">&quot;match&quot;</span>:&#123;<span class="string">&quot;age&quot;</span>: <span class="number">19</span>&#125;&#125;&#125;,_source=[<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;age&#x27;</span>]))  <span class="comment"># 结果字段过滤</span></span><br><span class="line"><span class="built_in">print</span>(es.search(index=<span class="string">&#x27;py3&#x27;</span>, doc_type=<span class="string">&#x27;doc&#x27;</span>, body=&#123;<span class="string">&quot;query&quot;</span>: &#123;<span class="string">&quot;match&quot;</span>:&#123;<span class="string">&quot;age&quot;</span>: <span class="number">19</span>&#125;&#125;&#125;,_source_exclude  =[ <span class="string">&#x27;age&#x27;</span>]))</span><br><span class="line"><span class="built_in">print</span>(es.search(index=<span class="string">&#x27;py3&#x27;</span>, doc_type=<span class="string">&#x27;doc&#x27;</span>, body=&#123;<span class="string">&quot;query&quot;</span>: &#123;<span class="string">&quot;match&quot;</span>:&#123;<span class="string">&quot;age&quot;</span>: <span class="number">19</span>&#125;&#125;&#125;,_source_include =[ <span class="string">&#x27;age&#x27;</span>]))</span><br></pre></td></tr></table></figure>

<ul>
<li>es.get_source，通过索引、类型和ID获取文档的来源，其实，直接返回想要的字典。</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(es.get_source(index=<span class="string">&#x27;py3&#x27;</span>, doc_type=<span class="string">&#x27;doc&#x27;</span>, <span class="built_in">id</span>=<span class="string">&#x27;1&#x27;</span>))  <span class="comment"># &#123;&#x27;name&#x27;: &#x27;王五&#x27;, &#x27;age&#x27;: 19&#125;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><strong>es.count，执行查询并获取该查询的匹配数。比如查询年龄是18的文档。</strong></li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">body = &#123;</span><br><span class="line">    <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;match&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;age&quot;</span>: <span class="number">18</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">print</span>(es.count(index=<span class="string">&#x27;py2&#x27;</span>, doc_type=<span class="string">&#x27;doc&#x27;</span>, body=body))  <span class="comment"># &#123;&#x27;count&#x27;: 1, &#x27;_shards&#x27;: &#123;&#x27;total&#x27;: 5, &#x27;successful&#x27;: 5, &#x27;skipped&#x27;: 0, &#x27;failed&#x27;: 0&#125;&#125;</span></span><br><span class="line"><span class="built_in">print</span>(es.count(index=<span class="string">&#x27;py2&#x27;</span>, doc_type=<span class="string">&#x27;doc&#x27;</span>, body=body)[<span class="string">&#x27;count&#x27;</span>])  <span class="comment"># 1</span></span><br><span class="line"><span class="built_in">print</span>(es.count(index=<span class="string">&#x27;w2&#x27;</span>))  <span class="comment"># &#123;&#x27;count&#x27;: 6, &#x27;_shards&#x27;: &#123;&#x27;total&#x27;: 5, &#x27;successful&#x27;: 5, &#x27;skipped&#x27;: 0, &#x27;failed&#x27;: 0&#125;&#125;</span></span><br><span class="line"><span class="built_in">print</span>(es.count(index=<span class="string">&#x27;w2&#x27;</span>, doc_type=<span class="string">&#x27;doc&#x27;</span>))  <span class="comment"># &#123;&#x27;count&#x27;: 6, &#x27;_shards&#x27;: &#123;&#x27;total&#x27;: 5, &#x27;successful&#x27;: 5, &#x27;skipped&#x27;: 0, &#x27;failed&#x27;: 0&#125;&#125;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><strong>es.create，创建索引（索引不存在的话）并新增一条数据，索引存在仅新增（只能新增，重复执行会报错）。</strong></li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(es.create(index=<span class="string">&#x27;py3&#x27;</span>, doc_type=<span class="string">&#x27;doc&#x27;</span>, <span class="built_in">id</span>=<span class="string">&#x27;1&#x27;</span>, body=&#123;<span class="string">&quot;name&quot;</span>: <span class="string">&#x27;王五&#x27;</span>, <span class="string">&quot;age&quot;</span>: <span class="number">20</span>&#125;))</span><br><span class="line"><span class="built_in">print</span>(es.get(index=<span class="string">&#x27;py3&#x27;</span>, doc_type=<span class="string">&#x27;doc&#x27;</span>, <span class="built_in">id</span>=<span class="string">&#x27;3&#x27;</span>))</span><br></pre></td></tr></table></figure>

<p>在内部，调用了index，等价于：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(es.index(index=<span class="string">&#x27;py3&#x27;</span>, doc_type=<span class="string">&#x27;doc&#x27;</span>, <span class="built_in">id</span>=<span class="string">&#x27;4&#x27;</span>, body=&#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;麻子&quot;</span>, <span class="string">&quot;age&quot;</span>: <span class="number">21</span>&#125;))</span><br></pre></td></tr></table></figure>

<p>但个人觉得没有index好用！</p>
<ul>
<li><strong>es.delete，删除指定的文档。比如删除文章id为<code>4</code>的文档，但不能删除索引，如果想要删除索引，还需要es.indices.delete来处理</strong></li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(es.delete(index=<span class="string">&#x27;py3&#x27;</span>, doc_type=<span class="string">&#x27;doc&#x27;</span>, <span class="built_in">id</span>=<span class="string">&#x27;4&#x27;</span>))</span><br></pre></td></tr></table></figure>

<ul>
<li>es.delete_by_query，删除与查询匹配的所有文档。<ul>
<li><code>index</code> 要搜索的以逗号分隔的索引名称列表; 使用_all 或空字符串对所有索引执行操作。</li>
<li><code>doc_type</code> 要搜索的以逗号分隔的文档类型列表; 留空以对所有类型执行操作。</li>
<li><code>body</code>使用Query DSL的搜索定义。</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(es.delete_by_query(index=<span class="string">&#x27;py3&#x27;</span>, doc_type=<span class="string">&#x27;doc&#x27;</span>, body=&#123;<span class="string">&quot;query&quot;</span>: &#123;<span class="string">&quot;match&quot;</span>:&#123;<span class="string">&quot;age&quot;</span>: <span class="number">20</span>&#125;&#125;&#125;))</span><br></pre></td></tr></table></figure>

<ul>
<li>es.exists，查询elasticsearch中是否存在指定的文档，返回一个布尔值。</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(es.exists(index=<span class="string">&#x27;py3&#x27;</span>, doc_type=<span class="string">&#x27;doc&#x27;</span>, <span class="built_in">id</span>=<span class="string">&#x27;1&#x27;</span>))</span><br></pre></td></tr></table></figure>

<ul>
<li>es.info，获取当前集群的基本信息。</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(es.info())</span><br></pre></td></tr></table></figure>

<ul>
<li>es.ping，如果群集已启动，则返回True，否则返回False。</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(es.ping())</span><br></pre></td></tr></table></figure>



<h3 id="Indices（es-indices）"><a href="#Indices（es-indices）" class="headerlink" title="Indices（es.indices）"></a>Indices（es.indices）</h3><ul>
<li><strong>es.indices.create，在Elasticsearch中创建索引，用的最多。</strong>比如创建一个严格模式、有4个字段、并为<code>title</code>字段指定<code>ik_max_word</code>查询粒度的<code>mappings</code>。并应用到<code>py4</code>索引中。这也是常用的创建自定义索引的方式。</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">body = &#123;</span><br><span class="line">    <span class="string">&quot;mappings&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;doc&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;dynamic&quot;</span>: <span class="string">&quot;strict&quot;</span>,</span><br><span class="line">            <span class="string">&quot;properties&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;title&quot;</span>: &#123;</span><br><span class="line">                    <span class="string">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;analyzer&quot;</span>: <span class="string">&quot;ik_max_word&quot;</span></span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="string">&quot;url&quot;</span>: &#123;</span><br><span class="line">                    <span class="string">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span></span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="string">&quot;action_type&quot;</span>: &#123;</span><br><span class="line">                    <span class="string">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span></span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="string">&quot;content&quot;</span>: &#123;</span><br><span class="line">                    <span class="string">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">es.indices.create(<span class="string">&#x27;py4&#x27;</span>, body=body)</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>es.indices.analyze，返回分词结果。</strong></li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">es.indices.analyze(body=&#123;<span class="string">&#x27;analyzer&#x27;</span>: <span class="string">&quot;ik_max_word&quot;</span>, <span class="string">&quot;text&quot;</span>: <span class="string">&quot;皮特和茱丽当选“年度模范情侣”Brad Pitt and Angelina Jolie&quot;</span>&#125;)</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>es.indices.delete，在Elasticsearch中删除索引。</strong></li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(es.indices.delete(index=<span class="string">&#x27;py4&#x27;</span>))</span><br><span class="line"><span class="built_in">print</span>(es.indices.delete(index=<span class="string">&#x27;w3&#x27;</span>))    <span class="comment"># &#123;&#x27;acknowledged&#x27;: True&#125;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>es.indices.put_alias，为一个或多个索引创建别名，查询多个索引的时候，可以使用这个别名。<ul>
<li><code>index</code> 别名应指向的逗号分隔的索引名称列表（支持通配符），使用_all对所有索引执行操作。</li>
<li><code>name</code>要创建或更新的别名的名称。</li>
<li><code>body</code>别名的设置，例如路由或过滤器。</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(es.indices.put_alias(index=<span class="string">&#x27;py4&#x27;</span>, name=<span class="string">&#x27;py4_alias&#x27;</span>))  <span class="comment"># 为单个索引创建别名</span></span><br><span class="line"><span class="built_in">print</span>(es.indices.put_alias(index=[<span class="string">&#x27;py3&#x27;</span>, <span class="string">&#x27;py2&#x27;</span>], name=<span class="string">&#x27;py23_alias&#x27;</span>))  <span class="comment"># 为多个索引创建同一个别名，联查用</span></span><br></pre></td></tr></table></figure>

<ul>
<li><strong>es.indices.delete_alias，删除一个或多个别名。</strong></li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(es.indices.delete_alias(index=<span class="string">&#x27;alias1&#x27;</span>))</span><br><span class="line"><span class="built_in">print</span>(es.indices.delete_alias(index=[<span class="string">&#x27;alias1, alias2&#x27;</span>]))</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>es.indices.get_mapping，检索索引或索引/类型的映射定义。</strong></li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(es.indices.get_mapping(index=<span class="string">&#x27;py4&#x27;</span>))</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>es.indices.get_settings，检索一个或多个（或所有）索引的设置。</strong></li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(es.indices.get_settings(index=<span class="string">&#x27;py4&#x27;</span>))</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>es.indices.get，允许检索有关一个或多个索引的信息。</strong></li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(es.indices.get(index=<span class="string">&#x27;py2&#x27;</span>))    <span class="comment"># 查询指定索引是否存在</span></span><br><span class="line"><span class="built_in">print</span>(es.indices.get(index=[<span class="string">&#x27;py2&#x27;</span>, <span class="string">&#x27;py3&#x27;</span>]))</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>es.indices.get_alias，检索一个或多个别名。</strong></li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(es.indices.get_alias(index=<span class="string">&#x27;py2&#x27;</span>))</span><br><span class="line"><span class="built_in">print</span>(es.indices.get_alias(index=[<span class="string">&#x27;py2&#x27;</span>, <span class="string">&#x27;py3&#x27;</span>]))</span><br></pre></td></tr></table></figure>

<ul>
<li>es.indices.get_field_mapping，检索特定字段的映射信息。</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(es.indices.get_field_mapping(fields=<span class="string">&#x27;url&#x27;</span>, index=<span class="string">&#x27;py4&#x27;</span>, doc_type=<span class="string">&#x27;doc&#x27;</span>))</span><br><span class="line"><span class="built_in">print</span>(es.indices.get_field_mapping(fields=[<span class="string">&#x27;url&#x27;</span>, <span class="string">&#x27;title&#x27;</span>], index=<span class="string">&#x27;py4&#x27;</span>, doc_type=<span class="string">&#x27;doc&#x27;</span>))</span><br></pre></td></tr></table></figure>

<ul>
<li>es.indices.delete_alias，删除特定别名。</li>
<li>es.indices.exists，返回一个布尔值，指示给定的索引是否存在。</li>
<li>es.indices.exists_type，检查索引/索引中是否存在类型/类型。</li>
<li>es.indices.flus，明确的刷新一个或多个索引。</li>
<li>es.indices.get_field_mapping，检索特定字段的映射。</li>
<li>es.indices.get_template，按名称检索索引模板。</li>
<li>es.indices.open，打开一个封闭的索引以使其可用于搜索。</li>
<li>es.indices.close，关闭索引以从群集中删除它的开销。封闭索引被阻止进行读/写操作。</li>
<li>es.indices.clear_cache，清除与一个或多个索引关联的所有缓存或特定缓存。</li>
<li>es.indices.put_alias，为特定索引/索引创建别名。</li>
<li>es.indices.get_uprade，监控一个或多个索引的升级程度。</li>
<li>es.indices.put_mapping，注册特定类型的特定映射定义。</li>
<li>es.indices.put_settings，实时更改特定索引级别设置。</li>
<li>es.indices.put_template，创建一个索引模板，该模板将自动应用于创建的新索引。</li>
<li>es.indices.rollove，当现有索引被认为太大或太旧时，翻转索引API将别名转移到新索引。API接受单个别名和条件列表。别名必须仅指向单个索引。如果索引满足指定条件，则创建新索引并切换别名以指向新别名。</li>
<li>es.indices.segments，提供构建Lucene索引（分片级别）的低级别段信息。</li>
</ul>
<h3 id="Cluster（集群相关）"><a href="#Cluster（集群相关）" class="headerlink" title="Cluster（集群相关）"></a>Cluster（集群相关）</h3><ul>
<li>es.cluster.get_settigns，获取集群设置。</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(es.cluster.get_settings())</span><br></pre></td></tr></table></figure>

<ul>
<li>es.cluster.health，获取有关群集运行状况的非常简单的状态。</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(es.cluster.health())</span><br></pre></td></tr></table></figure>

<ul>
<li>es.cluster.state，获取整个集群的综合状态信息。</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(es.cluster.state())</span><br></pre></td></tr></table></figure>

<ul>
<li>es.cluster.stats，返回群集的当前节点的信息。</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(es.cluster.stats())</span><br></pre></td></tr></table></figure>



<h3 id="Node（节点相关）"><a href="#Node（节点相关）" class="headerlink" title="Node（节点相关）"></a>Node（节点相关）</h3><ul>
<li>es.nodes.info，返回集群中节点的信息。</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(es.nodes.info())  <span class="comment"># 返回所节点</span></span><br><span class="line"><span class="built_in">print</span>(es.nodes.info(node_id=<span class="string">&#x27;node1&#x27;</span>))   <span class="comment"># 指定一个节点</span></span><br><span class="line"><span class="built_in">print</span>(es.nodes.info(node_id=[<span class="string">&#x27;node1&#x27;</span>, <span class="string">&#x27;node2&#x27;</span>]))   <span class="comment"># 指定多个节点列表</span></span><br></pre></td></tr></table></figure>

<ul>
<li>es.nodes.stats，获取集群中节点统计信息。</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(es.nodes.stats())</span><br><span class="line"><span class="built_in">print</span>(es.nodes.stats(node_id=<span class="string">&#x27;node1&#x27;</span>))</span><br><span class="line"><span class="built_in">print</span>(es.nodes.stats(node_id=[<span class="string">&#x27;node1&#x27;</span>, <span class="string">&#x27;node2&#x27;</span>]))</span><br></pre></td></tr></table></figure>

<ul>
<li>es.nodes.hot_threads，获取指定节点的线程信息。</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(es.nodes.hot_threads(node_id=<span class="string">&#x27;node1&#x27;</span>))</span><br><span class="line"><span class="built_in">print</span>(es.nodes.hot_threads(node_id=[<span class="string">&#x27;node1&#x27;</span>, <span class="string">&#x27;node2&#x27;</span>]))</span><br></pre></td></tr></table></figure>

<ul>
<li>es.nodes.usage，获取集群中节点的功能使用信息。</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(es.nodes.usage())</span><br><span class="line"><span class="built_in">print</span>(es.nodes.usage(node_id=<span class="string">&#x27;node1&#x27;</span>))</span><br><span class="line"><span class="built_in">print</span>(es.nodes.usage(node_id=[<span class="string">&#x27;node1&#x27;</span>, <span class="string">&#x27;node2&#x27;</span>]))</span><br></pre></td></tr></table></figure>



<h3 id="Cat（一种查询方式）"><a href="#Cat（一种查询方式）" class="headerlink" title="Cat（一种查询方式）"></a>Cat（一种查询方式）</h3><ul>
<li>es.cat.aliases，返回别名信息。<ul>
<li><code>name</code>要返回的以逗号分隔的别名列表。</li>
<li><code>format</code>Accept标头的简短版本，例如json，yaml</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(es.cat.aliases(name=<span class="string">&#x27;py23_alias&#x27;</span>))</span><br><span class="line"><span class="built_in">print</span>(es.cat.aliases(name=<span class="string">&#x27;py23_alias&#x27;</span>, <span class="built_in">format</span>=<span class="string">&#x27;json&#x27;</span>))</span><br></pre></td></tr></table></figure>

<ul>
<li>es.cat.allocation，返回分片使用情况。</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(es.cat.allocation())</span><br><span class="line"><span class="built_in">print</span>(es.cat.allocation(node_id=[<span class="string">&#x27;node1&#x27;</span>]))</span><br><span class="line"><span class="built_in">print</span>(es.cat.allocation(node_id=[<span class="string">&#x27;node1&#x27;</span>, <span class="string">&#x27;node2&#x27;</span>], <span class="built_in">format</span>=<span class="string">&#x27;json&#x27;</span>))</span><br></pre></td></tr></table></figure>

<ul>
<li>es.cat.count，Count提供对整个群集或单个索引的文档计数的快速访问。</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(es.cat.count())  <span class="comment"># 集群内的文档总数</span></span><br><span class="line"><span class="built_in">print</span>(es.cat.count(index=<span class="string">&#x27;py3&#x27;</span>))  <span class="comment"># 指定索引文档总数</span></span><br><span class="line"><span class="built_in">print</span>(es.cat.count(index=[<span class="string">&#x27;py3&#x27;</span>, <span class="string">&#x27;py2&#x27;</span>], <span class="built_in">format</span>=<span class="string">&#x27;json&#x27;</span>))  <span class="comment"># 返回两个索引文档和</span></span><br></pre></td></tr></table></figure>

<ul>
<li>es.cat.fielddata，基于每个节点显示有关当前加载的fielddata的信息。有些数据为了查询效率，会放在内存中，fielddata用来控制哪些数据应该被放在内存中，而这个<code>es.cat.fielddata</code>则查询现在哪些数据在内存中，数据大小等信息。</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(es.cat.fielddata())</span><br><span class="line"><span class="built_in">print</span>(es.cat.fielddata(<span class="built_in">format</span>=<span class="string">&#x27;json&#x27;</span>, <span class="built_in">bytes</span>=<span class="string">&#x27;b&#x27;</span>))</span><br></pre></td></tr></table></figure>

<p><code>bytes</code>显示字节值的单位，有效选项为：<code>&#39;b&#39;，&#39;k&#39;，&#39;kb&#39;，&#39;m&#39;，&#39;mb&#39;，&#39;g&#39;，&#39;gb&#39;，&#39;t&#39;，&#39;tb&#39; ，&#39;p&#39;，&#39;pb&#39;</code><br><code>format</code>Accept标头的简短版本，例如json，yaml</p>
<ul>
<li>es.cat.health，从集群中<code>health</code>里面过滤出简洁的集群健康信息。</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(es.cat.health())</span><br><span class="line"><span class="built_in">print</span>(es.cat.health(<span class="built_in">format</span>=<span class="string">&#x27;json&#x27;</span>))</span><br></pre></td></tr></table></figure>

<ul>
<li>es.cat.help，返回<code>es.cat</code>的帮助信息。</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(es.cat.<span class="built_in">help</span>())</span><br></pre></td></tr></table></figure>

<ul>
<li>es.cat.indices，返回索引的信息；也可以使用此命令进行查询集群中有多少索引。</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(es.cat.indices())</span><br><span class="line"><span class="built_in">print</span>(es.cat.indices(index=<span class="string">&#x27;py3&#x27;</span>))</span><br><span class="line"><span class="built_in">print</span>(es.cat.indices(index=<span class="string">&#x27;py3&#x27;</span>, <span class="built_in">format</span>=<span class="string">&#x27;json&#x27;</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(es.cat.indices(<span class="built_in">format</span>=<span class="string">&#x27;json&#x27;</span>)))  <span class="comment"># 查询集群中有多少索引</span></span><br></pre></td></tr></table></figure>

<ul>
<li>es.cat.master，返回集群中主节点的IP，绑定IP和节点名称。</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(es.cat.master())</span><br><span class="line"><span class="built_in">print</span>(es.cat.master(<span class="built_in">format</span>=<span class="string">&#x27;json&#x27;</span>))</span><br></pre></td></tr></table></figure>

<ul>
<li>es.cat.nodeattrs，返回节点的自定义属性。</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(es.cat.nodeattrs())</span><br><span class="line"><span class="built_in">print</span>(es.cat.nodeattrs(<span class="built_in">format</span>=<span class="string">&#x27;json&#x27;</span>))</span><br></pre></td></tr></table></figure>

<ul>
<li>es.cat.nodes，返回节点的拓扑，这些信息在查看整个集群时通常很有用，特别是大型集群。我有多少符合条件的节点？</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(es.cat.nodes())</span><br><span class="line"><span class="built_in">print</span>(es.cat.nodes(<span class="built_in">format</span>=<span class="string">&#x27;json&#x27;</span>))</span><br></pre></td></tr></table></figure>

<ul>
<li>es.cat.plugins，返回节点的插件信息。</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(es.cat.plugins())</span><br><span class="line"><span class="built_in">print</span>(es.cat.plugins(<span class="built_in">format</span>=<span class="string">&#x27;json&#x27;</span>))</span><br></pre></td></tr></table></figure>

<ul>
<li>es.cat.segments，返回每个索引的Lucene有关的信息。</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(es.cat.segments())</span><br><span class="line"><span class="built_in">print</span>(es.cat.segments(index=<span class="string">&#x27;py3&#x27;</span>))</span><br><span class="line"><span class="built_in">print</span>(es.cat.segments(index=<span class="string">&#x27;py3&#x27;</span>, <span class="built_in">format</span>=<span class="string">&#x27;json&#x27;</span>))</span><br></pre></td></tr></table></figure>

<ul>
<li>es.cat.shards，返回哪个节点包含哪些分片的信息。</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(es.cat.shards())</span><br><span class="line"><span class="built_in">print</span>(es.cat.shards(index=<span class="string">&#x27;py3&#x27;</span>))</span><br><span class="line"><span class="built_in">print</span>(es.cat.shards(index=<span class="string">&#x27;py3&#x27;</span>, <span class="built_in">format</span>=<span class="string">&#x27;json&#x27;</span>))</span><br></pre></td></tr></table></figure>

<ul>
<li>es.cat.thread_pool，获取有关线程池的信息。</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(es.cat.thread_pool())</span><br></pre></td></tr></table></figure>



<h3 id="Snapshot（快照相关）"><a href="#Snapshot（快照相关）" class="headerlink" title="Snapshot（快照相关）"></a>Snapshot（快照相关）</h3><ul>
<li>es.snapshot.create，在存储库中创建快照。<ul>
<li><code>repository</code> 存储库名称。</li>
<li><code>snapshot</code>快照名称。</li>
<li><code>body</code>快照定义。</li>
</ul>
</li>
<li>es.snapshot.delete，从存储库中删除快照。</li>
<li>es.snapshot.create_repository。注册共享文件系统存储库。</li>
<li>es.snapshot.delete_repository，删除共享文件系统存储库。</li>
<li>es.snapshot.get，检索有关快照的信息。</li>
<li>es.snapshot.get_repository，返回有关已注册存储库的信息。</li>
<li>es.snapshot.restore，恢复快照。</li>
<li>es.snapshot.status，返回有关所有当前运行快照的信息。通过指定存储库名称，可以将结果限制为特定存储库。</li>
<li>es.snapshot.verify_repository，返回成功验证存储库的节点列表，如果验证过程失败，则返回错误消息。</li>
</ul>
<h3 id="Task（任务相关）"><a href="#Task（任务相关）" class="headerlink" title="Task（任务相关）"></a>Task（任务相关）</h3><ul>
<li>es.tasks.get，检索特定任务的信息。</li>
<li>es.tasks.cancel，取消任务。</li>
<li>es.tasks.list，任务列表。</li>
</ul>
<h2 id="建议器简介"><a href="#建议器简介" class="headerlink" title="建议器简介"></a><a target="_blank" rel="noopener" href="https://www.cnblogs.com/Neeo/articles/10694922.html">建议器简介</a></h2><p>在elasticsearch中，建议功能通过使用建议器基于提供的文本建议类似的词</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">POST twitter/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot; : &#123;</span><br><span class="line">    &quot;match&quot;: &#123;</span><br><span class="line">      &quot;message&quot;: &quot;tring out Elasticsearch&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;suggest&quot; : &#123; &lt;!-- 定义建议查询 --&gt;</span><br><span class="line">    &quot;my-suggestion&quot; : &#123; &lt;!-- 一个建议查询名 --&gt;</span><br><span class="line">      &quot;text&quot; : &quot;tring out Elasticsearch&quot;, &lt;!-- 查询文本 --&gt;</span><br><span class="line">      &quot;term&quot; : &#123; &lt;!-- 使用词项建议器 --&gt;</span><br><span class="line">        &quot;field&quot; : &quot;message&quot; &lt;!-- 指定在哪个字段上获取建议词 --&gt;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="简单示例"><a href="#简单示例" class="headerlink" title="简单示例"></a>简单示例</h3><p>在查询文本中，我错把<code>Lucene</code>写成了<code>Lucen</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"> PUT ssss/doc/1</span><br><span class="line">&#123;</span><br><span class="line">  &quot;title&quot;: &quot;Lucene is cool&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">PUT ssss/doc/2</span><br><span class="line">&#123;</span><br><span class="line">  &quot;title&quot;:&quot;Elasticsearch builds on top of lucene&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">GET ssss/doc/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;suggest&quot;: &#123;</span><br><span class="line">    &quot;my_suggeter&quot;: &#123;</span><br><span class="line">      &quot;text&quot;: &quot;Lucen&quot;,</span><br><span class="line">      &quot;term&quot;: &#123;</span><br><span class="line">        &quot;field&quot;: &quot;title&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;took&quot; : 43,</span><br><span class="line">  &quot;timed_out&quot; : false,</span><br><span class="line">  &quot;_shards&quot; : &#123;</span><br><span class="line">    &quot;total&quot; : 1,</span><br><span class="line">    &quot;successful&quot; : 1,</span><br><span class="line">    &quot;skipped&quot; : 0,</span><br><span class="line">    &quot;failed&quot; : 0</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;hits&quot; : &#123;</span><br><span class="line">    &quot;total&quot; : &#123;</span><br><span class="line">      &quot;value&quot; : 0,</span><br><span class="line">      &quot;relation&quot; : &quot;eq&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;max_score&quot; : null,</span><br><span class="line">    &quot;hits&quot; : [ ]</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;suggest&quot; : &#123;</span><br><span class="line">    &quot;my_suggeter&quot; : [</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;text&quot; : &quot;lucen&quot;,</span><br><span class="line">        &quot;offset&quot; : 0,</span><br><span class="line">        &quot;length&quot; : 5,</span><br><span class="line">        &quot;options&quot; : [</span><br><span class="line">          &#123;</span><br><span class="line">            &quot;text&quot; : &quot;lucene&quot;,</span><br><span class="line">            &quot;score&quot; : 0.8,</span><br><span class="line">            &quot;freq&quot; : 2</span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>正如结果所示。对于输入的每个词条的建议结果，es都会放在<code>options</code>中，如果没有建议结果，<code>options</code>将会为空。</p>
<h3 id="多组建议器"><a href="#多组建议器" class="headerlink" title="多组建议器"></a>多组建议器</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">GET s1/doc/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;suggest&quot;: &#123;</span><br><span class="line">    &quot;my_sugget1&quot;: &#123;</span><br><span class="line">      &quot;text&quot;: &quot;Elasticsear&quot;,</span><br><span class="line">      &quot;term&quot;: &#123;</span><br><span class="line">        &quot;field&quot;: &quot;title&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;my_suggest2&quot;: &#123;</span><br><span class="line">      &quot;text&quot;: &quot;lucen&quot;,</span><br><span class="line">      &quot;term&quot;: &#123;</span><br><span class="line">        &quot;field&quot;: &quot;title&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在多个建议器中，如果输入的<code>text</code>字段值一致，可以单独写出来，以适用于<code>my_suggest1</code>和<code>my_suggest2</code>两个建议器：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">GET s1/doc/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;suggest&quot;: &#123;</span><br><span class="line">    &quot;text&quot;: &quot;Elasticsear lucen&quot;,</span><br><span class="line">    &quot;my_sugget1&quot;: &#123;</span><br><span class="line">      &quot;term&quot;: &#123;</span><br><span class="line">        &quot;field&quot;: &quot;title&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;my_suggest2&quot;: &#123;</span><br><span class="line">      &quot;term&quot;: &#123;</span><br><span class="line">        &quot;field&quot;: &quot;title&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="正常查询和建议联用"><a href="#正常查询和建议联用" class="headerlink" title="正常查询和建议联用"></a>正常查询和建议联用</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"> PUT s1</span><br><span class="line">&#123;</span><br><span class="line">  &quot;mappings&quot;: &#123;</span><br><span class="line">    &quot;doc&quot;: &#123;</span><br><span class="line">      &quot;properties&quot;: &#123;</span><br><span class="line">        &quot;title&quot;: &#123;</span><br><span class="line">          &quot;type&quot;: &quot;text&quot;,</span><br><span class="line">          &quot;analyzer&quot;: &quot;standard&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">PUT s1/doc/1</span><br><span class="line">&#123;</span><br><span class="line">  &quot;title&quot;: &quot;Lucene is cool&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">PUT s1/doc/2</span><br><span class="line">&#123;</span><br><span class="line">  &quot;title&quot;:&quot;Elasticsearch builds on top of lucene&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">GET s1/doc/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match&quot;: &#123;</span><br><span class="line">      &quot;title&quot;: &quot;Lucene&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;suggest&quot;: &#123;</span><br><span class="line">    &quot;my_suggest&quot;: &#123;</span><br><span class="line">      &quot;text&quot;: &quot;Elasticsear lucen&quot;,</span><br><span class="line">      &quot;term&quot;: &#123;</span><br><span class="line">        &quot;field&quot;: &quot;title&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><code>suggest</code>，每个建议器都有自己名称<code>my-suggestion</code>，es根据<code>text</code>字段返回建议结果。建议类型是<code>term</code>。从<code>field</code>字段生成建议。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;took&quot;</span> : <span class="number">3</span>,</span><br><span class="line">  <span class="attr">&quot;timed_out&quot;</span> : <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">&quot;_shards&quot;</span> : &#123;</span><br><span class="line">    <span class="attr">&quot;total&quot;</span> : <span class="number">5</span>,</span><br><span class="line">    <span class="attr">&quot;successful&quot;</span> : <span class="number">5</span>,</span><br><span class="line">    <span class="attr">&quot;skipped&quot;</span> : <span class="number">0</span>,</span><br><span class="line">    <span class="attr">&quot;failed&quot;</span> : <span class="number">0</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;hits&quot;</span> : &#123;</span><br><span class="line">    <span class="attr">&quot;total&quot;</span> : <span class="number">2</span>,</span><br><span class="line">    <span class="attr">&quot;max_score&quot;</span> : <span class="number">0.2876821</span>,</span><br><span class="line">    <span class="attr">&quot;hits&quot;</span> : [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">&quot;_index&quot;</span> : <span class="string">&quot;s1&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;_type&quot;</span> : <span class="string">&quot;doc&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;_id&quot;</span> : <span class="string">&quot;2&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;_score&quot;</span> : <span class="number">0.2876821</span>,</span><br><span class="line">        <span class="attr">&quot;_source&quot;</span> : &#123;</span><br><span class="line">          <span class="attr">&quot;title&quot;</span> : <span class="string">&quot;Elasticsearch builds on top of lucene&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">&quot;_index&quot;</span> : <span class="string">&quot;s1&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;_type&quot;</span> : <span class="string">&quot;doc&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;_id&quot;</span> : <span class="string">&quot;1&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;_score&quot;</span> : <span class="number">0.2876821</span>,</span><br><span class="line">        <span class="attr">&quot;_source&quot;</span> : &#123;</span><br><span class="line">          <span class="attr">&quot;title&quot;</span> : <span class="string">&quot;Lucene is cool&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;suggest&quot;</span> : &#123;</span><br><span class="line">    <span class="attr">&quot;my_suggest&quot;</span> : [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">&quot;text&quot;</span> : <span class="string">&quot;elasticsear&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;offset&quot;</span> : <span class="number">0</span>,</span><br><span class="line">        <span class="attr">&quot;length&quot;</span> : <span class="number">11</span>,</span><br><span class="line">        <span class="attr">&quot;options&quot;</span> : [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">&quot;text&quot;</span> : <span class="string">&quot;elasticsearch&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;score&quot;</span> : <span class="number">0.8181818</span>,</span><br><span class="line">            <span class="attr">&quot;freq&quot;</span> : <span class="number">1</span></span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">&quot;text&quot;</span> : <span class="string">&quot;lucen&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;offset&quot;</span> : <span class="number">12</span>,</span><br><span class="line">        <span class="attr">&quot;length&quot;</span> : <span class="number">5</span>,</span><br><span class="line">        <span class="attr">&quot;options&quot;</span> : [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">&quot;text&quot;</span> : <span class="string">&quot;lucene&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;score&quot;</span> : <span class="number">0.8</span>,</span><br><span class="line">            <span class="attr">&quot;freq&quot;</span> : <span class="number">2</span></span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="四种建议器"><a href="#四种建议器" class="headerlink" title="四种建议器"></a>四种建议器</h3><ul>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/Neeo/articles/10694969.html">词条建议器（term suggester）</a>：对于给定文本的每个词条，该键议器从索引中抽取要建议的关键词，这对于短字段（如分类标签）很有效。</li>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/Neeo/articles/10694996.html">词组建议器（phrase suggester）</a>：我们可以认为它是词条建议器的扩展，为整个文本（而不是单个词条）提供了替代方案，它考虑了各词条彼此临近出现的频率，使得该建议器更适合较长的字段，比如商品的描述。</li>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/Neeo/articles/10695019.html">完成建议器（completion suggester）</a>：该建议器根据词条的前缀，提供自动完成的功能（智能提示，有点最左前缀查询的意思），为了实现这种实时的建议功能，它得到了优化，工作在内存中。所以，速度要比之前说的<code>match_phrase_prefix</code>快的多！</li>
<li><a target="_blank" rel="noopener" href="https://www.cnblogs.com/Neeo/articles/10695031.html">上下文建议器（context suggester）</a>：它是完成建议器的扩展，允许我们根据词条或分类亦或是地理位置对结果进行过滤。</li>
</ul>
<h4 id="term-suggester"><a href="#term-suggester" class="headerlink" title="term suggester"></a><a target="_blank" rel="noopener" href="https://www.cnblogs.com/Neeo/articles/10694969.html">term suggester</a></h4><p>词条建议器接收输入的文本，对其进行分析并且分为词条，然后为每个词条提供一系列的建议。</p>
<p>在建议器中，都有哪些字段。</p>
<ul>
<li>text：建议文本，建议文本是必需的选项，可以通过全局（多个建议器中查询相同的内容）或者按照单个建议器的格式来。</li>
<li>field：从field字段中获取候选建议的字段。这是一个必需的选项，需要全局设置或根据建议设置。</li>
<li>analyzer：用于分析建议文本的分析器。默认为建议字段的搜索分析器。</li>
<li>size：个建议文本标记返回的最大条目。</li>
<li>sort：定义如何根据建议文本术语对建议进行排序。它有两个可能的值。<ul>
<li>score，先按分数排序，然后按文档频率排序，再按术语本身排序。</li>
<li>frequency，首先按文档频率排序，然后按相似性分数排序，然后按术语本身排序。也可以理解为按照流行度排序。</li>
</ul>
</li>
<li>suggest_mode：控制建议的模式，有3个模式可选择。<ul>
<li>missing，仅为不在索引中的建议文本术语提供建议。这是默认值。</li>
<li>popular，仅建议在比原始建议文本术语更多的文档中出现的建议。也就是说提供比原有输入词频更高的词条</li>
<li>always，根据建议文本中的条款建议任何匹配的建议。说白了就是无论如何都会提供建议。</li>
</ul>
</li>
<li>lowercase_terms：在文本分析之后降低建议文本术语的大小写。</li>
<li>min_word_length：建议文本术语必须具有的最小长度才能包含在内。默认为4.（旧名称<code>min_word_len</code>已弃用）。</li>
<li>shard_size：设置从每个单独分片中检索的最大建议数。在减少阶段，仅根据size选项返回前N个建议。默认为该 size选项。将此值设置为高于该值的值size可能非常有用，以便以性能为代价获得更准确的拼写更正文档频率。由于术语在分片之间被划分，因此拼写校正频率的分片级文档可能不准确。增加这些将使这些文档频率更精确。</li>
<li>max_inspections：用于乘以的因子， shards_size以便在碎片级别上检查更多候选拼写更正。可以以性能为代价提高准确性。默认为5。</li>
<li>string_distance：用于比较类似建议术语的字符串距离实现。<ul>
<li>internal，默认值基于damerau_levenshtein，但高度优化用于比较索引中术语的字符串距离。</li>
<li>damerau_levenshtein，基于Damerau-Levenshtein算法的字符串距离算法。</li>
<li>levenshtein，基于Levenshtein编辑距离算法的字符串距离算法。</li>
<li>jaro_winkler，基于Jaro-Winkler算法的字符串距离算法。</li>
<li>ngram，基于字符n-gram的字符串距离算法。</li>
</ul>
</li>
</ul>
<h6 id="词条建议器是如何运作"><a href="#词条建议器是如何运作" class="headerlink" title="词条建议器是如何运作"></a>词条建议器是如何运作</h6><ol>
<li><code>term suggester</code>首先将输入文本经过分析器（所以，分析结果由于采用的分析器不同而有所不同）分析，处理为单个词条，</li>
<li>然后根据单个词条去提供建议，并不会考虑多个词条之间的关系。</li>
<li>然后将每个词条的建议结果（有或没有）封装到<code>options</code>列表中。最后由建议器统一返回。</li>
</ol>
<p>词条建议器使用了Lucene的错拼检查器模块，该模块会根据给定词条的<strong>编辑距离</strong>（es使用了叫做Levenstein edit distance的算法，其核心思想就是一个词改动多少字符就可以和另外一个词一致），从索引中返回最大编辑距离不超过某个值的那些词条。</p>
<p>比如说为了从<code>mik</code>得到<code>mick</code>，需要加入一个字母（也就是说需要至少要改动一次），所以这两个词的编辑距离就是1。我们可以通过配置一系列的选项，来均衡灵活和性能：</p>
<ul>
<li>max_edits：最大编辑距离候选建议可以具有以便被视为建议。只能是介于1和2之间的值。任何其他值都会导致抛出错误的请求错误。默认为2。</li>
<li>prefix_length：必须匹配的最小前缀字符的数量才是候选建议。默认为1.增加此数字可提高拼写检查性能。通常拼写错误不会出现在术语的开头。（旧名<code>prefix_len</code>已弃用）。</li>
<li>min_doc_freq：建议应出现的文档数量的最小阈值。可以指定为绝对数字或文档数量的相对百分比。这可以仅通过建议高频项来提高质量。默认为0f且未启用。如果指定的值大于1，则该数字不能是小数。分片级文档频率用于此选项。</li>
<li>max_term_freq：建议文本令牌可以存在的文档数量的最大阈值，以便包括在内。可以是表示文档频率的相对百分比数（例如0.4）或绝对数。如果指定的值大于1，则不能指定小数。默认为0.01f。这可用于排除高频术语的拼写检查。高频术语通常拼写正确，这也提高了拼写检查的性能。分片级文档频率用于此选项。</li>
</ul>
<h4 id="phrase-suggester"><a href="#phrase-suggester" class="headerlink" title="phrase suggester"></a><a target="_blank" rel="noopener" href="https://www.cnblogs.com/Neeo/articles/10694996.html">phrase suggester</a></h4><p>词组建议器和词条建议器一样，不过它不再为单个词条提供建议，而是为整个文本提供建议。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">GET s4/doc/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;suggest&quot;: &#123;</span><br><span class="line">    &quot;my_s4&quot;: &#123;</span><br><span class="line">      &quot;text&quot;: &quot;lucne and elasticsear rock&quot;,</span><br><span class="line">      &quot;phrase&quot;: &#123;</span><br><span class="line">        &quot;field&quot;: &quot;title&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>phrase suggester</code>在<code>term suggester</code>的基础上，会考虑多个<code>term</code>之间的关系，比如是否同时出现索引的原文中，临近程度，词频等。</p>
<h4 id="completion-suggester"><a href="#completion-suggester" class="headerlink" title="completion suggester"></a><a target="_blank" rel="noopener" href="https://www.cnblogs.com/Neeo/articles/10695019.html">completion suggester</a></h4><p>是一个导航功能，提供自动完成、搜索功能，可以在用户输入时引导用户查看相关结果，从而提高搜索精度。但并不适用于拼接检查或者像<code>term</code>和<code>phrase</code>建议那样的功能。比如输入<code>e</code>，搜索引擎就应该知道用户想要查找的是<code>elasticsearch</code>）搜索。</p>
<p>为了告诉elasticsearch我们准备将建议存储在自动完成的FST中，需要在映射中定义一个字段并将其<code>type</code>类型设置为<code>completion</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">PUT s5</span><br><span class="line">&#123;</span><br><span class="line">  &quot;mappings&quot;:&#123;</span><br><span class="line">    &quot;doc&quot;:&#123;</span><br><span class="line">      &quot;properties&quot;: &#123;</span><br><span class="line">        &quot;title&quot;: &#123;</span><br><span class="line">          &quot;type&quot;: &quot;completion&quot;,</span><br><span class="line">          &quot;analyzer&quot;: &quot;standard&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">PUT s5/doc/1</span><br><span class="line">&#123;</span><br><span class="line">  &quot;title&quot;:&quot;Lucene is cool&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">PUT s5/doc/2</span><br><span class="line">&#123;</span><br><span class="line">  &quot;title&quot;:&quot;Elasticsearch builds on top of lucene&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">PUT s5/doc/3</span><br><span class="line">&#123;</span><br><span class="line">  &quot;title&quot;:&quot;Elasticsearch rocks&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">PUT s5/doc/4</span><br><span class="line">&#123;</span><br><span class="line">  &quot;title&quot;:&quot;Elastic is the company behind ELK stack&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">PUT s5/doc/5</span><br><span class="line">&#123;</span><br><span class="line">  &quot;title&quot;:&quot;the elk stack rocks&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">PUT s5/doc/6</span><br><span class="line">&#123;</span><br><span class="line">  &quot;title&quot;:&quot;elasticsearch is rock solid&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">GET s5/doc/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;suggest&quot;: &#123;</span><br><span class="line">    &quot;my_s5&quot;: &#123;</span><br><span class="line">      &quot;text&quot;: &quot;elas&quot;,</span><br><span class="line">      &quot;completion&quot;: &#123;</span><br><span class="line">        &quot;field&quot;: &quot;title&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="context-suggester"><a href="#context-suggester" class="headerlink" title="context suggester"></a><a target="_blank" rel="noopener" href="https://www.cnblogs.com/Neeo/articles/10695031.html">context suggester</a></h4><ul>
<li>完成建议器考虑索引中的所有文档，但通常我们希望提供某些标准过滤或者提升的建议。例如，我们想要推荐某些歌手过滤的歌曲标题，或者我们希望根据其类型推广歌曲标题。</li>
<li>上下文过滤器，它在完成建议器的基础上加入了过滤功能。</li>
<li>上下文建议器允许用户使用context上下文来进行过滤，上下文可以是分类（词条）或者地理位置，为了开启上下文，同样在映射中指定，然后在文档和建议中提供上下文。</li>
</ul>
<p>要实现建议过滤或者提升，我们可以在配置完成字段时添加上下文映射，我们也可以为完成字段定义多个上下文映射，每个上下文映射都有唯一的名称和类型，有两种类型<code>category</code>和<code>geo</code>。上下文映射<code>contexts</code>在字段映射中的参数下配置。<br>注意：在索引查询启用上下文的完成字段时，必须提供上下文。<br>如下示例定义了类型，每个类型都有一个完成字段的两个上下文映射：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">PUT place</span><br><span class="line">&#123;</span><br><span class="line">  &quot;mappings&quot;: &#123;</span><br><span class="line">    &quot;doc&quot;:&#123;</span><br><span class="line">      &quot;properties&quot;:&#123;</span><br><span class="line">        &quot;title&quot;:&#123;</span><br><span class="line">          &quot;type&quot;:&quot;completion&quot;,</span><br><span class="line">          &quot;contexts&quot;:[</span><br><span class="line">            &#123;①</span><br><span class="line">              &quot;name&quot;:&quot;place_type&quot;,</span><br><span class="line">              &quot;type&quot;: &quot;category&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;②</span><br><span class="line">              &quot;name&quot;:&quot;location&quot;,</span><br><span class="line">              &quot;type&quot;:&quot;geo&quot;,</span><br><span class="line">              &quot;precision&quot;: 4</span><br><span class="line">            &#125;</span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">PUT place_path_category</span><br><span class="line">&#123;</span><br><span class="line">  &quot;mappings&quot;: &#123;</span><br><span class="line">    &quot;doc&quot;:&#123;</span><br><span class="line">      &quot;properties&quot;:&#123;</span><br><span class="line">        &quot;title&quot;:&#123;</span><br><span class="line">          &quot;type&quot;:&quot;completion&quot;,</span><br><span class="line">          &quot;contexts&quot;:[</span><br><span class="line">            &#123;③</span><br><span class="line">              &quot;name&quot;:&quot;place_type&quot;,</span><br><span class="line">              &quot;type&quot;:&quot;category&quot;,</span><br><span class="line">              &quot;path&quot;:&quot;cat&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;④</span><br><span class="line">              &quot;name&quot;:&quot;location&quot;,</span><br><span class="line">              &quot;type&quot;:&quot;geo&quot;,</span><br><span class="line">              &quot;precision&quot;: 4,</span><br><span class="line">              &quot;path&quot;:&quot;loc&quot;</span><br><span class="line">            &#125;</span><br><span class="line">          ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;loc&quot;:&#123;</span><br><span class="line">          &quot;type&quot;:&quot;geo_point&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>①，定义category名为place_type的上下文，其中必须与建议一起发送类别。</li>
<li>②，定义一个geo名为location的上下文，其中必须使用建议发送类别。</li>
<li>③，定义category名为place_type的上下文，其中必须从cat字段字段中读取类别。</li>
<li>④，定义geo名为location的上下文，其中从loc字段中读取类别。</li>
</ul>
<h2 id="Index-Templates"><a href="#Index-Templates" class="headerlink" title="Index Templates"></a><a target="_blank" rel="noopener" href="https://www.cnblogs.com/Neeo/articles/10869231.html">Index Templates</a></h2><ul>
<li>索引模板允许我们定义在创建新索引时自动应用的模板。</li>
<li>模板包括设置和映射，以及一个简单的模式模板，该模板控制是否应该将模板应用于新索引。</li>
</ul>
<h3 id="为什么需要索引模板？"><a href="#为什么需要索引模板？" class="headerlink" title="为什么需要索引模板？"></a>为什么需要索引模板？</h3><p>在开发中，<code>elasticsearch</code>很大一部分工作是用来处理日志信息的，比如某公司对于日志处理策略是以日期为名创建每天的日志索引。并且每天的索引映射类型和配置信息都是一样的，只是索引名称改变了。如果手动的创建每天的索引，将会是一件很麻烦的事情。为了解决类似问题，<code>elasticsearch</code>提供了预先定义的模板进行索引创建，这个模板称作为<code>Index Templates</code>。通过索引模板可以让类似的索引重用同一个模板。</p>
<p><strong>模板只在创建索引时应用</strong>。更改模板不会对现有索引产生影响。</p>
<p>当使用<code>create index API</code>时，作为<code>create index</code>调用的一部分定义的设置/映射将优先于模板中定义的任何匹配设置/映射。</p>
<h3 id="创建索引模板"><a href="#创建索引模板" class="headerlink" title="创建索引模板"></a>创建索引模板</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">PUT _template/2019</span><br><span class="line">&#123;</span><br><span class="line">  &quot;index_patterns&quot;: [&quot;20*&quot;, &quot;product1*&quot;],   ①</span><br><span class="line">  &quot;settings&quot;:&#123;   ②</span><br><span class="line">    &quot;number_of_shards&quot;: 2,</span><br><span class="line">    &quot;number_of_replicas&quot;: 1</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;mappings&quot;:&#123;  ③</span><br><span class="line">    &quot;doc&quot;:&#123;</span><br><span class="line">      &quot;properties&quot;:&#123;</span><br><span class="line">        &quot;ip&quot;:&#123;</span><br><span class="line">          &quot;type&quot;:&quot;keyword&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;method&quot;:&#123;</span><br><span class="line">          &quot;type&quot;: &quot;keyword&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>①，<code>index_patterns</code>是索引模式，指当创建以<code>20</code>和<code>product1</code>开头的索引时，使用该索引模板。<br>②，在<code>settings</code>设置中，我们自定义为该索引分配3个主分片。复制分片不变。<br>③，<code>mappings</code>中指定映射关系。</p>
<h3 id="查看索引模板"><a href="#查看索引模板" class="headerlink" title="查看索引模板"></a>查看索引模板</h3><p>我们来查看一下刚才创建的索引模板。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET _template/2019</span><br></pre></td></tr></table></figure>

<p>我们还可以通过使用通配符来查询多个模板。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GET /_template/temp*</span><br><span class="line">GET /_template/template_1,template_2</span><br></pre></td></tr></table></figure>

<p>除此之外，我们可以查看所有可用的模板列表：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /_template</span><br></pre></td></tr></table></figure>

<p>也可以查询某个模板是否存在：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HEAD _template/2019</span><br></pre></td></tr></table></figure>

<p>注意，返回是以HTTP的状态表示模板是否存在，<code>200</code>表示存在，<code>404</code>表示不存在。</p>
<h3 id="索引模板的使用"><a href="#索引模板的使用" class="headerlink" title="索引模板的使用"></a>索引模板的使用</h3><p>有了索引模板，我们就可以创建索引并且添加数据了。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">PUT 20190101/doc/1</span><br><span class="line">&#123;</span><br><span class="line">  &quot;ip&quot;: &quot;127.0.0.1&quot;,</span><br><span class="line">  &quot;method&quot;:&quot;GET&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">PUT 20190102/doc/2</span><br><span class="line">&#123;</span><br><span class="line">  &quot;ip&quot;:&quot;192.168.1.1&quot;,</span><br><span class="line">  &quot;method&quot;:&quot;POST&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">PUT product1_log/doc/1</span><br><span class="line">&#123;</span><br><span class="line">  &quot;ip&quot;:&quot;127.0.0.1&quot;,</span><br><span class="line">  &quot;method&quot;:&quot;GET&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上例会按照模板自动生成3个索引<code>20190101</code>、<code>20190102</code>和<code>product1_log</code>。<br>当然查询也是没有问题的：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">GET 2019*/doc/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match_all&quot;: &#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们可以通过查询索引的信息来看一下是否应用上了模板。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">GET 20190101</span><br><span class="line"># 结果如下</span><br><span class="line">&#123;</span><br><span class="line">  &quot;20190101&quot; : &#123;</span><br><span class="line">    &quot;aliases&quot; : &#123; &#125;,</span><br><span class="line">    &quot;mappings&quot; : &#123;</span><br><span class="line">      &quot;doc&quot; : &#123;</span><br><span class="line">        &quot;properties&quot; : &#123;</span><br><span class="line">          &quot;ip&quot; : &#123;</span><br><span class="line">            &quot;type&quot; : &quot;keyword&quot;</span><br><span class="line">          &#125;,</span><br><span class="line">          &quot;method&quot; : &#123;</span><br><span class="line">            &quot;type&quot; : &quot;keyword&quot;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;settings&quot; : &#123;</span><br><span class="line">      &quot;index&quot; : &#123;</span><br><span class="line">        &quot;creation_date&quot; : &quot;1557889480975&quot;,</span><br><span class="line">        &quot;number_of_shards&quot; : &quot;2&quot;,</span><br><span class="line">        &quot;number_of_replicas&quot; : &quot;1&quot;,</span><br><span class="line">        &quot;uuid&quot; : &quot;FEuyT5aoTnGP3k_7hCtQFA&quot;,</span><br><span class="line">        &quot;version&quot; : &#123;</span><br><span class="line">          &quot;created&quot; : &quot;6050499&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;provided_name&quot; : &quot;20190101&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>由上例可以看出，索引<code>20190101</code>已经成功应用上了我们之前创建的模板。</p>
<h3 id="多模板匹配"><a href="#多模板匹配" class="headerlink" title="多模板匹配"></a>多模板匹配</h3><p>多个索引模板可以应用于同一个索引，顺序由<code>order</code>参数的大小决定。比如现在有着一样的一个索引模板：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">PUT _template/2018_1</span><br><span class="line">&#123;</span><br><span class="line">  &quot;index_patterns&quot;: [&quot;2018*&quot;],</span><br><span class="line">  &quot;order&quot;:0,</span><br><span class="line">  &quot;settings&quot;:&#123;</span><br><span class="line">    &quot;number_of_shards&quot;: 2</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上述索引模板将应用于以<code>2018</code>开头的所有索引，设置索引的主分片数量为2，<code>order</code>参数为0。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">PUT 2018010101/doc/1</span><br><span class="line">&#123;</span><br><span class="line">  &quot;method&quot;:&quot;GET&quot;</span><br><span class="line">&#125;</span><br><span class="line">GET 2018010101/_settings</span><br><span class="line"># 结果如下</span><br><span class="line">&#123;</span><br><span class="line">  &quot;2018010101&quot; : &#123;</span><br><span class="line">    &quot;settings&quot; : &#123;</span><br><span class="line">      &quot;index&quot; : &#123;</span><br><span class="line">        &quot;creation_date&quot; : &quot;1557900456281&quot;,</span><br><span class="line">        &quot;number_of_shards&quot; : &quot;2&quot;,</span><br><span class="line">        &quot;number_of_replicas&quot; : &quot;1&quot;,</span><br><span class="line">        &quot;uuid&quot; : &quot;P53RDmT6RRCDY2DlHtpymg&quot;,</span><br><span class="line">        &quot;version&quot; : &#123;</span><br><span class="line">          &quot;created&quot; : &quot;6050499&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;provided_name&quot; : &quot;2018010101&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以看到<code>20180101</code>索引的主分片数量是2，已经成功应用了索引模板。<br>现在我们再来创建一个索引模板：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">PUT _template/2018_2</span><br><span class="line">&#123;</span><br><span class="line">  &quot;index_patterns&quot;: [&quot;201802*&quot;],</span><br><span class="line">  &quot;order&quot;:1,</span><br><span class="line">  &quot;settings&quot;:&#123;</span><br><span class="line">    &quot;number_of_shards&quot;: 3</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上述模板应用于以<code>201802</code>开头的索引，只是主分片的数量为3，<code>order</code>参数为1。<br>我们再来创建一个索引：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">PUT 2018010201/doc/1</span><br><span class="line">&#123;</span><br><span class="line">  &quot;method&quot;: &quot;POST&quot;</span><br><span class="line">&#125;</span><br><span class="line">GET 20180201/_settings</span><br><span class="line"># 结果如下</span><br><span class="line">&#123;</span><br><span class="line">  &quot;20180201&quot; : &#123;</span><br><span class="line">    &quot;settings&quot; : &#123;</span><br><span class="line">      &quot;index&quot; : &#123;</span><br><span class="line">        &quot;creation_date&quot; : &quot;1557901225020&quot;,</span><br><span class="line">        &quot;number_of_shards&quot; : &quot;3&quot;,</span><br><span class="line">        &quot;number_of_replicas&quot; : &quot;1&quot;,</span><br><span class="line">        &quot;uuid&quot; : &quot;-B8_ZiK7QgesmGSzD_8xlQ&quot;,</span><br><span class="line">        &quot;version&quot; : &#123;</span><br><span class="line">          &quot;created&quot; : &quot;6050499&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;provided_name&quot; : &quot;20180201&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以看到<code>20180201</code>索引应用了<code>order</code>参数为1的索引模板。这在某些情况下非常有效，比如我们预料到2018年2月份的日志将会暴增，而其他月份不变，所以我们通过上述创建多个模板来完成索引创建，2月份每天的索引的主分片都多一片，过了2月，恢复正常。</p>
<h3 id="删除索引模板"><a href="#删除索引模板" class="headerlink" title="删除索引模板"></a>删除索引模板</h3><p>删除索引模板使用<code>DELETE</code>命令删除即可：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DELETE _template/2019</span><br></pre></td></tr></table></figure>

<p>需要注意的是，删除索引模板并不会影响其通过该模板创建的索引。那么，如果想要删除相关的索引怎么办？比如我们删除以<code>2019</code>开头的索引该怎么办？</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DELETE 2019*</span><br></pre></td></tr></table></figure>

<p>可以使用通配符<code>*</code>来完成。</p>
<h2 id="Routing"><a href="#Routing" class="headerlink" title="Routing"></a><a target="_blank" rel="noopener" href="https://www.cnblogs.com/Neeo/articles/10869556.html">Routing</a></h2><p>es的路由指的是如何找到文档对应的分片中。</p>
<p>当索引一个文档的时候，文档会被存储到一个主分片中。那么，elasticsearch如何知道一个文档应该存放到哪个分片中呢？</p>
<p>首先这肯定不是随机的，否则在检索文档时就不知道该从哪去寻找它了。实际上这个过程是根据下面公式决定的：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shard = hash(routing) % number_of_primary_shards</span><br></pre></td></tr></table></figure>

<p><code>routing</code>是一个可变值，默认是文档的<code>_id</code>，也可以是自定义的值。hash函数将<code>routing</code>值哈希后生成一个数字，然后这个数字再除以<code>number_of_primary_shards</code>（主分片的数量）得到余数，这个分布在<code>0</code>到<code>number_of_primary_shards</code>减一（计数从0开始，比如5个主分片，那么范围就是0~4）之间的余数，就是文档存放的分片位置。</p>
<p>比如一篇文档的id为123，那么它就应该存在：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; hash(123) % 5</span><br><span class="line">3</span><br></pre></td></tr></table></figure>

<p>这篇文档就存在<code>P3</code>主分片上。</p>
<p>这也就解释了为什么在创建索引时，主分片的数量一经定义就不能改变，因为如果数量变化了，那么之前所有的路由（routing）值都会无效，文档就再也找不到了。</p>
<p>一般的，elasticsearch的默认路由算法都会根据文档的id值作为依据将其哈希到相应的主分片上，该算法基本上会将所有的文档平均分布在所有的主分片上，而不会产生某个分片数据过大而导致集群不平衡的情况。</p>
<p>那么我们在向一个有100个主分片的索引发送查询某篇文档的请求时，该请求发送到集群，集群干了什么呢？</p>
<ul>
<li>这个请求会被集群交给主节点。</li>
<li>主节点接收这个请求后，将这个查询请求广播到这个索引的每个分片上（包含主、复制分片）。</li>
<li>每个分片执行这个搜索请求，并将结果返回。</li>
<li>结果在主节点上合并、排序后返回给用户。</li>
</ul>
<p>这里面就有些问题了。因为在存储文档时，通过hash算法将文档平均分布在各分片上，这就导致了elasticsearch也不确定文档的位置，所以它必须将这个请求广播到所有的分片上去执行。</p>
<p>为了避免不必要的查询，我们使用自定义的路由模式，这样可以使我们的查询更具目的性。比如之前的查询是这样的：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">请求来了，你们（索引下的所有分片）都要检查一下自己是否有符合条件的文档</span><br></pre></td></tr></table></figure>

<p>当能自定义路由后的查询变成了：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">请求来了，分片3、5你俩把文档给我返回</span><br></pre></td></tr></table></figure>



<h3 id="自定义路由"><a href="#自定义路由" class="headerlink" title="自定义路由"></a>自定义路由</h3><p>所有的文档 API（ <code>get</code> 、 <code>index</code> 、 <code>delete</code> 、 <code>bulk</code> 、 <code>update</code> 以及 <code>mget</code> ）都接受一个叫做 <code>routing</code> 的路由参数 ，通过这个参数我们可以自定义文档到分片的映射。一个自定义的路由参数可以用来确保所有相关的文档——例如所有属于同一个用户的文档——都被存储到同一个分片中。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">PUT r1/doc/1?routing=user1</span><br><span class="line">&#123;</span><br><span class="line">  &quot;title&quot;:&quot;论母猪的产前保养&quot;</span><br><span class="line">&#125;</span><br><span class="line">PUT r1/doc/2?routing=user1</span><br><span class="line">&#123;</span><br><span class="line">  &quot;title&quot;:&quot;论母猪的产后护理&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上例中，该文档使用<code>user1</code>作为路由值而不是使用<code>_id</code>。这样，具有相同<code>user1</code>的文档将会被分配同一个分片上。</p>
<h3 id="通过路由查询文档"><a href="#通过路由查询文档" class="headerlink" title="通过路由查询文档"></a>通过路由查询文档</h3><p>自定义路由可以减少搜索，不需要将搜索请求分发到所有的分片，只需要将请求发送到匹配特定的路由值分片既可。</p>
<p>查询：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">GET r1/doc/1?routing=user1</span><br><span class="line"># 结果如下</span><br><span class="line">&#123;</span><br><span class="line">  &quot;_index&quot; : &quot;r1&quot;,</span><br><span class="line">  &quot;_type&quot; : &quot;doc&quot;,</span><br><span class="line">  &quot;_id&quot; : &quot;1&quot;,</span><br><span class="line">  &quot;_version&quot; : 3,</span><br><span class="line">  &quot;_routing&quot; : &quot;user1&quot;,</span><br><span class="line">  &quot;found&quot; : true,</span><br><span class="line">  &quot;_source&quot; : &#123;</span><br><span class="line">    &quot;title&quot; : &quot;论母猪的产前保养&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>也可通过这个路由值查询文档：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">GET r1/doc/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;terms&quot;: &#123;</span><br><span class="line">      &quot;_routing&quot;:[&quot;user1&quot;] </span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"># 结果如下</span><br><span class="line">&#123;</span><br><span class="line">  &quot;took&quot; : 0,</span><br><span class="line">  &quot;timed_out&quot; : false,</span><br><span class="line">  &quot;_shards&quot; : &#123;</span><br><span class="line">    &quot;total&quot; : 5,</span><br><span class="line">    &quot;successful&quot; : 5,</span><br><span class="line">    &quot;skipped&quot; : 0,</span><br><span class="line">    &quot;failed&quot; : 0</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;hits&quot; : &#123;</span><br><span class="line">    &quot;total&quot; : 2,</span><br><span class="line">    &quot;max_score&quot; : 1.0,</span><br><span class="line">    &quot;hits&quot; : [</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;_index&quot; : &quot;r1&quot;,</span><br><span class="line">        &quot;_type&quot; : &quot;doc&quot;,</span><br><span class="line">        &quot;_id&quot; : &quot;2&quot;,</span><br><span class="line">        &quot;_score&quot; : 1.0,</span><br><span class="line">        &quot;_routing&quot; : &quot;user1&quot;,</span><br><span class="line">        &quot;_source&quot; : &#123;</span><br><span class="line">          &quot;title&quot; : &quot;论母猪的产后护理&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;_index&quot; : &quot;r1&quot;,</span><br><span class="line">        &quot;_type&quot; : &quot;doc&quot;,</span><br><span class="line">        &quot;_id&quot; : &quot;1&quot;,</span><br><span class="line">        &quot;_score&quot; : 1.0,</span><br><span class="line">        &quot;_routing&quot; : &quot;user1&quot;,</span><br><span class="line">        &quot;_source&quot; : &#123;</span><br><span class="line">          &quot;title&quot; : &quot;论母猪的产前保养&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="删除文档"><a href="#删除文档" class="headerlink" title="删除文档"></a>删除文档</h3><p>我们来删除文档。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">DELETE r1/doc/1   </span><br><span class="line"># 结果如下</span><br><span class="line">&#123;</span><br><span class="line">  &quot;_index&quot; : &quot;r1&quot;,</span><br><span class="line">  &quot;_type&quot; : &quot;doc&quot;,</span><br><span class="line">  &quot;_id&quot; : &quot;1&quot;,</span><br><span class="line">  &quot;_version&quot; : 1,</span><br><span class="line">  &quot;result&quot; : &quot;not_found&quot;,</span><br><span class="line">  &quot;_shards&quot; : &#123;</span><br><span class="line">    &quot;total&quot; : 2,</span><br><span class="line">    &quot;successful&quot; : 1,</span><br><span class="line">    &quot;failed&quot; : 0</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;_seq_no&quot; : 2,</span><br><span class="line">  &quot;_primary_term&quot; : 1</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>由上例可见，不提供路由，无法删除文档。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">DELETE r1/doc/1?routing=user1</span><br><span class="line"># 结果如下</span><br><span class="line">&#123;</span><br><span class="line">  &quot;_index&quot; : &quot;r1&quot;,</span><br><span class="line">  &quot;_type&quot; : &quot;doc&quot;,</span><br><span class="line">  &quot;_id&quot; : &quot;1&quot;,</span><br><span class="line">  &quot;_version&quot; : 2,</span><br><span class="line">  &quot;result&quot; : &quot;deleted&quot;,</span><br><span class="line">  &quot;_shards&quot; : &#123;</span><br><span class="line">    &quot;total&quot; : 2,</span><br><span class="line">    &quot;successful&quot; : 1,</span><br><span class="line">    &quot;failed&quot; : 0</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;_seq_no&quot; : 4,</span><br><span class="line">  &quot;_primary_term&quot; : 1</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>给上路由就OK了。<br>由此可见，在查询、删除、更新文档时都要提供相同的路由值。</p>
<h3 id="查询多个路由"><a href="#查询多个路由" class="headerlink" title="查询多个路由"></a>查询多个路由</h3><p>除了指定查询单个路由值之外，还可以指定多个路由值查询：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">PUT r2/doc/1?routing=user1</span><br><span class="line">&#123;</span><br><span class="line">  &quot;title&quot;:&quot;母猪产前保养重点在多喂饲料，辅以人工按摩&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">PUT r2/doc/2?routing=user2</span><br><span class="line">&#123;</span><br><span class="line">  &quot;title&quot;:&quot;母猪产后护理重点在母子隔离喂养&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>此搜索请求将仅在与user1和user2路由值关联的分片上执行。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">GET r2/doc/_search?routing=user1,user2</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;match&quot;: &#123;</span><br><span class="line">      &quot;title&quot;: &quot;母猪&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"># 结果如下</span><br><span class="line">&#123;</span><br><span class="line">  &quot;took&quot; : 0,</span><br><span class="line">  &quot;timed_out&quot; : false,</span><br><span class="line">  &quot;_shards&quot; : &#123;</span><br><span class="line">    &quot;total&quot; : 2,</span><br><span class="line">    &quot;successful&quot; : 2,</span><br><span class="line">    &quot;skipped&quot; : 0,</span><br><span class="line">    &quot;failed&quot; : 0</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;hits&quot; : &#123;</span><br><span class="line">    &quot;total&quot; : 2,</span><br><span class="line">    &quot;max_score&quot; : 0.68324494,</span><br><span class="line">    &quot;hits&quot; : [</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;_index&quot; : &quot;r2&quot;,</span><br><span class="line">        &quot;_type&quot; : &quot;doc&quot;,</span><br><span class="line">        &quot;_id&quot; : &quot;2&quot;,</span><br><span class="line">        &quot;_score&quot; : 0.68324494,</span><br><span class="line">        &quot;_routing&quot; : &quot;user2&quot;,</span><br><span class="line">        &quot;_source&quot; : &#123;</span><br><span class="line">          &quot;title&quot; : &quot;母猪产后护理重点在母子隔离喂养&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;_index&quot; : &quot;r2&quot;,</span><br><span class="line">        &quot;_type&quot; : &quot;doc&quot;,</span><br><span class="line">        &quot;_id&quot; : &quot;1&quot;,</span><br><span class="line">        &quot;_score&quot; : 0.5753642,</span><br><span class="line">        &quot;_routing&quot; : &quot;user1&quot;,</span><br><span class="line">        &quot;_source&quot; : &#123;</span><br><span class="line">          &quot;title&quot; : &quot;母猪产前保养重点在多喂饲料，辅以人工按摩&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="忘了路由值怎么办？"><a href="#忘了路由值怎么办？" class="headerlink" title="忘了路由值怎么办？"></a>忘了路由值怎么办？</h3><p>由之前的示例可以看到，在自定义的路由中，索引、查询、删除、更新文档时，都要提供路由值。但是我们有可能会忘记路由值，导致文档在多个分片建立索引：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">PUT r3/doc/1?routing=u1</span><br><span class="line">&#123;</span><br><span class="line">  &quot;title&quot;:&quot;小猪仔真可爱&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">PUT r3/doc/2</span><br><span class="line">&#123;</span><br><span class="line">  &quot;title&quot;:&quot;可爱可爱一盘菜&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>正如上例所示，我们在创建文档2的时候，忘记路由了，导致这篇文档被默认分配到别的分片上了。那我们想通过<code>u1</code>路由查询就会发现：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">GET r3/doc/_search</span><br><span class="line">&#123;</span><br><span class="line">  &quot;query&quot;: &#123;</span><br><span class="line">    &quot;terms&quot;: &#123;</span><br><span class="line">      &quot;_routing&quot;:[&quot;u1&quot;]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"># 结果如下</span><br><span class="line">&#123;</span><br><span class="line">  &quot;took&quot; : 1,</span><br><span class="line">  &quot;timed_out&quot; : false,</span><br><span class="line">  &quot;_shards&quot; : &#123;</span><br><span class="line">    &quot;total&quot; : 5,</span><br><span class="line">    &quot;successful&quot; : 5,</span><br><span class="line">    &quot;skipped&quot; : 0,</span><br><span class="line">    &quot;failed&quot; : 0</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;hits&quot; : &#123;</span><br><span class="line">    &quot;total&quot; : 1,</span><br><span class="line">    &quot;max_score&quot; : 1.0,</span><br><span class="line">    &quot;hits&quot; : [</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;_index&quot; : &quot;r3&quot;,</span><br><span class="line">        &quot;_type&quot; : &quot;doc&quot;,</span><br><span class="line">        &quot;_id&quot; : &quot;1&quot;,</span><br><span class="line">        &quot;_score&quot; : 1.0,</span><br><span class="line">        &quot;_routing&quot; : &quot;u1&quot;,</span><br><span class="line">        &quot;_source&quot; : &#123;</span><br><span class="line">          &quot;title&quot; : &quot;小猪仔真可爱&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以发现，那个文档2通过这个路由值查询不到，但是可以通过普通的查询：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET r3/doc/_search</span><br></pre></td></tr></table></figure>

<p>这样，两篇文档都会有被返回。<br>为了避免类似上述的情况出现，我们必须采取安全措施，加个套！在自定义映射关系时，使用<code>_routing</code>参数生成那个<code>安全套</code>！</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"># 以下是6.5.4版本的写法</span><br><span class="line">PUT r4</span><br><span class="line">&#123;</span><br><span class="line">  &quot;mappings&quot;: &#123;</span><br><span class="line">    &quot;doc&quot;:&#123;</span><br><span class="line">      &quot;_routing&quot;:&#123;</span><br><span class="line">        &quot;required&quot;: true</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"># 以下是7.0官方文档的的写法</span><br><span class="line">PUT my_index2 </span><br><span class="line">&#123; </span><br><span class="line">  “mappings”：&#123; </span><br><span class="line">    “_ usting”：&#123; </span><br><span class="line">      “required”：true</span><br><span class="line">    &#125; </span><br><span class="line">  &#125; </span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p>在<code>_routing</code>参数内，将<code>required:true</code>就表明在对文档做CURD时需要指定路由。不然就会抛出一个<code>routing_missing_exception</code>错误。就像下面的示例一样。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">PUT r4/doc/1</span><br><span class="line">&#123;</span><br><span class="line">  &quot;title&quot;:&quot;母猪不怀孕怎么办？&quot;</span><br><span class="line">&#125;</span><br><span class="line"># 结果是报错</span><br><span class="line">&#123;</span><br><span class="line">  &quot;error&quot;: &#123;</span><br><span class="line">    &quot;root_cause&quot;: [</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;type&quot;: &quot;routing_missing_exception&quot;,</span><br><span class="line">        &quot;reason&quot;: &quot;routing is required for [r4]/[doc]/[1]&quot;,</span><br><span class="line">        &quot;index_uuid&quot;: &quot;_na_&quot;,</span><br><span class="line">        &quot;index&quot;: &quot;r4&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    &quot;type&quot;: &quot;routing_missing_exception&quot;,</span><br><span class="line">    &quot;reason&quot;: &quot;routing is required for [r4]/[doc]/[1]&quot;,</span><br><span class="line">    &quot;index_uuid&quot;: &quot;_na_&quot;,</span><br><span class="line">    &quot;index&quot;: &quot;r4&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;status&quot;: 400</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>有了这种规范，我们在自定义路由时，就可以避免一些不必要的情况发生了。</p>
<h3 id="自定义路由唯一ID"><a href="#自定义路由唯一ID" class="headerlink" title="自定义路由唯一ID"></a>自定义路由唯一ID</h3><p>索引指定自定义<code>_routing</code>的文档时，不能保证索引中所有分片的<code>_id</code>唯一性。</p>
<p>事实上，如果使用不同的<code>_routing</code>值索引，具有相同<code>_id</code>的文档可能最终会出现在不同的分片上。我们应确保ID在索引中是唯一的。</p>
<h3 id="路由到索引分区"><a href="#路由到索引分区" class="headerlink" title="路由到索引分区"></a>路由到索引分区</h3><p>问题来了，在实际开发中，可能由于业务场景问题碰到某个路由的文档量非常大，造成该分片非常大，而某些路由的文档却非常小，这就会造成数据偏移而导致集群不平衡。我们该如何办呢？</p>
<p>我们可以配置索引，使得<strong>自定义路由值将转到分片的子集而不是单个分片。</strong>这有助于降低上述问题导致集群不平衡的风险，同时仍然可以减少搜索的影响。</p>
<p>这是通过在索引创建时提供索引级别设置<code>index.routing_partition_size</code>来完成的。随着分区大小的增加，数据分布越均匀，代价是每个请求必须搜索更多分片。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">PUT r6</span><br><span class="line">&#123;</span><br><span class="line">  &quot;mappings&quot;: &#123;</span><br><span class="line">    &quot;doc&quot;:&#123;</span><br><span class="line">      &quot;_routing&quot;:&#123;</span><br><span class="line">        &quot;required&quot;: true</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;settings&quot;: &#123;</span><br><span class="line">    &quot;index.routing_partition_size&quot;: 3 </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>通俗的说，这是限制文档分布到指定个数分片上，而不是默认的所有分片上，既提高了请求效率，也减小单一分片数据量过大的问题。<br>当此设置存在时，计算分片的公式变为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shard_num = (hash(_routing) + hash(_id) % routing_partition_size) % num_primary_shards</span><br></pre></td></tr></table></figure>

<p>也就是说，<code>_routing</code>字段用于计算索引中的一组分片，然后<code>_id</code>用于选择该集合中的分片。</p>
<p>要启用此功能，<code>index.routing_partition_size</code>应具有大于1且小于<code>index.number_of_shards</code>的值。</p>
<p>启用后，分区索引将具有以下限制：</p>
<ul>
<li>无法在其中创建具有<a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/parent-join.html">join field</a>关系的映射。</li>
<li>索引中的所有映射都必须将_routing字段标记为必需。</li>
</ul>
<h2 id="Index-Aliases"><a href="#Index-Aliases" class="headerlink" title="Index Aliases"></a><a target="_blank" rel="noopener" href="https://www.cnblogs.com/Neeo/articles/10897280.html">Index Aliases</a></h2><h3 id="别名解决了哪些问题？"><a href="#别名解决了哪些问题？" class="headerlink" title="别名解决了哪些问题？"></a>别名解决了哪些问题？</h3><p>在开发中，随着业务需求的迭代，较老的业务逻辑就要面临更新甚至是重构，而对于es来说，为了适应新的业务逻辑，可能就要对原有的索引做一些修改，比如对某些字段做调整，甚至是重建索引。而做这些操作的时候，可能会对业务造成影响，甚至是停机调整等问题。由此，es提供了索引别名来解决这些问题。</p>
<p><strong>索引别名就像一个快捷方式或是软连接，可以指向一个或多个索引</strong>，也可以给任意一个需要索引名的API来使用。别名的应用为程序提供了极大地灵活性，别名允许我们做下面这些操作：</p>
<ul>
<li>在运行的集群中可以无缝的从一个索引切换到另一个索引。</li>
<li>可以给多个索引分组。</li>
<li>给索引的一个子集创建视图，没错我们可以简单将es中的索引理解为关系型数据库中的视图。</li>
<li>可以与路由搭配使用。</li>
</ul>
<p>当然，既然是别名，就不能与索引同名，并且别名仅支持查询（暂时可以这么说）操作。因为如果有多个索引指向同一个别名的话，es不知道你要对哪一个具体的索引做操作。</p>
<h3 id="别名的相关操作"><a href="#别名的相关操作" class="headerlink" title="别名的相关操作"></a>别名的相关操作</h3><h4 id="准备数据"><a href="#准备数据" class="headerlink" title="准备数据"></a>准备数据</h4><p>首先，先准备两个索引：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">PUT l1/doc/1</span><br><span class="line">&#123;</span><br><span class="line">  &quot;title&quot;:&quot;我想要睡你&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">PUT l2/doc/1</span><br><span class="line">&#123;</span><br><span class="line">  &quot;title&quot;:&quot;你却拿我当兄弟&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">PUT l3/doc/1</span><br><span class="line">&#123;</span><br><span class="line">  &quot;title&quot;:&quot;不过，我不介意&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="创建别名"><a href="#创建别名" class="headerlink" title="创建别名"></a>创建别名</h4><p>我们来为一个索引起一个别名：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">POST /_aliases</span><br><span class="line">&#123;</span><br><span class="line">  &quot;actions&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;add&quot;: &#123;</span><br><span class="line">        &quot;index&quot;: &quot;l1&quot;,</span><br><span class="line">        &quot;alias&quot;: &quot;a1&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上例，我们使用<code>add</code>为索引<code>l1</code>添加一个别名<code>a1</code>。</p>
<h4 id="查看别名"><a href="#查看别名" class="headerlink" title="查看别名"></a>查看别名</h4><p>来查看一下刚才添加的别名：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">GET l1/_alias</span><br><span class="line"># result</span><br><span class="line">&#123;</span><br><span class="line">  &quot;l1&quot; : &#123;</span><br><span class="line">    &quot;aliases&quot; : &#123;</span><br><span class="line">      &quot;a1&quot; : &#123; &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="删除别名"><a href="#删除别名" class="headerlink" title="删除别名"></a>删除别名</h4><p>删除别名使用<code>remove</code>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">POST /_aliases</span><br><span class="line">&#123;</span><br><span class="line">  &quot;actions&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;remove&quot;: &#123;</span><br><span class="line">        &quot;index&quot;: &quot;l1&quot;,</span><br><span class="line">        &quot;alias&quot;: &quot;a1&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这样就删除了指向索引<code>l1</code>的别名<code>a1</code>，再查<code>l1</code>的别名，你会发现<code>aliases</code>为空。</p>
<blockquote>
<p>注意，重复删除别名会报<code>aliases_not_found_exception</code>错误。</p>
</blockquote>
<h4 id="重命名别名"><a href="#重命名别名" class="headerlink" title="重命名别名"></a>重命名别名</h4><p>重命名别名是一个简单的<code>remove</code>操作，然后执行<code>add</code>操作，无需担心短时间内别名不指向索引，因为这个操作原子性的：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">POST /_aliases</span><br><span class="line">&#123;</span><br><span class="line">  &quot;actions&quot;: [</span><br><span class="line">    &#123;&quot;remove&quot;: &#123;&quot;index&quot;: &quot;l1&quot;, &quot;alias&quot;: &quot;a1&quot;&#125;&#125;,</span><br><span class="line">    &#123;&quot;add&quot;: &#123;&quot;index&quot;: &quot;l1&quot;, &quot;alias&quot;: &quot;a2&quot;&#125;&#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意，索引<code>l1</code>要有别名<code>a1</code>。</p>
<h4 id="为多个索引指向同样的别名"><a href="#为多个索引指向同样的别名" class="headerlink" title="为多个索引指向同样的别名"></a>为多个索引指向同样的别名</h4><p>为多个索引指向同样的别名只需要几个<code>add</code>操作就OK了：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">POST /_aliases</span><br><span class="line">&#123;</span><br><span class="line">  &quot;actions&quot;: [</span><br><span class="line">    &#123;&quot;add&quot;: &#123;&quot;index&quot;: &quot;l1&quot;, &quot;alias&quot;: &quot;a1&quot;&#125;&#125;,</span><br><span class="line">    &#123;&quot;add&quot;: &#123;&quot;index&quot;: &quot;l2&quot;, &quot;alias&quot;: &quot;a1&quot;&#125;&#125;,</span><br><span class="line">    &#123;&quot;add&quot;: &#123;&quot;index&quot;: &quot;l3&quot;, &quot;alias&quot;: &quot;a1&quot;&#125;&#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上例，我们将<code>l1、l2、l3</code>三个索引都指向别名<code>a1</code>。</p>
<h4 id="使用indices数组语法在一个操作中为多个索引指向同一个别名"><a href="#使用indices数组语法在一个操作中为多个索引指向同一个别名" class="headerlink" title="使用indices数组语法在一个操作中为多个索引指向同一个别名"></a>使用indices数组语法在一个操作中为多个索引指向同一个别名</h4><p>可以<strong>使用<code>indices</code>数组语法在一个操作中为多个索引指向同一个别名</strong>，也是上面示例的另一种写法：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">POST /_aliases</span><br><span class="line">&#123;</span><br><span class="line">  &quot;actions&quot;: [</span><br><span class="line">    &#123;&quot;add&quot;: &#123;&quot;indices&quot;: [&quot;l1&quot;, &quot;l2&quot;, &quot;l3&quot;], &quot;alias&quot;: &quot;a2&quot;&#125;&#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>当然，这个套路同样适用于<strong>在一个操作中为一个索引指向多个别名</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">POST /_aliases</span><br><span class="line">&#123;</span><br><span class="line">  &quot;actions&quot;: [</span><br><span class="line">    &#123;&quot;add&quot;: &#123;&quot;index&quot;: &quot;l1&quot;, &quot;aliases&quot;: [&quot;a1&quot;, &quot;a2&quot;, &quot;a3&quot;]&#125;&#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>对于上面的示例，也可以使用<code>glob pattern</code>将别名关联到拥有公共名称的多个索引：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">POST /_aliases</span><br><span class="line">&#123;</span><br><span class="line">  &quot;actions&quot;: [</span><br><span class="line">    &#123;&quot;add&quot;: &#123;&quot;index&quot;: &quot;l*&quot;, &quot;alias&quot;: &quot;f1&quot;&#125;&#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上例指将所有以<code>l</code>开头的索引都指向别名<code>f1</code>。</p>
<p>这个操作非常的有用，比如我们处理日志的逻辑是以日期为索引名，每天创建一个索引，那么我们如果想以月为单位分析日志，就可以采用这种方式，比如将2月份每一天的索引都指向一个别名，便于操作。</p>
<h4 id="别名交换"><a href="#别名交换" class="headerlink" title="别名交换"></a>别名交换</h4><p>在一个操作中使用别名交换：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">POST /_aliases</span><br><span class="line">&#123;</span><br><span class="line">  &quot;actions&quot;: [</span><br><span class="line">    &#123;&quot;add&quot;: &#123;&quot;index&quot;: &quot;l1&quot;, &quot;alias&quot;: &quot;a1&quot;&#125;&#125;,</span><br><span class="line">    &#123;&quot;remove_index&quot;:&#123;&quot;index&quot;:&quot;a1&quot;&#125;&#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上例的例子的意思是，开始，我们错误的添加了索引<code>a1</code>，而是<code>l1</code>才是我们想要添加的索引，所以这里我们可以先为索引<code>l1</code>创建一个别名<code>a1</code>，然后再把原来的索引<code>a1</code>干掉。<code>remove_index</code>就像删除索引一样（是的，索引<code>a1</code>就这样被干掉了）。</p>
<h4 id="过滤器别名"><a href="#过滤器别名" class="headerlink" title="过滤器别名"></a>过滤器别名</h4><p>带有过滤器的别名提供了创建相同索引的不同<code>视图</code>的简单方法，过滤器可以使用查询DSL定义，并应用与所有的搜索、计数、按查询删除以及诸如此类的操作。要创建一个带过滤器的别名，首先要确保映射字段已存在与<code>mapping</code>中：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">PUT l4</span><br><span class="line">&#123;</span><br><span class="line">  &quot;mappings&quot;: &#123;</span><br><span class="line">    &quot;doc&quot;:&#123;</span><br><span class="line">      &quot;properties&quot;:&#123;</span><br><span class="line">        &quot;year&quot;:&#123;</span><br><span class="line">          &quot;type&quot;:&quot;integer&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;method&quot;:&#123;</span><br><span class="line">          &quot;type&quot;:&quot;keyword&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">PUT l4/doc/1</span><br><span class="line">&#123;</span><br><span class="line">  &quot;year&quot;:2019,</span><br><span class="line">  &quot;method&quot;:&quot;GET&quot;</span><br><span class="line">&#125;</span><br><span class="line">PUT l4/doc/2</span><br><span class="line">&#123;</span><br><span class="line">  &quot;year&quot;:2018,</span><br><span class="line">  &quot;method&quot;:&quot;POST&quot;</span><br><span class="line">&#125;</span><br><span class="line">PUT l4/doc/3</span><br><span class="line">&#123;</span><br><span class="line">  &quot;year&quot;:2019,</span><br><span class="line">  &quot;method&quot;:&quot;POST&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们来看过滤器别名是如何创建的：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">POST /_aliases</span><br><span class="line">&#123;</span><br><span class="line">  &quot;actions&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;add&quot;: &#123;</span><br><span class="line">        &quot;index&quot;: &quot;l4&quot;,</span><br><span class="line">        &quot;alias&quot;: &quot;a4&quot;,</span><br><span class="line">        &quot;filter&quot;: &#123;&quot;term&quot;: &#123;</span><br><span class="line">          &quot;year&quot;: 2019</span><br><span class="line">        &#125;&#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上例，我们为索引<code>l4</code>以<code>year</code>字段建立了别名<code>a4</code>。我们来看一下它与普通的别名有什么区别：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;l4&quot; : &#123;</span><br><span class="line">    &quot;aliases&quot; : &#123;</span><br><span class="line">      &quot;a4&quot; : &#123;</span><br><span class="line">        &quot;filter&quot; : &#123;</span><br><span class="line">          &quot;term&quot; : &#123;</span><br><span class="line">            &quot;year&quot; : 2019</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果你够细心的话，你会发现这个带过滤器的别名相较于之前的别名多了过滤条件，普通的别名<code>aliases</code>的字典是空的。<br>那么有啥用呢？我们如果以索引<code>l4</code>查询，一切没啥变化：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET l4/doc/_search</span><br></pre></td></tr></table></figure>

<p>上例查询返回该索引内的所有文档。<br>而如果以别名<code>a4</code>查询则仅返回过滤器过滤后的结果：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET a4/doc/_search</span><br></pre></td></tr></table></figure>

<p>上例仅返回<code>year</code>为2019的文档。</p>
<h4 id="与路由连用"><a href="#与路由连用" class="headerlink" title="与路由连用"></a>与路由连用</h4><p>除了单独使用别名，还可以将别名与路由值关联，以避免不必要的分片操作。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">POST /_aliases</span><br><span class="line">&#123;</span><br><span class="line">  &quot;actions&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;add&quot;: &#123;</span><br><span class="line">        &quot;index&quot;: &quot;l1&quot;,</span><br><span class="line">        &quot;alias&quot;: &quot;a1&quot;,</span><br><span class="line">        &quot;routing&quot;: &quot;1&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上例为索引<code>l1</code>创建了一个别名<code>a1</code>，在创建完<code>a1</code>后，所有与此别名的操作都将自动修改使用<code>routing</code>值进行路由。<br>除此之外，还可以为搜索和索引操作指定不同的路由值：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">POST /_aliases</span><br><span class="line">&#123;</span><br><span class="line">  &quot;actions&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;add&quot;: &#123;</span><br><span class="line">        &quot;index&quot;: &quot;l4&quot;,</span><br><span class="line">        &quot;alias&quot;: &quot;a4&quot;,</span><br><span class="line">        &quot;search_routing&quot;: &quot;1,2&quot;,</span><br><span class="line">        &quot;index_routing&quot;: &quot;1&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如上例所示，搜索路由（search_routing）可能包含多个（以英文逗号分隔）值，但索引路由（index_routing）就只能包含一个值。<br>如果使用路由别名的搜索也有路由参数，则使用在该参数中指定的搜索别名路由和路由的交集：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /a4/_search?q=year:2019&amp;routing=2,3</span><br></pre></td></tr></table></figure>

<p>上例中，搜索操作中有路由参数<code>2、3</code>，而搜索路由设置的是<code>1、2</code>，所以取交集<code>2</code>。</p>
<h4 id="写索引"><a href="#写索引" class="headerlink" title="写索引"></a>写索引</h4><p>在之前的介绍中，我们说过，我们仅能使用别名进行查询操作，不能做写入操作，因为如果一个别名关联多个索引的话，es不知道你要将文档写入到哪个索引中，而现在，我们就来解决这个问题，我们要告诉es，要将文档写入到哪个索引中。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">POST /_aliases</span><br><span class="line">&#123;</span><br><span class="line">  &quot;actions&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;add&quot;: &#123;</span><br><span class="line">        &quot;index&quot;: &quot;l1&quot;,</span><br><span class="line">        &quot;alias&quot;: &quot;a1&quot;,</span><br><span class="line">        &quot;is_write_index&quot;: true</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;add&quot;: &#123;</span><br><span class="line">        &quot;index&quot;: &quot;l2&quot;,</span><br><span class="line">        &quot;alias&quot;: &quot;a1&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意，上述的<code>l1</code>和<code>l2</code>索引必须存在。<br>在上例中，<code>is_write_index:true</code>表示当通过别名<code>a1</code>做写入操作的时候，将文档写入到索引<code>l1</code>中。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">PUT a1/doc/2</span><br><span class="line">&#123;</span><br><span class="line">  &quot;title&quot;: &quot;hi gay&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上例中，<code>PUT a1/doc/2</code>相当于向<code>l1/doc/2</code>写入。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GET l1/doc/_search</span><br><span class="line">GET l1/doc/2</span><br></pre></td></tr></table></figure>

<p>那么如果有些文档的写入要从<code>l1</code>切换到<code>l2</code>该怎么办呢？要交换哪个索引是别名的写入操作，可以利用别名API进行原子交换，交换不依赖于操作的顺序。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">POST /_aliases</span><br><span class="line">&#123;</span><br><span class="line">  &quot;actions&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;add&quot;: &#123;</span><br><span class="line">        &quot;index&quot;: &quot;l1&quot;,</span><br><span class="line">        &quot;alias&quot;: &quot;a1&quot;,</span><br><span class="line">        &quot;is_write_index&quot;: false</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;add&quot;: &#123;</span><br><span class="line">        &quot;index&quot;: &quot;l2&quot;,</span><br><span class="line">        &quot;alias&quot;: &quot;a1&quot;,</span><br><span class="line">        &quot;is_write_index&quot;: true</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上例中，我们首先取消<code>l1</code>的写索引权限，然后将该权限交给<code>l2</code>。这样，再写入的话，就是向<code>l2</code>索引了。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">PUT a1/doc/3</span><br><span class="line">&#123;</span><br><span class="line">  &quot;title&quot;: &quot;hi man&quot;</span><br><span class="line">&#125;</span><br><span class="line">GET l2/doc/3</span><br></pre></td></tr></table></figure>

<p>注意，如果一个别名仅有一个索引指向它时，那么该索引是有写权限的：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">PUT l5/doc/1</span><br><span class="line">&#123;</span><br><span class="line">  &quot;title&quot;:&quot;肉肉的猪仔真可爱&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">POST /_aliases</span><br><span class="line">&#123;</span><br><span class="line">  &quot;actions&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;add&quot;: &#123;</span><br><span class="line">        &quot;index&quot;: &quot;l5&quot;,</span><br><span class="line">        &quot;alias&quot;: &quot;a5&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line">PUT a5/doc/2</span><br><span class="line">&#123;</span><br><span class="line">  &quot;title&quot;:&quot;可爱可爱真可爱&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">GET l5/doc/_search</span><br></pre></td></tr></table></figure>

<p>如上例所示，此时的别名<code>a5</code>仅有索引<code>l5</code>指向它。所以可以通过该别名做写入操作。<br>但是，当又有新的索引<code>l4</code>指向该别名时，如果没有显示的设置<code>is_write_index:true</code>，此时就不能通过该别名做写索引操作了。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">POST /_aliases</span><br><span class="line">&#123;</span><br><span class="line">  &quot;actions&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;add&quot;: &#123;</span><br><span class="line">        &quot;index&quot;: &quot;l4&quot;,</span><br><span class="line">        &quot;alias&quot;: &quot;a5&quot;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">PUT a5/doc/3     </span><br><span class="line">&#123;</span><br><span class="line">  &quot;title&quot;:&quot;可爱可爱真可爱&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上例中，当<code>PUT a5/doc/3</code>时会报错<code>illegal_argument_exception</code>，因为此时没有为哪个索引指定<code>is_write_index:true</code>，es就不知道往哪个索引做写索引操作了。</p>
<h4 id="添加单个别名"><a href="#添加单个别名" class="headerlink" title="添加单个别名"></a>添加单个别名</h4><p>除了之前添加别名的方法，我们还可以使用端点添加别名：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PUT /&#123;index&#125;/_alias/&#123;name&#125;</span><br><span class="line">PUT /&#123;index&#125;/_alias/&#123;name&#125;?routing=user1</span><br></pre></td></tr></table></figure>

<ul>
<li>index，要为哪个索引添加别名。</li>
<li>name，别名的名称。</li>
<li>routing，可以与别名关联的路由。</li>
</ul>
<p>来个示例，基于时间的别名：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PUT /logs_201905/_alias/2019</span><br></pre></td></tr></table></figure>

<p>再来一个示例，为用户添加别名：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">PUT user</span><br><span class="line">&#123;</span><br><span class="line">  &quot;mappings&quot;: &#123;</span><br><span class="line">    &quot;doc&quot;:&#123;</span><br><span class="line">      &quot;properties&quot;:&#123;</span><br><span class="line">        &quot;user_id&quot;:&#123;</span><br><span class="line">          &quot;type&quot;:&quot;integer&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">PUT /user/_alias/user_1</span><br><span class="line">&#123;</span><br><span class="line">  &quot;routing&quot;: &quot;1&quot;,</span><br><span class="line">  &quot;filter&quot;: &#123;</span><br><span class="line">    &quot;term&quot;: &#123;</span><br><span class="line">      &quot;user_id&quot;: &quot;1&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">PUT /user/doc/1?routing=1</span><br><span class="line">&#123;</span><br><span class="line">  &quot;user_id&quot;: &quot;1&quot;</span><br><span class="line">&#125;</span><br><span class="line">GET /user/doc/_search</span><br><span class="line">GET /user/doc/1</span><br></pre></td></tr></table></figure>



<h4 id="索引期间指定别名"><a href="#索引期间指定别名" class="headerlink" title="索引期间指定别名"></a>索引期间指定别名</h4><p>我们除了单独的为一个或多个索引指定别名，也可以在索引创建期间指定别名：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">PUT l6</span><br><span class="line">&#123;</span><br><span class="line">  &quot;mappings&quot;: &#123;</span><br><span class="line">    &quot;doc&quot;:&#123;</span><br><span class="line">      &quot;properties&quot;:&#123;</span><br><span class="line">        &quot;year&quot;:&#123;</span><br><span class="line">          &quot;type&quot;:&quot;integer&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;aliases&quot;: &#123;</span><br><span class="line">    &quot;current_day&quot;: &#123;&#125;,</span><br><span class="line">    &quot;2019&quot;:&#123;</span><br><span class="line">      &quot;filter&quot;: &#123;</span><br><span class="line">        &quot;term&quot;: &#123;</span><br><span class="line">          &quot;year&quot;: 2019</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">PUT l6/doc/1</span><br><span class="line">&#123;</span><br><span class="line">  &quot;year&quot;: 2018</span><br><span class="line">&#125;</span><br><span class="line">PUT l6/doc/2</span><br><span class="line">&#123;</span><br><span class="line">  &quot;year&quot;: 2019</span><br><span class="line">&#125;</span><br><span class="line">GET 2019/_search</span><br></pre></td></tr></table></figure>



<h4 id="删除别名-1"><a href="#删除别名-1" class="headerlink" title="删除别名"></a>删除别名</h4><p>通过使用<code>DELETE</code>删除别名：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">DELETE /l1/_alias/a1</span><br><span class="line">DELETE /l2/_aliases/a*</span><br></pre></td></tr></table></figure>



<h4 id="检索现有别名"><a href="#检索现有别名" class="headerlink" title="检索现有别名"></a>检索现有别名</h4><p>使用<code>GET</code>索引别名API检索别名：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /&#123;index&#125;/_alias/&#123;alias&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>index，获取别名的索引名称。通过通配符支持部分名称，也可以使用逗号分隔多个索引名称。还可以使用索引的别名。</li>
<li>alias，要在响应中返回的别名的名称。与index选项一样，此选项支持通配符，并且选项指定由逗号分隔的多个别名。</li>
<li>ignore_unavailable，如果指定的索引名称不存在该怎么办。如果设置为true则那些索引将被忽略。</li>
</ul>
<p>来一些示例：<br>查询索引指定别名。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GET l1/_alias/a*    # 查询索引l1指向以a开头的所有别名</span><br><span class="line">GET l1/_alias/*		# 查询索引l1所有的别名</span><br></pre></td></tr></table></figure>

<p>查询所有别名是<code>a1</code>或<code>2019</code>的索引：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GET /_alias/a1</span><br><span class="line">GET /_alias/2019</span><br></pre></td></tr></table></figure>

<p>查询所有别名是以<code>20</code>开头的索引：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /_alias/20*</span><br></pre></td></tr></table></figure>



<h4 id="HEAD"><a href="#HEAD" class="headerlink" title="HEAD"></a>HEAD</h4><p>通过<code>HEAD</code>检测某个别名是否存在：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">HEAD /_alias/2019</span><br><span class="line">HEAD /_alias/20*</span><br><span class="line">HEAD /l2/_alias/*</span><br></pre></td></tr></table></figure>

<p>上例中，<code>HEAD</code>以状态码的形式返回是别名是否存在，<code>200 - OK</code>是存在，<code>404 - Not Found</code>是不存在。</p>
<p>接下来集群部分的内容留给以后再看吧</p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/Neeo/articles/10843759.html">https://www.cnblogs.com/Neeo/articles/10843759.html</a></p>
</div></div><div class="post-main post-comment"></div></article><link rel="stylesheet" type="text/css" href="/css/font.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.css"><script src="//cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script><script src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script>$(document).ready(function() {
  $(".fancybox").fancybox();
});
</script></body></html>
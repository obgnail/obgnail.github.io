<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="地址"><link rel="stylesheet" type="text/css" href="/css/normalize.css"><link rel="stylesheet" type="text/css" href="/css/highlight.css"><link rel="stylesheet" type="text/css" href="/css/noise.css"><title>gjson | 凉薄的自动书记人偶</title><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><meta name="generator" content="Hexo 5.4.0"></head><body><article class="wrapper"><div class="post-main"><div class="nav"><nav class="container"><a class="sidebar-nav-item active" href="/">Home</a></nav><div class="container post-meta"><div class="post-tags"><a class="post-tag-none-link" href="/tags/Golang/" rel="tag">Golang</a></div><div class="post-time">2021-03-23</div></div></div><div class="container post-header"><h1>gjson</h1></div><div class="container post-toc"><details class="toc"><summary class="toc-accordion">Table of Contents</summary><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BF%AB%E9%80%9F%E4%BD%BF%E7%94%A8"><span class="toc-number">1.</span> <span class="toc-text">快速使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%94%AE%E8%B7%AF%E5%BE%84"><span class="toc-number">2.</span> <span class="toc-text">键路径</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%AE%E9%A5%B0%E7%AC%A6"><span class="toc-number">3.</span> <span class="toc-text">修饰符</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E9%A5%B0%E7%AC%A6%E5%8F%82%E6%95%B0"><span class="toc-number">3.1.</span> <span class="toc-text">修饰符参数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E4%BF%AE%E9%A5%B0%E7%AC%A6"><span class="toc-number">3.2.</span> <span class="toc-text">自定义修饰符</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#JSON-%E8%A1%8C"><span class="toc-number">4.</span> <span class="toc-text">JSON 行</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%81%8D%E5%8E%86"><span class="toc-number">5.</span> <span class="toc-text">遍历</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%A1%E9%AA%8C-JSON"><span class="toc-number">5.1.</span> <span class="toc-text">校验 JSON</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E6%AC%A1%E8%8E%B7%E5%8F%96%E5%A4%9A%E4%B8%AA%E5%80%BC"><span class="toc-number">6.</span> <span class="toc-text">一次获取多个值</span></a></li></ol></details></div><div class="container post-content"><p>地址</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000022134050">Go 每日一库之 gjson</a></li>
</ul>
<p><code>gjson</code>实际上是<code>get + json</code>的缩写，用于读取 JSON 串，同样的还有一个<a target="_blank" rel="noopener" href="https://github.com/tidwall/sjson"><code>sjson</code></a>（<code>set + json</code>）库用来设置 JSON 串。</p>
<h2 id="快速使用"><a href="#快速使用" class="headerlink" title="快速使用"></a>快速使用</h2><p>先安装：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ go get github.com/tidwall/gjson</span><br></pre></td></tr></table></figure>

<p>后使用：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="string">&quot;github.com/tidwall/gjson&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  json := <span class="string">`&#123;&quot;name&quot;:&#123;&quot;first&quot;:&quot;li&quot;,&quot;last&quot;:&quot;dj&quot;&#125;,&quot;age&quot;:18&#125;`</span></span><br><span class="line">  lastName := gjson.Get(json, <span class="string">&quot;name.last&quot;</span>)</span><br><span class="line">  fmt.Println(<span class="string">&quot;last name:&quot;</span>, lastName.String())</span><br><span class="line"></span><br><span class="line">  age := gjson.Get(json, <span class="string">&quot;age&quot;</span>)</span><br><span class="line">  fmt.Println(<span class="string">&quot;age:&quot;</span>, age.Int())</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用很简单，只需要传入 JSON 串和要读取的键路径即可。</p>
<blockquote>
<p>注意一点细节，因为<code>gjson.Get()</code>函数实际上返回的是<code>gjson.Result</code>类型，我们要调用其相应的方法进行转换对应的类型。如上面的<code>String()</code>和<code>Int()</code>方法。</p>
</blockquote>
<p>如果是直接打印输出，其实可以省略<code>String()</code>，<code>fmt</code>包的大部分函数都可以对实现<code>fmt.Stringer</code>接口的类型调用<code>String()</code>方法。</p>
<h2 id="键路径"><a href="#键路径" class="headerlink" title="键路径"></a>键路径</h2><p>键路径实际上是以<code>.</code>分隔的一系列键。<code>gjson</code>支持在键中包含通配符<code>*</code>和<code>?</code>，<code>*</code>匹配任意多个字符，<code>?</code>匹配单个字符，例如<code>ca*</code>可以匹配<code>cat/cate/cake</code>等以<code>ca</code>开头的键，<code>ca?</code>只能匹配<code>cat/cap</code>等以<code>ca</code>开头且后面只有一个字符的键。</p>
<ul>
<li>数组使用<strong>键名 + <code>.</code> + 索引</strong>（索引从 0 开始）的方式读取元素，如果键<code>pets</code>对应的值是一个数组，那么<code>pets.0</code>读取数组的第一个元素，<code>pets.1</code>读取第二个元素。</li>
<li>数组长度使用**键名 + <code>.</code> + <code>#</code>**获取，例如<code>pets.#</code>返回数组<code>pets</code>的长度。</li>
<li>如果键名中出现<code>.</code>，那么需要使用<code>\</code>进行转义。</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> json = <span class="string">`</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">  &quot;name&quot;:&#123;&quot;first&quot;:&quot;Tom&quot;, &quot;last&quot;: &quot;Anderson&quot;&#125;,</span></span><br><span class="line"><span class="string">  &quot;age&quot;: 37,</span></span><br><span class="line"><span class="string">  &quot;children&quot;: [&quot;Sara&quot;, &quot;Alex&quot;, &quot;Jack&quot;],</span></span><br><span class="line"><span class="string">  &quot;fav.movie&quot;: &quot;Dear Hunter&quot;,</span></span><br><span class="line"><span class="string">  &quot;friends&quot;: [</span></span><br><span class="line"><span class="string">    &#123;&quot;first&quot;: &quot;Dale&quot;, &quot;last&quot;:&quot;Murphy&quot;, &quot;age&quot;: 44, &quot;nets&quot;: [&quot;ig&quot;, &quot;fb&quot;, &quot;tw&quot;]&#125;,</span></span><br><span class="line"><span class="string">    &#123;&quot;first&quot;: &quot;Roger&quot;, &quot;last&quot;: &quot;Craig&quot;, &quot;age&quot;: 68, &quot;nets&quot;: [&quot;fb&quot;, &quot;tw&quot;]&#125;,</span></span><br><span class="line"><span class="string">    &#123;&quot;first&quot;: &quot;Jane&quot;, &quot;last&quot;: &quot;Murphy&quot;, &quot;age&quot;: 47, &quot;nets&quot;: [&quot;ig&quot;, &quot;tw&quot;]&#125;</span></span><br><span class="line"><span class="string">  ]</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">`</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  fmt.Println(<span class="string">&quot;last name:&quot;</span>, gjson.Get(json, <span class="string">&quot;name.last&quot;</span>))</span><br><span class="line">  fmt.Println(<span class="string">&quot;age:&quot;</span>, gjson.Get(json, <span class="string">&quot;age&quot;</span>))</span><br><span class="line">  fmt.Println(<span class="string">&quot;children:&quot;</span>, gjson.Get(json, <span class="string">&quot;children&quot;</span>))</span><br><span class="line">  fmt.Println(<span class="string">&quot;children count:&quot;</span>, gjson.Get(json, <span class="string">&quot;children.#&quot;</span>))</span><br><span class="line">  fmt.Println(<span class="string">&quot;second child:&quot;</span>, gjson.Get(json, <span class="string">&quot;children.1&quot;</span>))</span><br><span class="line">  fmt.Println(<span class="string">&quot;third child*:&quot;</span>, gjson.Get(json, <span class="string">&quot;child*.2&quot;</span>))</span><br><span class="line">  fmt.Println(<span class="string">&quot;first c?ild:&quot;</span>, gjson.Get(json, <span class="string">&quot;c?ildren.0&quot;</span>))</span><br><span class="line">  fmt.Println(<span class="string">&quot;fav.moive&quot;</span>, gjson.Get(json, <span class="string">`fav.\moive`</span>))</span><br><span class="line">  fmt.Println(<span class="string">&quot;first name of friends:&quot;</span>, gjson.Get(json, <span class="string">&quot;friends.#.first&quot;</span>))</span><br><span class="line">  fmt.Println(<span class="string">&quot;last name of second friend:&quot;</span>, gjson.Get(json, <span class="string">&quot;friends.1.last&quot;</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>前 3 个比较简单，就不赘述了。看后面几个：</p>
<ul>
<li><code>children.#</code>：返回数组<code>children</code>的长度；</li>
<li><code>children.1</code>：读取数组<code>children</code>的第 2 个元素（注意索引从 0 开始）；</li>
<li><code>child*.2</code>：首先<code>child*</code>匹配<code>children</code>，<code>.2</code>读取第 3 个元素；</li>
<li><code>c?ildren.0</code>：<code>c?ildren</code>匹配到<code>children</code>，<code>.0</code>读取第一个元素；</li>
<li><code>fav.\moive</code>：因为键名中含有<code>.</code>，故需要<code>\</code>转义；</li>
<li><code>friends.#.first</code>：如果数组后<code>#</code>后还有内容，则以后面的路径读取数组中的每个元素，返回一个新的数组。所以该查询返回的数组所有<code>friends</code>的<code>first</code>字段组成；</li>
<li><code>friends.1.last</code>：读取<code>friends</code>第 2 个元素的<code>last</code>字段。</li>
</ul>
<p>运行结果：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">last name: Anderson</span><br><span class="line">age: 37</span><br><span class="line">children: [&quot;Sara&quot;, &quot;Alex&quot;, &quot;Jack&quot;]</span><br><span class="line">children count: 3</span><br><span class="line">second child: Alex</span><br><span class="line">third child*: Jack</span><br><span class="line">first c?ild: Sara</span><br><span class="line">fave.moive </span><br><span class="line">first name of friends: [&quot;Dale&quot;,&quot;Roger&quot;,&quot;Jane&quot;]</span><br><span class="line">last name of second friend: Craig</span><br></pre></td></tr></table></figure>

<p>对于数组，<code>gjson</code>还支持按条件查询元素，<code>#(条件)</code>返回第一个满足条件的元素，<code>#(条件)#</code>返回所有满足条件的元素。括号内的条件可以有<code>==</code>、<code>!=</code>、<code>&lt;</code>、<code>&lt;=</code>、<code>&gt;</code>、<code>&gt;=</code>，还有简单的模式匹配<code>%</code>（符合某个模式），<code>!%</code>（不符合某个模式）：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">fmt.Println(gjson.Get(json, `friends.#(last=&quot;Murphy&quot;).first`))</span><br><span class="line">fmt.Println(gjson.Get(json, `friends.#(last=&quot;Murphy&quot;)#.first`))</span><br><span class="line">fmt.Println(gjson.Get(json, &quot;friends.#(age&gt;45)#.last&quot;))</span><br><span class="line">fmt.Println(gjson.Get(json, `friends.#(first%&quot;D*&quot;).last`))</span><br><span class="line">fmt.Println(gjson.Get(json, `friends.#(first!%&quot;D*&quot;).last`))</span><br><span class="line">fmt.Println(gjson.Get(json, `friends.#(nets.#(==&quot;fb&quot;))#.first`))</span><br></pre></td></tr></table></figure>

<p>还是使用上面的 JSON 串。</p>
<ul>
<li><code>friends.#(last=&quot;Murphy&quot;).first</code>：<code>friends.#(last=&quot;Murphy&quot;)</code>返回数组<code>friends</code>中第一个<code>last</code>为<code>Murphy</code>的元素，<code>.first</code>表示取出该元素的<code>first</code>字段返回；</li>
<li><code>friends.#(last=&quot;Murphy&quot;)#.first</code>：<code>friends.#(last=&quot;Murphy&quot;)#</code>返回数组<code>friends</code>中所有的<code>last</code>为<code>Murphy</code>的元素，然后读取它们的<code>first</code>字段放在一个数组中返回。注意与上面一个的区别；</li>
<li><code>friends.#(age&gt;45)#.last</code>：<code>friends.#(age&gt;45)#</code>返回数组<code>friends</code>中所有年龄大于 45 的元素，然后读取它们的<code>last</code>字段返回；</li>
<li><code>friends.#(first%&quot;D*&quot;).last</code>：<code>friends.#(first%&quot;D*&quot;)</code>返回数组<code>friends</code>中第一个<code>first</code>字段满足模式<code>D*</code>的元素，取出其<code>last</code>字段返回；</li>
<li><code>friends.#(first!%&quot;D*&quot;).last</code>：``friends.#(first!%”D*”)<code>返回数组</code>friends<code>中第一个</code>first<code>字段**不**满足模式</code>D*<code>的元素，读取其</code>last`字段返回；</li>
<li><code>friends.#(nets.#(==&quot;fb&quot;))#.first</code>：这是个嵌套条件，<code>friends.#(nets.#(==&quot;fb&quot;))#</code>返回数组<code>friends</code>的元素的<code>nets</code>字段中有<code>fb</code>的所有元素，然后取出<code>first</code>字段返回。</li>
</ul>
<p>运行结果：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Dale</span><br><span class="line">[&quot;Dale&quot;,&quot;Jane&quot;]</span><br><span class="line">[&quot;Craig&quot;,&quot;Murphy&quot;]</span><br><span class="line">Murphy</span><br><span class="line">Craig</span><br><span class="line">[&quot;Dale&quot;,&quot;Roger&quot;]</span><br></pre></td></tr></table></figure>



<h2 id="修饰符"><a href="#修饰符" class="headerlink" title="修饰符"></a>修饰符</h2><p><strong>修饰符</strong>是<code>gjson</code>提供的非常强大的功能，和键路径搭配使用。<code>gjson</code>提供了一些内置的修饰符：</p>
<ul>
<li><code>@reverse</code>：翻转一个数组；</li>
<li><code>@ugly</code>：移除 JSON 中的所有空白符；</li>
<li><code>@pretty</code>：使 JSON 更易用阅读；</li>
<li><code>@this</code>：返回当前的元素，可以用来返回根元素；</li>
<li><code>@valid</code>：校验 JSON 的合法性；</li>
<li><code>@flatten</code>：数组平坦化，即将<code>[&quot;a&quot;, [&quot;b&quot;, &quot;c&quot;]]</code>转为<code>[&quot;a&quot;,&quot;b&quot;,&quot;c&quot;]</code>；</li>
<li><code>@join</code>：将多个对象合并到一个对象中。</li>
</ul>
<p><strong>修饰符的语法和管道类似，以<code>|</code>分隔键路径和分隔符。</strong></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> json = <span class="string">`&#123;</span></span><br><span class="line"><span class="string">  &quot;name&quot;:&#123;&quot;first&quot;:&quot;Tom&quot;, &quot;last&quot;: &quot;Anderson&quot;&#125;,</span></span><br><span class="line"><span class="string">  &quot;age&quot;: 37,</span></span><br><span class="line"><span class="string">  &quot;children&quot;: [&quot;Sara&quot;, &quot;Alex&quot;, &quot;Jack&quot;],</span></span><br><span class="line"><span class="string">  &quot;fav.movie&quot;: &quot;Dear Hunter&quot;,</span></span><br><span class="line"><span class="string">  &quot;friends&quot;: [</span></span><br><span class="line"><span class="string">    &#123;&quot;first&quot;: &quot;Dale&quot;, &quot;last&quot;:&quot;Murphy&quot;, &quot;age&quot;: 44, &quot;nets&quot;: [&quot;ig&quot;, &quot;fb&quot;, &quot;tw&quot;]&#125;,</span></span><br><span class="line"><span class="string">    &#123;&quot;first&quot;: &quot;Roger&quot;, &quot;last&quot;: &quot;Craig&quot;, &quot;age&quot;: 68, &quot;nets&quot;: [&quot;fb&quot;, &quot;tw&quot;]&#125;,</span></span><br><span class="line"><span class="string">    &#123;&quot;first&quot;: &quot;Jane&quot;, &quot;last&quot;: &quot;Murphy&quot;, &quot;age&quot;: 47, &quot;nets&quot;: [&quot;ig&quot;, &quot;tw&quot;]&#125;</span></span><br><span class="line"><span class="string">  ]</span></span><br><span class="line"><span class="string">&#125;`</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  fmt.Println(gjson.Get(json, <span class="string">&quot;children|@reverse&quot;</span>))</span><br><span class="line">  fmt.Println(gjson.Get(json, <span class="string">&quot;children|@reverse|0&quot;</span>))</span><br><span class="line">  fmt.Println(gjson.Get(json, <span class="string">&quot;friends|@ugly&quot;</span>))</span><br><span class="line">  fmt.Println(gjson.Get(json, <span class="string">&quot;friends|@pretty&quot;</span>))</span><br><span class="line">  fmt.Println(gjson.Get(json, <span class="string">&quot;@this&quot;</span>))</span><br><span class="line"></span><br><span class="line">  nestedJSON := <span class="string">`&#123;&quot;nested&quot;: [&quot;one&quot;, &quot;two&quot;, [&quot;three&quot;, &quot;four&quot;]]&#125;`</span></span><br><span class="line">  fmt.Println(gjson.Get(nestedJSON, <span class="string">&quot;nested|@flatten&quot;</span>))</span><br><span class="line"></span><br><span class="line">  userJSON := <span class="string">`&#123;&quot;info&quot;:[&#123;&quot;name&quot;:&quot;dj&quot;, &quot;age&quot;:18&#125;,&#123;&quot;phone&quot;:&quot;123456789&quot;,&quot;email&quot;:&quot;dj@example.com&quot;&#125;]&#125;`</span></span><br><span class="line">  fmt.Println(gjson.Get(userJSON, <span class="string">&quot;info|@join&quot;</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>children|@reverse</code>先读取数组<code>children</code>，然后使用修饰符<code>@reverse</code>翻转之后返回，输出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[&quot;Jack&quot;,&quot;Alex&quot;,&quot;Sara&quot;]</span><br></pre></td></tr></table></figure>

<p><code>children|@reverse|0</code>在上面翻转的基础上读取第一个元素，即原数组的最后一个元素，输出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Jack</span><br></pre></td></tr></table></figure>

<p><code>friends|@ugly</code>移除<code>friends</code>数组中的所有空白字符，返回一行长长的字符串：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[&#123;&quot;first&quot;:&quot;Dale&quot;,&quot;last&quot;:&quot;Murphy&quot;,&quot;age&quot;:44,&quot;nets&quot;:[&quot;ig&quot;,&quot;fb&quot;,&quot;tw&quot;]&#125;,&#123;&quot;first&quot;:&quot;Roger&quot;,&quot;last&quot;:&quot;Craig&quot;,&quot;age&quot;:68,&quot;nets&quot;:[&quot;fb&quot;,&quot;tw&quot;]&#125;,&#123;&quot;first&quot;:&quot;Jane&quot;,&quot;last&quot;:&quot;Murphy&quot;,&quot;age&quot;:47,&quot;nets&quot;:[&quot;ig&quot;,&quot;tw&quot;]&#125;]</span><br></pre></td></tr></table></figure>

<p><code>friends|@pretty</code>格式化<code>friends</code>数组，使之更易读：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">&quot;first&quot;</span>: <span class="string">&quot;Dale&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;last&quot;</span>: <span class="string">&quot;Murphy&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;age&quot;</span>: <span class="number">44</span>,</span><br><span class="line">    <span class="attr">&quot;nets&quot;</span>: [<span class="string">&quot;ig&quot;</span>, <span class="string">&quot;fb&quot;</span>, <span class="string">&quot;tw&quot;</span>]</span><br><span class="line">  &#125;, </span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">&quot;first&quot;</span>: <span class="string">&quot;Roger&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;last&quot;</span>: <span class="string">&quot;Craig&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;age&quot;</span>: <span class="number">68</span>,</span><br><span class="line">    <span class="attr">&quot;nets&quot;</span>: [<span class="string">&quot;fb&quot;</span>, <span class="string">&quot;tw&quot;</span>]</span><br><span class="line">  &#125;, </span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">&quot;first&quot;</span>: <span class="string">&quot;Jane&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;last&quot;</span>: <span class="string">&quot;Murphy&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;age&quot;</span>: <span class="number">47</span>,</span><br><span class="line">    <span class="attr">&quot;nets&quot;</span>: [<span class="string">&quot;ig&quot;</span>, <span class="string">&quot;tw&quot;</span>]</span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p><code>@this</code>返回原始的 JSON 串。</p>
<p><code>@flatten</code>将数组<code>nested</code>的内层数组平坦到外层后返回，即将所有内层数组的元素依次添加到外层数组后面并移除内层数组，输出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[&quot;one&quot;,&quot;two&quot;,&quot;three&quot;, &quot;four&quot;]</span><br></pre></td></tr></table></figure>

<p><code>@join</code>将一个数组中的各个对象合并到一个中，例子中将数组中存放的部分个人信息合并成一个对象返回：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;name&quot;:&quot;dj&quot;,&quot;age&quot;:18,&quot;phone&quot;:&quot;123456789&quot;,&quot;email&quot;:&quot;dj@example.com&quot;&#125;</span><br></pre></td></tr></table></figure>



<h3 id="修饰符参数"><a href="#修饰符参数" class="headerlink" title="修饰符参数"></a>修饰符参数</h3><p>修饰符还可以有参数，通过在修饰符后加<code>:</code>后跟参数。如果我们在格式化 JSON 串时，想要对键进行排序，那么可以使用<code>@pretty</code>修饰符的<code>sortKeys</code>参数。我们还是拿上面的 JSON 数据举例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fmt.Println(gjson.Get(json, `friends|@pretty:&#123;&quot;sortKeys&quot;:true&#125;`))</span><br></pre></td></tr></table></figure>

<p>最终按键名顺序输出 JSON 串：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  &#123;</span><br><span class="line">    &quot;age&quot;: 44,</span><br><span class="line">    &quot;first&quot;: &quot;Dale&quot;,</span><br><span class="line">    &quot;last&quot;: &quot;Murphy&quot;,</span><br><span class="line">    &quot;nets&quot;: [&quot;ig&quot;, &quot;fb&quot;, &quot;tw&quot;]</span><br><span class="line">  &#125;, </span><br><span class="line">  &#123;</span><br><span class="line">    &quot;age&quot;: 68,</span><br><span class="line">    &quot;first&quot;: &quot;Roger&quot;,</span><br><span class="line">    &quot;last&quot;: &quot;Craig&quot;,</span><br><span class="line">    &quot;nets&quot;: [&quot;fb&quot;, &quot;tw&quot;]</span><br><span class="line">  &#125;, </span><br><span class="line">  &#123;</span><br><span class="line">    &quot;age&quot;: 47,</span><br><span class="line">    &quot;first&quot;: &quot;Jane&quot;,</span><br><span class="line">    &quot;last&quot;: &quot;Murphy&quot;,</span><br><span class="line">    &quot;nets&quot;: [&quot;ig&quot;, &quot;tw&quot;]</span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>当然还可以指定每行缩进<code>indent</code>（默认两个空格），每行开头字符串<code>prefix</code>（默认为空串）和一行最多显示字符数<code>width</code>（默认 80 字符）。下面在每行前增加两个空格：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fmt.Println(gjson.Get(json, `friends|@pretty:&#123;&quot;sortKeys&quot;:true,&quot;prefix&quot;:&quot; &quot;&#125;`))</span><br></pre></td></tr></table></figure>



<h3 id="自定义修饰符"><a href="#自定义修饰符" class="headerlink" title="自定义修饰符"></a>自定义修饰符</h3><p>如此强大的功当然要支持自定义！<code>gjson</code>使用<code>AddModifier()</code>添加一个修饰符，传入一个名字和类型为<code>func(json arg string) string</code>的处理函数。处理函数接受待处理的 JSON 值和修饰符参数，返回处理后的结果。下面编写一个转换大小写的修饰符：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">func main() &#123;</span><br><span class="line">  gjson.AddModifier(&quot;case&quot;, func(json, arg string) string &#123;</span><br><span class="line">    if arg == &quot;upper&quot; &#123;</span><br><span class="line">      return strings.ToUpper(json)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if arg == &quot;lower&quot; &#123;</span><br><span class="line">      return strings.ToLower(json)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return json</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  const json = `&#123;&quot;children&quot;: [&quot;Sara&quot;, &quot;Alex&quot;, &quot;Jack&quot;]&#125;`</span><br><span class="line">  fmt.Println(gjson.Get(json, &quot;children|@case:upper&quot;))</span><br><span class="line">  fmt.Println(gjson.Get(json, &quot;children|@case:lower&quot;))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[&quot;SARA&quot;, &quot;ALEX&quot;, &quot;JACK&quot;]</span><br><span class="line">[&quot;sara&quot;, &quot;alex&quot;, &quot;jack&quot;]</span><br></pre></td></tr></table></figure>



<h2 id="JSON-行"><a href="#JSON-行" class="headerlink" title="JSON 行"></a>JSON 行</h2><p><code>gjson</code>提供<code>..</code>语法可以将多行数据看成一个数组，每行数据是一个元素：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> json = <span class="string">`</span></span><br><span class="line"><span class="string">&#123;&quot;name&quot;: &quot;Gilbert&quot;, &quot;age&quot;: 61&#125;</span></span><br><span class="line"><span class="string">&#123;&quot;name&quot;: &quot;Alexa&quot;, &quot;age&quot;: 34&#125;</span></span><br><span class="line"><span class="string">&#123;&quot;name&quot;: &quot;May&quot;, &quot;age&quot;: 57&#125;</span></span><br><span class="line"><span class="string">&#123;&quot;name&quot;: &quot;Deloise&quot;, &quot;age&quot;: 44&#125;`</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  fmt.Println(gjson.Get(json, <span class="string">&quot;..#&quot;</span>))</span><br><span class="line">  fmt.Println(gjson.Get(json, <span class="string">&quot;..1&quot;</span>))</span><br><span class="line">  fmt.Println(gjson.Get(json, <span class="string">&quot;..#.name&quot;</span>))</span><br><span class="line">  fmt.Println(gjson.Get(json, <span class="string">`..#(name=&quot;May&quot;).age`</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>..#</code>：返回有多少行 JSON 数据；</li>
<li><code>..1</code>：返回第一行，即<code>&#123;&quot;name&quot;: &quot;Gilbert&quot;, &quot;age&quot;: 61&#125;</code>；</li>
<li><code>..#.name</code>：<code>#</code>后再接路径，表示对数组中每个元素读取后面的路径，将读取到的值组成一个新数组返回；<code>..#.name</code>表示读取每一行中的<code>name</code>字段，最终返回<code>[&quot;Gilbert&quot;,&quot;Alexa&quot;,&quot;May&quot;,&quot;Deloise&quot;]</code>；</li>
<li><code>..#(name=&quot;May&quot;).age</code>：括号中的内容<code>(name=&quot;May&quot;)</code>表示条件，所以该条含义为取<code>name</code>为<code>&quot;May&quot;</code>的行中的<code>age</code>字段。</li>
</ul>
<p><code>gjson</code>还提供了遍历 JSON 行的方法：<code>gjson.ForEachLine()</code>，参数为 JSON 串和类型为<code>func(line gjson.Result) bool</code>的回调函数。回调返回<code>false</code>时遍历停止。下面代码读取输出每一行的<code>name</code>字段：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">gjson.ForEachLine(json, <span class="function"><span class="keyword">func</span><span class="params">(line gjson.Result)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">  fmt.Println(<span class="string">&quot;name:&quot;</span>, gjson.Get(line.String(), <span class="string">&quot;name&quot;</span>))</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<h2 id="遍历"><a href="#遍历" class="headerlink" title="遍历"></a>遍历</h2><p>上面我们介绍了遍历 JSON 行的方式，实际上<code>gjson</code>还提供了通用的遍历数组和对象的方式。<code>gjson.Get()</code>方法返回一个<code>gjson.Result</code>类型的对象，<code>json.Result</code>提供了<code>ForEach()</code>方法用于遍历。该方法接受一个类型为<code>func (key, value gjson.Result) bool</code>的回调函数。遍历对象时<code>key</code>和<code>value</code>分别为对象的键和值；遍历数组时，<code>value</code>为数组元素，<code>key</code>为空（<strong>不是索引</strong>）。回调返回<code>false</code>时，遍历停止。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> json = <span class="string">`</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">  &quot;name&quot;:&quot;dj&quot;,</span></span><br><span class="line"><span class="string">  &quot;age&quot;:18,</span></span><br><span class="line"><span class="string">  &quot;pets&quot;: [&quot;cat&quot;, &quot;dog&quot;],</span></span><br><span class="line"><span class="string">  &quot;contact&quot;: &#123;</span></span><br><span class="line"><span class="string">    &quot;phone&quot;: &quot;123456789&quot;,</span></span><br><span class="line"><span class="string">    &quot;email&quot;: &quot;dj@example.com&quot;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;`</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  pets := gjson.Get(json, <span class="string">&quot;pets&quot;</span>)</span><br><span class="line">  pets.ForEach(<span class="function"><span class="keyword">func</span><span class="params">(_, pet gjson.Result)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">    fmt.Println(pet)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  contact := gjson.Get(json, <span class="string">&quot;contact&quot;</span>)</span><br><span class="line">  contact.ForEach(<span class="function"><span class="keyword">func</span><span class="params">(key, value gjson.Result)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">    fmt.Println(key, value)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="校验-JSON"><a href="#校验-JSON" class="headerlink" title="校验 JSON"></a>校验 JSON</h3><p>调用<code>gjson.Get()</code>时，<code>gjson</code>假设我们传入的 JSON 串是合法的。如果 JSON 非法也不会<code>panic</code>，这时会返回不确定的结果：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">func main() &#123;</span><br><span class="line">  const json = `&#123;&quot;name&quot;:dj,age:18&#125;`</span><br><span class="line">  fmt.Println(gjson.Get(json, &quot;name&quot;))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面 JSON 串是非法的，<code>dj</code>和<code>age</code>都没有加上双引号（实际上习惯了 Go 语言<code>map</code>的写法，很容易把 JSON 写成这样）。上面代码输出<strong>18</strong>，显然是错误的。我们可以使用<code>gjson.Valid()</code>检测 JSON 串是否合法：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">if !gjson.Valid(json) &#123;</span><br><span class="line">  fmt.Println(&quot;error&quot;)</span><br><span class="line">&#125; else &#123;</span><br><span class="line">  fmt.Println(&quot;ok&quot;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="一次获取多个值"><a href="#一次获取多个值" class="headerlink" title="一次获取多个值"></a>一次获取多个值</h2><p>调用<code>gjson.Get()</code>一次只能读取一个值，多次调用又比较麻烦，<code>gjson</code>提供了<code>GetMany()</code>可以一次读取多个值，返回一个数组<code>[]gjson.Result</code>。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> json = <span class="string">`</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">  &quot;name&quot;:&quot;dj&quot;,</span></span><br><span class="line"><span class="string">  &quot;age&quot;:18,</span></span><br><span class="line"><span class="string">  &quot;pets&quot;: [&quot;cat&quot;, &quot;dog&quot;],</span></span><br><span class="line"><span class="string">  &quot;contact&quot;: &#123;</span></span><br><span class="line"><span class="string">    &quot;phone&quot;: &quot;123456789&quot;,</span></span><br><span class="line"><span class="string">    &quot;email&quot;: &quot;dj@example.com&quot;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;`</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  results := gjson.GetMany(json, <span class="string">&quot;name&quot;</span>, <span class="string">&quot;age&quot;</span>, <span class="string">&quot;pets.#&quot;</span>, <span class="string">&quot;contact.phone&quot;</span>)</span><br><span class="line">  <span class="keyword">for</span> _, result := <span class="keyword">range</span> results &#123;</span><br><span class="line">    fmt.Println(result)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面代码返回字段<code>name</code>、<code>age</code>、数组<code>pets</code>的长度和<code>contact.phone</code>字段。</p>
</div></div><div class="post-main post-comment"></div></article><link rel="stylesheet" type="text/css" href="/css/font.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.css"><script src="//cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script><script src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script>$(document).ready(function() {
  $(".fancybox").fancybox();
});
</script></body></html>
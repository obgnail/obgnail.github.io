<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content=" id=&quot;路由&quot;&gt;&lt;a href=&quot;#路由&quot; class=&quot;headerlink&quot; title=&quot;路由&quot;&gt;&lt;/a&gt;路由&lt;/h2&gt;&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;@blue.route(&lt;span class=&quot;params&quot;&gt;&lt;span class=&quot;string&quot;&gt;&amp;#x27;/test/&amp;#x27;&lt;/span&gt;&lt;/span&gt;)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;test&lt;/span&gt;():&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; render_template(&lt;span class=&quot;string&quot;&gt;&amp;#x27;test.html&amp;#x27;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;@blue.route(&lt;span class=&quot;params&quot;&gt;&lt;span class=&quot;string&quot;&gt;&amp;#x27;/test&amp;#x27;&lt;/span&gt;&lt;/span&gt;)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;function&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;test&lt;/span&gt;():&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; render_template(&lt;span class=&quot;string&quot;&gt;&amp;#x27;test.html&amp;#x27;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;上面两段的区别: "><link rel="stylesheet" type="text/css" href="/css/normalize.css"><link rel="stylesheet" type="text/css" href="/css/highlight.css"><link rel="stylesheet" type="text/css" href="/css/noise.css"><title>Web开发之Flask框架从入门到精通2_MTV和项目拆分 | 凉薄的自动书记人偶</title><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><meta name="generator" content="Hexo 5.4.0"></head><body><article class="wrapper"><div class="post-main"><div class="nav"><nav class="container"><a class="sidebar-nav-item active" href="/">Home</a></nav><div class="container post-meta"><div class="post-tags"><a class="post-tag-none-link" href="/tags/Flask/" rel="tag">Flask</a></div><div class="post-time">2021-08-29</div></div></div><div class="container post-header"><h1>Web开发之Flask框架从入门到精通2_MTV和项目拆分</h1></div><div class="container post-toc"><details class="toc"><summary class="toc-accordion">Table of Contents</summary><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1"><span class="toc-number">1.</span> <span class="toc-text">路由</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A8%A1%E6%9D%BF"><span class="toc-number">2.</span> <span class="toc-text">模板</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%9B%E4%B8%AA%E5%86%85%E7%BD%AE%E5%AF%B9%E8%B1%A1-%E4%B8%80%E4%B8%AA%E6%96%B9%E6%B3%95"><span class="toc-number">2.1.</span> <span class="toc-text">四个内置对象,一个方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%9B%E4%B8%AA%E9%87%8D%E8%A6%81%E7%9A%84%E7%BB%93%E6%9E%84%E6%A0%87%E7%AD%BE"><span class="toc-number">2.2.</span> <span class="toc-text">四个重要的结构标签</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%87%E6%BB%A4%E5%99%A8"><span class="toc-number">2.3.</span> <span class="toc-text">过滤器</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A8%A1%E5%9E%8B"><span class="toc-number">3.</span> <span class="toc-text">模型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E7%9A%84SQLAlchemy%E5%AD%97%E6%AE%B5%E7%B1%BB%E5%9E%8B"><span class="toc-number">3.1.</span> <span class="toc-text">常用的SQLAlchemy字段类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E7%9A%84SQLAlchemy%E5%88%97%E9%80%89%E9%A1%B9"><span class="toc-number">3.2.</span> <span class="toc-text">常用的SQLAlchemy列选项</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E7%9A%84SQLAlchemy%E5%85%B3%E7%B3%BB%E9%80%89%E9%A1%B9"><span class="toc-number">3.3.</span> <span class="toc-text">常用的SQLAlchemy关系选项</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E7%9A%84SQLAlchemy%E6%9F%A5%E8%AF%A2%E8%BF%87%E6%BB%A4%E5%99%A8"><span class="toc-number">3.4.</span> <span class="toc-text">常用的SQLAlchemy查询过滤器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E7%9A%84SQLAlchemy%E6%9F%A5%E8%AF%A2%E6%89%A7%E8%A1%8C%E5%99%A8"><span class="toc-number">3.5.</span> <span class="toc-text">常用的SQLAlchemy查询执行器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#migrate%E6%89%BE%E4%B8%8D%E5%88%B0%E7%9A%84%E9%97%AE%E9%A2%98"><span class="toc-number">3.6.</span> <span class="toc-text">migrate找不到的问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E7%BA%A6%E6%9D%9F"><span class="toc-number">3.7.</span> <span class="toc-text">常用约束</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Model%E7%9A%84%E7%BB%A7%E6%89%BF%E9%97%AE%E9%A2%98"><span class="toc-number">3.8.</span> <span class="toc-text">Model的继承问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SQlalchemy%E7%9A%84%E8%BF%9E%E6%8E%A5%E6%B1%A0"><span class="toc-number">3.9.</span> <span class="toc-text">SQlalchemy的连接池</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E6%9F%A5%E8%AF%A2%E6%B1%87%E6%80%BB"><span class="toc-number">3.10.</span> <span class="toc-text">数据查询汇总</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%8D%95%E4%B8%AA%E5%AF%B9%E8%B1%A1"><span class="toc-number">3.10.1.</span> <span class="toc-text">获取单个对象</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E7%BB%93%E6%9E%9C%E9%9B%86"><span class="toc-number">3.10.2.</span> <span class="toc-text">获取结果集</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="toc-number">3.11.</span> <span class="toc-text">运算符</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AD%9B%E9%80%89"><span class="toc-number">3.12.</span> <span class="toc-text">筛选</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8offset%E5%92%8Climit%E6%A8%A1%E6%8B%9F%E5%88%86%E9%A1%B5"><span class="toc-number">3.12.1.</span> <span class="toc-text">使用offset和limit模拟分页</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8paginate%E5%88%86%E9%A1%B5"><span class="toc-number">3.12.2.</span> <span class="toc-text">使用paginate分页</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%88%86%E9%A1%B5%E6%89%8B%E6%B3%95"><span class="toc-number">3.13.</span> <span class="toc-text">常用分页手法</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A8%A1%E6%9D%BF-1"><span class="toc-number">4.</span> <span class="toc-text">模板</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90"><span class="toc-number">4.1.</span> <span class="toc-text">静态资源</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A8%A1%E6%9D%BF%E7%89%B9%E6%AE%8A%E7%9A%84%E5%8F%98%E9%87%8F"><span class="toc-number">4.2.</span> <span class="toc-text">模板特殊的变量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E8%BF%87%E6%BB%A4%E5%99%A8"><span class="toc-number">4.3.</span> <span class="toc-text">自定义过滤器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8C%85%E5%90%AB"><span class="toc-number">4.4.</span> <span class="toc-text">包含</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%8F%E7%BB%93"><span class="toc-number">4.5.</span> <span class="toc-text">小结</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A8%A1%E6%9D%BF%E4%B8%AD%E7%89%B9%E6%9C%89%E7%9A%84%E5%8F%98%E9%87%8F%E5%92%8C%E5%87%BD%E6%95%B0"><span class="toc-number">4.6.</span> <span class="toc-text">模板中特有的变量和函数</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%86%E5%9B%BE"><span class="toc-number">5.</span> <span class="toc-text">视图</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Flask%E5%8A%A0%E8%BD%BD%E9%85%8D%E7%BD%AE"><span class="toc-number">5.1.</span> <span class="toc-text">Flask加载配置</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E6%8B%86%E5%88%86"><span class="toc-number">6.</span> <span class="toc-text">项目拆分</span></a></li></ol></details></div><div class="container post-content"><h2 id="路由"><a href="#路由" class="headerlink" title="路由"></a>路由</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@blue.route(<span class="params"><span class="string">&#x27;/test/&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test</span>():</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;test.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@blue.route(<span class="params"><span class="string">&#x27;/test&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test</span>():</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;test.html&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>上面两段的区别: </p>
<ol>
<li>app.route(‘/test/‘) : 在浏览器中输入<a target="_blank" rel="noopener" href="http://127.0.0.1:5000/test/">http://127.0.0.1:5000/test/</a> 和<a target="_blank" rel="noopener" href="http://127.0.0.1:5000/test%E9%83%BD%E8%83%BD%E8%AE%BF%E9%97%AE">http://127.0.0.1:5000/test都能访问</a></li>
<li>app.route(‘/test’) : 在浏览器中输入<a target="_blank" rel="noopener" href="http://127.0.0.1:5000/test">http://127.0.0.1:5000/test</a> 能正常访问， 输入<a target="_blank" rel="noopener" href="http://127.0.0.1:5000/test/">http://127.0.0.1:5000/test/</a> 报错Not  found</li>
</ol>
<blockquote>
<p>总结：当我们设计路由时，如果后面加了‘/’ ，当用户输入的url末尾没有”/“ ，Flask会自动响应一个重定向，转向路由末端带有‘/’的url</p>
</blockquote>
<p>converter类型:</p>
<ol>
<li>string接收任何没有斜杠的文件（默认）</li>
<li>int 接收整型</li>
<li>float 接收浮点型</li>
<li>path 接收路径，可接收斜线</li>
<li>uid 只接受uuid字符串，唯一码，一种生成规则</li>
<li>any 可以同时指定多种路径，进行限定</li>
</ol>
<h2 id="模板"><a href="#模板" class="headerlink" title="模板"></a>模板</h2><h3 id="四个内置对象-一个方法"><a href="#四个内置对象-一个方法" class="headerlink" title="四个内置对象,一个方法"></a>四个内置对象,一个方法</h3><ul>
<li>request</li>
<li>config</li>
<li>g</li>
<li>current_user</li>
<li>get_flashed_message</li>
</ul>
<h3 id="四个重要的结构标签"><a href="#四个重要的结构标签" class="headerlink" title="四个重要的结构标签"></a>四个重要的结构标签</h3><ul>
<li>block</li>
<li>extends</li>
<li>include</li>
<li>macro</li>
</ul>
<p><code>&#123;&#123; super() &#125;&#125;</code></p>
<p>在使用<code>&#123;% extends 'xx' %&#125;</code>继承后,能保留块中的内容</p>
<p><code>&#123;% include 'xxx' %&#125;</code></p>
<p>包含,将其他html包含进来 , 体现的是由零到一的概念</p>
<p>marco</p>
<p>宏定义 , 可以在模板中定义函数 , 在其他地方调用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;# hyl.html #&#125;</span><br><span class="line">&#123;% marco hello(name) %&#125;</span><br><span class="line">	&#123;&#123;name&#125;&#125;</span><br><span class="line">&#123;% endmarco %&#125;</span><br></pre></td></tr></table></figure>

<p>宏定义可以导入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;% from &#x27;hyl.html&#x27; import hello %&#125;</span><br><span class="line"></span><br><span class="line">&#123;&#123; hello(&#x27;dsz&#x27;) &#125;&#125;</span><br></pre></td></tr></table></figure>



<p><code>&#123;%  for  %&#125;</code></p>
<ul>
<li>loop.first</li>
<li>loop.last</li>
<li>loop.index</li>
<li>loop.reindex</li>
<li>loop.index()</li>
<li>loop.reindex()</li>
</ul>
<h3 id="过滤器"><a href="#过滤器" class="headerlink" title="过滤器"></a>过滤器</h3><p><code>&#123;&#123; 变量 | 过滤器 | 过滤器 | ... &#125;&#125;</code></p>
<ul>
<li>captitalize</li>
<li>lower</li>
<li>upper</li>
<li>title</li>
<li>trim</li>
<li>reverse</li>
<li>format</li>
<li>safe</li>
<li>default</li>
<li>last</li>
<li>first</li>
<li>length</li>
<li>sum</li>
<li>sort</li>
<li>striptags : 渲染之前,将值中标签去掉</li>
<li>…</li>
</ul>
<h2 id="模型"><a href="#模型" class="headerlink" title="模型"></a>模型</h2><h3 id="常用的SQLAlchemy字段类型"><a href="#常用的SQLAlchemy字段类型" class="headerlink" title="常用的SQLAlchemy字段类型"></a>常用的SQLAlchemy字段类型</h3><table>
<thead>
<tr>
<th align="left">类型名</th>
<th align="left">python中类型</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Integer</td>
<td align="left">int</td>
<td align="left">普通整数，一般是32位</td>
</tr>
<tr>
<td align="left">SmallInteger</td>
<td align="left">int</td>
<td align="left">取值范围小的整数，一般是16位</td>
</tr>
<tr>
<td align="left">BigInteger</td>
<td align="left">int或long</td>
<td align="left">不限制精度的整数</td>
</tr>
<tr>
<td align="left">Float</td>
<td align="left">float</td>
<td align="left">浮点数</td>
</tr>
<tr>
<td align="left">Numeric</td>
<td align="left">decimal.Decimal</td>
<td align="left">普通整数，一般是32位</td>
</tr>
<tr>
<td align="left">String</td>
<td align="left">str</td>
<td align="left">变长字符串</td>
</tr>
<tr>
<td align="left">Text</td>
<td align="left">str</td>
<td align="left">变长字符串，对较长或不限长度的字符串做了优化</td>
</tr>
<tr>
<td align="left">Unicode</td>
<td align="left">unicode</td>
<td align="left">变长Unicode字符串</td>
</tr>
<tr>
<td align="left">UnicodeText</td>
<td align="left">unicode</td>
<td align="left">变长Unicode字符串，对较长或不限长度的字符串做了优化</td>
</tr>
<tr>
<td align="left">Boolean</td>
<td align="left">bool</td>
<td align="left">布尔值</td>
</tr>
<tr>
<td align="left">Date</td>
<td align="left">datetime.date</td>
<td align="left">时间</td>
</tr>
<tr>
<td align="left">Time</td>
<td align="left">datetime.datetime</td>
<td align="left">日期和时间</td>
</tr>
<tr>
<td align="left">LargeBinary</td>
<td align="left">str</td>
<td align="left">二进制文件</td>
</tr>
</tbody></table>
<h3 id="常用的SQLAlchemy列选项"><a href="#常用的SQLAlchemy列选项" class="headerlink" title="常用的SQLAlchemy列选项"></a>常用的SQLAlchemy列选项</h3><table>
<thead>
<tr>
<th align="left">选项名</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">primary_key</td>
<td align="left">如果为True，代表表的主键</td>
</tr>
<tr>
<td align="left">unique</td>
<td align="left">如果为True，代表这列不允许出现重复的值</td>
</tr>
<tr>
<td align="left">index</td>
<td align="left">如果为True，为这列创建索引，提高查询效率</td>
</tr>
<tr>
<td align="left">nullable</td>
<td align="left">如果为True，允许有空值，如果为False，不允许有空值</td>
</tr>
<tr>
<td align="left">default</td>
<td align="left">为这列定义默认值</td>
</tr>
</tbody></table>
<h3 id="常用的SQLAlchemy关系选项"><a href="#常用的SQLAlchemy关系选项" class="headerlink" title="常用的SQLAlchemy关系选项"></a>常用的SQLAlchemy关系选项</h3><table>
<thead>
<tr>
<th align="left">选项名</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">backref</td>
<td align="left">在关系的另一模型中添加反向引用</td>
</tr>
<tr>
<td align="left">primary join</td>
<td align="left">明确指定两个模型之间使用的联结条件</td>
</tr>
<tr>
<td align="left">uselist</td>
<td align="left">如果为False，不使用列表，而使用标量值</td>
</tr>
<tr>
<td align="left">order_by</td>
<td align="left">指定关系中记录的排序方式</td>
</tr>
<tr>
<td align="left">secondary</td>
<td align="left">指定多对多关系中关系表的名字</td>
</tr>
<tr>
<td align="left">secondary join</td>
<td align="left">在SQLAlchemy中无法自行决定时，指定多对多关系中的二级联结条件</td>
</tr>
</tbody></table>
<h3 id="常用的SQLAlchemy查询过滤器"><a href="#常用的SQLAlchemy查询过滤器" class="headerlink" title="常用的SQLAlchemy查询过滤器"></a>常用的SQLAlchemy查询过滤器</h3><ul>
<li>用来过滤数据,返回查询的结果集</li>
</ul>
<table>
<thead>
<tr>
<th align="left">过滤器</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">filter()</td>
<td align="left">把过滤器添加到原查询上，返回一个新查询</td>
</tr>
<tr>
<td align="left">filter_by()</td>
<td align="left">把等值过滤器添加到原查询上，返回一个新查询</td>
</tr>
<tr>
<td align="left">limit</td>
<td align="left">使用指定的值限定原查询返回的结果</td>
</tr>
<tr>
<td align="left">offset()</td>
<td align="left">偏移原查询返回的结果，返回一个新查询</td>
</tr>
<tr>
<td align="left">order_by()</td>
<td align="left">根据指定条件对原查询结果进行排序，返回一个新查询</td>
</tr>
<tr>
<td align="left">group_by()</td>
<td align="left">根据指定条件对原查询结果进行分组，返回一个新查询</td>
</tr>
</tbody></table>
<h3 id="常用的SQLAlchemy查询执行器"><a href="#常用的SQLAlchemy查询执行器" class="headerlink" title="常用的SQLAlchemy查询执行器"></a>常用的SQLAlchemy查询执行器</h3><ul>
<li>用来执行结果集,得到具体数据</li>
</ul>
<table>
<thead>
<tr>
<th align="left">方法</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">all()</td>
<td align="left">以列表形式返回查询的所有结果</td>
</tr>
<tr>
<td align="left">first()</td>
<td align="left">返回查询的第一个结果，如果未查到，返回None</td>
</tr>
<tr>
<td align="left">first_or_404()</td>
<td align="left">返回查询的第一个结果，如果未查到，返回404</td>
</tr>
<tr>
<td align="left">get()</td>
<td align="left">返回指定主键对应的行，如不存在，返回None</td>
</tr>
<tr>
<td align="left">get_or_404()</td>
<td align="left">返回指定主键对应的行，如不存在，返回404</td>
</tr>
<tr>
<td align="left">count()</td>
<td align="left">返回查询结果的数量</td>
</tr>
<tr>
<td align="left">paginate()</td>
<td align="left">返回一个Paginate对象，它包含指定范围内的结果</td>
</tr>
</tbody></table>
<h3 id="migrate找不到的问题"><a href="#migrate找不到的问题" class="headerlink" title="migrate找不到的问题"></a>migrate找不到的问题</h3><p>我们在Model.py里新建了Model,执行<code>python manager.py db migrate</code> 却返回<code>No changes in schema detected.</code><br>原因 : 没人知道我们新建了一个Model . 所以只要在View.py里面<code>import</code>就可以了</p>
<p>get_or_404的代码其实超级简单</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_or_404</span>(<span class="params">self,ident</span>):</span></span><br><span class="line">    rv = self.get(ident)</span><br><span class="line">    <span class="keyword">if</span> rv <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        abort(<span class="number">404</span>)</span><br><span class="line">    <span class="keyword">return</span> rv</span><br></pre></td></tr></table></figure>



<h3 id="常用约束"><a href="#常用约束" class="headerlink" title="常用约束"></a>常用约束</h3><ul>
<li>primary_key</li>
<li>autonimcrement</li>
<li>unque</li>
<li>index</li>
<li>nullable</li>
<li>default</li>
<li>ForeignKey</li>
</ul>
<h3 id="Model的继承问题"><a href="#Model的继承问题" class="headerlink" title="Model的继承问题"></a>Model的继承问题</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animal</span>(<span class="params">db.Model</span>):</span></span><br><span class="line">    <span class="built_in">id</span> = db.Column(db.Integer,primary_key=<span class="literal">True</span>,autonicrement=<span class="literal">True</span>)</span><br><span class="line">    a_name = db.Column(db.String(<span class="number">16</span>))</span><br><span class="line">    </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dog</span>(<span class="params">Animal</span>):</span></span><br><span class="line">    d_legs = db.Column(db.Integer,default=<span class="number">4</span>)</span><br><span class="line">    </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Cat</span>(<span class="params">Animal</span>):</span></span><br><span class="line">    c_eat = db.Column(db.String(<span class="number">32</span>),default=<span class="string">&#x27;fish&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>将上面migrate后,发现</p>
<ol>
<li><p><strong>就只有Aniaml表</strong>,Dog,cat都没有 </p>
</li>
<li><p>Aniaml表拥有字段id,a_name,d_legs,c_eat</p>
</li>
<li><p>当我们执行</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cat = Cat()</span><br><span class="line">cat.a_name = <span class="string">&#x27;加菲猫&#x27;</span></span><br><span class="line">car.c_eat = <span class="string">&#x27;花鱼&#x27;</span></span><br><span class="line"></span><br><span class="line">db.session.add(cat)</span><br><span class="line">db.session.commit()</span><br></pre></td></tr></table></figure>

<p>之后 , Anmail表就会多一行 . 同理也可以添加一行Dog</p>
<blockquote>
<ul>
<li>就是说 , 将所有的字段都揉进了Animal表中</li>
<li>Django的做法是创建三个表 , 并且以外键的形式链接</li>
</ul>
</blockquote>
</li>
<li><p>要想实现Django的做法只需将Animal改为抽象表:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animal</span>(<span class="params">db.Model</span>):</span></span><br><span class="line">    __abstract__ = <span class="literal">True</span></span><br><span class="line">    <span class="built_in">id</span> = db.Column(db.Integer,primary_key=<span class="literal">True</span>,autonicrement=<span class="literal">True</span>)</span><br><span class="line">    a_name = db.Column(db.String(<span class="number">16</span>))</span><br></pre></td></tr></table></figure>

<p>这样 , 当我们再执行上面插入的操作的使用就会创建一张Cat表和一张Dog表</p>
</li>
</ol>
<p>总结 :</p>
<ul>
<li>默认继承并不会报错,它会将多个模型的数据映射到一张表中,导致数据混乱,不能满足基本使用</li>
<li>抽象的模型是不会在数据库中产生映射的 : <code>__abstract__ = True</code></li>
</ul>
<h3 id="SQlalchemy的连接池"><a href="#SQlalchemy的连接池" class="headerlink" title="SQlalchemy的连接池"></a>SQlalchemy的连接池</h3><ul>
<li>Django和Flask默认都是有数据库连接池的</li>
</ul>
<h3 id="数据查询汇总"><a href="#数据查询汇总" class="headerlink" title="数据查询汇总"></a>数据查询汇总</h3><h4 id="获取单个对象"><a href="#获取单个对象" class="headerlink" title="获取单个对象"></a>获取单个对象</h4><ul>
<li>first</li>
<li>get</li>
<li>get_or_404</li>
</ul>
<h4 id="获取结果集"><a href="#获取结果集" class="headerlink" title="获取结果集"></a>获取结果集</h4><ul>
<li>all : 返回列表</li>
<li>filter : <ul>
<li>返回BaseQuery对象</li>
<li><code>__str__</code>输出的是这个对象数据的SQL</li>
<li>方法1 : <code>类名.属性名.魔术方法(临界值)</code>(eg : <code>Cat.query.filter(Dog.id.__eq__(2)).all()</code>)</li>
<li>方法2 : <code>类名.属性名 比较运算符 临界值</code>(eg : <code>Cat.qeury.filter(Cat.id==2)</code>)</li>
<li>方法3 : <code>Cat.qeury.filter_by(id=2)</code></li>
</ul>
</li>
<li>不同于DJango , 在flask-sqlalchemy中,all必须放在最后</li>
</ul>
<h3 id="运算符"><a href="#运算符" class="headerlink" title="运算符"></a>运算符</h3><ul>
<li>contains</li>
<li>startswith</li>
<li>endswith</li>
<li>in_</li>
<li>like</li>
<li>__gt__</li>
<li>__ge__</li>
<li>__lt__</li>
<li>__le__</li>
</ul>
<p>使用:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cats = Cat.query.<span class="built_in">filter</span>(Dog.<span class="built_in">id</span>.__eq__(<span class="number">2</span>)).<span class="built_in">all</span>()</span><br><span class="line">cats = Cat.query.<span class="built_in">filter</span>(Cat.name.contains(<span class="string">&#x27;猫&#x27;</span>))</span><br></pre></td></tr></table></figure>



<h3 id="筛选"><a href="#筛选" class="headerlink" title="筛选"></a>筛选</h3><ul>
<li>filter_by()</li>
<li>offest()</li>
<li>limit()</li>
<li>order_by()</li>
<li>get()</li>
<li>first()</li>
<li>paginate()</li>
</ul>
<p>使用 :</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 编写时offset和limit顺序无所谓 , 最后都是先执行offset</span></span><br><span class="line"><span class="comment"># 但是order_by必须在offset和limit的前面</span></span><br><span class="line">cats = Cat.query.offset(<span class="number">1</span>).limit(<span class="number">2</span>)</span><br></pre></td></tr></table></figure>



<h4 id="使用offset和limit模拟分页"><a href="#使用offset和limit模拟分页" class="headerlink" title="使用offset和limit模拟分页"></a>使用offset和limit模拟分页</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_dog</span>():</span></span><br><span class="line">    page = request.args.get(<span class="string">&#x27;page&#x27;</span>, <span class="number">1</span>,<span class="built_in">type</span>=<span class="built_in">int</span>)</span><br><span class="line">    per_page = request.args.get(<span class="string">&#x27;per_page&#x27;</span>,<span class="number">4</span>,<span class="built_in">type</span>=<span class="built_in">int</span>)</span><br><span class="line">    record = Dog.query.offset(per_page * (page -<span class="number">1</span>).limit(per_page))</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;xxx.html&#x27;</span>,record = record)</span><br></pre></td></tr></table></figure>

<p>之后访问<code>http://127.0.0.1:5000/user?page=2&amp;per_page=3</code>即可</p>
<h4 id="使用paginate分页"><a href="#使用paginate分页" class="headerlink" title="使用paginate分页"></a>使用paginate分页</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_with_page</span>():</span></span><br><span class="line">    dogs = Dog.query.paginate().items</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;Dog.html&#x27;</span>,dogs=dogs)</span><br></pre></td></tr></table></figure>

<p>此时<code>paginate()</code>方法会自动处理url中的<code>page参数</code>和<code>per_page参数</code></p>
<blockquote>
<p>paginate()的部分源码:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> request:</span><br><span class="line">    <span class="keyword">if</span> page <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            page = <span class="built_in">int</span>(request.args.get(<span class="string">&#x27;page&#x27;</span>, <span class="number">1</span>))</span><br><span class="line">        <span class="keyword">except</span> (TypeError, ValueError):</span><br><span class="line">            <span class="keyword">if</span> error_out:</span><br><span class="line">                abort(<span class="number">404</span>)</span><br><span class="line"></span><br><span class="line">            page = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> per_page <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            per_page = <span class="built_in">int</span>(request.args.get(<span class="string">&#x27;per_page&#x27;</span>, <span class="number">20</span>))</span><br><span class="line">        <span class="keyword">except</span> (TypeError, ValueError):</span><br><span class="line">            <span class="keyword">if</span> error_out:</span><br><span class="line">                abort(<span class="number">404</span>)</span><br><span class="line"></span><br><span class="line">            per_page = <span class="number">20</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="keyword">if</span> page <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        page = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> per_page <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        per_page = <span class="number">20</span></span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="常用分页手法"><a href="#常用分页手法" class="headerlink" title="常用分页手法"></a>常用分页手法</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@blue.route(<span class="params"><span class="string">&#x27;/getdogswithpage/&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_dogs_with_page</span>():</span></span><br><span class="line">    pagination = Dog.query.paginate()</span><br><span class="line">    per_page = request.args.get(<span class="string">&#x27;per_page&#x27;</span>,<span class="number">4</span>,<span class="built_in">type</span>=<span class="built_in">int</span>)</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;Dog.html&#x27;</span>,pagination=pagination,per_page=per_page)</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;ul&gt;</span><br><span class="line">    &#123;% for dog in pagination.items %&#125;</span><br><span class="line">        &lt;li&gt;&#123;&#123; dog.name &#125;&#125;&lt;/li&gt;</span><br><span class="line">    &#123;% endfor %&#125;</span><br><span class="line">&lt;/ul&gt;</span><br><span class="line"></span><br><span class="line">&lt;div class=pagination&gt;</span><br><span class="line">    &#123;% for page in pagination.iter_pages() %&#125;</span><br><span class="line">        &#123;% if page %&#125;</span><br><span class="line">            &#123;% if page != pagination.page %&#125;</span><br><span class="line">                &lt;a href=&quot;&#123;&#123; url_for(blue.getdogswithpage) &#125;&#125;?page=&#123;&#123; page &#125;&#125;&amp;per_page=&#123;&#123; per_page &#125;&#125;&quot;&gt;&#123;&#123; page &#125;&#125;&lt;/a&gt;</span><br><span class="line">            &#123;% else %&#125;</span><br><span class="line">                &lt;strong&gt;&#123;&#123; page &#125;&#125;&lt;/strong&gt;</span><br><span class="line">            &#123;% endif %&#125;</span><br><span class="line">        &#123;% else %&#125;</span><br><span class="line">            &lt;span class=ellipsis&gt;…&lt;/span&gt;</span><br><span class="line">        &#123;% endif %&#125;</span><br><span class="line">    &#123;% endfor %&#125;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>iter_pages源码:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">iter_pages</span>(<span class="params">self, left_edge=<span class="number">2</span>, left_current=<span class="number">2</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">                right_current=<span class="number">5</span>, right_edge=<span class="number">2</span></span>):</span></span><br><span class="line">    last = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> num <span class="keyword">in</span> xrange(<span class="number">1</span>, self.pages + <span class="number">1</span>):</span><br><span class="line">        <span class="keyword">if</span> num &lt;= left_edge <span class="keyword">or</span> \</span><br><span class="line">            (num &gt; self.page - left_current - <span class="number">1</span> <span class="keyword">and</span></span><br><span class="line">            num &lt; self.page + right_current) <span class="keyword">or</span> \</span><br><span class="line">            num &gt; self.pages - right_edge:</span><br><span class="line">            <span class="keyword">if</span> last + <span class="number">1</span> != num:</span><br><span class="line">                <span class="keyword">yield</span> <span class="literal">None</span></span><br><span class="line">            <span class="keyword">yield</span> num</span><br><span class="line">            last = num</span><br></pre></td></tr></table></figure>
</blockquote>
<p>Pagination对象的属性和方法:</p>
<ul>
<li>items</li>
<li>page</li>
<li>pages</li>
<li>prev</li>
<li>has_prev</li>
<li>perv_num</li>
<li>next</li>
<li>has_next</li>
<li>next_num</li>
</ul>
<h2 id="模板-1"><a href="#模板-1" class="headerlink" title="模板"></a>模板</h2><p>如果我们想获取APP外的template怎么办?</p>
<ol>
<li><p>可以<strong>在定义app的时候设置template的位置</strong>:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app = Flask(__name__,template_folder=<span class="string">&#x27;../templates&#x27;</span>)</span><br></pre></td></tr></table></figure></li>
<li><p>也可以<strong>在蓝图里设置</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">domains_app = Blueprint(<span class="string">&#x27;domains&#x27;</span>, __name__, template_folder=<span class="string">&#x27;templates&#x27;</span>, static_folder=<span class="string">&quot;static&quot;</span>)</span><br></pre></td></tr></table></figure></li>
</ol>
<blockquote>
<ol>
<li>模板路径默认在Flask(app)创建的路径下</li>
<li>如果想自己指定模板路径<ul>
<li>在Flask创建的时候,指定template_folder</li>
<li>在蓝图创建的时候,也可以templatefolder<ul>
<li>蓝图的<code>url_prefix</code>参数还可以指定此蓝图统一前缀:/xx</li>
</ul>
</li>
</ul>
</li>
</ol>
</blockquote>
<h3 id="静态资源"><a href="#静态资源" class="headerlink" title="静态资源"></a>静态资源</h3><ul>
<li>静态资源在Flask中是默认支持的</li>
<li>默认路径在和Flask同级别的static中</li>
<li>想要自己指定<ul>
<li>可以Flask创建的时候指定static_folde</li>
<li>也可以在蓝图中</li>
</ul>
</li>
<li>指定静态资源也是有路由的<ul>
<li>endpoint是static</li>
<li>参数有一个filename</li>
<li><code>&#123;&#123; url_for('static',filename='xxx') &#125;&#125;</code></li>
</ul>
</li>
</ul>
<h3 id="模板特殊的变量"><a href="#模板特殊的变量" class="headerlink" title="模板特殊的变量"></a>模板特殊的变量</h3><p>在一个 for 循环块中你可以访问这些特殊的变量:</p>
<table>
<thead>
<tr>
<th align="left">变量</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">loop.index</td>
<td align="left">当前循环迭代的次数（从 1 开始）</td>
</tr>
<tr>
<td align="left">loop.index0</td>
<td align="left">当前循环迭代的次数（从 0 开始）</td>
</tr>
<tr>
<td align="left">loop.revindex</td>
<td align="left">到循环结束需要迭代的次数（从 1 开始）</td>
</tr>
<tr>
<td align="left">loop.revindex0</td>
<td align="left">到循环结束需要迭代的次数（从 0 开始）</td>
</tr>
<tr>
<td align="left">loop.first</td>
<td align="left">如果是第一次迭代，为 True 。</td>
</tr>
<tr>
<td align="left">loop.last</td>
<td align="left">如果是最后一次迭代，为 True 。</td>
</tr>
<tr>
<td align="left">loop.length</td>
<td align="left">序列中的项目数。</td>
</tr>
<tr>
<td align="left">loop.cycle</td>
<td align="left">在一串序列间期取值的辅助函数。见下面示例程序。</td>
</tr>
</tbody></table>
<h3 id="自定义过滤器"><a href="#自定义过滤器" class="headerlink" title="自定义过滤器"></a>自定义过滤器</h3><p>过滤器的本质是函数。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.template_filter(<span class="params"><span class="string">&#x27;lireverse&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">do_listreverse</span>(<span class="params">li</span>):</span></span><br><span class="line">  <span class="comment"># 通过原列表创建一个新列表</span></span><br><span class="line">  temp_li = <span class="built_in">list</span>(li)</span><br><span class="line">  <span class="comment"># 将新列表进行返转</span></span><br><span class="line">  temp_li.reverse()</span><br><span class="line">  <span class="keyword">return</span> temp_li</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;h2&gt;my_array 原内容：&#123;&#123; my_array &#125;&#125;&lt;/h2&gt;</span><br><span class="line">&lt;h2&gt; my_array 反转：&#123;&#123; my_array | lireverse &#125;&#125;&lt;/h2&gt;</span><br></pre></td></tr></table></figure>



<h3 id="包含"><a href="#包含" class="headerlink" title="包含"></a>包含</h3><p>Jinja2模板中，除了宏和继承，还支持一种代码重用的功能，叫<code>包含(Include)</code>。它的功能是将另一个模板整个加载到当前模板中，并直接渲染。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;% include &#x27;hello.html&#x27; %&#125;</span><br><span class="line">或者</span><br><span class="line">&#123;% include &#x27;hello.html&#x27; ignore missing %&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;body&gt;</span><br><span class="line">    &#123;% include &#x27;其他模板文件&#x27; ignore missing %&#125;</span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>提示: ignore missing 加上后如果文件不存在,不会报错</p>
</blockquote>
<h3 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h3><ul>
<li>宏(Macro)、继承(Block)、包含(include)均能实现代码的复用。</li>
<li><strong>继承(Block)的本质是代码替换</strong>，一般用来实现多个页面中重复不变的区域。</li>
<li><strong>宏(Macro)的功能类似函数</strong>，可以传入参数，需要定义、调用。</li>
<li><strong>包含(include)是直接将目标模板文件整个渲染出来</strong>。</li>
</ul>
<h3 id="模板中特有的变量和函数"><a href="#模板中特有的变量和函数" class="headerlink" title="模板中特有的变量和函数"></a>模板中特有的变量和函数</h3><ul>
<li><p>config </p>
<blockquote>
<p>从模板中直接访问Flask当前的config对象:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;config.DEBUG&#125;&#125;</span><br></pre></td></tr></table></figure></blockquote>
</li>
<li><p>request</p>
<blockquote>
<p>就是flask中代表当前请求的request对象：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;request.url&#125;&#125;</span><br></pre></td></tr></table></figure></blockquote>
</li>
<li><p>g</p>
<blockquote>
<p>在视图函数中设置g变量的 name 属性的值，然后在模板中直接可以取出</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; g.name &#125;&#125;</span><br></pre></td></tr></table></figure></blockquote>
</li>
<li><p>url_for()</p>
<blockquote>
<p>url_for会根据传入的路由器函数名,返回该路由对应的URL,在模板中始终使用url_for()就可以安全的修改路由绑定的URL,则不比担心模板中渲染出错的链接:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;url_for(&#x27;home&#x27;)&#125;&#125;</span><br></pre></td></tr></table></figure></blockquote>
</li>
<li><p>get_flashed_messages()</p>
<blockquote>
<ul>
<li>这个函数会返回之前在flask中通过flask()传入的消息的列表，</li>
<li>flash函数的作用很简单,可以把由Python字符串表示的消息加入一个消息队列中，再使用get_flashed_message()函数取出它们并<strong>消费掉</strong>：</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;%for message in get_flashed_messages()%&#125;</span><br><span class="line">    &#123;&#123;message&#125;&#125;</span><br><span class="line">&#123;%endfor%&#125;</span><br></pre></td></tr></table></figure></blockquote>
</li>
</ul>
<h2 id="视图"><a href="#视图" class="headerlink" title="视图"></a>视图</h2><h3 id="Flask加载配置"><a href="#Flask加载配置" class="headerlink" title="Flask加载配置"></a>Flask加载配置</h3><p> Flask配置有以下三种方式：</p>
<ul>
<li><code>app.config.from_object()</code> : 从配置对象中加载(常用)</li>
<li><code>app.config.from_pyfile()</code> : 从配置文件中加载</li>
<li><code>app.config.from_envvar()</code> : 从环境变量中加载(了解)</li>
</ul>
<h2 id="项目拆分"><a href="#项目拆分" class="headerlink" title="项目拆分"></a>项目拆分</h2><ul>
<li>目的</li>
<li>代码结构更清晰</li>
</ul>
<p>拆分方案:</p>
<ul>
<li>一拆六</li>
<li>以前就有一个manage文件<ul>
<li>manage进行全局控制</li>
<li>应用初始化<ul>
<li>初始化配置</li>
<li>初始化路由</li>
<li>初始化第三方</li>
</ul>
</li>
<li>配置文件<ul>
<li>配置项目所需各种信息</li>
</ul>
</li>
<li>视图函数<ul>
<li>用来处理业务逻辑,协调模板和模型</li>
</ul>
</li>
<li>模型文件<ul>
<li>定义模型</li>
</ul>
</li>
<li>外部扩展<ul>
<li>统一管理扩展</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><img src="/images/1560502052652.png" alt="1560502052652"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># manage.py</span></span><br><span class="line"><span class="keyword">from</span> flask_script <span class="keyword">import</span> Manager</span><br><span class="line"><span class="keyword">from</span> app <span class="keyword">import</span> create_app</span><br><span class="line"></span><br><span class="line">app = create_app()</span><br><span class="line">manager = Manager(app=app)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    manager.run()</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># app/__init__.py</span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> app.ext <span class="keyword">import</span> init_ext</span><br><span class="line"><span class="keyword">from</span> settings <span class="keyword">import</span> envs</span><br><span class="line"><span class="keyword">from</span> app.views <span class="keyword">import</span> init_blue</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">create_app</span>():</span></span><br><span class="line">    <span class="comment"># 创建app</span></span><br><span class="line">    app = Flask(__name__)</span><br><span class="line">    <span class="comment"># 初始化配置</span></span><br><span class="line">    app.config.from_object(envs.get(<span class="string">&#x27;develop&#x27;</span>))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 注册蓝图,初始化蓝图</span></span><br><span class="line">    init_blue(app)</span><br><span class="line">    <span class="comment"># 初始化第三方插件</span></span><br><span class="line">    init_ext(app)</span><br><span class="line">    <span class="keyword">return</span> app</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># views.py</span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Blueprint</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> app.ext <span class="keyword">import</span> db</span><br><span class="line"><span class="keyword">from</span> app.models <span class="keyword">import</span> Person</span><br><span class="line"></span><br><span class="line">blue = Blueprint(<span class="string">&#x27;first_blue&#x27;</span>,__name__)</span><br><span class="line"><span class="comment"># 初始化蓝图的函数</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">init_blue</span>(<span class="params">app</span>):</span></span><br><span class="line">    app.register_blueprint(blueprint=blue)</span><br><span class="line"></span><br><span class="line"><span class="meta">@blue.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span>():</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;index.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@blue.route(<span class="params"><span class="string">&#x27;/addperson/&#x27;</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add_person</span>():</span></span><br><span class="line">    p = Person()</span><br><span class="line">    p.p_name = <span class="string">&#x27;liangbo&#x27;</span></span><br><span class="line">    db.session.add(p)</span><br><span class="line">    db.session.commit()</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;Person Add Success&#x27;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ext.py</span></span><br><span class="line"><span class="keyword">from</span> flask_sqlalchemy <span class="keyword">import</span> SQLAlchemy</span><br><span class="line"></span><br><span class="line">db = SQLAlchemy()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">init_ext</span>(<span class="params">app</span>):</span></span><br><span class="line">    db.init_app(app=app)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># settings.py</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_db_url</span>(<span class="params">dbinfo</span>):</span></span><br><span class="line">    ENGINE = dbinfo.get(<span class="string">&#x27;ENGINE&#x27;</span>) <span class="keyword">or</span> <span class="string">&#x27;mysql&#x27;</span></span><br><span class="line">    DRIVER = dbinfo.get(<span class="string">&#x27;DRIVER&#x27;</span>) <span class="keyword">or</span> <span class="string">&#x27;pymysql&#x27;</span></span><br><span class="line">    USER = dbinfo.get(<span class="string">&#x27;USER&#x27;</span>) <span class="keyword">or</span> <span class="string">&#x27;root&#x27;</span></span><br><span class="line">    PASSWORD = dbinfo.get(<span class="string">&#x27;PASSWORD&#x27;</span>) <span class="keyword">or</span> <span class="string">&#x27;root&#x27;</span></span><br><span class="line">    HOST = dbinfo.get(<span class="string">&#x27;HOST&#x27;</span>) <span class="keyword">or</span> <span class="string">&#x27;localhost&#x27;</span></span><br><span class="line">    PORT = dbinfo.get(<span class="string">&#x27;PORT&#x27;</span>) <span class="keyword">or</span> <span class="string">&#x27;3306&#x27;</span></span><br><span class="line">    NAME = dbinfo.get(<span class="string">&#x27;NAME&#x27;</span>) <span class="keyword">or</span> <span class="string">&#x27;test&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#123;&#125;+&#123;&#125;://&#123;&#125;:&#123;&#125;@&#123;&#125;/&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(ENGINE,DRIVER,USER,PASSWORD,HOST,PORT,NAME)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Config</span>:</span></span><br><span class="line">    DEBUG  = <span class="literal">False</span></span><br><span class="line">    TESTING = <span class="literal">False</span></span><br><span class="line">    SECRET_KEY = <span class="string">&#x27;1346537457asdasd&#x27;</span></span><br><span class="line">    SQLALCHEMY_TRACK_MODIFICATIONS = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 开发环境设置</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DevelopCofig</span>(<span class="params">Config</span>):</span></span><br><span class="line">    DEBUG = <span class="literal">True</span></span><br><span class="line">    DATABASE = &#123;</span><br><span class="line">        <span class="string">&#x27;ENGINE&#x27;</span>:<span class="string">&#x27;mysql&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;DRIVER&#x27;</span>:<span class="string">&#x27;pymysql&#x27;</span></span><br><span class="line">        <span class="string">&#x27;USER&#x27;</span>:<span class="string">&#x27;root&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;PASSWORD&#x27;</span>:<span class="string">&#x27;XXX&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;HOST&#x27;</span>:<span class="string">&#x27;localhost&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;PORT&#x27;</span>:<span class="string">&#x27;3306&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;NAME&#x27;</span>:<span class="string">&#x27;firstflask&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    SQLALCHEMY_DATABASE_URI = get_db_url(DATABASE)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试环境设置</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestingCofig</span>(<span class="params">Config</span>):</span></span><br><span class="line">    TESTING = <span class="literal">True</span></span><br><span class="line">    DATABASE = &#123;</span><br><span class="line">        <span class="string">&#x27;ENGINE&#x27;</span>:<span class="string">&#x27;mysql&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;DRIVER&#x27;</span>:<span class="string">&#x27;pymysql&#x27;</span></span><br><span class="line">        <span class="string">&#x27;USER&#x27;</span>:<span class="string">&#x27;root&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;PASSWORD&#x27;</span>:<span class="string">&#x27;XXX&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;HOST&#x27;</span>:<span class="string">&#x27;localhost&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;PORT&#x27;</span>:<span class="string">&#x27;3306&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;NAME&#x27;</span>:<span class="string">&#x27;firstflask&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    SQLALCHEMY_DATABASE_URI = get_db_url(DATABASE)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 演示环境设置</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">StagingCofig</span>(<span class="params">Config</span>):</span></span><br><span class="line">    DATABASE = &#123;</span><br><span class="line">        <span class="string">&#x27;ENGINE&#x27;</span>:<span class="string">&#x27;mysql&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;DRIVER&#x27;</span>:<span class="string">&#x27;pymysql&#x27;</span></span><br><span class="line">        <span class="string">&#x27;USER&#x27;</span>:<span class="string">&#x27;root&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;PASSWORD&#x27;</span>:<span class="string">&#x27;XXX&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;HOST&#x27;</span>:<span class="string">&#x27;localhost&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;PORT&#x27;</span>:<span class="string">&#x27;3306&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;NAME&#x27;</span>:<span class="string">&#x27;firstflask&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    SQLALCHEMY_DATABASE_URI = get_db_url(DATABASE)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 线上环境设置</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ProductCofig</span>(<span class="params">Config</span>):</span></span><br><span class="line">    DATABASE = &#123;</span><br><span class="line">        <span class="string">&#x27;ENGINE&#x27;</span>:<span class="string">&#x27;mysql&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;DRIVER&#x27;</span>:<span class="string">&#x27;pymysql&#x27;</span></span><br><span class="line">        <span class="string">&#x27;USER&#x27;</span>:<span class="string">&#x27;root&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;PASSWORD&#x27;</span>:<span class="string">&#x27;XXX&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;HOST&#x27;</span>:<span class="string">&#x27;localhost&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;PORT&#x27;</span>:<span class="string">&#x27;3306&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;NAME&#x27;</span>:<span class="string">&#x27;firstflask&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">    SQLALCHEMY_DATABASE_URI = get_db_url(DATABASE)</span><br><span class="line"></span><br><span class="line">envs = &#123;</span><br><span class="line">    <span class="string">&#x27;develop&#x27;</span>: DevelopCofig,</span><br><span class="line">    <span class="string">&#x27;testing&#x27;</span>: TestingCofig,</span><br><span class="line">    <span class="string">&#x27;staging&#x27;</span>: StagingCofig,</span><br><span class="line">    <span class="string">&#x27;product&#x27;</span>: ProductCofig,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># models.py</span></span><br><span class="line"><span class="keyword">from</span> app.ext <span class="keyword">import</span> db</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>(<span class="params">db.Model</span>):</span></span><br><span class="line">    p_id = db.Column(db.Integer,primary_key=<span class="literal">True</span>,autoincrement=<span class="literal">True</span>)</span><br><span class="line">    p_name = db.Column(db.String(<span class="number">16</span>))</span><br></pre></td></tr></table></figure>

<blockquote>
<p>blueprint直接使用装饰器 , 用来注册路由</p>
</blockquote>
<p><img src="/images/1572163410753.png" alt="1572163410753"></p>
</div></div><div class="post-main post-comment"></div></article><link rel="stylesheet" type="text/css" href="/css/font.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.css"><script src="//cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script><script src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script>$(document).ready(function() {
  $(".fancybox").fancybox();
});
</script></body></html>
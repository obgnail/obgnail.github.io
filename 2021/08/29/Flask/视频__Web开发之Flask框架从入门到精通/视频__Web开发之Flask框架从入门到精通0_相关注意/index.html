<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content=" id=&quot;数据库优化&quot;&gt;&lt;a href=&quot;#数据库优化&quot; class=&quot;headerlink&quot; title=&quot;数据库优化&quot;&gt;&lt;/a&gt;数据库优化&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;数据库其实存在&lt;code&gt;连接池&lt;/code&gt;的&lt;/li&gt;
&lt;li&gt;连接池维护着一定数量的数据库连接&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&quot;current-app&quot;&gt;&lt;a href=&quot;#current-app&quot; class=&quot;headerlink&quot; title=&quot;current_app&quot;&gt;&lt;/a&gt;current_app&lt;/h2&gt;&lt;p&gt;&lt;strong&gt;current_app只有在项目启动之后才能使用 , 项目没有启动时不能使用&lt;/strong&gt;"><link rel="stylesheet" type="text/css" href="/css/normalize.css"><link rel="stylesheet" type="text/css" href="/css/highlight.css"><link rel="stylesheet" type="text/css" href="/css/noise.css"><title>Web开发之Flask框架从入门到精通0_相关注意 | 凉薄的自动书记人偶</title><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><meta name="generator" content="Hexo 5.4.0"></head><body><article class="wrapper"><div class="post-main"><div class="nav"><nav class="container"><a class="sidebar-nav-item active" href="/">Home</a><a class="sidebar-nav-item" href="/archives">Tags</a><a class="sidebar-nav-item" href="/About">About</a></nav><div class="container post-meta"><div class="post-tags"><a class="post-tag-link" href="/tags/Flask/" rel="tag">Flask</a></div><div class="post-time">2021-08-29</div></div></div><div class="container post-header"><h1>Web开发之Flask框架从入门到精通0_相关注意</h1></div><div class="container post-toc"><details class="toc"><summary class="toc-accordion">Table of Contents</summary><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BC%98%E5%8C%96"><span class="toc-number">1.</span> <span class="toc-text">数据库优化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#current-app"><span class="toc-number">2.</span> <span class="toc-text">current_app</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CSRF%E6%94%BB%E5%87%BB%E7%A4%BA%E6%84%8F%E5%9B%BE"><span class="toc-number">3.</span> <span class="toc-text">CSRF攻击示意图</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%98%B2%E6%AD%A2CSRF%E6%94%BB%E5%87%BB"><span class="toc-number">4.</span> <span class="toc-text">防止CSRF攻击</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%86%85%E7%BD%AE%E7%9A%84%E5%AF%86%E7%A0%81%E5%8A%A0%E5%AF%86%E8%A7%A3%E5%AF%86"><span class="toc-number">5.</span> <span class="toc-text">使用内置的密码加密解密</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E5%A4%8D%E7%94%A8%E7%9A%84%E6%96%B9%E6%B3%95"><span class="toc-number">6.</span> <span class="toc-text">代码复用的方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#flash-%E6%96%B9%E6%B3%95%E7%9A%84%E6%9C%AC%E8%B4%A8"><span class="toc-number">7.</span> <span class="toc-text">flash()方法的本质</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#UserModel%E5%85%B3%E4%BA%8E%E5%AF%86%E7%A0%81%E7%9A%84%E8%AE%BE%E7%BD%AE"><span class="toc-number">8.</span> <span class="toc-text">UserModel关于密码的设置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9D%83%E9%99%90%E7%9A%84%E4%B8%A4%E7%A7%8D%E8%AE%BE%E8%AE%A1"><span class="toc-number">9.</span> <span class="toc-text">权限的两种设计</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%95%E4%B8%AA%E5%AD%97%E6%AE%B5%E5%AE%9E%E7%8E%B0%E6%89%80%E6%9C%89%E5%8A%9F%E8%83%BD"><span class="toc-number">9.1.</span> <span class="toc-text">单个字段实现所有功能</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B9%E6%A1%88%E4%B8%80-Linux%E6%9D%83%E9%99%90%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F"><span class="toc-number">9.1.1.</span> <span class="toc-text">方案一 : Linux权限设计模式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B9%E6%A1%88%E4%BA%8C-%E5%8C%85%E5%90%AB%E6%A8%A1%E5%BC%8F"><span class="toc-number">9.1.2.</span> <span class="toc-text">方案二 : 包含模式</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E8%A1%A8%E8%AE%BE%E8%AE%A1%E6%9D%83%E9%99%90"><span class="toc-number">9.2.</span> <span class="toc-text">多表设计权限</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E4%BA%8B%E5%8A%A1"><span class="toc-number">10.</span> <span class="toc-text">使用事务</span></a></li></ol></details></div><div class="container post-content"><h2 id="数据库优化"><a href="#数据库优化" class="headerlink" title="数据库优化"></a>数据库优化</h2><ol>
<li>数据库其实存在<code>连接池</code>的</li>
<li>连接池维护着一定数量的数据库连接</li>
</ol>
<h2 id="current-app"><a href="#current-app" class="headerlink" title="current_app"></a>current_app</h2><p><strong>current_app只有在项目启动之后才能使用 , 项目没有启动时不能使用</strong></p>
<h2 id="CSRF攻击示意图"><a href="#CSRF攻击示意图" class="headerlink" title="CSRF攻击示意图"></a>CSRF攻击示意图</h2><p><img src="/images/CSRF%E6%94%BB%E5%87%BB%E8%BF%87%E7%A8%8B.png" alt="CSRF攻击过程"></p>
<h2 id="防止CSRF攻击"><a href="#防止CSRF攻击" class="headerlink" title="防止CSRF攻击"></a>防止CSRF攻击</h2><ol>
<li>在客户端向后端请求界面数据的时候，后端会往响应中的 cookie 中设置 csrf_token 的值</li>
<li>在 Form 表单中添加一个隐藏的的字段，值也是 csrf_token</li>
<li>在用户点击提交的时候，会带上这两个值向后台发起请求</li>
<li>后端接受到请求，以会以下几件事件：<ul>
<li>从 cookie中取出 csrf_token</li>
<li>从 表单数据中取出来隐藏的 csrf_token 的值</li>
<li>进行对比</li>
</ul>
</li>
<li>如果比较之后两值一样，那么代表是正常的请求，如果没取到或者比较不一样，代表不是正常的请求，不执行下一步操作</li>
</ol>
<h2 id="使用内置的密码加密解密"><a href="#使用内置的密码加密解密" class="headerlink" title="使用内置的密码加密解密"></a>使用内置的密码加密解密</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> werkzeug.security <span class="keyword">import</span> generate_password_hash, check_password_hash</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置密码</span></span><br><span class="line">psw = request.form.get(<span class="string">&#x27;password&#x27;</span>)</span><br><span class="line">hash_psw = generate_password_hash(psw)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查密码</span></span><br><span class="line">student = Student.query.filter_by(<span class="built_in">id</span>=<span class="number">123</span>)</span><br><span class="line">psw = request.form.get(<span class="string">&#x27;password&#x27;</span>)</span><br><span class="line"><span class="keyword">if</span> checkout_password_hash(student.password,psw):</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;ok&#x27;</span></span><br></pre></td></tr></table></figure>

<p>上面两个方法应该封装到StudentModel上</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserOauthModel</span>(<span class="params">db.Model</span>):</span></span><br><span class="line">    _password = db.Column(db.String(<span class="number">54</span>), nullable=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">password</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self._password</span><br><span class="line"></span><br><span class="line"><span class="meta">    @password.setter</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">password</span>(<span class="params">self,psw</span>):</span></span><br><span class="line">        self._password = generate_password_hash(psw)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">check_password</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> checkout_password_hash(self._password,psw)</span><br></pre></td></tr></table></figure>



<h2 id="代码复用的方法"><a href="#代码复用的方法" class="headerlink" title="代码复用的方法"></a>代码复用的方法</h2><ul>
<li>装饰器</li>
<li>钩子函数</li>
<li>封装函数</li>
<li>创建父类</li>
</ul>
<h2 id="flash-方法的本质"><a href="#flash-方法的本质" class="headerlink" title="flash()方法的本质"></a>flash()方法的本质</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@index_router.route(<span class="params"><span class="string">&#x27;/login&#x27;</span>, methods=[<span class="string">&quot;GET&quot;</span>, <span class="string">&quot;POST&quot;</span>, ]</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span>():</span></span><br><span class="line">    form = UserOauthForm()</span><br><span class="line">    <span class="keyword">if</span> form.validate_on_submit():</span><br><span class="line">        form = UserOauthForm(formdata=request.form)</span><br><span class="line">        user = Cache.get_user(form.data.get(<span class="string">&#x27;emp_id&#x27;</span>))</span><br><span class="line">        <span class="keyword">if</span> user:</span><br><span class="line">            <span class="comment"># 登录用户</span></span><br><span class="line">            login_user(user)</span><br><span class="line">            flash(<span class="string">f&quot;欢迎登陆: 工号<span class="subst">&#123;user.emp_id&#125;</span>&quot;</span>, category=<span class="string">&quot;success&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> redirect(request.args.get(<span class="string">&#x27;next&#x27;</span>) <span class="keyword">or</span> url_for(<span class="string">&quot;user.emp_detail&quot;</span>))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            Cache.update_user(user)</span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&#x27;user/login.html&#x27;</span>, form=form)</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;% with messages = get_flashed_messages() %&#125;</span><br><span class="line">&#123;% if messages %&#125;</span><br><span class="line">	&#123;% for message in messages %&#125;</span><br><span class="line">		&lt;div class=&quot;alert alert-success&quot; style=&quot;text-align: center;&quot;&gt;</span><br><span class="line">			&lt;button aria-hidden=&quot;true&quot; data-dismiss=&quot;alert&quot; class=&quot;close&quot; type=&quot;button&quot;&gt;×&lt;/button&gt;</span><br><span class="line">			&lt;strong&gt;&#123;&#123; message &#125;&#125;&lt;/strong&gt;</span><br><span class="line">		&lt;/div&gt;</span><br><span class="line">	&#123;% endfor %&#125;</span><br><span class="line">&#123;% endif %&#125;</span><br><span class="line">&#123;% endwith %&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>flash本质就是session</li>
<li>后台的flash函数将信息写入session中 , 前台再从session取出,输出到相应的位置 , 然后再次传入后台的时候就将这个session去除</li>
<li>这就能解释flash()的功能 : 将信息输出到<strong>下一个页面</strong>,而且只会输出一次</li>
</ul>
<h2 id="UserModel关于密码的设置"><a href="#UserModel关于密码的设置" class="headerlink" title="UserModel关于密码的设置"></a>UserModel关于密码的设置</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span>(<span class="params">db.Model</span>):</span></span><br><span class="line">    <span class="built_in">id</span> = db.Column(db.Integer , primerry_key=<span class="literal">True</span>)</span><br><span class="line">    username = db.Column(db.String(<span class="number">32</span>),unique=<span class="literal">True</span>)</span><br><span class="line">    _password = db.Column(db.String(<span class="number">256</span>))</span><br><span class="line">    permission = db.Column(db.Integer , default=PERMISSION_NONE)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">password</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">raise</span> Exception(<span class="string">&quot;cant access&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @password.setter</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">password</span>(<span class="params">self,psw</span>):</span></span><br><span class="line">        self._password = genrate_password_hash(psw)</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">check_password</span>(<span class="params">self,psw</span>):</span></span><br><span class="line">        <span class="keyword">return</span> check_password_hash(self._password,psw)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">check_permission</span>(<span class="params">self,permission</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        检测是否有某个权限</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="comment"># 如果是黑名单用户,则没有权限</span></span><br><span class="line">        <span class="keyword">if</span> BLACK_USER &amp; self.permission == BLACK_USER:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">return</span> permission &amp; self.permission == permission</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">PERMISSION_NONE = <span class="number">0</span></span><br><span class="line">BLACK_USER = <span class="number">1</span></span><br><span class="line">COMMON_USER = <span class="number">2</span></span><br><span class="line">VIP_USER = <span class="number">4</span></span><br></pre></td></tr></table></figure>





<h2 id="权限的两种设计"><a href="#权限的两种设计" class="headerlink" title="权限的两种设计"></a>权限的两种设计</h2><h3 id="单个字段实现所有功能"><a href="#单个字段实现所有功能" class="headerlink" title="单个字段实现所有功能"></a>单个字段实现所有功能</h3><p>类似于Linux权限设计 , 一个字段可以代表多种权限 : <code>rwx</code></p>
<h4 id="方案一-Linux权限设计模式"><a href="#方案一-Linux权限设计模式" class="headerlink" title="方案一 : Linux权限设计模式"></a>方案一 : Linux权限设计模式</h4><ul>
<li>完全和Linux中一样 , 使用二进制 </li>
<li>每一种权限使用一个不重复的二进制确定</li>
<li>所有的初始权限值都是2的n次幂</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">BLACK_USER = <span class="number">1</span></span><br><span class="line">COMMON_USER = <span class="number">2</span></span><br><span class="line">VIP_USER = <span class="number">4</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, permission</span>):</span></span><br><span class="line">        self.permission = permission</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">me = User(permission=<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">check_permissin</span>(<span class="params">user,permission</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    检测user是否拥有某个权限</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> user.permission &amp; permission == permission</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">res = check_permissin(me,VIP_USER)</span><br><span class="line"><span class="built_in">print</span>(res)</span><br></pre></td></tr></table></figure>



<h4 id="方案二-包含模式"><a href="#方案二-包含模式" class="headerlink" title="方案二 : 包含模式"></a>方案二 : 包含模式</h4><ul>
<li>只是给一个数值</li>
<li>数值越大权限越高 , 包含数值小的所有权限</li>
</ul>
<h3 id="多表设计权限"><a href="#多表设计权限" class="headerlink" title="多表设计权限"></a>多表设计权限</h3><ul>
<li>用户表</li>
<li>权限表</li>
<li>用户权限表(用户表和权限表多对多的关系)</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span>(<span class="params">db.Model</span>):</span></span><br><span class="line">    <span class="built_in">id</span> = db.Column(db.Integer, primerry_key=<span class="literal">True</span>)</span><br><span class="line">    username = db.Column(db.String(<span class="number">32</span>), unique=<span class="literal">True</span>)</span><br><span class="line">    _password = db.Column(db.String(<span class="number">256</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Permission</span>(<span class="params">db.Model</span>):</span></span><br><span class="line">    p_name = db.Column(db.Integer,db.ForerginKey(User.<span class="built_in">id</span>))</span><br><span class="line">    c_persmission_id = db.Column(db.Integer,db.ForerginKey(Permission.<span class="built_in">id</span>))</span><br></pre></td></tr></table></figure>



<h2 id="使用事务"><a href="#使用事务" class="headerlink" title="使用事务"></a>使用事务</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># flask</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># 这里写sql语句组 一旦发生异常执行rollback() 相当于什么都没执行</span></span><br><span class="line">        connect.commit()</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;OK&#x27;</span></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> error:</span><br><span class="line">        <span class="built_in">print</span>(error)</span><br><span class="line">        connect.rollback()    <span class="comment"># 发生异常时执行回滚</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;Err&#x27;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># django</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hello_transaction</span>(<span class="params">request</span>):</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">with</span> transaction.atomic():</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        transaction.rollback()</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        transaction.commit()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;hello&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># or</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">welcome_transaction</span>(<span class="params">request</span>):</span></span><br><span class="line">    save_point = transaction.savepoint()</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        transaction.savepoint_rollback(save_point)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        transaction.savepoint_commit(save_point)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">&#x27;welcome&#x27;</span>)</span><br></pre></td></tr></table></figure>























</div></div></article><link rel="stylesheet" type="text/css" href="/css/font.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.css"><script src="//cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script><script src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script>$(document).ready(function() {
  $(".fancybox").fancybox();
});
</script></body></html>
<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content=" id=&quot;视图&quot;&gt;&lt;a href=&quot;#视图&quot; class=&quot;headerlink&quot; title=&quot;视图&quot;&gt;&lt;/a&gt;视图&lt;/h1&gt;&lt;h2 id=&quot;概述&quot;&gt;&lt;a href=&quot;#概述&quot; class=&quot;headerlink&quot; title=&quot;概述&quot;&gt;&lt;/a&gt;概述&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;作用:&lt;br&gt;视图接受web请求,并响应web请求.&lt;/li&gt;
&lt;li&gt;本质:&lt;br&gt;视图就是python中的函数&lt;/li&gt;
&lt;li&gt;响应的内容:&lt;ul&gt;
&lt;li&gt;网页:&lt;ol&gt;
&lt;li&gt;重定向&lt;/li&gt;
&lt;li&gt;错误视图:&lt;br&gt;404错误.&lt;br&gt;500错误.(服务器内部请求)&lt;br&gt;400错误.&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;JSON数据&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&quot;URL配置&quot;&gt;&lt;a href=&quot;#URL配置&quot; class=&quot;headerlink&quot; title=&quot;URL配置&quot;&gt;&lt;/a&gt;URL配置&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;&lt;p&gt;配置流程:"><link rel="stylesheet" type="text/css" href="/css/normalize.css"><link rel="stylesheet" type="text/css" href="/css/highlight.css"><link rel="stylesheet" type="text/css" href="/css/noise.css"><title>千锋教育2_视图与模板 | 凉薄的自动书记人偶</title><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><meta name="generator" content="Hexo 5.4.0"></head><body><article class="wrapper"><div class="post-main"><div class="nav"><nav class="container"><a class="sidebar-nav-item active" href="/">Home</a></nav><div class="container post-meta"><div class="post-tags"><a class="post-tag-none-link" href="/tags/Django/" rel="tag">Django</a></div><div class="post-time">2021-08-29</div></div></div><div class="container post-header"><h1>千锋教育2_视图与模板</h1></div><div class="container post-toc"><details class="toc"><summary class="toc-accordion">Table of Contents</summary><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%A7%86%E5%9B%BE"><span class="toc-number">1.</span> <span class="toc-text">视图</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0"><span class="toc-number">1.1.</span> <span class="toc-text">概述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#URL%E9%85%8D%E7%BD%AE"><span class="toc-number">1.2.</span> <span class="toc-text">URL配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%86%E5%9B%BE%E5%87%BD%E6%95%B0"><span class="toc-number">1.3.</span> <span class="toc-text">视图函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HttpRequest%E5%AF%B9%E8%B1%A1"><span class="toc-number">1.4.</span> <span class="toc-text">HttpRequest对象</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HttpResponse%E5%AF%B9%E8%B1%A1"><span class="toc-number">1.5.</span> <span class="toc-text">HttpResponse对象:</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%8A%B6%E6%80%81%E4%BF%9D%E6%8C%81"><span class="toc-number">1.6.</span> <span class="toc-text">状态保持:</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%A8%A1%E7%89%88"><span class="toc-number">2.</span> <span class="toc-text">模版</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0-1"><span class="toc-number">2.1.</span> <span class="toc-text">概述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89%E6%A8%A1%E6%9D%BF"><span class="toc-number">2.2.</span> <span class="toc-text">定义模板</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%8D%E5%90%91%E8%A7%A3%E6%9E%90"><span class="toc-number">2.3.</span> <span class="toc-text">反向解析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A8%A1%E6%9D%BF%E7%BB%A7%E6%89%BF"><span class="toc-number">2.4.</span> <span class="toc-text">模板继承</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HTML%E8%BD%AC%E4%B9%89"><span class="toc-number">2.5.</span> <span class="toc-text">HTML转义</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CSRF"><span class="toc-number">2.6.</span> <span class="toc-text">CSRF</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%AA%8C%E8%AF%81%E7%A0%81"><span class="toc-number">2.7.</span> <span class="toc-text">验证码</span></a></li></ol></li></ol></details></div><div class="container post-content"><h1 id="视图"><a href="#视图" class="headerlink" title="视图"></a>视图</h1><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><ol>
<li>作用:<br>视图接受web请求,并响应web请求.</li>
<li>本质:<br>视图就是python中的函数</li>
<li>响应的内容:<ul>
<li>网页:<ol>
<li>重定向</li>
<li>错误视图:<br>404错误.<br>500错误.(服务器内部请求)<br>400错误.</li>
</ol>
</li>
<li>JSON数据</li>
</ul>
</li>
</ol>
<h2 id="URL配置"><a href="#URL配置" class="headerlink" title="URL配置"></a>URL配置</h2><ol>
<li><p>配置流程:</p>
<ul>
<li><p>指定<strong>根级</strong>url配置文件:<br>在settings.py的ROOT_URLCONF选项</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ROOT_URLCONF = <span class="string">&#x27;me.urls&#x27;</span></span><br></pre></td></tr></table></figure></li>
<li><p>urlpatterns:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.conf.urls <span class="keyword">import</span> url,include</span><br><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    url(<span class="string">r&#x27;^admin/&#x27;</span>, admin.site.urls),</span><br><span class="line">    url(<span class="string">r&#x27;^&#x27;</span>,include(<span class="string">&#x27;myapp.urls&#x27;</span>))</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>一个url实例的列表,元素是url对象</p>
</li>
<li><p>url对象的三参数:</p>
<ol>
<li><p>正则表达式</p>
</li>
<li><p>视图名称</p>
</li>
<li><p>名称(之后再讲)</p>
<p>url匹配的注意事项:</p>
</li>
<li><p>如果想从url中获取一个值,需要对正则加小括号形成分组.</p>
</li>
<li><p><strong>匹配正则前方不需要添加反斜杠.</strong><br>因为都是在最后加的.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">url(<span class="string">r&#x27;^students/$&#x27;</span>,views.index)</span><br></pre></td></tr></table></figure></li>
</ol>
</li>
</ul>
</li>
<li><p>引入其他其他url配置:</p>
<p> 在应用中创建urls.py文件,定义本应用的url配置.<br> 在工程urls.py文件中使用include()方法</p>
 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">urlpatterns = [</span><br><span class="line">    url(<span class="string">r&#x27;^admin/&#x27;</span>, admin.site.urls),</span><br><span class="line">    url(<span class="string">r&#x27;^&#x27;</span>,include(<span class="string">&#x27;myapp.urls&#x27;</span>))</span><br><span class="line">]</span><br></pre></td></tr></table></figure></li>
</ol>
<ul>
<li><p>ulr的反向解析:</p>
<ol>
<li>概述:<br>如果在视图,模板中使用了硬编码链接,在rul配置发生改变时,动态生成链接的地址.</li>
<li>解决:在使用链接时,通过url配置的名称,动态生成url地址</li>
<li>作用:使用url模板</li>
</ol>
</li>
</ul>
<h2 id="视图函数"><a href="#视图函数" class="headerlink" title="视图函数"></a>视图函数</h2><ol>
<li><p>定义视图:<br> 本质:一个函数.<br>视图参数:</p>
<ul>
<li><strong>一个HttpRequest的实例</strong>.</li>
<li>通过正则表达式获取的参数.</li>
</ul>
<p>位置:在views.py中定义</p>
</li>
<li><p>错误视图:</p>
<ul>
<li><p>404视图:</p>
<ol>
<li><p>找不到网页时返回(url匹配不成功时).</p>
</li>
<li><p>404.html不必匹配视图,<strong>在templates目录下定义404.html</strong>即可</p>
</li>
<li><p>django会自动给404.html传递一个request_path参数(就是错误的路径)</p>
</li>
<li><p>配置settings.py:<br>debug:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 如果为True,则永远不会调用404.html</span></span><br><span class="line">DEBUG = <span class="literal">False</span></span><br></pre></td></tr></table></figure>

<p>allowed_hosts:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 允许任何人访问</span></span><br><span class="line">ALLOWED_HOSTS = [*]</span><br></pre></td></tr></table></figure></li>
</ol>
</li>
<li><p>500视图:<br>在视图代码中出现错误(服务器代码)</p>
</li>
<li><p>400视图:<br>错误出现在客户的操作.</p>
</li>
</ul>
</li>
</ol>
<p>​     </p>
<h2 id="HttpRequest对象"><a href="#HttpRequest对象" class="headerlink" title="HttpRequest对象"></a>HttpRequest对象</h2><ul>
<li><p>概述:<br> 服务器接收http请求后,会根据报文创建HttpRequest对象.<br> 视图的第一个参数就是HttpRequest.<br> HttpRequest对象是django创建的,之后调用视图时传递给视图.</p>
</li>
<li><p>属性:</p>
<ol>
<li><p>path:<br>请求的完整路径(不包含域名和端口)</p>
</li>
<li><p>method:<br>请求的方式</p>
</li>
<li><p>encoding:<br>就是请求响应头的accept-encoding参数,<br>表示浏览器提交的数据的编码方式.一般为UTF-8</p>
</li>
<li><p>GET:<br>类似于字典的对象,包含了get请求的所有参数<br>(比方说,当你传递的url为<a target="_blank" rel="noopener" href="http://www.baidu.com/?a=1&amp;b=2A&amp;c=3,get%E5%AF%B9%E8%B1%A1%E5%B0%B1%E6%98%AF%7B&#39;a&#39;:1,&#39;b&#39;:2,&#39;c&#39;:3}">www.baidu.com/?a=1&amp;b=2A&amp;c=3,get对象就是{&#39;a&#39;:1,&#39;b&#39;:2,&#39;c&#39;:3}</a>)</p>
</li>
<li><p>POST:</p>
<p>类似于字典的对象,包含了post请求的所有参数.</p>
</li>
<li><p>FIELS:<br>类似于字典的对象,包含了所有上传的文件.</p>
</li>
<li><p>COOKIES:<br>字典,包含所有的cookies</p>
</li>
<li><p>session:<br>类似字典的对象,表示当前会话</p>
</li>
</ol>
</li>
<li><p>方法:</p>
<p> is_ajax():<br> 如果是通过XMLHttpRequst发起的,返回True</p>
</li>
<li><p>QueryDict对象:</p>
<ol>
<li>request对象中的GET,POST都属于QueryDict对象</li>
<li>方法:<br>get():作用:根据键获取值<br>getlist():将键的值易列表的形式返回,可以获取多个值.</li>
</ol>
</li>
<li><p>GET属性:<br> 获取浏览器传递过来给服务器的数据.</p>
<ol>
<li><p>如果传入的url为:127.0.0.1/8000/get1?a=1&amp;b=2&amp;c=3<br>可以使用下面的视图函数获取:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get1</span>(<span class="params">request</span>):</span></span><br><span class="line">	<span class="comment"># 使用request.GET.get获取abc参数的值</span></span><br><span class="line">	a = request.GET.get(<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">	b = request.GET.get(<span class="string">&#x27;b&#x27;</span>)</span><br><span class="line">	c = request.GET.get(<span class="string">&#x27;c&#x27;</span>)</span><br><span class="line">	<span class="keyword">return</span> HttpResponse(a,b,c)</span><br></pre></td></tr></table></figure></li>
<li><p>如果传入的url为:127.0.0.1/8000/get1?a=1&amp;a=2&amp;c=3(有两个相同的参数)<br>可以使用下面的视图函数获取:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get1</span>(<span class="params">request</span>):</span></span><br><span class="line">	<span class="comment"># 使用request.GET.get获取ac参数的值</span></span><br><span class="line">	a = request.GET.getlist(<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">	a1,a2 = a[<span class="number">0</span>],a[<span class="number">1</span>]</span><br><span class="line">	c = request.GET.get(<span class="string">&#x27;c&#x27;</span>)</span><br><span class="line">	<span class="keyword">return</span> HttpResponse(a1,a2,c)</span><br></pre></td></tr></table></figure></li>
</ol>
</li>
<li><p>POST属性:<br> 使用表单实现POST请求.<br> 因为表单本身就是一个字典,所有可以使用request.POST.get获取</p>
 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">post</span>(<span class="params">request</span>):</span></span><br><span class="line">	name   = request.POST.get(<span class="string">&#x27;name&#x27;</span>)</span><br><span class="line">	gender = request.POST.get(<span class="string">&#x27;gender&#x27;</span>)</span><br><span class="line">	age    = request.POST.get(<span class="string">&#x27;age&#x27;</span>)</span><br><span class="line">	<span class="comment"># 因为hobby是一个复选框,所以使用getlist</span></span><br><span class="line">	hobby  = request.POST.getlist(<span class="string">&#x27;hobby&#x27;</span>)</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">return</span> HttpResponse(name,gender,age,hobby)</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="HttpResponse对象"><a href="#HttpResponse对象" class="headerlink" title="HttpResponse对象:"></a>HttpResponse对象:</h2><ul>
<li><p>作用:给浏览器返回数据.<br> HttpRequst对象是由django创建的,HttpResponse对象是由程序员创建.</p>
</li>
<li><p>用法:</p>
<ol>
<li><p>不调用模板:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> HttpResponse</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span>(<span class="params">request</span>):</span></span><br><span class="line">	<span class="keyword">return</span> HttpResponse(<span class="string">&#x27;hello world&#x27;</span>)</span><br></pre></td></tr></table></figure></li>
<li><p>调用模板:使用render方法:</p>
<ul>
<li><p>原型:<br>render(request,templateName [,context])</p>
</li>
<li><p>作用:<br>结合数据和模板,返回完整的HTML页面</p>
</li>
<li><p>参数:<br>request:请求体对象<br>templateName:模板路径<br>context:传递给需要渲染在模板上的数据.</p>
</li>
<li><p>示例:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">students</span>(<span class="params">request</span>):</span></span><br><span class="line">	studentslist = Students.objects.<span class="built_in">all</span>()</span><br><span class="line">	<span class="keyword">return</span> render(request,<span class="string">&#x27;myapp/students.html&#x27;</span>,&#123;<span class="string">&#x27;students&#x27;</span>:studentslist&#125;)</span><br></pre></td></tr></table></figure></li>
<li><p>属性:</p>
</li>
<li><p> content:返回的内容.(就是响应体)</p>
</li>
<li><p> charset:编码格式</p>
</li>
<li><p> status_code:响应状态码</p>
</li>
<li><p>content-type:<br> 就是响应头的<code>Content-Type: text/html</code>,<br> 表示返回的内容的类型</p>
<p> 指定输出的MIME类型</p>
</li>
<li><p>方法:</p>
</li>
</ul>
</li>
<li><p>init:<br>使用页面内容实例化HttpResponse对象</p>
</li>
<li><p>write(content):<br>以文件的形式写入</p>
</li>
<li><p>flush():<br>以文件的形式输出缓冲区</p>
</li>
<li><p>set_cookie(key,value=’’,max_age=None,exprise=None):<br>设置cookie</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 定义一个视图函数,并且为其配置url</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">setcookies</span>(<span class="params">request</span>):</span></span><br><span class="line">	res = HttpResponse()</span><br><span class="line">	res.set_cookie(<span class="string">&#x27;cookie_key&#x27;</span>,<span class="string">&#x27;cookie_value&#x27;</span>)</span><br><span class="line">	<span class="keyword">return</span> res</span><br></pre></td></tr></table></figure>

<p>当我们访问url就可以得到:<br><img src="/images/1555553501652.png" alt="1555553501652"><br><img src="/images/1555553522059.png" alt="1555553522059"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 获取cookie值,并且展示到页面上</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cookietest</span>(<span class="params">reqeust</span>):</span></span><br><span class="line">    res = HttpResponse()</span><br><span class="line">    cookie = request.COOKIES</span><br><span class="line">    res.write(<span class="string">&#x27;&lt;h1&gt;&#x27;</span>+cookie[<span class="string">&#x27;cookie_key&#x27;</span>]+<span class="string">&#x27;&lt;/h1&gt;&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> res</span><br></pre></td></tr></table></figure></li>
<li><p>delete_cookie(key):<br>删除cookie,如果删除一个不存在的key,就当什么都没发生.</p>
<ul>
<li>子类HttpResponseRedirect:</li>
</ul>
</li>
<li><p>功能:重定向,服务器端跳转</p>
</li>
<li><p>使用:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 匹配url</span></span><br><span class="line">url(<span class="string">r&#x27;^before$&#x27;</span>,views.before),</span><br><span class="line">url(<span class="string">r&#x27;^after$&#x27;</span>,views.after),</span><br><span class="line"></span><br><span class="line"><span class="comment"># 匹配视图</span></span><br><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> HttpResponseRedirect</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">before</span>(<span class="params">request</span>):</span></span><br><span class="line">	<span class="keyword">return</span> HttpResponseRedirect(<span class="string">&#x27;after&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">after</span>(<span class="params">request</span>):</span></span><br><span class="line">	<span class="keyword">return</span> HttpResponse(<span class="string">&#x27;this is after HTML&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>当我们输入before时,得到:</p>
<p><img src="/images/1555554581025.png" alt="1555554581025"></p>
</li>
<li><p>简写:redirect(to)<br>  其实就是换了一个函数</p>
</li>
</ol>
<pre><code><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 匹配url</span></span><br><span class="line">url(<span class="string">r&#x27;^before$&#x27;</span>,views.before),</span><br><span class="line">url(<span class="string">r&#x27;^after$&#x27;</span>,views.after),</span><br><span class="line"></span><br><span class="line"><span class="comment"># 匹配视图</span></span><br><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> redirect</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">before</span>(<span class="params">request</span>):</span></span><br><span class="line">	<span class="keyword">return</span> redirect(<span class="string">&#x27;after&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">after</span>(<span class="params">request</span>):</span></span><br><span class="line">	<span class="keyword">return</span> HttpResponse(<span class="string">&#x27;this is after HTML&#x27;</span>)</span><br></pre></td></tr></table></figure>

**to推荐使用反向解析**
</code></pre>
</li>
<li><p>子类JsonResponse:</p>
<ol start="11">
<li><p>返回Json数据,一般用于异步请求(ajax)</p>
</li>
<li><p>__init__(self.data)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> JsonResponse</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">jsonresponse</span>(<span class="params">request</span>):</span></span><br><span class="line">	<span class="keyword">if</span> request.is_ajax():</span><br><span class="line">		a = JsonResponse(&#123;...&#125;)</span><br><span class="line">	<span class="keyword">return</span> a</span><br></pre></td></tr></table></figure></li>
<li><p>__init__(self.data)中的data:字典对象</p>
</li>
<li><p>JsonResponse的Content-type类型为<code>application/json</code></p>
</li>
</ol>
</li>
</ul>
<h2 id="状态保持"><a href="#状态保持" class="headerlink" title="状态保持:"></a>状态保持:</h2><ul>
<li><p>概述:</p>
<ol>
<li><p>http协议时无状态的,每次请求都是一次新的请求,他不记得以前的请求.</p>
</li>
<li><p>客户端与服务器的一次通信就是一次会话</p>
</li>
<li><p>实现状态保持,在客户端或者服务端存储有关会话的数据</p>
</li>
<li><p>存储方式:cookie,session.<br>cookie:所有的数据存储在客户端,不要存敏感的数据.<br>session:所有数据存储在服务端,在客户端使用cookie存储session_id.</p>
<p>简单来说,session是一个字典,敏感数据存储在字典的values中,现在我将字典的key作为cookie返回给客户端.<br>这样就实现了敏感数据的传输,不会被截获.</p>
</li>
<li><p>状态保持的目的:<br>在一段时间内跟踪请求者的状态,可以实现跨页面访问当前请求者的数据.</p>
<ul>
<li>启用session:<br>在setting.py的installed_apps,MIDDLEWARE选项:</li>
</ul>
</li>
</ol>
 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">INSTALLED_APPS = [</span><br><span class="line">    <span class="string">&#x27;django.contrib.admin&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.auth&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.contenttypes&#x27;</span>,</span><br><span class="line">    <span class="comment"># 默认启用sessions应用</span></span><br><span class="line">    <span class="string">&#x27;django.contrib.sessions&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.messages&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.staticfiles&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;myapp&#x27;</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure>

 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">MIDDLEWARE = [</span><br><span class="line">    <span class="string">&#x27;django.middleware.security.SecurityMiddleware&#x27;</span>,</span><br><span class="line">    <span class="comment"># 默认启用sessions中间件</span></span><br><span class="line">    <span class="string">&#x27;django.contrib.sessions.middleware.SessionMiddleware&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.middleware.common.CommonMiddleware&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.middleware.csrf.CsrfViewMiddleware&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.auth.middleware.AuthenticationMiddleware&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.contrib.messages.middleware.MessageMiddleware&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;django.middleware.clickjacking.XFrameOptionsMiddleware&#x27;</span>,</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<ul>
<li>使用session:</li>
</ul>
<ol>
<li><p>启用session后,每个HttpRequest对象都有一个session属性,他其实就是一个类型字典的对象.</p>
</li>
<li><p>get(key,default=None):<br>根据键获取session值</p>
</li>
<li><p>clear():<br>清除所有的会话</p>
</li>
<li><p>flush()<br>删除当前会话并删除会话的cookie</p>
</li>
<li><p>使用如下:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 配置url</span></span><br><span class="line">url(<span class="string">r&#x27;^main$&#x27;</span>,views.main),</span><br><span class="line">url(<span class="string">r&#x27;^login$&#x27;</span>,views.login),</span><br><span class="line">url(<span class="string">r&#x27;^showmain&#x27;</span>,views.showmain)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 视图函数:</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>(<span class="params">request</span>):</span></span><br><span class="line">	username = request.session.get(<span class="string">&#x27;username&#x27;</span>,<span class="string">&#x27;游客&#x27;</span>)</span><br><span class="line">	<span class="keyword">return</span> render(request,<span class="string">&#x27;myapp/main.html&#x27;</span>,&#123;<span class="string">&#x27;username&#x27;</span>:username&#125;)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span>(<span class="params">request</span>):</span></span><br><span class="line">	<span class="keyword">return</span> render(request,<span class="string">&#x27;myapp/login.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">showmain</span>(<span class="params">request</span>):</span></span><br><span class="line">	username = request.POST.get(<span class="string">&#x27;username&#x27;</span>)</span><br><span class="line">	request.session[<span class="string">&#x27;username&#x27;</span>] = username</span><br><span class="line">	<span class="keyword">return</span> HttpResponseRedirect(<span class="string">&#x27;main&#x27;</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight django"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"><span class="comment">&lt;!-- templates/myapp/main.html  --&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&#x27;cn&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="xml">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">	<span class="tag">&lt;<span class="name">title</span>&gt;</span>我的<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="xml">	<span class="tag">&lt;<span class="name">h1</span>&gt;</span>欢迎:</span><span class="template-variable">&#123;&#123;username&#125;&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="xml">	<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;/login&quot;</span>&gt;</span>登录<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line"><span class="xml">	</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<figure class="highlight django"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"><span class="comment">&lt;!-- templates/myapp/login.html  --&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&#x27;cn&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="xml">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">	<span class="tag">&lt;<span class="name">title</span>&gt;</span>登录<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="comment">&lt;!-- action会跳转到/showmain页面  --&gt;</span></span></span><br><span class="line"><span class="xml">	<span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/showmain&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">		<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">		<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;登录&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">	<span class="tag">&lt;/<span class="name">form</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p><img src="/images/1555575956733.png" alt="1555575956733"><br><img src="/images/1555575968695.png" alt="1555575968695"><br><img src="/images/1555575985398.png" alt="1555575985398"></p>
</li>
<li><p>还可以添加一个退出登录:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 匹配url</span></span><br><span class="line">url(<span class="string">r&#x27;^quit$&#x27;</span>,views.quit)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 退出登录的视图</span></span><br><span class="line"><span class="keyword">from</span> django.contrib.auth <span class="keyword">import</span> logout</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">quit</span>(<span class="params">request</span>):</span></span><br><span class="line">    <span class="comment"># 清除session,建议使用这种方法</span></span><br><span class="line">	logout(request)</span><br><span class="line">    <span class="comment"># 或者使用:request.session.clear()</span></span><br><span class="line">    <span class="comment"># 或者使用:request.session.flush()</span></span><br><span class="line">	<span class="keyword">return</span> HttpResponseRedirect(<span class="string">&#x27;main&#x27;</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight django"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"><span class="comment">&lt;!-- 添加一个退出登录的按钮 --&gt;</span></span></span><br><span class="line"><span class="xml"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&#x27;cn&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="xml">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">	<span class="tag">&lt;<span class="name">title</span>&gt;</span>我的<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="xml">	<span class="tag">&lt;<span class="name">h1</span>&gt;</span>欢迎:</span><span class="template-variable">&#123;&#123;username&#125;&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="xml">	<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;/login&quot;</span>&gt;</span>登录<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line"><span class="xml">	<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;/quit&quot;</span>&gt;</span>退出登录<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line"><span class="xml">	</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p><img src="/images/1555577659145.png" alt="1555577659145"></p>
<p>点击退出登录</p>
<p><img src="/images/1555577668606.png" alt="1555577668606"></p>
</li>
<li><p>设置过期时间:<br>session默认寿命:两个星期.</p>
<p>修改使用set_expiry(value)函数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">showmain</span>(<span class="params">request</span>):</span></span><br><span class="line">    username = reqeust.POST.get(<span class="string">&#x27;username&#x27;</span>)</span><br><span class="line">    <span class="comment"># 设置10秒寿命</span></span><br><span class="line">    request.sessionn.set_expiry(<span class="number">10</span>)</span><br></pre></td></tr></table></figure>

<p>value的值:</p>
<ul>
<li>整数,表示秒</li>
<li>时间对象</li>
<li>0,表示关闭浏览器是失效</li>
<li>None,永不过期</li>
</ul>
</li>
</ol>
</li>
</ul>
<ol start="3">
<li><p>存储session的位置:</p>
<ul>
<li><p>默认存储在数据库中:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">INSTALLED_APPS = [</span><br><span class="line">    <span class="comment"># 启用 sessions 应用</span></span><br><span class="line">    <span class="string">&#x27;django.contrib.sessions&#x27;</span>,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">MIDDLEWARE = [</span><br><span class="line">    <span class="comment"># 启用 Session 中间层</span></span><br><span class="line">    <span class="string">&#x27;django.contrib.sessions.middleware.SessionMiddleware&#x27;</span>,</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># /setting.py</span></span><br><span class="line"><span class="comment"># SESSION_ENGINE的默认值为:</span></span><br><span class="line">SESSION_ENGINE = <span class="string">&#x27;django.contrib.sessions.backends.db&#x27;</span></span><br></pre></td></tr></table></figure></li>
<li><p>如果要修改session的存储方式.必须修改SESSION_ENGINE<br> 保存到存缓:</p>
 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 只存储在内容中,速度比存储在数据库快,若丢失了则无法找回.</span></span><br><span class="line">SESSION_ENGINE = <span class="string">&#x27;django.contrib.sessions.backends.cache&#x27;</span></span><br></pre></td></tr></table></figure></li>
<li><p>保存到存缓和数据库:</p>
 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 优先从内存获取,若读取失败再去数据库中读取</span></span><br><span class="line">SESSION_ENGINE = <span class="string">&#x27;django.contrib.sessions.backends.cached_db&#x27;</span></span><br></pre></td></tr></table></figure></li>
<li><p>保存到文件:</p>
 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SESSION_ENGINE = <span class="string">&#x27;django.contrib.sessions.backends.file&#x27;</span></span><br><span class="line"><span class="comment"># 可选配置</span></span><br><span class="line">SESSION_FILE_PATH = <span class="string">&#x27;/monkey/www/&#x27;</span></span><br></pre></td></tr></table></figure></li>
<li><p>保存到cookies:</p>
 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SESSION_ENGINE = <span class="string">&#x27;jango.contrib.sessions.backends.signed_cookies&#x27;</span></span><br><span class="line"><span class="comment"># 建议配置，阻止 javascript 对会话数据的访问，提高安全性。</span></span><br><span class="line">SESSION_COOKIE_HTTPONLY= <span class="literal">True</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>使用redis存缓session:</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 先安装依赖库</span><br><span class="line">pip install django-redis-sessions</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># /setting.py</span></span><br><span class="line">SESSION_ENGINE = <span class="string">&#x27;redis_sessions.session&#x27;</span></span><br><span class="line">SESSION_REDIS_HOST = <span class="string">&#x27;localhost&#x27;</span></span><br><span class="line">SESSION_REDIS_PORT = <span class="number">6379</span></span><br><span class="line">SESSION_REDIS_DB = <span class="number">0</span></span><br><span class="line">SESSION_REDIS_PASSWORD = <span class="string">&#x27;&#x27;</span></span><br><span class="line">SESSION_REDIS_PREFIX = <span class="string">&#x27;session&#x27;</span></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h1 id="模版"><a href="#模版" class="headerlink" title="模版"></a>模版</h1><h2 id="概述-1"><a href="#概述-1" class="headerlink" title="概述"></a>概述</h2><ol>
<li>模板由两部分组成:<ul>
<li>html代码</li>
<li>逻辑控制代码</li>
</ul>
</li>
<li>作用:<br>快速生成HTML页面</li>
<li>优点:<ul>
<li>模板的设计实现了业务逻辑和现实内容的分离</li>
<li>视图可以使用任何模板</li>
</ul>
</li>
<li>模板处理:<ul>
<li>加载</li>
<li>渲染</li>
</ul>
</li>
</ol>
<h2 id="定义模板"><a href="#定义模板" class="headerlink" title="定义模板"></a>定义模板</h2><ol>
<li><p>变量:</p>
<ul>
<li>视图传递给模板的数据</li>
<li>语法:</li>
<li>注意:<br><strong>如果使用的变量不存在,则插入的是空字符串</strong></li>
<li>在模板中使用点语法:<ul>
<li>字典查询</li>
<li>属性或者方法</li>
<li>数字索引</li>
</ul>
</li>
<li>在模板中对象的方法:<br>在模板里确实能使用对象的方法,但是不能传递参数.<br>(简单来说,就是不能调用有参数的方法)</li>
</ul>
</li>
<li><p>标签:</p>
<ul>
<li><p>语法:<code>&#123;% tag %&#125;</code></p>
</li>
<li><p>作用:</p>
<ol>
<li>在输出中创建文本</li>
<li>控制逻辑和循环</li>
</ol>
</li>
<li><p>if</p>
<ol>
<li><p>格式:</p>
<figure class="highlight django"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="template-tag">&#123;% <span class="name"><span class="name">if</span></span> 表达式 %&#125;</span><span class="xml"></span></span><br><span class="line"><span class="xml">语句</span></span><br><span class="line"><span class="xml"></span><span class="template-tag">&#123;% <span class="name"><span class="name">elif</span></span> 表达式 %&#125;</span><span class="xml"></span></span><br><span class="line"><span class="xml">语句</span></span><br><span class="line"><span class="xml"></span><span class="template-tag">&#123;% <span class="name"><span class="name">else</span></span> 表达式 %&#125;</span><span class="xml"></span></span><br><span class="line"><span class="xml">语句</span></span><br><span class="line"><span class="xml"></span><span class="template-tag">&#123;% <span class="name"><span class="name">endif</span></span> %&#125;</span></span><br></pre></td></tr></table></figure></li>
<li><p>示例:</p>
<figure class="highlight django"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="template-tag">&#123;% <span class="name"><span class="name">if</span></span> num %&#125;</span><span class="xml"></span></span><br><span class="line"><span class="xml">	<span class="tag">&lt;<span class="name">h1</span>&gt;</span>hello world<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span><span class="template-tag">&#123;% <span class="name"><span class="name">endif</span></span> %&#125;</span></span><br></pre></td></tr></table></figure></li>
</ol>
</li>
<li><p>for:</p>
<ol>
<li><p>格式:</p>
<figure class="highlight django"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="template-tag">&#123;% <span class="name"><span class="name">for</span></span> 变量 <span class="keyword">in</span> 列表 %&#125;</span><span class="xml"></span></span><br><span class="line"><span class="xml">语句</span></span><br><span class="line"><span class="xml"></span><span class="template-tag">&#123;% <span class="name"><span class="name">endfor</span></span> %&#125;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight django"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"><span class="comment">&lt;!-- 列表为空或者列表为空或者不存在时执行语句2 --&gt;</span></span></span><br><span class="line"><span class="xml"></span><span class="template-tag">&#123;% <span class="name"><span class="name">for</span></span> 变量 <span class="keyword">in</span> 列表 %&#125;</span><span class="xml"></span></span><br><span class="line"><span class="xml">语句1</span></span><br><span class="line"><span class="xml"></span><span class="template-tag">&#123;% <span class="name"><span class="name">empty</span></span> %&#125;</span><span class="xml"></span></span><br><span class="line"><span class="xml">语句1</span></span><br><span class="line"><span class="xml"></span><span class="template-tag">&#123;% <span class="name"><span class="name">endfor</span></span> %&#125;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight django"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"><span class="comment">&lt;!-- 这不是语句,而是一个变量 --&gt;</span></span></span><br><span class="line"><span class="xml"><span class="comment">&lt;!-- 表示当前是第几次循环 --&gt;</span></span></span><br><span class="line"><span class="xml"><span class="comment">&lt;!-- 一般在for循环体里使用 --&gt;</span></span></span><br><span class="line"><span class="xml"></span><span class="template-variable">&#123;&#123;forloop.counter&#125;&#125;</span></span><br></pre></td></tr></table></figure></li>
<li><p>示例:</p>
<figure class="highlight django"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="template-tag">&#123;% <span class="name"><span class="name">for</span></span> stu <span class="keyword">in</span> students %&#125;</span><span class="xml"></span></span><br><span class="line"><span class="xml">	<span class="tag">&lt;<span class="name">li</span>&gt;</span></span><span class="template-variable">&#123;&#123;forloop.counter&#125;&#125;</span><span class="xml">--</span><span class="template-variable">&#123;&#123;stu.name&#125;&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span><span class="template-tag">&#123;% <span class="name"><span class="name">empty</span></span> %&#125;</span><span class="xml"></span></span><br><span class="line"><span class="xml">	<span class="tag">&lt;<span class="name">li</span>&gt;</span>目前没有学生<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span><span class="template-tag">&#123;% <span class="name"><span class="name">endfor</span></span> %&#125;</span></span><br></pre></td></tr></table></figure></li>
</ol>
</li>
<li><p>comment:</p>
<ol>
<li><p>作用:多行注释</p>
</li>
<li><p>格式:</p>
<figure class="highlight django"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&#123;% comment %&#125;</span></span><br><span class="line"><span class="comment">注释的内容</span></span><br><span class="line"><span class="comment">&#123;% endcomment %&#125;</span></span><br></pre></td></tr></table></figure></li>
<li><p>示例:</p>
<figure class="highlight django"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&#123;% comment %&#125;</span></span><br><span class="line"><span class="comment">	&lt;h1&gt;被注释&lt;/h1&gt;</span></span><br><span class="line"><span class="comment">	&#123;&#123;stu.name&#125;&#125;</span></span><br><span class="line"><span class="comment">&#123;% endcomment %&#125;</span></span><br></pre></td></tr></table></figure></li>
</ol>
</li>
<li><p>ifequal、ifnotequal:</p>
<ol>
<li><p>判断是否相等,是否不相等</p>
</li>
<li><p>格式:</p>
<figure class="highlight django"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"><span class="comment">&lt;!-- 值1==值2则执行语句--&gt;</span></span></span><br><span class="line"><span class="xml"></span><span class="template-tag">&#123;% <span class="name"><span class="name">ifequal</span></span> 值1 值2 %&#125;</span><span class="xml"></span></span><br><span class="line"><span class="xml">语句</span></span><br><span class="line"><span class="xml"></span><span class="template-tag">&#123;% <span class="name"><span class="name">endifequal</span></span> %&#125;</span></span><br></pre></td></tr></table></figure></li>
</ol>
</li>
<li><p>include:</p>
<ol>
<li><p>作用:<br>加载模板并以标签内的参数渲染</p>
</li>
<li><p>格式:</p>
<figure class="highlight django"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="template-tag">&#123;% <span class="name"><span class="name">include</span></span> &#x27;模板目录&#x27; 参数1 参数2 %&#125;</span></span><br></pre></td></tr></table></figure></li>
</ol>
</li>
<li><p>url:</p>
<ol>
<li><p>作用:<br>反向解析</p>
</li>
<li><p>格式:</p>
<figure class="highlight django"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="template-tag">&#123;% <span class="name"><span class="name">url</span></span> &#x27;namespace.name&#x27; p1 p2 %&#125;</span></span><br></pre></td></tr></table></figure></li>
</ol>
</li>
<li><p>csrf_token:</p>
<ol>
<li><p>作用:<br>用于跨站请求伪造保护</p>
</li>
<li><p>格式:</p>
<figure class="highlight django"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="template-tag">&#123;% <span class="name"><span class="name">csrf_token</span></span> %&#125;</span></span><br></pre></td></tr></table></figure></li>
</ol>
</li>
<li><p>block、extends</p>
<ol>
<li>作用:<br>用于模板的继承</li>
</ol>
</li>
<li><p>autoescape</p>
<ol>
<li>作用:<br>用于HTML转义</li>
</ol>
</li>
</ul>
</li>
<li><p>过滤器:</p>
<ul>
<li><p>语法:</p>
<figure class="highlight django"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="template-variable">&#123;&#123;var|过滤器&#125;&#125;</span></span><br></pre></td></tr></table></figure></li>
<li><p>作用:<br>在变量被显示前修改它,但是并不修改这个变量</p>
</li>
<li><p>示例:</p>
<figure class="highlight django"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&#123;% comment %&#125;</span></span><br><span class="line"><span class="comment">	&#123;&#123;grade.headteacher&#125;&#125;的值是hyl</span></span><br><span class="line"><span class="comment">	&#123;&#123;grade.headteacher|upper&#125;&#125;的值是HYL</span></span><br><span class="line"><span class="comment">&#123;% endcomment %&#125;</span><span class="xml"></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="comment">&lt;!-- 输出hyl --&gt;</span></span></span><br><span class="line"><span class="xml">    </span><span class="template-variable">&#123;&#123;grade.headteacher&#125;&#125;</span><span class="xml"></span></span><br><span class="line"><span class="xml">    <span class="comment">&lt;!-- 输出HYL --&gt;</span></span></span><br><span class="line"><span class="xml">    </span><span class="template-variable">&#123;&#123;grade.headteacher|<span class="name">upper</span>&#125;&#125;</span><span class="xml"></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br></pre></td></tr></table></figure></li>
<li><p>过滤器其实就是函数.<br>过滤器可以传递参数,参数使用引号引起来.</p>
<p>join:<br>和python的join的功能是一样的</p>
<ol>
<li><p>格式:</p>
<figure class="highlight django"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="template-variable">&#123;&#123;var|<span class="name">default</span>:<span class="string">&#x27;good&#x27;</span>&#125;&#125;</span></span><br></pre></td></tr></table></figure></li>
<li><p>示例:</p>
<figure class="highlight django"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="xml">    </span><span class="template-variable">&#123;&#123;the_list|<span class="name">join</span>:<span class="string">&#x27;#&#x27;</span>&#125;&#125;</span><span class="xml"></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml"><span class="comment">&lt;!-- the_list=[&#x27;hyl&#x27;,&#x27;123&#x27;,&#x27;456&#x27;] --&gt;</span></span></span><br><span class="line"><span class="xml"><span class="comment">&lt;!-- 返回:hyl#123#456 --&gt;</span></span></span><br></pre></td></tr></table></figure></li>
</ol>
</li>
<li><p>如果一个变量没有被提供.或者值为false,空.可以使用默认值.<br>default:</p>
<ol>
<li><p>格式:</p>
<figure class="highlight django"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="template-variable">&#123;&#123;var|<span class="name">default</span>:<span class="string">&#x27;good&#x27;</span>&#125;&#125;</span></span><br></pre></td></tr></table></figure></li>
<li><p>示例</p>
<figure class="highlight django"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="xml">    </span><span class="template-variable">&#123;&#123;test_num|<span class="name">default</span>:<span class="string">&#x27;没有&#x27;</span>&#125;&#125;</span><span class="xml"></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="comment">&lt;!-- 如果没有test_num这个变量,就会使用默认值&#x27;没有&#x27; --&gt;</span></span></span><br></pre></td></tr></table></figure></li>
</ol>
</li>
<li><p>根据给定格式转换日期为字符串:<br>date:</p>
<p>格式:</p>
<figure class="highlight django"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="template-variable">&#123;&#123;dateVal|<span class="name">date</span>:<span class="string">&#x27;y-m-d&#x27;</span>&#125;&#125;</span></span><br></pre></td></tr></table></figure></li>
<li><p>HTML转义:<br>escape</p>
</li>
<li><p>加减乘除</p>
<figure class="highlight django"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"><span class="comment">&lt;!-- 加减是过滤器 --&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml"><span class="comment">&lt;!-- 加 --&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span></span><span class="template-variable">&#123;&#123;num|<span class="name">add</span>:10&#125;&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="comment">&lt;!-- 减 --&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span></span><span class="template-variable">&#123;&#123;num|<span class="name">add</span>:-10&#125;&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml"><span class="comment">&lt;!-- 乘除不是过滤器,是一个标签 --&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml"><span class="comment">&lt;!-- 乘:num乘以5 --&gt;</span></span></span><br><span class="line"><span class="xml"><span class="comment">&lt;!-- 实际上是(num/1)*5 --&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span></span><span class="template-tag">&#123;% <span class="name"><span class="name">widthratio</span></span> num 1 5 %&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="comment">&lt;!-- 除:num除以2 --&gt;</span></span></span><br><span class="line"><span class="xml"><span class="comment">&lt;!-- 实际上是(num/2)*1 --&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span></span><span class="template-tag">&#123;% <span class="name"><span class="name">widthratio</span></span> num 2 1 %&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>注释:<br>单行注释:</p>
<figure class="highlight django"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&#123;# 注释内容 #&#125;</span></span><br></pre></td></tr></table></figure>

<p>多行注释:</p>
<figure class="highlight django"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&#123;% comment %&#125;</span></span><br><span class="line"><span class="comment">	&lt;h1&gt;被注释&lt;/h1&gt;</span></span><br><span class="line"><span class="comment">	&#123;&#123;stu.name&#125;&#125;</span></span><br><span class="line"><span class="comment">&#123;% endcomment %&#125;</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="反向解析"><a href="#反向解析" class="headerlink" title="反向解析"></a>反向解析</h2><ol>
<li><p>实现功能在index.html页面点击超链接,然后跳转到good.html<br>代码如下:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># project/urls.py</span></span><br><span class="line">urlpatterns = [url(<span class="string">r&#x27;^&#x27;</span>,include(<span class="string">&#x27;myapp.urls&#x27;</span>))]</span><br><span class="line"></span><br><span class="line"><span class="comment"># myapp/urls.py</span></span><br><span class="line">urlpatterns = [</span><br><span class="line">    url(<span class="string">r&#x27;^good/(\d+)$&#x27;</span>,views.good),</span><br><span class="line">    url(<span class="string">r&#x27;^index$&#x27;</span>,views.index)]</span><br><span class="line"></span><br><span class="line"><span class="comment"># myapp/views.py</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">good</span>(<span class="params">request,num</span>):</span></span><br><span class="line">	<span class="keyword">return</span> render(request,<span class="string">&#x27;myapp/good.html&#x27;</span>,&#123;<span class="string">&#x27;num&#x27;</span>:num&#125;)</span><br></pre></td></tr></table></figure>

<figure class="highlight django"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&#123;# templates/myapp/index.html #&#125;</span><span class="xml"></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&#x27;cn&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="xml">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">	<span class="tag">&lt;<span class="name">title</span>&gt;</span>index<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="xml">	<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;/good/188&quot;</span>&gt;</span>链接<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml"></span><span class="comment">&#123;# templates/myapp/good.html #&#125;</span><span class="xml"></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&#x27;cn&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="xml">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">	<span class="tag">&lt;<span class="name">title</span>&gt;</span>good<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="xml">	good---</span><span class="template-variable">&#123;&#123;num&#125;&#125;</span><span class="xml"></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>现在确实能获取网页.</p>
<p><img src="/images/1555596678103.png" alt="1555596678103"></p>
<p><img src="/images/1555595962864.png" alt="1555595962864"></p>
<p>但是,假如某天project/urls.py的根路径改变了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># project/urls.py</span></span><br><span class="line">urlpatterns = [url(<span class="string">r&#x27;^&#x27;</span>,include(<span class="string">&#x27;myapp.urls&#x27;</span>))]</span><br><span class="line"><span class="comment"># 改变为</span></span><br><span class="line">urlpatterns = [url(<span class="string">r&#x27;^me&#x27;</span>,include(<span class="string">&#x27;myapp.urls&#x27;</span>))]</span><br></pre></td></tr></table></figure>

<p>那么全部就都会报废.出现问题的根本原因:<br>这里是根据a标签的路径<code>&lt;a href=&quot;/good/188&quot;&gt;链接&lt;/a&gt;</code>得出url为<code>/good/188</code>,然后再根据这个url去寻找视图.这时候urls.py中可能没有这个url,所以也就找不到视图.</p>
<p>解决方法:反向解析<br>我们不再根据url去找视图,而是<strong>直接调用想要的视图</strong></p>
</li>
<li><p>示例,代码如下:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># project/urls.py</span></span><br><span class="line">urlpatterns = [</span><br><span class="line">    url(<span class="string">r&#x27;^admin/&#x27;</span>, admin.site.urls),</span><br><span class="line">    <span class="comment"># 注意这里不是r&#x27;^&#x27;而是r&#x27;^hyl/&#x27;</span></span><br><span class="line">    <span class="comment"># 使用include的namespace参数</span></span><br><span class="line">    url(<span class="string">r&#x27;^hyl/&#x27;</span>,include(<span class="string">&#x27;myapp.urls&#x27;</span>,namespace=<span class="string">&#x27;myapp&#x27;</span>))</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># myapp/urls.py</span></span><br><span class="line">urlpatterns = [</span><br><span class="line">    <span class="comment"># 使用url的name参数</span></span><br><span class="line">    url(<span class="string">r&#x27;^good/(\d+)$&#x27;</span>,views.good,name=<span class="string">&#x27;good&#x27;</span>),</span><br><span class="line">    url(<span class="string">r&#x27;^redict/$&#x27;</span>,views.redict)</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 两个视图函数不变</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">good</span>(<span class="params">request,num</span>):</span></span><br><span class="line">	<span class="keyword">return</span> render(request,<span class="string">&#x27;myapp/good.html&#x27;</span>,&#123;<span class="string">&#x27;num&#x27;</span>:num&#125;)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">redict</span>(<span class="params">request</span>):</span></span><br><span class="line">	<span class="keyword">return</span> render(request,<span class="string">&#x27;myapp/redict.html&#x27;</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight django"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&#123;# templates/myapp/good.html #&#125;</span><span class="xml"></span></span><br><span class="line"><span class="xml"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&#x27;cn&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="xml">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">	<span class="tag">&lt;<span class="name">title</span>&gt;</span>good<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="xml">	good---</span><span class="template-variable">&#123;&#123;num&#125;&#125;</span><span class="xml"></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml"></span><span class="comment">&#123;# templates/myapp/redict.html #&#125;</span><span class="xml"></span></span><br><span class="line"><span class="xml"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&#x27;cn&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="xml">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">	<span class="tag">&lt;<span class="name">title</span>&gt;</span>redict<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="xml">    </span><span class="comment">&#123;# 注意这里就是:直接调用myapp的good对应的视图 #&#125;</span><span class="xml"></span></span><br><span class="line"><span class="xml">	<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;</span></span></span><span class="template-tag">&#123;% <span class="name"><span class="name">url</span></span> &#x27;myapp:good&#x27; 199 %&#125;</span><span class="xml"><span class="tag"><span class="string">&quot;</span>&gt;</span>链接<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>结果:<br><img src="/images/1555635099413.png" alt="1555635099413"></p>
<p>使用<code>&lt;a href=&quot;&#123;% url 'myapp:good' 199 %&#125;&quot;&gt;链接&lt;/a&gt;</code><br>直接跳转到127.0.0.:8000/<strong>hyl</strong>/good/199</p>
<p><img src="/images/1555635111445.png" alt="1555635111445"><br>上一个例子是使用:<code>&lt;a href=&quot;/good/188&quot;&gt;链接&lt;/a&gt;</code><br>这个url为127.0.0.:8000/good/199,<br>这是找不到对应的视图的.</p>
</li>
<li><p>总结:<br>使用反向解析只需要修改三个地方:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># project/urls.py</span></span><br><span class="line">url(<span class="string">r&#x27;^hyl/&#x27;</span>,include(<span class="string">&#x27;myapp.urls&#x27;</span>,namespace=<span class="string">&#x27;myapp&#x27;</span>))</span><br><span class="line"><span class="comment"># myapp/urls.py</span></span><br><span class="line">url(<span class="string">r&#x27;^good/(\d+)$&#x27;</span>,views.good,name=<span class="string">&#x27;good&#x27;</span>)</span><br><span class="line"><span class="comment"># templates/good.html</span></span><br><span class="line">&lt;a href=<span class="string">&quot;&#123;% url &#x27;myapp:good&#x27; 199 %&#125;&quot;</span>&gt;链接&lt;/a&gt;</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="模板继承"><a href="#模板继承" class="headerlink" title="模板继承"></a>模板继承</h2><ol>
<li><p>作用:<br>减小页面的内容的重复定义,实现页面的重用</p>
</li>
<li><p>block标签:</p>
<ul>
<li><p>在父模板中预留区域,子模板去填充.</p>
</li>
<li><p>语法:</p>
<figure class="highlight django"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="template-tag">&#123;%<span class="name"><span class="name">block</span></span> 标签名 %&#125;</span><span class="xml"></span></span><br><span class="line"><span class="xml">...</span></span><br><span class="line"><span class="xml"></span><span class="template-tag">&#123;%<span class="name"><span class="name">endblock</span></span> 标签名 %&#125;</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>extends标签:</p>
<ul>
<li><p>继承模板,需要写在模板文件的第一行</p>
</li>
<li><p>语法:</p>
<figure class="highlight django"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="template-tag">&#123;% <span class="name"><span class="name">extends</span></span> &#x27;父模板的路径&#x27; %&#125;</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>示例:</p>
<figure class="highlight django"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&#123;# templates/myapp/base.html #&#125;</span><span class="xml"></span></span><br><span class="line"><span class="xml"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&#x27;cn&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="xml">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">	<span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">	<span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="css"></span></span></span><br><span class="line"><span class="css"><span class="xml">		<span class="selector-id">#header</span>&#123;</span></span></span><br><span class="line"><span class="css"><span class="xml">			<span class="attribute">width</span>: <span class="number">100%</span>;</span></span></span><br><span class="line"><span class="css"><span class="xml">			<span class="attribute">height</span>: <span class="number">100px</span>;</span></span></span><br><span class="line"><span class="css"><span class="xml">			<span class="attribute">background-color</span>: red; </span></span></span><br><span class="line"><span class="css"><span class="xml">		&#125;</span></span></span><br><span class="line"><span class="css"><span class="xml">		<span class="selector-id">#footer</span>&#123;</span></span></span><br><span class="line"><span class="css"><span class="xml">			<span class="attribute">width</span>: <span class="number">100%</span>;</span></span></span><br><span class="line"><span class="css"><span class="xml">			<span class="attribute">height</span>: <span class="number">100px</span>;</span></span></span><br><span class="line"><span class="css"><span class="xml">			<span class="attribute">background-color</span>: bule; </span></span></span><br><span class="line"><span class="css"><span class="xml">		&#125;	</span></span></span><br><span class="line"><span class="css"><span class="xml">	</span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span></span><br><span class="line"><span class="xml">	</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="xml">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&#x27;header&#x27;</span>&gt;</span>header<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">	<span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">		</span><span class="template-tag">&#123;% <span class="name"><span class="name">block</span></span> hyl %&#125;</span><span class="xml"></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">		</span><span class="template-tag">&#123;% <span class="name"><span class="name">endblock</span></span> hyl %&#125;</span><span class="xml"></span></span><br><span class="line"><span class="xml">	<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&#x27;footer&#x27;</span>&gt;</span>footer<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<figure class="highlight django"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&#123;# templates/myapp/test.html #&#125;</span><span class="xml"></span></span><br><span class="line"><span class="xml"></span><span class="template-tag">&#123;% <span class="name"><span class="name">extends</span></span> &#x27;myapp/base.html&#x27; %&#125;</span><span class="xml"></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml"></span><span class="template-tag">&#123;% <span class="name"><span class="name">block</span></span> hyl %&#125;</span><span class="xml"></span></span><br><span class="line"><span class="xml">	<span class="tag">&lt;<span class="name">h1</span>&gt;</span>hello world<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span><span class="template-tag">&#123;% <span class="name"><span class="name">endblock</span></span> hyl %&#125;</span></span><br></pre></td></tr></table></figure>

<p>配置路由,视图.得到结果:<br><img src="/images/1555637359104.png" alt="1555637359104"></p>
</li>
</ol>
<h2 id="HTML转义"><a href="#HTML转义" class="headerlink" title="HTML转义"></a>HTML转义</h2><ol>
<li><p>问题,现在我们在视图函数中传递html代码作为参数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span>(<span class="params">request</span>):</span></span><br><span class="line">	<span class="keyword">return</span> render(request,<span class="string">&#x27;myapp/index.html&#x27;</span>,&#123;<span class="string">&#x27;code&#x27;</span>:<span class="string">&#x27;&lt;h1&gt;heyingliang&lt;/h1&gt;&#x27;</span>&#125;)</span><br></pre></td></tr></table></figure>

<figure class="highlight django"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&#x27;cn&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="xml">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">	<span class="tag">&lt;<span class="name">title</span>&gt;</span>index<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="xml">	</span><span class="template-variable">&#123;&#123;code&#125;&#125;</span><span class="xml"></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>得到结果<br><img src="/images/1555638153092.png" alt="1555638153092"><br>Django会将接收到的code当成普通字符串渲染.<br>现在想要将接收到的字符串当成HTML代码渲染.</p>
</li>
<li><p>过滤器:</p>
<ul>
<li><p>escape:转成字符串</p>
<figure class="highlight django"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&#123;# 将传来的code当成字符串渲染 #&#125;</span><span class="xml"></span></span><br><span class="line"><span class="xml"></span><span class="template-variable">&#123;&#123;code|<span class="name">escape</span>&#125;&#125;</span></span><br></pre></td></tr></table></figure></li>
<li><p>safe</p>
<figure class="highlight django"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&#123;# 将传来的code当成代码渲染 #&#125;</span><span class="xml"></span></span><br><span class="line"><span class="xml"></span><span class="template-variable">&#123;&#123;code|<span class="name">safe</span>&#125;&#125;</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>标签:<br>autoescape:上面的过滤器确实可以开启和关闭HTML转义.<br>但是不够方便,这时可以使用qutoescape:<br>语法:</p>
<figure class="highlight django"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&#123;# off/on表示开启/关闭转义 #&#125;</span><span class="xml"></span></span><br><span class="line"><span class="xml"></span><span class="template-tag">&#123;%<span class="name"><span class="name">autoescape</span></span> off%&#125;</span><span class="xml"></span></span><br><span class="line"><span class="xml">	</span><span class="template-variable">&#123;&#123;code&#125;&#125;</span><span class="xml"></span></span><br><span class="line"><span class="xml"></span><span class="template-tag">&#123;%<span class="name"><span class="name">endautoescape</span></span>%&#125;</span></span><br></pre></td></tr></table></figure>

<p>示例:</p>
<figure class="highlight django"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&#x27;cn&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="xml">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">	<span class="tag">&lt;<span class="name">title</span>&gt;</span>index<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="xml">    </span><span class="comment">&#123;# 开启转义 #&#125;</span><span class="xml"></span></span><br><span class="line"><span class="xml">	</span><span class="template-tag">&#123;%<span class="name"><span class="name">autoescape</span></span> off%&#125;</span><span class="xml"></span></span><br><span class="line"><span class="xml">	</span><span class="template-variable">&#123;&#123;code&#125;&#125;</span><span class="xml"></span></span><br><span class="line"><span class="xml">	</span><span class="template-tag">&#123;%<span class="name"><span class="name">endautoescape</span></span>%&#125;</span><span class="xml"></span></span><br><span class="line"><span class="xml">	</span><span class="comment">&#123;# 关闭转义 #&#125;</span><span class="xml"></span></span><br><span class="line"><span class="xml">	</span><span class="template-tag">&#123;%<span class="name"><span class="name">autoescape</span></span> on%&#125;</span><span class="xml"></span></span><br><span class="line"><span class="xml">	</span><span class="template-variable">&#123;&#123;code&#125;&#125;</span><span class="xml"></span></span><br><span class="line"><span class="xml">	</span><span class="template-tag">&#123;%<span class="name"><span class="name">endautoescape</span></span>%&#125;</span><span class="xml"></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p><img src="/images/1555638949488.png" alt="1555638949488"></p>
</li>
</ol>
<h2 id="CSRF"><a href="#CSRF" class="headerlink" title="CSRF"></a>CSRF</h2><ol>
<li>概念解释:<br>CSRF, Cross Site Request Forgery,跨站点伪造请求。<br>某些恶意网站包含链接,表单,按钮,js利用登录用户在浏览器中认证,从而攻击服务器.</li>
</ol>
<p>   举例来讲，某个恶意的网站上有一个指向你的网站的链接，如果某个用户已经登录到你的网站上了，而且与你的网站的session 尚未过期，那么当这个用户点击这个恶意网站上的那个链接时，就会向你的网站发来一个请求，你的网站会以为这个请求是用户自己发来的，其实呢，这个请求是那个恶意网站伪造</p>
<p>   但是我们在使用post发起请求的时候就有可能csrf校验失败错误,此时request请求被丢弃掉。<br>   <img src="/images/1183125-20171105151628513-843946189.png" alt="img"></p>
<ol start="2">
<li><p>防止CSRF:</p>
<ul>
<li><p>出现上面错误的原因就是Django默认开启了防止CSRF,把正确的post请求都防下来了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># project/settings.py</span></span><br><span class="line">MIDDLEWARE = [</span><br><span class="line">    <span class="string">&#x27;django.middleware.csrf.CsrfViewMiddleware&#x27;</span>,</span><br><span class="line">    ...</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>虽然我们可以通过关闭这个应用来取消,此时将不会进行csrf的校验，但如前面所述，这是一种不安全的行为。而且djano也不推荐使用。</p>
</li>
<li><p>第二种方式:<br>使用csrf_toke标签</p>
<figure class="highlight django"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="template-tag">&#123;% <span class="name">scrf_token</span> %&#125;</span></span><br></pre></td></tr></table></figure>

<p>也就是说是:<br><strong>在网页中加入csrf_token的标签就可以通过csrf校验</strong></p>
</li>
<li><p>示例:</p>
<figure class="highlight django"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&#x27;/showinfo/&#x27;</span> <span class="attr">method</span>=<span class="string">&#x27;post&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">    </span><span class="comment">&#123;# 仅仅是添加了这句 #&#125;</span><span class="xml"></span></span><br><span class="line"><span class="xml">    </span><span class="template-tag">&#123;% <span class="name">scrf_token</span> %&#125;</span><span class="xml"></span></span><br><span class="line"><span class="xml">    姓名:<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&#x27;text&#x27;</span> <span class="attr">name</span>=<span class="string">&#x27;username&#x27;</span>/&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">hr</span>/&gt;</span></span></span><br><span class="line"><span class="xml">    密码:<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&#x27;password&#x27;</span> <span class="attr">name</span>=<span class="string">&#x27;pwd&#x27;</span>/&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">hr</span>/&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&#x27;submit&#x27;</span> <span class="attr">value</span>=<span class="string">&#x27;登录&#x27;</span>/&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span></span><br></pre></td></tr></table></figure></li>
<li><p>Django 提供的 CSRF 防护机制：</p>
<ol>
<li>django 第一次响应来自某个客户端的请求时，会在服务器端随机生成一个 token，把这个 token 放在 cookie 里。然后每次 POST 请求都会带上这个 token，这样就能避免被 CSRF 攻击。</li>
<li>在返回的 HTTP 响应的 cookie 里，django 会为你添加一个 csrftoken 字段，其值为一个自动生成的 token，在所有的 POST 表单时，必须包含一个 csrfmiddlewaretoken 字段 （只需要在模板里加一个 tag， django 就会自动帮你生成）</li>
<li>在处理 POST 请求之前，django 会验证这个请求的 cookie 里的 csrftoken 字段的值和提交的表单里的 csrfmiddlewaretoken 字段的值是否一样。如果一样，则表明这是一个合法的请求，否则，这个请求可能是来自于别人的 csrf 攻击，返回 403 Forbidden.</li>
<li> 在所有 ajax POST 请求里，添加一个 X-CSRFTOKEN header，其值为 cookie 里的 csrftoken 的值</li>
</ol>
</li>
</ul>
</li>
</ol>
<h2 id="验证码"><a href="#验证码" class="headerlink" title="验证码"></a>验证码</h2><ol>
<li><p>作用:<br>在用户注册,登录页面的时候使用,防止暴力请求.减轻服务器的压力.还是防止CSRF的一种方式.</p>
</li>
<li><p>示例:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># myapp/urls.py</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 验证码图片的url</span></span><br><span class="line">url(<span class="string">r&#x27;^verifycode/$&#x27;</span>,views.verifycode),</span><br><span class="line"><span class="comment"># 呈现验证码的网址</span></span><br><span class="line">url(<span class="string">r&#x27;^show_verifycode/$&#x27;</span>,views.show_verifycode),</span><br><span class="line"><span class="comment"># 验证验证码的网址</span></span><br><span class="line">url(<span class="string">r&#x27;^verifycodecheck/$&#x27;</span>,views.verifycodecheck)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mypp/views.py</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 制作验证码</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">verifycode</span>(<span class="params">request</span>):</span></span><br><span class="line">    <span class="comment">#引入绘图模块</span></span><br><span class="line">    <span class="keyword">from</span> PIL <span class="keyword">import</span> Image, ImageDraw, ImageFont</span><br><span class="line">    <span class="comment">#引入随机函数模块</span></span><br><span class="line">    <span class="keyword">import</span> random</span><br><span class="line">    <span class="comment">#定义变量，用于画面的背景色、宽、高</span></span><br><span class="line">    bgcolor = (random.randrange(<span class="number">20</span>, <span class="number">100</span>), random.randrange(</span><br><span class="line">        <span class="number">20</span>, <span class="number">100</span>), random.randrange(<span class="number">20</span>, <span class="number">100</span>))</span><br><span class="line">    width = <span class="number">100</span></span><br><span class="line">    height = <span class="number">50</span></span><br><span class="line">    <span class="comment">#创建画面对象</span></span><br><span class="line">    im = Image.new(<span class="string">&#x27;RGB&#x27;</span>, (width, height), bgcolor)</span><br><span class="line">    <span class="comment">#创建画笔对象</span></span><br><span class="line">    draw = ImageDraw.Draw(im)</span><br><span class="line">    <span class="comment">#调用画笔的point()函数绘制噪点</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">100</span>):</span><br><span class="line">        xy = (random.randrange(<span class="number">0</span>, width), random.randrange(<span class="number">0</span>, height))</span><br><span class="line">        fill = (random.randrange(<span class="number">0</span>, <span class="number">255</span>), <span class="number">255</span>, random.randrange(<span class="number">0</span>, <span class="number">255</span>))</span><br><span class="line">        draw.point(xy, fill=fill)</span><br><span class="line">    <span class="comment">#定义验证码的备选值</span></span><br><span class="line">    <span class="built_in">str</span> = <span class="string">&#x27;1234567890QWERTYUIOPASDFGHJKLZXCVBNMqwertyuiopasdfghjklzxcvbnm&#x27;</span></span><br><span class="line">    <span class="comment">#随机选取4个值作为验证码</span></span><br><span class="line">    rand_str = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">4</span>):</span><br><span class="line">        rand_str += <span class="built_in">str</span>[random.randrange(<span class="number">0</span>, <span class="built_in">len</span>(<span class="built_in">str</span>))]</span><br><span class="line">    <span class="comment">#构造字体对象</span></span><br><span class="line">    font = ImageFont.truetype(<span class="string">r&#x27;C:\Windows\Fonts\AdobeArabic-Bold.otf&#x27;</span>, <span class="number">40</span>)</span><br><span class="line">    <span class="comment">#构造字体颜色</span></span><br><span class="line">    fontcolor1 = (<span class="number">255</span>, random.randrange(<span class="number">0</span>, <span class="number">255</span>), random.randrange(<span class="number">0</span>, <span class="number">255</span>))</span><br><span class="line">    fontcolor2 = (<span class="number">255</span>, random.randrange(<span class="number">0</span>, <span class="number">255</span>), random.randrange(<span class="number">0</span>, <span class="number">255</span>))</span><br><span class="line">    fontcolor3 = (<span class="number">255</span>, random.randrange(<span class="number">0</span>, <span class="number">255</span>), random.randrange(<span class="number">0</span>, <span class="number">255</span>))</span><br><span class="line">    fontcolor4 = (<span class="number">255</span>, random.randrange(<span class="number">0</span>, <span class="number">255</span>), random.randrange(<span class="number">0</span>, <span class="number">255</span>))</span><br><span class="line">    <span class="comment">#绘制4个字</span></span><br><span class="line">    draw.text((<span class="number">5</span>, <span class="number">2</span>), rand_str[<span class="number">0</span>], font=font, fill=fontcolor1)</span><br><span class="line">    draw.text((<span class="number">25</span>, <span class="number">2</span>), rand_str[<span class="number">1</span>], font=font, fill=fontcolor2)</span><br><span class="line">    draw.text((<span class="number">50</span>, <span class="number">2</span>), rand_str[<span class="number">2</span>], font=font, fill=fontcolor3)</span><br><span class="line">    draw.text((<span class="number">75</span>, <span class="number">2</span>), rand_str[<span class="number">3</span>], font=font, fill=fontcolor4)</span><br><span class="line">    <span class="comment">#释放画笔</span></span><br><span class="line">    <span class="keyword">del</span> draw</span><br><span class="line">    <span class="comment">#存入session，用于做进一步验证</span></span><br><span class="line">    request.session[<span class="string">&#x27;verifycode&#x27;</span>] = rand_str</span><br><span class="line">    <span class="comment">#内存文件操作</span></span><br><span class="line">    <span class="keyword">import</span> io</span><br><span class="line">    buf = io.BytesIO()</span><br><span class="line">    <span class="comment">#将图片保存在内存中，文件类型为png</span></span><br><span class="line">    im.save(buf, <span class="string">&#x27;png&#x27;</span>)</span><br><span class="line">    <span class="comment">#将内存中的图片数据返回给客户端，MIME类型为图片png</span></span><br><span class="line">    <span class="keyword">return</span> HttpResponse(buf.getvalue(), <span class="string">&#x27;image/png&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show_verifycode</span>(<span class="params">request</span>):</span></span><br><span class="line">	<span class="keyword">return</span> render(request,<span class="string">&#x27;myapp/verifycode.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">verifycodecheck</span>(<span class="params">request</span>):</span></span><br><span class="line">	userinput = request.POST.get(<span class="string">&#x27;verifycode&#x27;</span>).upper()</span><br><span class="line">	ture_val = request.session[<span class="string">&#x27;verifycode&#x27;</span>].upper()</span><br><span class="line">	<span class="keyword">if</span> userinput == ture_val:</span><br><span class="line">		<span class="keyword">return</span> render(request,<span class="string">&#x27;myapp/verifycode_success.html&#x27;</span>)</span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		ifsuccess = <span class="string">&#x27;失败,请重新输出&#x27;</span></span><br><span class="line">		<span class="keyword">return</span> render(request,<span class="string">&#x27;myapp/verifycode.html&#x27;</span>,&#123;<span class="string">&#x27;ifsuccess&#x27;</span>:ifsuccess&#125;)</span><br></pre></td></tr></table></figure>

<figure class="highlight django"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&#123;# verfifycode.html #&#125;</span><span class="xml"></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&#x27;cn&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="xml">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">	<span class="tag">&lt;<span class="name">title</span>&gt;</span>verifycode<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="xml">	<span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">action</span>=<span class="string">&#x27;/verifycodecheck/&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">		<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;verifycode&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="xml">		<span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;/verifycode/&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">		<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">name</span>=<span class="string">&quot;登录&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">		<span class="tag">&lt;<span class="name">span</span>&gt;</span></span><span class="template-variable">&#123;&#123;ifsuccess&#125;&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">	<span class="tag">&lt;/<span class="name">form</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml"></span><span class="comment">&#123;# verifycode_success.html #&#125;</span><span class="xml"></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&#x27;cn&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="xml">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">	<span class="tag">&lt;<span class="name">title</span>&gt;</span>verifycode<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="xml">	成功</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>效果:<br><img src="/images/1555663891643.png" alt="1555663891643"><br><img src="/images/1555663902752.png" alt="1555663902752"><br><img src="/images/1555663923872.png" alt="1555663923872"></p>
<p>如果使用重定向的话:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show_verifycode</span>(<span class="params">request</span>):</span></span><br><span class="line">    <span class="comment"># 在这里获取session的值</span></span><br><span class="line">	f = request.session.get(<span class="string">&#x27;flag&#x27;</span>,<span class="literal">True</span>)</span><br><span class="line">	<span class="built_in">str</span> = <span class="string">&#x27;&#x27;</span></span><br><span class="line">	<span class="keyword">if</span> f == <span class="literal">False</span>:</span><br><span class="line">		<span class="built_in">str</span> = <span class="string">&#x27;验证失败,请重新输入&#x27;</span></span><br><span class="line">	<span class="comment"># 注意要清除session</span></span><br><span class="line">	request.session.clear()</span><br><span class="line">	<span class="keyword">return</span> render(request,<span class="string">&#x27;myapp/verifycode.html&#x27;</span>,&#123;<span class="string">&#x27;flag&#x27;</span>:<span class="built_in">str</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">verifycodecheck</span>(<span class="params">request</span>):</span></span><br><span class="line">	userinput = request.POST.get(<span class="string">&#x27;verifycode&#x27;</span>).upper()</span><br><span class="line">	ture_val = request.session[<span class="string">&#x27;verifycode&#x27;</span>].upper()</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> userinput == ture_val:</span><br><span class="line">		<span class="keyword">return</span> render(request,<span class="string">&#x27;myapp/verifycode_success.html&#x27;</span>)</span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		<span class="comment"># 在这里给session赋值</span></span><br><span class="line">		request.session[<span class="string">&#x27;flag&#x27;</span>] = <span class="literal">False</span></span><br><span class="line">		<span class="comment"># 重定向</span></span><br><span class="line">		<span class="keyword">return</span> HttpResponseRedirect(<span class="string">&#x27;/show_verifycode/&#x27;</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight django"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&#123;# verfifycode.html #&#125;</span><span class="xml"></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&#x27;cn&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="xml">	<span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">	<span class="tag">&lt;<span class="name">title</span>&gt;</span>verifycode<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="xml">	<span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">action</span>=<span class="string">&#x27;/verifycodecheck/&#x27;</span>&gt;</span></span></span><br><span class="line"><span class="xml">		<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;verifycode&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="xml">		<span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;/verifycode/&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">		<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">name</span>=<span class="string">&quot;登录&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">		<span class="tag">&lt;<span class="name">span</span>&gt;</span></span><span class="template-variable">&#123;&#123;flag&#125;&#125;</span><span class="xml"><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span><br><span class="line"><span class="xml">	<span class="tag">&lt;/<span class="name">form</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>简单来说,如果要使用重定向的话,就类似于scrapy的Meta参数.==Django是使用session来传递参数的.==</p>
</li>
</ol>
</div></div><div class="post-main post-comment"></div></article><link rel="stylesheet" type="text/css" href="/css/font.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.css"><script src="//cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script><script src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script>$(document).ready(function() {
  $(".fancybox").fancybox();
});
</script></body></html>
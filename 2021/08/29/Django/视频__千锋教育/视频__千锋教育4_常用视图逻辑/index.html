<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="各种视图"><link rel="stylesheet" type="text/css" href="/css/normalize.css"><link rel="stylesheet" type="text/css" href="/css/highlight.css"><link rel="stylesheet" type="text/css" href="/css/noise.css"><title>千锋教育4_常用视图逻辑 | 凉薄的自动书记人偶</title><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><meta name="generator" content="Hexo 5.4.0"></head><body><article class="wrapper"><div class="post-main"><div class="nav"><nav class="container"><a class="sidebar-nav-item active" href="/">Home</a><a class="sidebar-nav-item" href="/archives">Tags</a><a class="sidebar-nav-item" href="/About">About</a></nav><div class="container post-meta"><div class="post-tags"><a class="post-tag-link" href="/tags/Django/" rel="tag">Django</a></div><div class="post-time">2021-08-29</div></div></div><div class="container post-header"><h1>千锋教育4_常用视图逻辑</h1></div><div class="container post-content"><p>各种视图</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 登录逻辑</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login</span>(<span class="params">request</span>):</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        form = LoginForm(request.POST)</span><br><span class="line">        <span class="keyword">if</span> form.is_valid():</span><br><span class="line">            nameid = form.cleaned_data[<span class="string">&quot;username&quot;</span>]</span><br><span class="line">            pswd = form.cleaned_data[<span class="string">&quot;passwd&quot;</span>]</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                user = User.objects.get(userAccount=nameid)</span><br><span class="line">                <span class="keyword">if</span> user.userPasswd != pswd:</span><br><span class="line">                    <span class="keyword">return</span> redirect(<span class="string">&#x27;/login/&#x27;</span>)</span><br><span class="line">            <span class="keyword">except</span> User.DoesNotExist <span class="keyword">as</span> e:</span><br><span class="line">                <span class="keyword">return</span> redirect(<span class="string">&#x27;/login/&#x27;</span>)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># 更换Token值</span></span><br><span class="line">            token = time.time() + random.randrange(<span class="number">1</span>, <span class="number">100000</span>)</span><br><span class="line">            user.userToken = <span class="built_in">str</span>(token)</span><br><span class="line">            user.save()</span><br><span class="line">            <span class="comment"># 传递session</span></span><br><span class="line">            request.session[<span class="string">&quot;username&quot;</span>] = user.userName</span><br><span class="line">            request.session[<span class="string">&quot;token&quot;</span>] = user.userToken</span><br><span class="line">            <span class="keyword">return</span> redirect(<span class="string">&#x27;/mine/&#x27;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            context = &#123;<span class="string">&#x27;title&#x27;</span>:<span class="string">&#x27;登录&#x27;</span>,<span class="string">&#x27;form&#x27;</span>:form,<span class="string">&#x27;error&#x27;</span>:form.errors&#125;</span><br><span class="line">            <span class="keyword">return</span> render(request,<span class="string">&#x27;axfapp/login.html&#x27;</span>,context=context)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        form = LoginForm()</span><br><span class="line">        context = &#123;<span class="string">&#x27;title&#x27;</span>:<span class="string">&#x27;登录&#x27;</span>,<span class="string">&#x27;form&#x27;</span>:form&#125;</span><br><span class="line">        <span class="keyword">return</span> render(request,<span class="string">&#x27;axfapp/login.html&#x27;</span>,context=context)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 注册逻辑</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">register</span>(<span class="params">request</span>):</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&quot;POST&quot;</span>:</span><br><span class="line">        userAccount = request.POST.get(<span class="string">&quot;userAccount&quot;</span>)</span><br><span class="line">        userPasswd  = request.POST.get(<span class="string">&quot;userPass&quot;</span>)</span><br><span class="line">        userName    = request.POST.get(<span class="string">&quot;userName&quot;</span>)</span><br><span class="line">        userPhone   = request.POST.get(<span class="string">&quot;userPhone&quot;</span>)</span><br><span class="line">        userAdderss = request.POST.get(<span class="string">&quot;userAdderss&quot;</span>)</span><br><span class="line">        userRank    = <span class="number">0</span></span><br><span class="line">        token = time.time() + random.randrange(<span class="number">1</span>, <span class="number">100000</span>)</span><br><span class="line">        userToken = <span class="built_in">str</span>(token)</span><br><span class="line">        f = request.FILES[<span class="string">&quot;userImg&quot;</span>]</span><br><span class="line">        userImg = os.path.join(settings.MEDIA_ROOT, userAccount + <span class="string">&quot;.png&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(userImg, <span class="string">&quot;wb&quot;</span>) <span class="keyword">as</span> fp:</span><br><span class="line">            <span class="keyword">for</span> data <span class="keyword">in</span> f.chunks():</span><br><span class="line">                fp.write(data)</span><br><span class="line"></span><br><span class="line">        user = User.createuser(userAccount,userPasswd,userName,userPhone,userAdderss,userImg,userRank,userToken)</span><br><span class="line">        user.save()</span><br><span class="line"></span><br><span class="line">        request.session[<span class="string">&quot;username&quot;</span>] = userName</span><br><span class="line">        request.session[<span class="string">&quot;token&quot;</span>] = userToken</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> redirect(<span class="string">&#x27;/mine/&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> render(request, <span class="string">&#x27;axfapp/register.html&#x27;</span>, &#123;<span class="string">&quot;title&quot;</span>:<span class="string">&quot;注册&quot;</span>&#125;)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 检查账户名是否被抢注</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">checkuserid</span>(<span class="params">request</span>):</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">&#x27;POST&#x27;</span>:</span><br><span class="line">        userid = request.POST.get(<span class="string">&#x27;userid&#x27;</span>)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            user = User.objects.get(userAccount=userid)</span><br><span class="line">            <span class="keyword">return</span> JsonResponse(&#123;<span class="string">&#x27;data&#x27;</span>:<span class="string">&#x27;该用户已经被注册&#x27;</span>,<span class="string">&#x27;status&#x27;</span>:<span class="string">&#x27;error&#x27;</span>&#125;)</span><br><span class="line">        <span class="keyword">except</span> User.DoesNotExist <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">return</span> JsonResponse(&#123;<span class="string">&#x27;data&#x27;</span>:<span class="string">&#x27;ok&#x27;</span>,<span class="string">&#x27;status&#x27;</span>:<span class="string">&#x27;success&#x27;</span>&#125;)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 退出登录</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">quit</span>(<span class="params">request</span>):</span></span><br><span class="line">    logout(request)</span><br><span class="line">    <span class="keyword">return</span> redirect(<span class="string">&#x27;/mine/&#x27;</span>)</span><br></pre></td></tr></table></figure>

</div></div></article><link rel="stylesheet" type="text/css" href="/css/font.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.css"><script src="//cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script><script src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script>$(document).ready(function() {
  $(".fancybox").fancybox();
});
</script></body></html>
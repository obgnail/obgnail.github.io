<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content=" id=&quot;ç”¨å…ƒç´ åç§°ã€idã€class-å®šä½å…ƒç´ &quot;&gt;&lt;a href=&quot;#ç”¨å…ƒç´ åç§°ã€idã€class-å®šä½å…ƒç´ &quot; class=&quot;headerlink&quot; title=&quot;ç”¨å…ƒç´ åç§°ã€idã€class å®šä½å…ƒç´ &quot;&gt;&lt;/a&gt;ç”¨å…ƒç´ åç§°ã€idã€class å®šä½å…ƒç´ &lt;/h2&gt;&lt;p&gt;addressï¼š&lt;a href=&quot;https://testerhome.com/topics/1047&quot;&gt;https://testerhome.com/topics/1047&lt;/a&gt;"><link rel="stylesheet" type="text/css" href="/css/normalize.css"><link rel="stylesheet" type="text/css" href="/css/highlight.css"><link rel="stylesheet" type="text/css" href="/css/noise.css"><title>ADB+Python | å‡‰è–„çš„è‡ªåŠ¨ä¹¦è®°äººå¶</title><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><meta name="generator" content="Hexo 5.4.0"></head><body><article class="wrapper"><div class="post-main"><div class="nav"><nav class="container"><a class="sidebar-nav-item active" href="/">Home</a><a class="sidebar-nav-item" href="/archives">Tags</a><a class="sidebar-nav-item" href="/About">About</a></nav><div class="container post-meta"><div class="post-tags"><a class="post-tag-link" href="/tags/Android-Debug-Bridge/" rel="tag">Android Debug Bridge</a></div><div class="post-time">2021-10-27</div></div></div><div class="container post-header"><h1>ADB+Python</h1></div><div class="container post-toc"><details class="toc"><summary class="toc-accordion">Table of Contents</summary><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%A8%E5%85%83%E7%B4%A0%E5%90%8D%E7%A7%B0%E3%80%81id%E3%80%81class-%E5%AE%9A%E4%BD%8D%E5%85%83%E7%B4%A0"><span class="toc-number">1.</span> <span class="toc-text">ç”¨å…ƒç´ åç§°ã€idã€class å®šä½å…ƒç´ </span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%92%89%E9%92%89%E6%89%93%E5%8D%A1"><span class="toc-number">2.</span> <span class="toc-text">é’‰é’‰æ‰“å¡</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B7%B3%E4%B8%80%E8%B7%B3%E8%BE%85%E5%8A%A9%E7%A8%8B%E5%BA%8F"><span class="toc-number">3.</span> <span class="toc-text">è·³ä¸€è·³è¾…åŠ©ç¨‹åº</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A41"><span class="toc-number">3.1.</span> <span class="toc-text">æ­¥éª¤1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A42"><span class="toc-number">3.2.</span> <span class="toc-text">æ­¥éª¤2</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A43"><span class="toc-number">3.3.</span> <span class="toc-text">æ­¥éª¤3</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A44"><span class="toc-number">3.4.</span> <span class="toc-text">æ­¥éª¤4</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%8C%E6%95%B4%E4%BB%A3%E7%A0%81"><span class="toc-number">3.5.</span> <span class="toc-text">å®Œæ•´ä»£ç </span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A6%82%E6%9E%9C%E6%83%B3%E4%BD%BF%E7%94%A8%E6%A1%86%E6%9E%B6%EF%BC%8C%E5%8F%AF%E4%BB%A5%E8%AF%95%E8%AF%95Appium%E5%92%8Cpocoui"><span class="toc-number">4.</span> <span class="toc-text">å¦‚æœæƒ³ä½¿ç”¨æ¡†æ¶ï¼Œå¯ä»¥è¯•è¯•Appiumå’Œpocoui</span></a></li></ol></details></div><div class="container post-content"><h2 id="ç”¨å…ƒç´ åç§°ã€idã€class-å®šä½å…ƒç´ "><a href="#ç”¨å…ƒç´ åç§°ã€idã€class-å®šä½å…ƒç´ " class="headerlink" title="ç”¨å…ƒç´ åç§°ã€idã€class å®šä½å…ƒç´ "></a>ç”¨å…ƒç´ åç§°ã€idã€class å®šä½å…ƒç´ </h2><p>addressï¼š<a target="_blank" rel="noopener" href="https://testerhome.com/topics/1047">https://testerhome.com/topics/1047</a></p>
<p>æ­¥éª¤ï¼š</p>
<ol>
<li>ä½¿ç”¨<code>adb shell uiautomator dump</code>å‘½ä»¤ï¼Œæ‰§è¡Œ <code>adb shell uiautomator dump /data/local/tmp/uidump.xml</code>ï¼Œ</li>
<li>ç„¶åå°†è¯¥ xml æ–‡ä»¶ pull åˆ°æœ¬åœ°ï¼Œä»é‡Œé¢å¯ä»¥çœ‹åˆ°æ‰‹æœºä¸Šå½“å‰é¡µé¢çš„å¸ƒå±€ï¼Œåœ¨ note èŠ‚ç‚¹ä¸‹å¯ä»¥æ‰¾åˆ°è¿™äº›å±æ€§ï¼štextï¼Œresource-idï¼Œclassï¼Œboundsï¼ŒçŸ¥é“è¿™äº›å†…å®¹åå°±å¯ä»¥ä½¿ç”¨ python å¯¹è¯¥ xml æ–‡ä»¶è§£æè·å–åˆ°å¯¹åº”çš„å±æ€§ï¼Œå–å‡º bounds çš„å€¼ï¼Œè®¡ç®—å‡ºå¯¹åº”å…ƒç´ åŒºåŸŸçš„ä¸­å¿ƒåæ ‡ï¼Œ</li>
<li>æ¥ç€ä½¿ç”¨<code> adb shell input tap</code> å‘½ä»¤å°±å¯ä»¥ç‚¹å‡»è¯¥åæ ‡ï¼Œå¦‚æœæœ‰ç›¸åŒçš„å±æ€§å€¼ï¼Œé‚£å°±éœ€è¦å¾—åˆ°ä¸€ä¸ªåæ ‡ç‚¹çš„åˆ—è¡¨ï¼Œ</li>
</ol>
<p>ä»¥åº”ç”¨ â€œ1 å·åº— â€œä¸ºä¾‹ï¼Œåœ¨æ¡Œé¢ä¸Šé€šè¿‡åº”ç”¨åç§° â€œ1 å·åº—â€ï¼Œç‚¹å‡»è¿›å…¥åº”ç”¨ï¼Œç„¶åç‚¹å‡» â€œæ‰‹æœºå……å€¼â€ç”¨ python ç®€å•å®ç°ï¼š</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding=utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> tempfile</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> xml.etree.cElementTree <span class="keyword">as</span> ET</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Element</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    é€šè¿‡å…ƒç´ å®šä½,éœ€è¦Android 4.0ä»¥ä¸Š</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        åˆå§‹åŒ–ï¼Œè·å–ç³»ç»Ÿä¸´æ—¶æ–‡ä»¶å­˜å‚¨ç›®å½•ï¼Œå®šä¹‰åŒ¹é…æ•°å­—æ¨¡å¼</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        self.tempFile = tempfile.gettempdir()</span><br><span class="line">        self.pattern = re.<span class="built_in">compile</span>(<span class="string">r&quot;\d+&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__uidump</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        è·å–å½“å‰Activityæ§ä»¶æ ‘</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        os.popen(<span class="string">&quot;adb shell uiautomator dump /data/local/tmp/uidump.xml&quot;</span>)</span><br><span class="line">        os.popen(<span class="string">&quot;adb pull /data/local/tmp/uidump.xml &quot;</span> + self.tempFile)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__element</span>(<span class="params">self, attrib, name</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        åŒå±æ€§å•ä¸ªå…ƒç´ ï¼Œè¿”å›å•ä¸ªåæ ‡å…ƒç»„</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        self.__uidump()</span><br><span class="line">        tree = ET.ElementTree(file=self.tempFile + <span class="string">&quot;\\uidump.xml&quot;</span>)</span><br><span class="line">        treeIter = tree.<span class="built_in">iter</span>(tag=<span class="string">&quot;node&quot;</span>)</span><br><span class="line">        <span class="keyword">for</span> elem <span class="keyword">in</span> treeIter:</span><br><span class="line">            <span class="keyword">if</span> elem.attrib[attrib] == name:</span><br><span class="line">                bounds = elem.attrib[<span class="string">&quot;bounds&quot;</span>]</span><br><span class="line">                coord = self.pattern.findall(bounds)</span><br><span class="line">                Xpoint = (<span class="built_in">int</span>(coord[<span class="number">2</span>]) - <span class="built_in">int</span>(coord[<span class="number">0</span>])) / <span class="number">2.0</span> + <span class="built_in">int</span>(coord[<span class="number">0</span>])</span><br><span class="line">                Ypoint = (<span class="built_in">int</span>(coord[<span class="number">3</span>]) - <span class="built_in">int</span>(coord[<span class="number">1</span>])) / <span class="number">2.0</span> + <span class="built_in">int</span>(coord[<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">                <span class="keyword">return</span> Xpoint, Ypoint</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__elements</span>(<span class="params">self, attrib, name</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        åŒå±æ€§å¤šä¸ªå…ƒç´ ï¼Œè¿”å›åæ ‡å…ƒç»„åˆ—è¡¨</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="built_in">list</span> = []</span><br><span class="line">        self.__uidump()</span><br><span class="line">        tree = ET.ElementTree(file=self.tempFile + <span class="string">&quot;\\uidump.xml&quot;</span>)</span><br><span class="line">        treeIter = tree.<span class="built_in">iter</span>(tag=<span class="string">&quot;node&quot;</span>)</span><br><span class="line">        <span class="keyword">for</span> elem <span class="keyword">in</span> treeIter:</span><br><span class="line">            <span class="keyword">if</span> elem.attrib[attrib] == name:</span><br><span class="line">                bounds = elem.attrib[<span class="string">&quot;bounds&quot;</span>]</span><br><span class="line">                coord = self.pattern.findall(bounds)</span><br><span class="line">                Xpoint = (<span class="built_in">int</span>(coord[<span class="number">2</span>]) - <span class="built_in">int</span>(coord[<span class="number">0</span>])) / <span class="number">2.0</span> + <span class="built_in">int</span>(coord[<span class="number">0</span>])</span><br><span class="line">                Ypoint = (<span class="built_in">int</span>(coord[<span class="number">3</span>]) - <span class="built_in">int</span>(coord[<span class="number">1</span>])) / <span class="number">2.0</span> + <span class="built_in">int</span>(coord[<span class="number">1</span>])</span><br><span class="line">                <span class="built_in">list</span>.append((Xpoint, Ypoint))</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">list</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">findElementByName</span>(<span class="params">self, name</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        é€šè¿‡å…ƒç´ åç§°å®šä½</span></span><br><span class="line"><span class="string">        usage: findElementByName(u&quot;ç›¸æœº&quot;)</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> self.__element(<span class="string">&quot;text&quot;</span>, name)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">findElementsByName</span>(<span class="params">self, name</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.__elements(<span class="string">&quot;text&quot;</span>, name)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">findElementByClass</span>(<span class="params">self, className</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        é€šè¿‡å…ƒç´ ç±»åå®šä½</span></span><br><span class="line"><span class="string">        usage: findElementByClass(&quot;android.widget.TextView&quot;)</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> self.__element(<span class="string">&quot;class&quot;</span>, className)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">findElementsByClass</span>(<span class="params">self, className</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.__elements(<span class="string">&quot;class&quot;</span>, className)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">findElementById</span>(<span class="params">self, <span class="built_in">id</span></span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        é€šè¿‡å…ƒç´ çš„resource-idå®šä½</span></span><br><span class="line"><span class="string">        usage: findElementsById(&quot;com.android.deskclock:id/imageview&quot;)</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> self.__element(<span class="string">&quot;resource-id&quot;</span>,<span class="built_in">id</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">findElementsById</span>(<span class="params">self, <span class="built_in">id</span></span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.__elements(<span class="string">&quot;resource-id&quot;</span>,<span class="built_in">id</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Event</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        os.popen(<span class="string">&quot;adb wait-for-device &quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">touch</span>(<span class="params">self, dx, dy</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        è§¦æ‘¸äº‹ä»¶</span></span><br><span class="line"><span class="string">        usage: touch(500, 500)</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        os.popen(<span class="string">&quot;adb shell input tap &quot;</span> + <span class="built_in">str</span>(dx) + <span class="string">&quot; &quot;</span> + <span class="built_in">str</span>(dy))</span><br><span class="line">        time.sleep(<span class="number">0.5</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test</span>():</span></span><br><span class="line">    element = Element()</span><br><span class="line">    evevt = Event()</span><br><span class="line"></span><br><span class="line">    e1 = element.findElementByName(<span class="string">u&quot;1å·åº—&quot;</span>)</span><br><span class="line">    evevt.touch(e1[<span class="number">0</span>], e1[<span class="number">1</span>])</span><br><span class="line">    time.sleep(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">    e2 = element.findElementByName(<span class="string">u&quot;æ‰‹æœºå……å€¼&quot;</span>)</span><br><span class="line">    evevt.touch(e2[<span class="number">0</span>], e2[<span class="number">1</span>])</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨çš„å‰ææ˜¯éœ€è¦å¼€å¯ view serverï¼Œå¦åˆ™æ— æ³•è·å–åˆ° uidump.xml è¿™ä¸ªæ–‡ä»¶ã€‚å¦å¤–ç¨‹åºè¿è¡Œçš„æ—¶é—´ä¼šæœ‰ç‚¹æ…¢ï¼Œå¯ä»¥æœ‰ä¼˜åŒ–çš„æ–¹æ³•ã€‚<br>å¦å¤–å¦‚æœå±æ€§å€¼ç›¸åŒï¼Œä½¿ç”¨ elementsï¼Œè¿”å›çš„æ˜¯å«åæ ‡å…ƒç»„çš„åˆ—è¡¨ï¼Œå¦‚ä½•ä½¿ç”¨ï¼Œè¿™é‡Œå°±ä¸è®²äº†ã€‚</p>
<p>å°†å…¶è¿›è¡Œä¿®æ”¹:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> xml.etree.cElementTree <span class="keyword">as</span> ET</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run_without_output</span>(<span class="params">cmd</span>):</span></span><br><span class="line">    os.popen(cmd)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run_with_output</span>(<span class="params">cmd</span>):</span></span><br><span class="line">    <span class="keyword">with</span> os.popen(cmd) <span class="keyword">as</span> fp:</span><br><span class="line">        bf = fp._stream.buffer.read()</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">return</span> bf.decode()</span><br><span class="line">    <span class="keyword">except</span> UnicodeDecodeError:</span><br><span class="line">        <span class="keyword">return</span> bf.decode(<span class="string">&#x27;gbk&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Element</span>:</span></span><br><span class="line"></span><br><span class="line">    ADB_UI_TREE_DUMP_CMD = <span class="string">&quot;adb shell uiautomator dump /data/local/tmp/uidump.xml&quot;</span></span><br><span class="line">    ADB_GET_UI_TREE_CMD = <span class="string">&quot;adb shell cat /data/local/tmp/uidump.xml&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.pattern = re.<span class="built_in">compile</span>(<span class="string">r&quot;\d+&quot;</span>)</span><br><span class="line">        self.ui_tree = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__uidump</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        è·å–å½“å‰Activityæ§ä»¶æ ‘</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        run_with_output(self.ADB_UI_TREE_DUMP_CMD)</span><br><span class="line">        self.ui_tree = run_with_output(self.ADB_GET_UI_TREE_CMD)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__element</span>(<span class="params">self, attrib, name</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        åŒå±æ€§å•ä¸ªå…ƒç´ ï¼Œè¿”å›å•ä¸ªåæ ‡å…ƒç»„</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        self.__uidump()</span><br><span class="line">        tree = ET.ElementTree(ET.fromstring(self.ui_tree))</span><br><span class="line"></span><br><span class="line">        treeIter = tree.<span class="built_in">iter</span>(tag=<span class="string">&quot;node&quot;</span>)</span><br><span class="line">        <span class="keyword">for</span> elem <span class="keyword">in</span> treeIter:</span><br><span class="line">            <span class="keyword">if</span> elem.attrib[attrib] == name:</span><br><span class="line">                bounds = elem.attrib[<span class="string">&quot;bounds&quot;</span>]</span><br><span class="line">                coord = self.pattern.findall(bounds)</span><br><span class="line">                Xpoint = (<span class="built_in">int</span>(coord[<span class="number">2</span>]) - <span class="built_in">int</span>(coord[<span class="number">0</span>])) / <span class="number">2.0</span> + <span class="built_in">int</span>(coord[<span class="number">0</span>])</span><br><span class="line">                Ypoint = (<span class="built_in">int</span>(coord[<span class="number">3</span>]) - <span class="built_in">int</span>(coord[<span class="number">1</span>])) / <span class="number">2.0</span> + <span class="built_in">int</span>(coord[<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">                <span class="keyword">return</span> Xpoint, Ypoint</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__elements</span>(<span class="params">self, attrib, name</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        åŒå±æ€§å¤šä¸ªå…ƒç´ ï¼Œè¿”å›åæ ‡å…ƒç»„åˆ—è¡¨</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        self.__uidump()</span><br><span class="line">        tree = ET.ElementTree(ET.fromstring(self.ui_tree))</span><br><span class="line">        </span><br><span class="line">        l = []</span><br><span class="line">        treeIter = tree.<span class="built_in">iter</span>(tag=<span class="string">&quot;node&quot;</span>)</span><br><span class="line">        <span class="keyword">for</span> elem <span class="keyword">in</span> treeIter:</span><br><span class="line">            <span class="keyword">if</span> elem.attrib[attrib] == name:</span><br><span class="line">                bounds = elem.attrib[<span class="string">&quot;bounds&quot;</span>]</span><br><span class="line">                coord = self.pattern.findall(bounds)</span><br><span class="line">                Xpoint = (<span class="built_in">int</span>(coord[<span class="number">2</span>]) - <span class="built_in">int</span>(coord[<span class="number">0</span>])) / <span class="number">2.0</span> + <span class="built_in">int</span>(coord[<span class="number">0</span>])</span><br><span class="line">                Ypoint = (<span class="built_in">int</span>(coord[<span class="number">3</span>]) - <span class="built_in">int</span>(coord[<span class="number">1</span>])) / <span class="number">2.0</span> + <span class="built_in">int</span>(coord[<span class="number">1</span>])</span><br><span class="line">                l.append((Xpoint, Ypoint))</span><br><span class="line">        <span class="keyword">return</span> l</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">findElementByName</span>(<span class="params">self, name</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        é€šè¿‡å…ƒç´ åç§°å®šä½</span></span><br><span class="line"><span class="string">        usage: findElementByName(u&quot;ç›¸æœº&quot;)</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> self.__element(<span class="string">&quot;text&quot;</span>, name)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">findElementsByName</span>(<span class="params">self, name</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.__elements(<span class="string">&quot;text&quot;</span>, name)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">findElementByClass</span>(<span class="params">self, className</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        é€šè¿‡å…ƒç´ ç±»åå®šä½</span></span><br><span class="line"><span class="string">        usage: findElementByClass(&quot;android.widget.TextView&quot;)</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> self.__element(<span class="string">&quot;class&quot;</span>, className)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">findElementsByClass</span>(<span class="params">self, className</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.__elements(<span class="string">&quot;class&quot;</span>, className)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">findElementById</span>(<span class="params">self, <span class="built_in">id</span></span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        é€šè¿‡å…ƒç´ çš„resource-idå®šä½</span></span><br><span class="line"><span class="string">        usage: findElementsById(&quot;com.android.deskclock:id/imageview&quot;)</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> self.__element(<span class="string">&quot;resource-id&quot;</span>,<span class="built_in">id</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">findElementsById</span>(<span class="params">self, <span class="built_in">id</span></span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.__elements(<span class="string">&quot;resource-id&quot;</span>,<span class="built_in">id</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Event</span>:</span></span><br><span class="line"></span><br><span class="line">    ADB_WAIT_DEVICE_CMD = <span class="string">&quot;adb wait-for-device &quot;</span></span><br><span class="line">    ADB_TOUCH_CMD = <span class="string">&quot;adb shell input tap &#123;&#125; &#123;&#125;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        run_with_output(self.ADB_WAIT_DEVICE_CMD)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">touch</span>(<span class="params">self, dx, dy</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        è§¦æ‘¸äº‹ä»¶</span></span><br><span class="line"><span class="string">        usage: touch(500, 500)</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        run_with_output(self.ADB_TOUCH_CMD.<span class="built_in">format</span>(dx, dy))</span><br><span class="line"></span><br><span class="line">element = Element()</span><br><span class="line">evevt = Event()</span><br><span class="line"></span><br><span class="line">e1 = element.findElementByName(<span class="string">u&quot;ä¼ä¸šå¾®ä¿¡&quot;</span>)</span><br><span class="line">evevt.touch(e1[<span class="number">0</span>], e1[<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">e2 = element.findElementByName(<span class="string">u&quot;æŠ€æœ¯æ”¯æŒç ”å‘æ²Ÿé€š&quot;</span>)</span><br><span class="line">evevt.touch(e2[<span class="number">0</span>], e2[<span class="number">1</span>])</span><br></pre></td></tr></table></figure>



<h2 id="é’‰é’‰æ‰“å¡"><a href="#é’‰é’‰æ‰“å¡" class="headerlink" title="é’‰é’‰æ‰“å¡"></a>é’‰é’‰æ‰“å¡</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> os,subprocess</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line">PATH = <span class="keyword">lambda</span> p: os.path.abspath(p)</span><br><span class="line">  </span><br><span class="line">isScreenshoting = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#æ‰“å¡</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">onWork</span>():</span></span><br><span class="line">    <span class="comment"># å¼€ä¸ªçº¿ç¨‹æˆªå›¾</span></span><br><span class="line">    ts = threading.Thread(target=runLoopScreenshot, args=())</span><br><span class="line">    ts.setDaemon(<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">global</span> isScreenshoting</span><br><span class="line">    isScreenshoting = <span class="literal">True</span></span><br><span class="line">    ts.start()</span><br><span class="line"></span><br><span class="line">    os.system(<span class="string">&#x27;adb shell input keyevent 26&#x27;</span>)</span><br><span class="line">    os.system(<span class="string">&#x27;adb shell input keyevent 3&#x27;</span>)</span><br><span class="line">    os.system(<span class="string">&#x27;adb shell am start -n com.alibaba.android.rimet/com.alibaba.android.rimet.biz.SplashActivity&#x27;</span>)</span><br><span class="line">    <span class="comment"># ç­‰15ç§’åå…³é—­</span></span><br><span class="line">    time.sleep(<span class="number">15</span>)</span><br><span class="line"></span><br><span class="line">    os.system(<span class="string">&#x27;adb shell input keyevent 3&#x27;</span>)</span><br><span class="line">    os.system(<span class="string">&#x27;adb shell input keyevent 6&#x27;</span>)</span><br><span class="line">    isScreenshoting = <span class="literal">False</span></span><br><span class="line">    <span class="comment"># æ‰“å¡å®Œæ¯•</span></span><br><span class="line">    tend = threading.Thread(target=enddk, args=())</span><br><span class="line">    tend.start()</span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">enddk</span>():</span></span><br><span class="line">    <span class="comment"># é€šçŸ¥ä½ æƒ³é€šçŸ¥çš„åœ°æ–¹</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;end&quot;</span>)</span><br><span class="line">    time.sleep(<span class="number">10</span>)</span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">runLoopScreenshot</span>():</span></span><br><span class="line">    <span class="keyword">global</span> isScreenshoting</span><br><span class="line">    <span class="keyword">while</span> isScreenshoting:</span><br><span class="line">        <span class="comment"># os.popen(&quot;adb wait-for-device&quot;)</span></span><br><span class="line">        s = os.popen(<span class="string">&quot;adb shell screencap -p  | base64&quot;</span>).read()</span><br><span class="line">        <span class="built_in">print</span>(s)</span><br><span class="line">        os.popen(<span class="string">&quot;adb shell screencap -p /data/local/tmp/tmp.png&quot;</span>)</span><br><span class="line">        path = <span class="string">&#x27;/home/pi&#x27;</span></span><br><span class="line">        os.popen(<span class="string">&quot;adb pull /data/local/tmp/tmp.png &quot;</span> + PATH(path + <span class="string">&quot;/s.png&quot;</span>))</span><br><span class="line">        <span class="comment"># os.popen(&quot;adb shell rm /data/local/tmp/tmp.png&quot;)</span></span><br><span class="line">        <span class="comment"># å›¾ç‰‡è½¬äº†base64 å¯ä»¥å‘åˆ°ä½ æƒ³å‘çš„åœ°æ–¹</span></span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(path + <span class="string">&quot;/s.png&quot;</span>, <span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            base64_data = base64.b64encode(f.read())</span><br><span class="line">             </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;success&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    dakaTime = [<span class="string">&#x27;08:49:40&#x27;</span>, <span class="string">&#x27;08:47:32&#x27;</span>, <span class="string">&#x27;08:53:25&#x27;</span>]</span><br><span class="line">    nextDakaTime = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="comment"># çœ‹æœ‰æ²¡æœ‰è®¾å¤‡è¿æ¥</span></span><br><span class="line">            device = os.popen(<span class="string">&#x27;adb devices -l&#x27;</span>).read()</span><br><span class="line">            out = device.split(<span class="string">&#x27; &#x27;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;&#123;&quot;action&quot;:&quot;device&quot;,&quot;data&quot;:&quot;%s,%s,%s&quot;&#125;&#x27;</span> % (out[<span class="number">11</span>], out[<span class="number">12</span>], out[<span class="number">13</span>]))</span><br><span class="line">            currentTime = time.strftime(<span class="string">&quot;%H:%M:%S&quot;</span>, time.localtime())</span><br><span class="line">  </span><br><span class="line">            <span class="keyword">if</span> nextDakaTime == <span class="literal">None</span>:</span><br><span class="line">                r = random.randint(<span class="number">0</span>, <span class="built_in">len</span>(dakaTime) - <span class="number">1</span>)</span><br><span class="line">                nextDakaTime = dakaTime[r]</span><br><span class="line">            <span class="built_in">print</span>(currentTime,nextDakaTime)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> currentTime == nextDakaTime:</span><br><span class="line">                <span class="comment"># å¼€ä¸ªçº¿ç¨‹æ‰“å¡</span></span><br><span class="line">                t = threading.Thread(target=onWork, args=())</span><br><span class="line">                t.setDaemon(<span class="literal">True</span>)</span><br><span class="line">                t.start()</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;something wrong:&quot;</span>, e)</span><br><span class="line"></span><br><span class="line">        time.sleep(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">  <span class="comment"># è®¾ç½®å¤šå‡ ä¸ªæ‰“å¡æ—¶é—´</span></span><br><span class="line">  main()</span><br></pre></td></tr></table></figure>



<h2 id="è·³ä¸€è·³è¾…åŠ©ç¨‹åº"><a href="#è·³ä¸€è·³è¾…åŠ©ç¨‹åº" class="headerlink" title="è·³ä¸€è·³è¾…åŠ©ç¨‹åº"></a>è·³ä¸€è·³è¾…åŠ©ç¨‹åº</h2><p>addressï¼š<a target="_blank" rel="noopener" href="https://www.cnblogs.com/dongkuo/p/8285162.html">https://www.cnblogs.com/dongkuo/p/8285162.html</a></p>
<ol>
<li>æ¯æ¬¡è·³è·ƒä¹‹å‰ï¼Œæˆªå–ä¸€ä¸‹æ‰‹æœºå±å¹•ï¼Œå¹¶å°†æˆªå›¾ä¿å­˜åˆ°æœ¬åœ°ç”µè„‘ä¸­ï¼›</li>
<li>è®¡ç®—æˆªå›¾ä¸­äººå¶çš„ä½ç½®ä¸å°†è¦è·³è‡³çš„å°é¢ä¸­å¿ƒçš„è·ç¦»ğ‘‘ï¼›</li>
<li>å°†ä»¥ä¸Šè·ç¦»ğ‘‘æ¢ç®—æˆç›¸åº”çš„è§¦æ‘¸æ—¶é—´ğ‘ ï¼›</li>
<li>å‘é€æ¨¡æ‹Ÿè§¦æ‘¸çš„å‘½ä»¤è‡³æ‰‹æœºï¼Œè§¦æ‘¸æ—¶é—´ä¸ºä»¥ä¸Šæ—¶é—´ğ‘ ï¼›</li>
</ol>
<h3 id="æ­¥éª¤1"><a href="#æ­¥éª¤1" class="headerlink" title="æ­¥éª¤1"></a>æ­¥éª¤1</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç”¨å¦‚ä¸‹å‘½ä»¤å¯æˆªå–æ‰‹æœºå±å¹•å›¾ç‰‡è‡³SDå¡ä¿å­˜ï¼š</span></span><br><span class="line">adb shell screencap -p /mnt/sdcard/screencap.png</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç„¶åå¯ç”¨å¦‚ä¸‹å‘½ä»¤pullå›¾ç‰‡åˆ°ç”µè„‘ï¼š</span></span><br><span class="line">adb pull /mnt/sdcard/screencap.png C:/screencap.png</span><br></pre></td></tr></table></figure>



<h3 id="æ­¥éª¤2"><a href="#æ­¥éª¤2" class="headerlink" title="æ­¥éª¤2"></a>æ­¥éª¤2</h3><p>è¦è®¡ç®—å‡ºäººå¶ä¸å°†è¦è·³è‡³çš„å°é¢ä¸­å¿ƒçš„è·ç¦»ï¼Œéœ€è¦åˆ†åˆ«è¯†åˆ«å‡ºäººå¶çš„ä½ç½®ï¼ˆåæ ‡ï¼‰å’Œå°é¢ä¸­å¿ƒçš„ä½ç½®ï¼ˆåæ ‡ï¼‰ã€‚</p>
<p>æˆ‘ä»¬ä»¥äººå¶æœ€åº•éƒ¨çš„ä¸€è¡Œçš„ä¸­å¿ƒä½œä¸ºäººå¶çš„ä½ç½®ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º:</p>
<p><img src="/images/TIM%E6%88%AA%E5%9B%BE20180114225816.jpg" alt="img"></p>
<p>è‡³äºæ€ä¹ˆè¯†åˆ«å‡ºäººå¶çš„æœ€åº•éƒ¨ï¼Œå¯ä»¥è¿™æ ·æ¥æ“ä½œã€‚é€šè¿‡è§‚å¯Ÿå¯å‘ç°ï¼Œäººå¶åº•éƒ¨çš„é¢œè‰²çš„rgbå€¼åœ¨(53, 57, 95)åˆ°(59, 61, 103)ä¹‹é—´ï¼Œå› æ­¤æˆ‘ä»¬é€è¡Œæ‰«æå„ä¸ªåƒç´ ç‚¹ï¼Œæ‰¾åˆ°rbgå€¼åœ¨è¯¥åŒºé—´çš„å„è¡Œï¼Œæœ€åä¸€è¡Œå³ä¸ºäººå¶çš„åº•éƒ¨äº†ã€‚å¾—åˆ°äº†æœ€åº•éƒ¨çš„ä¸€è¡Œï¼Œè‡ªç„¶å°±èƒ½ç®—å‡ºè¯¥è¡Œçš„ä¸­å¿ƒåæ ‡ã€‚</p>
<p>æ¥ä¸‹æ¥éœ€è¦è¯†åˆ«äººå¶å°†è¦è·³è‡³çš„å¹³å°çš„ä¸­å¿ƒã€‚è¦æƒ³å¾—åˆ°è¯¥ä¸­å¿ƒçš„åæ ‡ï¼Œæˆ‘ä»¬åªéœ€è¦è¯†åˆ«å¾—åˆ°ä¸‹å›¾ä¸­çš„ä¸¤ä¸ªé¡¶ç‚¹vertex1å’Œvertex2çš„åæ ‡å³å¯ï¼š</p>
<p><img src="/images/TIM%E6%88%AA%E5%9B%BE20180114232019.jpg" alt="img"></p>
<p>æˆ‘ä»¬åŒæ ·ç”¨<strong>ä»å·¦å¾€å³ï¼Œä»ä¸Šå¾€ä¸‹çš„é¡ºåºæ‰«æå„ä¸ªåƒç´ ç‚¹çš„æ–¹æ³•æ¥æ‰¾å‡ºvertex1çš„åæ ‡</strong>ã€‚æ‰«æä¹‹å‰å…ˆè·å–æ•´ä¸ªèƒŒæ™¯çš„é¢œè‰²çš„rgbå€¼ï¼Œå–ä»»æ„â€œç©ºç™½â€å¤„å³å¯ï¼ˆä¾‹å¦‚æœ¬äººæ‰‹æœºæˆªå›¾å¤§å°ä¸º1920x1080ï¼Œå¯æ–­å®šåæ ‡ä¸º(40, 500)çš„ç‚¹ä¸€å®šå¤„äºâ€œç©ºç™½â€å¤„ã€‚ï¼‰ã€‚åœ¨æ‰«æè¿‡ç¨‹ä¸­ä¸€æ—¦å‘ç°æŸå¤„çš„é¢œè‰²ä¸èƒŒæ™¯è‰²ä¸ä¸€è‡´ï¼Œå‘ç”Ÿäº†â€œçªå˜â€ï¼Œå¯æ–­å®šè¯¥ç‚¹å³ä¸ºvertex1ã€‚</p>
<p>æˆ‘ä»¬æŠŠvertex1ç‚¹çš„rgbå€¼è®°å½•ä¸‹æ¥ä½œä¸ºå°é¢çš„èƒŒæ™¯è‰²ã€‚åœ¨æ¥ä¸‹å»çš„æ‰«æè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¼€å§‹å…³å¿ƒå½“å‰æ‰«æçš„ç‚¹çš„rgbå€¼æ˜¯å¦å’Œè¯¥è®°å½•å€¼â€œç›¸ä¼¼â€ã€‚â€œç›¸ä¼¼â€åˆ™è¯´æ˜è¯¥ç‚¹â€œå±äºâ€å°é¢ï¼Œè€Œé€šè¿‡ä¸Šå›¾å¯å‘ç°ï¼Œé¡¶ç‚¹vertex2æ˜¯æ‰€æœ‰â€œå±äºâ€å°é¢çš„ç‚¹ä¸­ï¼Œæ¨ªåæ ‡æœ€å°çš„ç‚¹ï¼Œè¿™æ ·vertex2çš„åæ ‡ä¹Ÿæ‰¾åˆ°äº†ã€‚</p>
<p>æ˜¾ç„¶ï¼Œå°é¢ä¸­å¿ƒçš„æ¨ªåæ ‡ç­‰äºvertex1çš„æ¨ªåæ ‡ï¼Œè€Œçºµåæ ‡ç­‰äºvertex2çš„çºµåæ ‡ã€‚</p>
<h3 id="æ­¥éª¤3"><a href="#æ­¥éª¤3" class="headerlink" title="æ­¥éª¤3"></a>æ­¥éª¤3</h3><p>é€šè¿‡å¤šæ¬¡å°è¯•ï¼Œå‘ç°ç”¨å¦‚ä¸‹å…¬å¼è½¬æ¢è·ç¦»ğ‘‘ï¼ˆå•ä½ï¼špxï¼‰ä¸ºæ—¶é—´ğ‘ ï¼ˆå•ä½ï¼šæ¯«ç§’ï¼‰æ¯”è¾ƒåˆé€‚ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">s=dâˆ—1.35</span><br></pre></td></tr></table></figure>



<h3 id="æ­¥éª¤4"><a href="#æ­¥éª¤4" class="headerlink" title="æ­¥éª¤4"></a>æ­¥éª¤4</h3><p>å¾—åˆ°äº†è§¦æ‘¸æ—¶é—´ï¼Œæˆ‘ä»¬è¿˜æ˜¯å€ŸåŠ©adbå·¥å…·æ¥æ¨¡æ‹Ÿè§¦æ‘¸å±å¹•çš„è¡Œä¸ºï¼Œä»¥ä¸‹æ˜¯ç›¸å…³å‘½ä»¤ï¼š</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell input swipe 0 0 0 0 1000</span><br></pre></td></tr></table></figure>

<p>ä»¥ä¸Šå‘½ä»¤çš„æœ€åä¸€ä¸ªå‚æ•°å³ä¸ºéœ€è¦æ¨¡æ‹ŸæŒ‰å‹å±å¹•çš„æ—¶é•¿ï¼Œå•ä½æ˜¯æ¯«ç§’ã€‚</p>
<h3 id="å®Œæ•´ä»£ç "><a href="#å®Œæ•´ä»£ç " class="headerlink" title="å®Œæ•´ä»£ç "></a>å®Œæ•´ä»£ç </h3><p>ä»¥ä¸‹æ˜¯å®Œæ•´ä»£ç ï¼Œåœ¨æœ¬äººæ‰‹æœºï¼ˆ1920 * 1080 ï¼‰ä¸‹æµ‹è¯•å‘ç°å¤§å¤šæ•°æƒ…å†µéƒ½èƒ½æ­£ä¸­é¶å¿ƒï¼Œå°‘æ•°æƒ…å†µä¸èƒ½å‘½ä¸­é¶å¿ƒï¼Œæå°‘æ•°æƒ…å†µä¼šè·³å‡ºå°é¢ä»¥å¤–ã€‚å…¶ä»–åˆ†è¾¨ç‡çš„æ‰‹æœºå¯èƒ½éœ€è¦é€‚å½“ä¿®æ”¹<code>BACKGROUND_POS</code>å’Œ<code>DISTANCE_TO_TIME_RATIO</code>å‚æ•°å¤§å°ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> math</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> tempfile</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> reduce</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"> </span><br><span class="line">BACKGROUND_POS = (<span class="number">40</span>, <span class="number">500</span>)</span><br><span class="line">DISTANCE_TO_TIME_RATIO = <span class="number">1.35</span></span><br><span class="line">SCREENSHOT_PATH = tempfile.gettempdir() + <span class="string">&quot;/screenshot.png&quot;</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">calculate_jump_distance</span>():</span></span><br><span class="line">    im = Image.<span class="built_in">open</span>(SCREENSHOT_PATH)</span><br><span class="line">    background_rgb = im.getpixel(BACKGROUND_POS)</span><br><span class="line"> </span><br><span class="line">    role_pos_list = <span class="literal">None</span></span><br><span class="line">    vertex1_pos = <span class="literal">None</span></span><br><span class="line">    vertex2_pos = <span class="literal">None</span></span><br><span class="line">    block_background_rgb = <span class="literal">None</span></span><br><span class="line">    role_line_flag = <span class="literal">True</span></span><br><span class="line">    <span class="keyword">for</span> y <span class="keyword">in</span> <span class="built_in">range</span>(BACKGROUND_POS[<span class="number">1</span>], im.height):</span><br><span class="line">        <span class="keyword">if</span> role_pos_list <span class="keyword">and</span> role_line_flag:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        role_line_flag = <span class="literal">True</span></span><br><span class="line">        vertex2_line_flag = <span class="literal">True</span></span><br><span class="line">        <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(BACKGROUND_POS[<span class="number">0</span>], im.width):</span><br><span class="line">            current_rgb = im.getpixel((x, y))</span><br><span class="line">            next_rgb = im.getpixel((x + <span class="number">1</span>, y)) <span class="keyword">if</span> x + <span class="number">1</span> &lt; im.width <span class="keyword">else</span> (<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">            <span class="comment"># è¯†åˆ«é¡¶ç‚¹1</span></span><br><span class="line">            <span class="keyword">if</span> x &gt; BACKGROUND_POS[<span class="number">0</span>] <span class="keyword">and</span> y &gt; BACKGROUND_POS[<span class="number">1</span>] <span class="keyword">and</span> <span class="keyword">not</span> vertex1_pos <span class="keyword">and</span> <span class="keyword">not</span> is_similar(background_rgb, current_rgb) <span class="keyword">and</span> is_similar(current_rgb, next_rgb):</span><br><span class="line">                vertex1_pos = (x, y)</span><br><span class="line">                block_background_rgb = current_rgb</span><br><span class="line">            <span class="comment"># è¯†åˆ«é¡¶ç‚¹2</span></span><br><span class="line">            <span class="keyword">if</span> block_background_rgb <span class="keyword">and</span> vertex2_line_flag <span class="keyword">and</span> is_similar(current_rgb, block_background_rgb, <span class="number">5</span>):</span><br><span class="line">                vertex2_line_flag = <span class="literal">False</span></span><br><span class="line">                <span class="keyword">if</span> vertex2_pos:</span><br><span class="line">                    <span class="keyword">if</span> x &lt; vertex2_pos[<span class="number">0</span>] <span class="keyword">and</span> vertex2_pos[<span class="number">0</span>] - x &lt; <span class="number">20</span> <span class="keyword">and</span> y - vertex2_pos[<span class="number">1</span>] &lt; <span class="number">20</span>:</span><br><span class="line">                        vertex2_pos = (x, y)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    vertex2_pos = (x, y)</span><br><span class="line">            <span class="comment"># è¯†åˆ«å°äºº</span></span><br><span class="line">            <span class="keyword">if</span> is_part_of_role(current_rgb):</span><br><span class="line">                <span class="keyword">if</span> role_line_flag:</span><br><span class="line">                    role_pos_list = []</span><br><span class="line">                    role_line_flag = <span class="literal">False</span></span><br><span class="line">                role_pos_list.append((x, y))</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(role_pos_list) == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">raise</span> Exception(<span class="string">&#x27;æ— æ³•è¯†åˆ«å°äººä½ç½®ï¼ï¼ï¼&#x27;</span>)</span><br><span class="line">    pos_sum = reduce((<span class="keyword">lambda</span> o1, o2: (o1[<span class="number">0</span>] + o2[<span class="number">0</span>], o1[<span class="number">1</span>] + o2[<span class="number">1</span>])), role_pos_list)</span><br><span class="line">    role_pos = (<span class="built_in">int</span>(pos_sum[<span class="number">0</span>] / <span class="built_in">len</span>(role_pos_list)), <span class="built_in">int</span>(pos_sum[<span class="number">1</span>] / <span class="built_in">len</span>(role_pos_list)))</span><br><span class="line">    destination_pos = (vertex1_pos[<span class="number">0</span>], vertex2_pos[<span class="number">1</span>])</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">int</span>(linear_distance(role_pos, destination_pos))</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">is_part_of_role</span>(<span class="params">rgb</span>):</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">53</span> &lt; rgb[<span class="number">0</span>] &lt; <span class="number">59</span> <span class="keyword">and</span> <span class="number">57</span> &lt; rgb[<span class="number">1</span>] &lt; <span class="number">61</span> <span class="keyword">and</span> <span class="number">95</span> &lt; rgb[<span class="number">2</span>] &lt; <span class="number">103</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">linear_distance</span>(<span class="params">xy1, xy2</span>):</span></span><br><span class="line">    <span class="keyword">return</span> math.sqrt(<span class="built_in">pow</span>(xy1[<span class="number">0</span>] - xy2[<span class="number">0</span>], <span class="number">2</span>) + <span class="built_in">pow</span>(xy1[<span class="number">1</span>] - xy2[<span class="number">1</span>], <span class="number">2</span>))</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">is_similar</span>(<span class="params">rgb1, rgb2, degree=<span class="number">10</span></span>):</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">abs</span>(rgb1[<span class="number">0</span>] - rgb2[<span class="number">0</span>]) &lt;= degree <span class="keyword">and</span> <span class="built_in">abs</span>(rgb1[<span class="number">1</span>] - rgb2[<span class="number">1</span>]) &lt;= degree <span class="keyword">and</span> <span class="built_in">abs</span>(rgb1[<span class="number">2</span>] - rgb2[<span class="number">2</span>]) &lt;= degree</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">screenshot</span>():</span></span><br><span class="line">    os.system(<span class="string">&quot;adb shell screencap -p /mnt/sdcard/screencap.png&quot;</span>)</span><br><span class="line">    os.system(<span class="string">&quot;adb pull /mnt/sdcard/screencap.png &#123;&#125; &gt;&gt; &#123;&#125;/jump.out&quot;</span>.<span class="built_in">format</span>(SCREENSHOT_PATH, tempfile.gettempdir()))</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">jump</span>(<span class="params">touch_time</span>):</span></span><br><span class="line">    os.system(<span class="string">&quot;adb shell input swipe 0 0 0 0 &#123;&#125;&quot;</span>.<span class="built_in">format</span>(touch_time))</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">distance2time</span>(<span class="params">distance</span>):</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">int</span>(distance * DISTANCE_TO_TIME_RATIO)</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    count = <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        screenshot()</span><br><span class="line">        distance = calculate_jump_distance()</span><br><span class="line">        touch_time = distance2time(distance)</span><br><span class="line">        jump(touch_time)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;#&#123;&#125;: distance=&#123;&#125;, time=&#123;&#125;&quot;</span>.<span class="built_in">format</span>(count, distance, touch_time))</span><br><span class="line">        count += <span class="number">1</span></span><br><span class="line">        time.sleep(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">  main()</span><br></pre></td></tr></table></figure>



<h2 id="å¦‚æœæƒ³ä½¿ç”¨æ¡†æ¶ï¼Œå¯ä»¥è¯•è¯•Appiumå’Œpocoui"><a href="#å¦‚æœæƒ³ä½¿ç”¨æ¡†æ¶ï¼Œå¯ä»¥è¯•è¯•Appiumå’Œpocoui" class="headerlink" title="å¦‚æœæƒ³ä½¿ç”¨æ¡†æ¶ï¼Œå¯ä»¥è¯•è¯•Appiumå’Œpocoui"></a>å¦‚æœæƒ³ä½¿ç”¨æ¡†æ¶ï¼Œå¯ä»¥è¯•è¯•Appiumå’Œpocoui</h2></div></div></article><link rel="stylesheet" type="text/css" href="/css/font.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.css"><script src="//cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script><script src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script>$(document).ready(function() {
  $(".fancybox").fancybox();
});
</script></body></html>
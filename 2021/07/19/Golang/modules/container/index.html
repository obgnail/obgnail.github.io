<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content=" id=&quot;container-heap&quot;&gt;&lt;a href=&quot;#container-heap&quot; class=&quot;headerlink&quot; title=&quot;container/heap&quot;&gt;&lt;/a&gt;container/heap&lt;/h1&gt;&lt;h2 id=&quot;Interface&quot;&gt;&lt;a href=&quot;#Interface&quot; class=&quot;headerlink&quot; title=&quot;#Interface&quot;&gt;&lt;/a&gt;&lt;a href=&quot;https://syaning.github.io/go-pkgs/container/heap.html#interface&quot;&gt;#&lt;/a&gt;Interface&lt;/h2&gt;&lt;p&gt;关于堆的介绍参看&lt;a href=&quot;https://en.wikipedia.org/wiki/Heap_(data_structure)&quot;&gt;Heap&lt;/a&gt;。"><link rel="stylesheet" type="text/css" href="/css/normalize.css"><link rel="stylesheet" type="text/css" href="/css/highlight.css"><link rel="stylesheet" type="text/css" href="/css/noise.css"><title>container | 凉薄的自动书记人偶</title><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><meta name="generator" content="Hexo 5.4.0"></head><body><article class="wrapper"><div class="post-main"><div class="nav"><nav class="container"><a class="sidebar-nav-item active" href="/">Home</a><a class="sidebar-nav-item" href="/archives">Tags</a><a class="sidebar-nav-item" href="/About">About</a></nav><div class="container post-meta"><div class="post-tags"><a class="post-tag-link" href="/tags/Golang/" rel="tag">Golang</a></div><div class="post-time">2021-07-19</div></div></div><div class="container post-header"><h1>container</h1></div><div class="container post-toc"><details class="toc"><summary class="toc-accordion">Table of Contents</summary><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#container-heap"><span class="toc-number">1.</span> <span class="toc-text">container&#x2F;heap</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Interface"><span class="toc-number">1.1.</span> <span class="toc-text">Interface</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#down-%E5%92%8C-up"><span class="toc-number">1.2.</span> <span class="toc-text">down 和 up</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Init"><span class="toc-number">1.3.</span> <span class="toc-text">Init</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Push"><span class="toc-number">1.4.</span> <span class="toc-text">Push</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Pop"><span class="toc-number">1.5.</span> <span class="toc-text">Pop</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Remove"><span class="toc-number">1.6.</span> <span class="toc-text">Remove</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Fix"><span class="toc-number">1.7.</span> <span class="toc-text">Fix</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#container-list"><span class="toc-number">2.</span> <span class="toc-text">container&#x2F;list</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Element"><span class="toc-number">2.1.</span> <span class="toc-text">Element</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#List"><span class="toc-number">2.2.</span> <span class="toc-text">List</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#container-ring"><span class="toc-number">3.</span> <span class="toc-text">container&#x2F;ring</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Next-%E5%92%8C-Prev"><span class="toc-number">3.1.</span> <span class="toc-text">Next 和 Prev</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Len"><span class="toc-number">3.2.</span> <span class="toc-text">Len</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Move"><span class="toc-number">3.3.</span> <span class="toc-text">Move</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Link-%E5%92%8C-Unlink"><span class="toc-number">3.4.</span> <span class="toc-text">Link 和 Unlink</span></a></li></ol></li></ol></details></div><div class="container post-content"><h1 id="container-heap"><a href="#container-heap" class="headerlink" title="container/heap"></a>container/heap</h1><h2 id="Interface"><a href="#Interface" class="headerlink" title="#Interface"></a><a target="_blank" rel="noopener" href="https://syaning.github.io/go-pkgs/container/heap.html#interface">#</a>Interface</h2><p>关于堆的介绍参看<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Heap_(data_structure)">Heap</a>。</p>
<p>在Go中实现的是一个最小堆，即每个节点的值总是以该节点为根节点的子树的最小值。同时应当注意到，对于任意一个节点，假设其下表为<code>i</code>，则其父节点下标为<code>(i - 1) / 2</code>，其左子节点下标为<code>2 * i + 1</code>，其右子节点下标为<code>2 * i + 2</code>。</p>
<p>在heap包中，定义了一个<code>heap.Interface</code>接口，只要实现该接口的数据结构，都可以作为一个堆来使用。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Interface <span class="keyword">interface</span> &#123;</span><br><span class="line">    sort.Interface</span><br><span class="line">    Push(x <span class="keyword">interface</span>&#123;&#125;) <span class="comment">// add x as element Len()</span></span><br><span class="line">    Pop() <span class="keyword">interface</span>&#123;&#125;   <span class="comment">// remove and return element Len() - 1.</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="down-和-up"><a href="#down-和-up" class="headerlink" title="#down 和 up"></a><a target="_blank" rel="noopener" href="https://syaning.github.io/go-pkgs/container/heap.html#down-%E5%92%8C-up">#</a>down 和 up</h2><p>heap操作中最重要的两个方法是<code>down</code>和<code>up</code>。</p>
<p><code>down</code>让一个节点下沉：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">down</span><span class="params">(h Interface, i0, n <span class="keyword">int</span>)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">    i := i0</span><br><span class="line">    <span class="keyword">for</span> &#123;</span><br><span class="line">        <span class="comment">// j1为左子节点下标</span></span><br><span class="line">        j1 := <span class="number">2</span>*i + <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> j1 &gt;= n || j1 &lt; <span class="number">0</span> &#123; <span class="comment">// j1 &lt; 0 after int overflow</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        &#125;</span><br><span class="line">        j := j1 <span class="comment">// left child</span></span><br><span class="line">        <span class="comment">// j2为右子节点下标，j为最小的子节点的下标</span></span><br><span class="line">        <span class="keyword">if</span> j2 := j1 + <span class="number">1</span>; j2 &lt; n &amp;&amp; !h.Less(j1, j2) &#123;</span><br><span class="line">            j = j2 <span class="comment">// = 2*i + 2  // right child</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 如果最小的子节点不小于父节点，则已经满足最小堆条件，退出</span></span><br><span class="line">        <span class="keyword">if</span> !h.Less(j, i) &#123;</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 如果最小的子节点小于父节点，则交换这两个节点</span></span><br><span class="line">        h.Swap(i, j)</span><br><span class="line">        <span class="comment">// 让父节点继续下沉</span></span><br><span class="line">        i = j</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> i &gt; i0</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>up</code>让一个节点上升：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">up</span><span class="params">(h Interface, j <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> &#123;</span><br><span class="line">        <span class="comment">// i为父节点下标</span></span><br><span class="line">        i := (j - <span class="number">1</span>) / <span class="number">2</span> <span class="comment">// parent</span></span><br><span class="line">        <span class="comment">// 如果该节点不小于父节点，则满足最小堆条件，退出</span></span><br><span class="line">        <span class="keyword">if</span> i == j || !h.Less(j, i) &#123;</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 如果该节点小于父节点，则交换这两个节点</span></span><br><span class="line">        h.Swap(i, j)</span><br><span class="line">        <span class="comment">// 让该节点继续上升</span></span><br><span class="line">        j = i</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="Init"><a href="#Init" class="headerlink" title="#Init"></a><a target="_blank" rel="noopener" href="https://syaning.github.io/go-pkgs/container/heap.html#init">#</a>Init</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Init</span><span class="params">(h Interface)</span></span> &#123;</span><br><span class="line">    n := h.Len()</span><br><span class="line">    <span class="comment">// 最后一个节点下表为n-1，因此其父节点为(n-1-1)/2，即n/2-1</span></span><br><span class="line">    <span class="keyword">for</span> i := n/<span class="number">2</span> - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i-- &#123;</span><br><span class="line">        down(h, i, n)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="Push"><a href="#Push" class="headerlink" title="#Push"></a><a target="_blank" rel="noopener" href="https://syaning.github.io/go-pkgs/container/heap.html#push">#</a>Push</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Push</span><span class="params">(h Interface, x <span class="keyword">interface</span>&#123;&#125;)</span></span> &#123;</span><br><span class="line">    h.Push(x)</span><br><span class="line">    up(h, h.Len()<span class="number">-1</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>Push</code>的时候，先把新元素放置在结尾，然后让其上升。</p>
<h2 id="Pop"><a href="#Pop" class="headerlink" title="#Pop"></a><a target="_blank" rel="noopener" href="https://syaning.github.io/go-pkgs/container/heap.html#pop">#</a>Pop</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Pop</span><span class="params">(h Interface)</span> <span class="title">interface</span></span>&#123;&#125; &#123;</span><br><span class="line">    n := h.Len() - <span class="number">1</span></span><br><span class="line">    h.Swap(<span class="number">0</span>, n)</span><br><span class="line">    down(h, <span class="number">0</span>, n)</span><br><span class="line">    <span class="keyword">return</span> h.Pop()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>Pop</code>的时候，先把根节点和最后一个节点交换位置，然后让新的根节点下降。注意这里<code>down</code>的第三个参数是<code>n</code>的值为<code>h.Len() - 1</code>，因此新的根节点下降的过程中，原先的根节点位于最后的位置，不受影响。</p>
<h2 id="Remove"><a href="#Remove" class="headerlink" title="#Remove"></a><a target="_blank" rel="noopener" href="https://syaning.github.io/go-pkgs/container/heap.html#remove">#</a>Remove</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Remove</span><span class="params">(h Interface, i <span class="keyword">int</span>)</span> <span class="title">interface</span></span>&#123;&#125; &#123;</span><br><span class="line">    n := h.Len() - <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> n != i &#123;</span><br><span class="line">        h.Swap(i, n)</span><br><span class="line">        down(h, i, n)</span><br><span class="line">        up(h, i)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> h.Pop()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>Remove</code>操作与<code>Pop</code>非常类似，先将需要移除的节点和最后一个节点交换位置，然后同时进行<code>down</code>和<code>up</code>操作。</p>
<h2 id="Fix"><a href="#Fix" class="headerlink" title="#Fix"></a><a target="_blank" rel="noopener" href="https://syaning.github.io/go-pkgs/container/heap.html#fix">#</a>Fix</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Fix</span><span class="params">(h Interface, i <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> !down(h, i, h.Len()) &#123;</span><br><span class="line">        up(h, i)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>当某个节点的值改变后，通过<code>Fix</code>操作来调整堆的结构。该操作实际上也是同时进行了<code>down</code>和<code>up</code>操作。</p>
<p>与先移除旧节点再添加新节点相比，<code>Fix</code>操作的复杂度要低一些。</p>
<h1 id="container-list"><a href="#container-list" class="headerlink" title="container/list"></a>container/list</h1><p>list定义了一个双向链表。</p>
<h2 id="Element"><a href="#Element" class="headerlink" title="#Element"></a><a target="_blank" rel="noopener" href="https://syaning.github.io/go-pkgs/container/list.html#element">#</a>Element</h2><p>list的元素定义如下：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Element <span class="keyword">struct</span> &#123;</span><br><span class="line">    <span class="comment">// Next and previous pointers in the doubly-linked list of elements.</span></span><br><span class="line">    <span class="comment">// The front of the list has prev = nil, and the back has next = nil.</span></span><br><span class="line">    next, prev *Element</span><br><span class="line"></span><br><span class="line">    <span class="comment">// The list to which this element belongs.</span></span><br><span class="line">    list *List</span><br><span class="line"></span><br><span class="line">    <span class="comment">// The contents of this list element.</span></span><br><span class="line">    Value <span class="keyword">interface</span>&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Element定义了<code>Next()</code>和<code>Prev()</code>方法，定义如下：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Next returns the next list element or nil.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(e *Element)</span> <span class="title">Next</span><span class="params">()</span> *<span class="title">Element</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> p := e.next; e.list != <span class="literal">nil</span> &amp;&amp; p != &amp;e.list.root &#123;</span><br><span class="line">        <span class="keyword">return</span> p</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Prev returns the previous list element or nil.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(e *Element)</span> <span class="title">Prev</span><span class="params">()</span> *<span class="title">Element</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> p := e.prev; e.list != <span class="literal">nil</span> &amp;&amp; p != &amp;e.list.root &#123;</span><br><span class="line">        <span class="keyword">return</span> p</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>总的来说，这两个方法的执行逻辑是：</p>
<ul>
<li>如果该元素在某一个链表上，且其前一个（后一个）元素不是链表的根元素，则返回其前一个（后一个）元素</li>
<li>其它情况下，即如果该元素不属于任何链表，或者其前一个（后一个）元素为链表的根元素，则返回<code>nil</code>（即：链表的根元素只起到一个占位作用，而并不会存储数据值）</li>
</ul>
<h2 id="List"><a href="#List" class="headerlink" title="#List"></a><a target="_blank" rel="noopener" href="https://syaning.github.io/go-pkgs/container/list.html#list">#</a>List</h2><p>通过<code>New()</code>方法可以创建一个新的链表：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// List represents a doubly linked list.</span></span><br><span class="line"><span class="comment">// The zero value for List is an empty list ready to use.</span></span><br><span class="line"><span class="keyword">type</span> List <span class="keyword">struct</span> &#123;</span><br><span class="line">    root Element <span class="comment">// sentinel list element, only &amp;root, root.prev, and root.next are used</span></span><br><span class="line">    <span class="built_in">len</span>  <span class="keyword">int</span>     <span class="comment">// current list length excluding (this) sentinel element</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Init initializes or clears list l.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l *List)</span> <span class="title">Init</span><span class="params">()</span> *<span class="title">List</span></span> &#123;</span><br><span class="line">    l.root.next = &amp;l.root</span><br><span class="line">    l.root.prev = &amp;l.root</span><br><span class="line">    l.<span class="built_in">len</span> = <span class="number">0</span></span><br><span class="line">    <span class="keyword">return</span> l</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// New returns an initialized list.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">New</span><span class="params">()</span> *<span class="title">List</span></span> &#123; <span class="keyword">return</span> <span class="built_in">new</span>(List).Init() &#125;</span><br></pre></td></tr></table></figure>

<p>可以看到，<code>New()</code>实际上调用了<code>Init()</code>方法，主要作用就是初始化一个链表的根元素。</p>
<p>事实上，List是一个首尾相连的环状结构，只不过由于根元素只是起到了占位作用，对外是不可见的，因此对于用户操作来说，看到的是一个链状结构。</p>
<p>其相关操作以及源码都比较简单，不做赘述。下面是一个例子：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;container/list&quot;</span></span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    l := list.New()</span><br><span class="line"></span><br><span class="line">    l.PushBack(<span class="string">&quot;a&quot;</span>)</span><br><span class="line">    printList(l) <span class="comment">// a</span></span><br><span class="line"></span><br><span class="line">    l.PushBack(<span class="string">&quot;b&quot;</span>)</span><br><span class="line">    printList(l) <span class="comment">// a b</span></span><br><span class="line"></span><br><span class="line">    l.PushFront(<span class="string">&quot;c&quot;</span>)</span><br><span class="line">    printList(l) <span class="comment">// c a b</span></span><br><span class="line"></span><br><span class="line">    fmt.Println(l.Front().Value) <span class="comment">// c</span></span><br><span class="line">    fmt.Println(l.Back().Value)  <span class="comment">// b</span></span><br><span class="line">    fmt.Println(l.Len())         <span class="comment">// 3</span></span><br><span class="line"></span><br><span class="line">    l.MoveToBack(l.Front())</span><br><span class="line">    printList(l) <span class="comment">// a b c</span></span><br><span class="line"></span><br><span class="line">    l.MoveToFront(l.Back())</span><br><span class="line">    printList(l) <span class="comment">// c a b</span></span><br><span class="line"></span><br><span class="line">    l.Remove(l.Back())</span><br><span class="line">    printList(l) <span class="comment">// c a</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">printList</span><span class="params">(l *list.List)</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> e := l.Front(); e != <span class="literal">nil</span>; e = e.Next() &#123;</span><br><span class="line">        fmt.Print(e.Value, <span class="string">&quot; &quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    fmt.Println()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="container-ring"><a href="#container-ring" class="headerlink" title="container/ring"></a>container/ring</h1><p>ring是一个首尾相连的list。其中每一个元素的定义如下：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Ring <span class="keyword">struct</span> &#123;</span><br><span class="line">    next, prev *Ring</span><br><span class="line">    Value      <span class="keyword">interface</span>&#123;&#125; <span class="comment">// for use by client; untouched by this library</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>通过<code>New</code>方法可以创建一个特定大小的ring，例如：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">r := ring.New(<span class="number">5</span>)</span><br></pre></td></tr></table></figure>



<h2 id="Next-和-Prev"><a href="#Next-和-Prev" class="headerlink" title="#Next 和 Prev"></a><a target="_blank" rel="noopener" href="https://syaning.github.io/go-pkgs/container/ring.html#next-%E5%92%8C-prev">#</a>Next 和 Prev</h2><p><code>Next</code>和<code>Prev</code>操作比较简单，不做赘述。</p>
<h2 id="Len"><a href="#Len" class="headerlink" title="#Len"></a><a target="_blank" rel="noopener" href="https://syaning.github.io/go-pkgs/container/ring.html#len">#</a>Len</h2><p>通过遍历整个ring来统计元素的个数。</p>
<h2 id="Move"><a href="#Move" class="headerlink" title="#Move"></a><a target="_blank" rel="noopener" href="https://syaning.github.io/go-pkgs/container/ring.html#move">#</a>Move</h2><p><code>Move</code>操作用来获取某个元素之前或者之后的某个元素。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r *Ring)</span> <span class="title">Move</span><span class="params">(n <span class="keyword">int</span>)</span> *<span class="title">Ring</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> r.next == <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> r.init()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">switch</span> &#123;</span><br><span class="line">    <span class="comment">// 向前找</span></span><br><span class="line">    <span class="keyword">case</span> n &lt; <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">for</span> ; n &lt; <span class="number">0</span>; n++ &#123;</span><br><span class="line">            r = r.prev</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="comment">// 向后找</span></span><br><span class="line">    <span class="keyword">case</span> n &gt; <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">for</span> ; n &gt; <span class="number">0</span>; n-- &#123;</span><br><span class="line">            r = r.next</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> r</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Link-和-Unlink"><a href="#Link-和-Unlink" class="headerlink" title="#Link 和 Unlink"></a><a target="_blank" rel="noopener" href="https://syaning.github.io/go-pkgs/container/ring.html#link-%E5%92%8C-unlink">#</a>Link 和 Unlink</h2><p><code>Link</code>操作可以将两个ring连接起来，比较简单，不做赘述。</p>
<p><code>Unlink</code>可以移除某个元素后面的若干个元素：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r *Ring)</span> <span class="title">Unlink</span><span class="params">(n <span class="keyword">int</span>)</span> *<span class="title">Ring</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> n &lt;= <span class="number">0</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> r.Link(r.Move(n + <span class="number">1</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>Unlink</code>操作实际上是将起始点与移除后的下一个点进行了<code>Link</code>操作，这样中间需要被移除的点就不再出现在该ring中了。</p>
</div></div></article><link rel="stylesheet" type="text/css" href="/css/font.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.css"><script src="//cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script><script src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script>$(document).ready(function() {
  $(".fancybox").fancybox();
});
</script></body></html>
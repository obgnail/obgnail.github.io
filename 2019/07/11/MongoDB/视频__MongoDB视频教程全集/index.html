<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="RDBMS(Relational Database Management System):&lt;br&gt;关系型数据库."><link rel="stylesheet" type="text/css" href="/css/normalize.css"><link rel="stylesheet" type="text/css" href="/css/highlight.css"><link rel="stylesheet" type="text/css" href="/css/noise.css"><title>MongoDB视频教程全集 | 凉薄的自动书记人偶</title><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><meta name="generator" content="Hexo 5.4.0"></head><body><article class="wrapper"><div class="post-main"><div class="nav"><nav class="container"><a class="sidebar-nav-item active" href="/">Home</a></nav><div class="container post-meta"><div class="post-tags"><a class="post-tag-none-link" href="/tags/MongoDB/" rel="tag">MongoDB</a></div><div class="post-time">2019-07-11</div></div></div><div class="container post-header"><h1>MongoDB视频教程全集</h1></div><div class="container post-toc"><details class="toc"><summary class="toc-accordion">Table of Contents</summary><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%93%8D%E4%BD%9CmongoDB%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">1.</span> <span class="toc-text">操作mongoDB数据库</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E9%9B%86%E5%90%88"><span class="toc-number">2.</span> <span class="toc-text">操作集合</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E6%96%87%E6%A1%A3"><span class="toc-number">3.</span> <span class="toc-text">操作文档</span></a></li></ol></details></div><div class="container post-content"><p>RDBMS(Relational Database Management System):<br>关系型数据库.</p>
<p>MongoDB属于<strong>文档数据库</strong></p>
<p>MongoDB的数据模型是面向文档的，所谓文档是一种类似于JSON的结构，简单理解MongoDB这个数据库中存的是各种各样的JSON(BSON)</p>
<blockquote>
<p><code>BSON</code>中的<code>B</code>为<code>Binary</code>就是说这其实是一个二进制的JSON文件</p>
</blockquote>
<ul>
<li>数据库（database）数据库是一个仓库，在仓库中可以存放集合。</li>
<li>集合（collection）集合类似于数组，在集合中可以存放文档。</li>
<li>文档（document）文档数据库中的最小单位，我们存储和操作的内容都是文档。</li>
</ul>
<hr>
<p>展示数据库</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">show dbs</span><br><span class="line"><span class="comment">#或者</span></span><br><span class="line">show databases</span><br></pre></td></tr></table></figure>

<p>进入数据库</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">use <span class="built_in">test</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看当前数据库</span></span><br><span class="line">db</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意:在mongo中,数据库和集合都不需要手动创建.<br>当我们创建文档时，如果文档所在的集合或数据库不存在会自动创建数据和集合</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看数据库的集合(很想MySQL的show tables)</span></span><br><span class="line">show collections</span><br></pre></td></tr></table></figure>





<table>
<thead>
<tr>
<th>SQL术语</th>
<th>MongoDB术语</th>
<th>解释说明</th>
</tr>
</thead>
<tbody><tr>
<td>database</td>
<td>database</td>
<td>数据库</td>
</tr>
<tr>
<td>table</td>
<td>collecion</td>
<td>数据库表/集合</td>
</tr>
<tr>
<td>row</td>
<td>document</td>
<td>数据记录行/文档</td>
</tr>
<tr>
<td>column</td>
<td>field</td>
<td>数据字段/域</td>
</tr>
<tr>
<td>index</td>
<td>index</td>
<td>索引</td>
</tr>
<tr>
<td>table joins</td>
<td></td>
<td>表连接MongoDB不支持</td>
</tr>
<tr>
<td>primary key</td>
<td>primary key</td>
<td>主键,MongoDB自动将_id设置为主键</td>
</tr>
</tbody></table>
<p>文档:<br>{name：“张三”，age：20，hobby：{“看书”，“旅游”，“唱歌”}}</p>
<p>注意:</p>
<ol>
<li><strong>文档中的键/值对是有序的</strong>。</li>
<li>文档的键必须是字符串</li>
</ol>
<p>如果将文档类比成数据库中的行，那么集合就可以类比成数据库的表</p>
<p>在mongodb中的集合是无模式的，也就是说集合中存储的文档的结构可以是不同的，比如下面的两个文档可以同时存入到一个集合中:<br>{“name”:”hyl”}<br>{“name”:”hyl”,”age”:1}</p>
<table>
<thead>
<tr>
<th align="left"><strong>Type</strong></th>
<th align="left"><strong>Number</strong></th>
<th align="left"><strong>String</strong></th>
<th align="left"><strong>Notes</strong></th>
</tr>
</thead>
<tbody><tr>
<td align="left">Double</td>
<td align="left">1</td>
<td align="left">“double”</td>
<td align="left">—–</td>
</tr>
<tr>
<td align="left">字符串</td>
<td align="left">2</td>
<td align="left">“string”</td>
<td align="left">—–</td>
</tr>
<tr>
<td align="left">对象</td>
<td align="left">3</td>
<td align="left">“object”</td>
<td align="left">—–</td>
</tr>
<tr>
<td align="left">数组</td>
<td align="left">4</td>
<td align="left">“array”</td>
<td align="left">—–</td>
</tr>
<tr>
<td align="left">二进制数据</td>
<td align="left">5</td>
<td align="left">“binData”</td>
<td align="left">—–</td>
</tr>
<tr>
<td align="left">未定义</td>
<td align="left">6</td>
<td align="left">“undefined”</td>
<td align="left">已过期</td>
</tr>
<tr>
<td align="left">ObjectId</td>
<td align="left">7</td>
<td align="left">“objectId”</td>
<td align="left">—–</td>
</tr>
<tr>
<td align="left">Boolean</td>
<td align="left">8</td>
<td align="left">“bool”</td>
<td align="left">—–</td>
</tr>
<tr>
<td align="left">日期</td>
<td align="left">9</td>
<td align="left">“date”</td>
<td align="left">—–</td>
</tr>
<tr>
<td align="left">空</td>
<td align="left">10</td>
<td align="left">“null”</td>
<td align="left">—–</td>
</tr>
<tr>
<td align="left">正则表达式</td>
<td align="left">11</td>
<td align="left">“regex”</td>
<td align="left">—–</td>
</tr>
<tr>
<td align="left">DBPointer</td>
<td align="left">12</td>
<td align="left">“dbPointer”</td>
<td align="left">已过期</td>
</tr>
<tr>
<td align="left">JavaScript(代码)</td>
<td align="left">13</td>
<td align="left">“javascript”</td>
<td align="left">此数据类型用于将JavaScript代码存储到文档中</td>
</tr>
<tr>
<td align="left">符号</td>
<td align="left">14</td>
<td align="left">“symbol”</td>
<td align="left">已过期</td>
</tr>
<tr>
<td align="left">JavaScript(带范围)</td>
<td align="left">15</td>
<td align="left">“javascriptWithScope”</td>
<td align="left">—–</td>
</tr>
<tr>
<td align="left">32位整数</td>
<td align="left">16</td>
<td align="left">“int”</td>
<td align="left">—–</td>
</tr>
<tr>
<td align="left">时间戳</td>
<td align="left">17</td>
<td align="left">“timestamp”</td>
<td align="left">—–</td>
</tr>
<tr>
<td align="left">64位整数</td>
<td align="left">18</td>
<td align="left">“long”</td>
<td align="left">—–</td>
</tr>
<tr>
<td align="left">Decimal128</td>
<td align="left">19</td>
<td align="left">“decimal”</td>
<td align="left">New in version 3.4</td>
</tr>
<tr>
<td align="left">Min key</td>
<td align="left">-1</td>
<td align="left">“minKey”</td>
<td align="left">—–</td>
</tr>
<tr>
<td align="left">Max key</td>
<td align="left">127</td>
<td align="left">“maxKey”</td>
<td align="left">—–</td>
</tr>
</tbody></table>
<h2 id="操作mongoDB数据库"><a href="#操作mongoDB数据库" class="headerlink" title="操作mongoDB数据库"></a>操作mongoDB数据库</h2><ol>
<li><p>创建数据库:<br>如果数据库不存在则创建数据库,否则切换到指定的数据库</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">use 数据库名</span><br></pre></td></tr></table></figure></li>
<li><p>查看所有数据库:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show dbs</span><br></pre></td></tr></table></figure>

<p>注意:刚创建的数据库是不能显示的.必须插入数据库才能显示</p>
</li>
<li><p>查看当前正在使用的数据库</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db</span><br></pre></td></tr></table></figure>

<p>或:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.getName()</span><br></pre></td></tr></table></figure></li>
<li><p>删除数据库:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.dropDatabase()</span><br></pre></td></tr></table></figure></li>
<li><p>插入数据</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.student.insert(&#123;name:&quot;hyl&quot;,age:18,gender:1,address:&quot;北京&quot;&#125;)</span><br></pre></td></tr></table></figure></li>
<li><p>断开连接:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">exit</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="操作集合"><a href="#操作集合" class="headerlink" title="操作集合"></a>操作集合</h2><ol>
<li><p>查看当前数据库下有哪些集合</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show collections</span><br></pre></td></tr></table></figure></li>
<li><p>创建集合</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.createCollection(&quot;集合名&quot;)</span><br></pre></td></tr></table></figure>

<p>或者:<br>创建一个空的集合并添加一个文档</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.集合名.insert(document)</span><br></pre></td></tr></table></figure></li>
<li><p>删除当前数据库中的集合</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.集合名.drop(document)</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="操作文档"><a href="#操作文档" class="headerlink" title="操作文档"></a>操作文档</h2><ol>
<li><p>插入文件</p>
<ul>
<li><p>使用 insert()方法插入文档</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.集合名.insert(document)</span><br></pre></td></tr></table></figure>

<p>eg:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.student.insert(&#123;name:&quot;hyl&quot;,age:18,gender:1,address:&quot;北京&quot;&#125;)</span><br></pre></td></tr></table></figure>

<p>如果要插入多条数据:<br>注意要<strong>添加中括号</strong>:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">db.student.insert(</span><br><span class="line">[&#123;name:&quot;hyl&quot;,age:18,gender:1,address:&quot;北京&quot;&#125;,</span><br><span class="line">&#123;name:&quot;dsz&quot;,age:15,gender:0,address:&quot;广州&quot;&#125;,])</span><br></pre></td></tr></table></figure></li>
<li><p>使用save方法插入文档:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.集合名.save(文档)</span><br></pre></td></tr></table></figure>

<p>如果不指定<strong>_id字段</strong>，save（）方法类似于 Insert（）方法.如果指定_id字段,则会更新_id字段的数据.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">db.student.save(</span><br><span class="line">&#123;name:&quot;hyl&quot;,age:18,gender:1,address:&quot;北京&quot;&#125;)</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">db.student.save(</span><br><span class="line">&#123;_id:ObjectId(5995096201 723fe2a0d8d17&quot;&#125;,name:&quot;poi&quot;,age:22,gender:7 address:&quot;石家庄&quot;,isDelete:e&#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>文档更新:</p>
<ul>
<li><p>update()方法用于更新已经存在的文档</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">db.集合名.update(</span><br><span class="line">	query,</span><br><span class="line">	update,</span><br><span class="line">	&#123;</span><br><span class="line">        upset:&lt;boolean&gt;,</span><br><span class="line">        multi:&lt;boolean&gt;,</span><br><span class="line">        writeConcern:&lt;document&gt;</span><br><span class="line">	&#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>参数说明:</p>
<ol>
<li>query:<br>updata的查询条件,类似于sql里的update语句内where后面的内容.</li>
<li>update:<br>update的对象和一些更新的操作符($set,​$inc)等</li>
<li>upset:<br>可选.如果不存在update的记录,是否当成新数据插入,true为插入,False为不插入(默认False)</li>
<li>multi:<br>可选.如果查找到多条数据,是否更新全部数据,否则只更新一条数据(默认False)</li>
<li>writeConcern:<br>可选,抛出异常的级别.</li>
</ol>
</li>
</ul>
</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// 示例:将李雷的年龄更新为25</span><br><span class="line">db.student.update(&#123;name:&quot;lilei&quot;&#125;,&#123;$set:&#123;age:25&#125;&#125;)</span><br><span class="line"></span><br><span class="line">// 将所有名字是李雷的人年龄更新为25</span><br><span class="line">db.student.update(&#123;name:&quot;lilei&quot;&#125;,&#123;$set:&#123;age:25&#125;&#125;,&#123;mutil:true&#125;)</span><br></pre></td></tr></table></figure>

<p>删除集合的某个文档:<code>$unset</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.student.update(&#123;name:&quot;lilei&quot;&#125;,&#123;$unset:&#123;age:25&#125;&#125;)</span><br></pre></td></tr></table></figure>

<ul>
<li><p>save()方法通过传入的文档<strong>替换</strong>已有文档:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">db.集合名.save(</span><br><span class="line">	document,</span><br><span class="line">	&#123;</span><br><span class="line">        writeConcern:&lt;document&gt;</span><br><span class="line">	&#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure></li>
</ul>
<ol start="3">
<li><p>文档删除</p>
<ul>
<li><p>说明：在执行 remove（）函数前，先执行find命令来判断执行的条件是否存在是一个良好习惯</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">db.集合名.remove(</span><br><span class="line">	query,</span><br><span class="line">	&#123;</span><br><span class="line">        justOne:&lt;boolean&gt;,</span><br><span class="line">        writeConcern:&lt;document&gt;</span><br><span class="line">	&#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<ol>
<li>query:<br>可选,删除文档的条件</li>
<li>justOne:<br>可选,如果为tureen或1,则只删除一个文档</li>
<li>writeConcern:<br>可选,抛出异常的级别.</li>
</ol>
</li>
<li><p>eg:删除名字为tom的学生</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">db.student.remove(&#123;name:&quot;tom&quot;&#125;)</span><br><span class="line"></span><br><span class="line">db.student.remove(&#123;name:&quot;tom&quot;&#125;,&#123;justOne:&quot;true&quot;&#125;)</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>文档查询:</p>
<ul>
<li><p>find()方法:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// 查询集合下所有的文档</span><br><span class="line">db.集合名.find()</span><br><span class="line"></span><br><span class="line">db.student.find()</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">// 查询指定列</span><br><span class="line">db.集合名.find(</span><br><span class="line">	query,</span><br><span class="line">	&#123;</span><br><span class="line">        &lt;key&gt;:1,</span><br><span class="line">        &lt;key&gt;:1</span><br><span class="line">	&#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">// 查看年龄为18的所有人的姓名,性别:</span><br><span class="line">db.student.find(&#123;age:18&#125;,&#123;name:1,age:1&#125;)</span><br></pre></td></tr></table></figure>

<p>query:查询条件<br>key:要显示的字段,1表示显示</p>
</li>
<li><p>pretty()方法以格式化的方式来显示文档</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bd.student.find().pretty()</span><br></pre></td></tr></table></figure></li>
<li><p>findOne():方法查询匹配结果哦第一条数据</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.student.findOne(&#123;gender:0&#125;)</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>查询条件操作符:</p>
<ul>
<li><p><code>$gt</code>,<code>$gte</code>,<code>$lt</code>,<code>$lte</code>:大于,大于等于,小于,小于等于.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">db.集合名.find(&lt;key&gt;:&#123;$gt:&lt;value&gt;&#125;)</span><br><span class="line"></span><br><span class="line">// 查询年龄大于20的学生</span><br><span class="line">db.student.find(&#123;age:&#123;$gt:20&#125;&#125;)</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// 查询年龄大于20,小于40的学生</span><br><span class="line">db.student.find(&#123;age:&#123;$gte:20,$lte:40&#125;&#125;)</span><br></pre></td></tr></table></figure></li>
<li><p>等于使用冒号<code>:</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.student.findOne(&#123;gender:0&#125;)</span><br></pre></td></tr></table></figure></li>
<li><p>使用id进行查询:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.student.find(&#123;&quot;_id&quot;:ObjectId(&quot;59995084b019723fe2a0d8d14&quot;)&#125;)</span><br></pre></td></tr></table></figure></li>
<li><p>id查询某个结果集的数据条数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.student.find().count()</span><br></pre></td></tr></table></figure></li>
<li><p>查询某个字段的值当中是否包含另一个值</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// 查询名字包含yl的学生</span><br><span class="line">db.student.find(&#123;name:/yl/&#125;)</span><br></pre></td></tr></table></figure></li>
<li><p>ObjectId()查询某个字段的值是否以另一个值开头</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// 查询名字以h开头的学生</span><br><span class="line">db.student.find(&#123;name:/^h/&#125;)</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>and,or:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">db.集合名.find(条件1,条件2,条件3....)</span><br><span class="line"></span><br><span class="line">db.student.find(&#123;age:&#123;$gt:16&#125;,gender:0&#125;)</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">db.集合名.find(&#123;</span><br><span class="line">    $or:[&#123;条件1&#125;,&#123;条件2&#125;,&#123;条件3&#125;....]</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">db.student.find(&#123;$or:[&#123;age:&#123;$gt:16&#125;&#125;,&#123;gender:0&#125;]&#125;)</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">db.集合名.find(&#123;</span><br><span class="line">	条件1,</span><br><span class="line">	条件2,</span><br><span class="line">    $or:[&#123;条件3&#125;,&#123;条件4&#125;]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li>
<li><p>limit,skip:</p>
<ul>
<li><p>limit():读取指定数量的数据记录</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.student.find().limit(2)</span><br></pre></td></tr></table></figure></li>
<li><p>skip():跳过指定数量的数据</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// 跳过前三条</span><br><span class="line">db.student.find().skip(3)</span><br></pre></td></tr></table></figure></li>
<li><p>limit与skip联合使用:<br>实现分页功能</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.student.find().skip(3).limit(2)</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>排序:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.集合名.find().sort(&lt;key&gt;:1|-1)</span><br></pre></td></tr></table></figure>

<p>1表示升序,-1表示降序</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.student.find().sort(age:1)</span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<p>练习:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 进入my_test效据库</span></span><br><span class="line">use my_test</span><br><span class="line"></span><br><span class="line"><span class="comment"># 向数据库的user集合中插入一个文档</span></span><br><span class="line">db.user.insert(&#123;name:<span class="string">&#x27;hyl&#x27;</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查询user集合中的文档</span></span><br><span class="line">db.users.find()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 统计数据库user集合中的文档数量</span></span><br><span class="line">db.users.find().count()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查询数据库user集合中username为sunwukong的文档</span></span><br><span class="line">db.users.find(&#123;username:<span class="string">&#x27;sunwukong&#x27;</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 向数据库user集合中的username为sunwukona的文档，添加一个address属性，属性值为huaguoshan</span></span><br><span class="line">db.users.update(&#123;username:<span class="string">&#x27;sunwukona&#x27;</span>&#125;,&#123;<span class="variable">$set</span>:&#123;address:<span class="string">&#x27;sunwukona&#x27;</span>&#125;&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用&#123;username：“tangseng”&#125;替换username为 zhubajie的文档</span></span><br><span class="line">db.users.replaceOne(&#123;username:<span class="string">&#x27;zhubajie&#x27;</span>&#125;,&#123;username:<span class="string">&#x27;tangseng&#x27;</span>&#125;)</span><br><span class="line"><span class="comment"># 或者</span></span><br><span class="line">db.users.update(&#123;username:<span class="string">&#x27;zhubajie&#x27;</span>&#125;,&#123;username:<span class="string">&#x27;tangseng&#x27;</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除username为sunwukong的文档的address属性</span></span><br><span class="line">db.users.update(&#123;username:<span class="string">&#x27;sunwukong&#x27;</span>&#125;,&#123;<span class="variable">$unset</span>:&#123;address:1&#125;&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 向username为sunwukong的文档中,添加一个 hobby:&#123;cities:[&quot;beijing&quot;,&quot;shanghai&quot;,&quot;shenzhen&quot;],movies:[&quot;sangu&quot;,&quot;hero&quot;]&#125; </span></span><br><span class="line">db.users.update(&#123;username:sunwukong&#125;,&#123;<span class="variable">$set</span>:hobby:&#123;cities:[<span class="string">&quot;beijing&quot;</span>,<span class="string">&quot;shanghai&quot;</span>,<span class="string">&quot;shenzhen&quot;</span>],movies:[<span class="string">&quot;sangu&quot;</span>,<span class="string">&quot;hero&quot;</span>]&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 向username为tangseng的文档中,添加一个 &#123;hobby:&#123;movies:[&quot;A Chinese odyssey&quot;,&quot;King of comedy&quot;]&#125; </span></span><br><span class="line">db.users.update(&#123;username:<span class="string">&#x27;tangseng&#x27;</span>&#125;,&#123;<span class="variable">$set</span>:&#123;hobby:&#123;movies:[<span class="string">&quot;A Chinese odyssey&quot;</span>,<span class="string">&quot;King of comedy&quot;</span>]&#125; )</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查询喜欢电影&lt;hero&gt;的文档</span></span><br><span class="line">db.users.find(&#123;<span class="string">&quot;hobby.movies&quot;</span>:<span class="string">&#x27;hero&#x27;</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 向tangseng中添加一个新的电影&lt;teretellar&gt;</span></span><br><span class="line">db.users.update(&#123;username:<span class="string">&#x27;tangseng&#x27;</span>&#125;,&#123;<span class="variable">$push</span>:&#123;<span class="string">&quot;hobby.movies&quot;</span>:<span class="string">&#x27;teretellar&#x27;</span>&#125;&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除喜欢beijing的用户</span></span><br><span class="line">db.users.remove(&#123;<span class="string">&#x27;hobby.cities&#x27;</span>:<span class="string">&#x27;beijing&#x27;</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除user集合</span></span><br><span class="line">db.users.drop()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 向numbers中插入20000条数据</span></span><br><span class="line"><span class="keyword">for</span> (var i=x; i&lt;=20000; i++)&#123;</span><br><span class="line">    db.numbers.insert(&#123;num:x&#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment"># 或者</span></span><br><span class="line">var arr = [];</span><br><span class="line"><span class="keyword">for</span> (var i=x; i&lt;=20000; i++)&#123;</span><br><span class="line">    arr.push(num:i);</span><br><span class="line">&#125;</span><br><span class="line">db.numbers.insert(arr)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查询numbers中num为500的文档</span></span><br><span class="line">db.numbers.find(&#123;<span class="string">&#x27;num&#x27;</span>:500&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查询numbers中num大于5000的文档</span></span><br><span class="line">db.numbers.find(&#123;<span class="string">&#x27;num&#x27;</span>:&#123;<span class="variable">$gt</span>:500&#125;&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查询numbers中num小于30的文档</span></span><br><span class="line">db.numbers.find(&#123;<span class="string">&#x27;num&#x27;</span>:&#123;<span class="variable">$lt</span>:30&#125;&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查询numbers大于40小于50的文档</span></span><br><span class="line">db.numbers.find(&#123;<span class="string">&#x27;num&#x27;</span>:&#123;<span class="variable">$gt</span>:40,<span class="variable">$lt</span>:50&#125;&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看numbers集合中的前10条效据</span></span><br><span class="line">db.numbers.find().<span class="built_in">limit</span>(10)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看numbers集合中的第11条到20条数指</span></span><br><span class="line">db.numbers.find().skip(10).<span class="built_in">limit</span>(10)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看numbers集合中的第21条到30条数据</span></span><br><span class="line">db.numbers.find().skip(20).<span class="built_in">limit</span>(10)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>MongoDB支持直接通过内嵌文档的属性进行查询.使用点号获取.<br>但是注意,此时的属性名必须使用引号</p>
<p><code>db.users.update(&#123;username:sunwukong&#125;,&#123;$set:hobby:&#123;cities:[&quot;beijing&quot;,&quot;shanghai&quot;,&quot;shenzhen&quot;],movies:[&quot;sangu&quot;,&quot;hero&quot;]&#125;)</code></p>
<p><code>db.users.find(&#123;hobby.movies:&#39;hero&#39;&#125;)</code>是错的.<br>必须使用<code>db.users.find(&#123;&quot;hobby.movies&quot;:&#39;hero&#39;&#125;)</code></p>
<p>发现movies其实是一个数组.所以说,MongoDB还支持数组的匹配</p>
</blockquote>
<blockquote>
<p><code>$push</code>用于向数组中添加一个新的元素</p>
<p><code>db.users.update(&#123;username:&#39;tangseng&#39;&#125;,&#123;$set:&#123;hobby:&#123;movies:[&quot;A Chinese odyssey&quot;,&quot;King of comedy&quot;]&#125; )</code></p>
<p><code>db.users.update(&#123;username:&#39;tangseng&#39;&#125;,&#123;$push:&#123;&quot;hobby.movies&quot;:&#39;teretellar&#39;&#125;&#125;)</code></p>
<p>还可以使用<code>$addToSet</code>,有点类似于Redis的<code>msetnx</code>,如果数组中已经存在了该元素,则添加失败</p>
</blockquote>
<blockquote>
<p>注意查询集可以使用skip()和limit()</p>
<p>配合使用:<br><code>skip((页码-1)*每页显示的条数).limit(每页显示的条数)</code></p>
<p>MongoDB会自动调整<code>limit</code>和<code>skip</code>的位置,所以写成<code>.skip().limit()</code>也行</p>
</blockquote>
<hr>
<p>文档间的关系</p>
<ul>
<li>一对一</li>
<li>一对多</li>
<li>多对多</li>
</ul>
<p>MongoDB可以通过<strong>内嵌文档</strong>的形式来体现出一对一的关系</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">db.person.insert(&#123;</span><br><span class="line">    name:&#x27;黄蓉&#x27;,</span><br><span class="line">    husband:&#123;</span><br><span class="line">        name:&#x27;郭靖&#x27;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;,&#123;</span><br><span class="line">    name:&#x27;潘金莲&#x27;,</span><br><span class="line">    husband:&#123;</span><br><span class="line">        name:&#x27;武大郎&#x27;</span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure>

<p>一对多也可以使用内嵌文档的形式表示:<br>只要将内嵌文档的字典改为列表即可</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">db.artcile.insert(&#123;</span><br><span class="line">    title:&#x27;这是文章标题1&#x27;,</span><br><span class="line">    reply:[</span><br><span class="line">        &#123;name:&#x27;用户1&#x27;,context:&#x27;评论1&#x27;&#125;,</span><br><span class="line">        &#123;name:&#x27;用户2&#x27;,context:&#x27;评论2&#x27;&#125;,</span><br><span class="line">        &#123;name:&#x27;用户3&#x27;,context:&#x27;评论3&#x27;&#125;,</span><br><span class="line">    ]</span><br><span class="line">&#125;,&#123;</span><br><span class="line">    title:&#x27;这是文章标题2&#x27;,</span><br><span class="line">    reply:[</span><br><span class="line">        &#123;name:&#x27;用户1&#x27;,context:&#x27;评论1&#x27;&#125;,</span><br><span class="line">        &#123;name:&#x27;用户2&#x27;,context:&#x27;评论2&#x27;&#125;,</span><br><span class="line">        &#123;name:&#x27;用户3&#x27;,context:&#x27;评论3&#x27;&#125;,</span><br><span class="line">    ]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>和MySQL类似,MongoDB一对多关系也可以拆成两张表:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">db.artcile.insert(&#123;</span><br><span class="line">    title:&#x27;这是文章标题&#x27;,</span><br><span class="line">    content:&#x27;这是文章内容&#x27;,</span><br><span class="line">    author:&#x27;这是文章作者&#x27;,</span><br><span class="line">    reply:ObjectId(&#x27;46123887135871578715&#x27;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">// ObjectId(&#x27;46123887135871578715&#x27;)</span><br><span class="line">db.reply.insert(&#123;</span><br><span class="line">	&#123;name:&#x27;用户1&#x27;,context:&#x27;评论1&#x27;&#125;,</span><br><span class="line">	&#123;name:&#x27;用户2&#x27;,context:&#x27;评论2&#x27;&#125;,</span><br><span class="line">	&#123;name:&#x27;用户3&#x27;,context:&#x27;评论3&#x27;&#125;, </span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>那么拆成两个集合如何查找?<br>查找标题为XXX的文章对应的回复:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">var replyid = db.artcile.findOne(&#123;title:<span class="string">&#x27;XXX&#x27;</span>&#125;)._id;</span><br><span class="line">db.reply.find(&#123;replyid:replyid&#125;)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>这种查找方式很像Django里的ORM的会造成1+N问题的查找方式</p>
</blockquote>
<p>多对多的关系在MongoDB中还是以两张表的形式</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">db.terchers.insert([</span><br><span class="line">    &#123;name:&#x27;tercher1&#x27;&#125;,</span><br><span class="line">    &#123;name:&#x27;tercher2&#x27;&#125;,</span><br><span class="line">    &#123;name:&#x27;tercher3&#x27;&#125;,</span><br><span class="line">])</span><br><span class="line"></span><br><span class="line">db.stus.insert([</span><br><span class="line">    &#123;name:&#x27;student1&#x27;,</span><br><span class="line">    tech_id:[</span><br><span class="line">        ObjectId(&#x27;46ssadasdsdfas5&#x27;)</span><br><span class="line">        ObjectId(&#x27;461asdasdff8715&#x27;)</span><br><span class="line">        ObjectId(&#x27;4612388713dfgdf&#x27;)</span><br><span class="line">    ]&#125;,</span><br><span class="line">    &#123;name:&#x27;student2&#x27;,</span><br><span class="line">    tech_id:[</span><br><span class="line">        ObjectId(&#x27;46ssadasdsdfas5&#x27;)</span><br><span class="line">        ObjectId(&#x27;461asdasdff8715&#x27;)</span><br><span class="line">        ObjectId(&#x27;4612388713dfgdf&#x27;)</span><br><span class="line">    ]&#125;</span><br><span class="line">])</span><br></pre></td></tr></table></figure>



<p>练习:<br>现在有两个JSON文件<code>dept.json</code>和<code>emp.json</code>(部门和员工)</p>
<p><img src="/images/1560821848709.png" alt="1560821848709"></p>
<p><img src="/images/1560821842958.png" alt="1560821842958"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查均工资小于2000的员工</span></span><br><span class="line">db.emp.find(&#123;sal:&#123;<span class="variable">$lt</span>:2000&#125;&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查均工资在1000-2000之间的员工</span></span><br><span class="line">db.emp.find(&#123;sal:&#123;<span class="variable">$lt</span>:2000,<span class="variable">$gt</span>:1000&#125;&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查工资小于1000或大于2500的员工</span></span><br><span class="line">db.emp.find(&#123;<span class="variable">$or</span>:[sal:&#123;<span class="variable">$lt</span>:1000&#125;,sal:&#123;<span class="variable">$gt</span>:2500&#125;]&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查均财务部的所有员工</span></span><br><span class="line">var dept = db.dept.find(&#123;dname:<span class="string">&#x27;财务部&#x27;</span>&#125;)[0].deptn</span><br><span class="line">db.emp.find(&#123;depno:depto&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查均销售部的所有员工</span></span><br><span class="line">var dept = db.dept.findOne(&#123;dname:<span class="string">&#x27;销售部&#x27;</span>&#125;)</span><br><span class="line">db.emp.find(&#123;depno:<span class="string">&#x27;deptOne.deptno&#x27;</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查询所有mgr为7698的所有员工</span></span><br><span class="line">db.emp.find(&#123;mgr:7698&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 为所有薪资低于1000的员工增加工资400元</span></span><br><span class="line">db.emp.update(&#123;sal:&#123;<span class="variable">$lte</span>:1000&#125;,&#123;<span class="variable">$inc</span>:&#123;sal:400&#125;&#125;)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>查均财务部的所有员工</p>
<p><code>var dept = db.dept.find(&#123;dname:&#39;财务部&#39;&#125;)[0].deptn</code><br><code>db.emp.find(&#123;depno:depto&#125;)</code></p>
<p>注意<code> db.dept.find(&#123;dname:&#39;财务部&#39;&#125;)</code>的查询结果是数组,要用[0]切出来</p>
<p>或者直接使用<br><code>var dept = db.dept.findOne(&#123;dname:&#39;财务部&#39;&#125;).deptn</code></p>
</blockquote>
<hr>
<p>排序</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 主要关键字sal升序排列,次要关键字empno降序排列</span><br><span class="line">db.emp.find().sort(&#123;sal:1,empno:-1&#125;)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>limit,skip和sort可以任意顺序编写</p>
</blockquote>
<p>投影:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// 查询全部行</span><br><span class="line">db.emp.find(&#123;&#125;)</span><br><span class="line"></span><br><span class="line">// 截取出ename列和sal列(这种方式成为投影)</span><br><span class="line">db.emp.find(&#123;&#125;,&#123;ename:1,sal:1&#125;)</span><br></pre></td></tr></table></figure>



<hr>
<p>Mongoose:Node.js的MongoDB的模块</p>
<ul>
<li>可以为文档创建一个模式结构（Schema）</li>
<li>可以对模型中的对象/文档进行验证</li>
<li>数据可以通过类型转换转换为对象模型</li>
<li>可以使用中间件来应用业务逻辑挂钩</li>
<li>比Node原生的MongoDB驱动更容易</li>
</ul>
<p>mongoose中为我们提供了几个新的对象</p>
<ul>
<li>Schema（模式对象）<br>Schema对象定义约束了数据库中的文档结构</li>
<li>ModeI<br>Mode对象作为集合中的所有文档的表示，相当于MongoDB数据库中的集合collection</li>
<li>Document<br>表示集合中的具体文档，相当于集合中的一个具体的文档</li>
</ul>
<p>安装</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i mongoose --save</span><br></pre></td></tr></table></figure>

<p>导入:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> mongoose = <span class="built_in">require</span>(<span class="string">&#x27;mongoose&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>连接:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Mongoose.connect(<span class="string">&#x27;mongodb://localhost:27017/数据库&#x27;</span>,&#123;<span class="attr">useMongoClient</span>:<span class="literal">true</span>&#125;)</span><br></pre></td></tr></table></figure>

<p>监听数据库的连接:使用mongoose的connection属性</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 数据库成功连接的事件</span></span><br><span class="line">mongoose.connection.once(<span class="string">&#x27;open&#x27;</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;);</span><br><span class="line"><span class="comment">// 数据库断开的事件</span></span><br><span class="line">mongoose.connection.once(<span class="string">&#x27;close&#x27;</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;);</span><br></pre></td></tr></table></figure>

<p>简单使用:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> mongoose = <span class="built_in">require</span>(<span class="string">&#x27;mongoose&#x27;</span>);</span><br><span class="line"></span><br><span class="line">Mongoose.connect(<span class="string">&#x27;mongodb://localhost:27017/test_db&#x27;</span>,&#123;<span class="attr">useMongoClient</span>:<span class="literal">true</span>&#125;);</span><br><span class="line"></span><br><span class="line">mongoose.connection.once(<span class="string">&#x27;open&#x27;</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;数据库连接成功&#x27;</span>)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 断开数据库连接</span></span><br><span class="line">mongoose.disconnect();</span><br></pre></td></tr></table></figure>



<p>Schema模式对象</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> mongoose = <span class="built_in">require</span>(<span class="string">&#x27;mongoose&#x27;</span>);</span><br><span class="line"></span><br><span class="line">Mongoose.connect(<span class="string">&#x27;mongodb://localhost:27017/test_db&#x27;</span>,&#123;<span class="attr">useMongoClient</span>:<span class="literal">true</span>&#125;);</span><br><span class="line"></span><br><span class="line">mongoose.connection.once(<span class="string">&#x27;open&#x27;</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;数据库连接成功&#x27;</span>)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> mongoose = <span class="built_in">require</span>(<span class="string">&#x27;mongoose&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> Schema = mongoose.Schema;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> blogSchema = <span class="keyword">new</span> Schema(&#123;</span><br><span class="line">    <span class="attr">title</span>:  <span class="built_in">String</span>,</span><br><span class="line">    <span class="attr">author</span>: <span class="built_in">String</span>,</span><br><span class="line">    <span class="attr">body</span>:   <span class="built_in">String</span>,</span><br><span class="line">    <span class="attr">comments</span>: [&#123; <span class="attr">body</span>: <span class="built_in">String</span>, <span class="attr">date</span>: <span class="built_in">Date</span> &#125;],</span><br><span class="line">    <span class="comment">// 设置默认值</span></span><br><span class="line">    <span class="attr">date</span>: &#123; <span class="attr">type</span>: <span class="built_in">Date</span>, </span><br><span class="line">           <span class="attr">default</span>: <span class="built_in">Date</span>.now</span><br><span class="line">          &#125;,</span><br><span class="line">    <span class="attr">hidden</span>: <span class="built_in">Boolean</span>,</span><br><span class="line">    <span class="attr">meta</span>: &#123;</span><br><span class="line">      <span class="attr">votes</span>: <span class="built_in">Number</span>,</span><br><span class="line">      <span class="attr">favs</span>:  <span class="built_in">Number</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 和MySQL一样,我们是通过Schema来创建Model的</span></span><br><span class="line"><span class="comment">// mongoose.model(modelName, Schema)</span></span><br><span class="line"><span class="keyword">var</span> BlogModel = mongoose.model(<span class="string">&#x27;Blog&#x27;</span>, blogSchema);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 插入文档</span></span><br><span class="line">BlogModel.create(&#123;</span><br><span class="line">    <span class="attr">title</span>:<span class="string">&#x27;this is blog&#x27;</span>,</span><br><span class="line">    <span class="attr">author</span>:<span class="string">&#x27;liangbo&#x27;</span>,</span><br><span class="line">&#125;,<span class="function"><span class="keyword">function</span> (<span class="params">err</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!err)&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;插入成功&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>使用Model对数据库进行增删改查:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> BlogModel = mongoose.model(<span class="string">&#x27;Blog&#x27;</span>, blogSchema);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建:Model.create(docs,[callback])</span></span><br><span class="line">BlogModel.create([</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">title</span>:<span class="string">&#x27;this is blog1&#x27;</span>,</span><br><span class="line">        <span class="attr">author</span>:<span class="string">&#x27;liangbo1&#x27;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">title</span>:<span class="string">&#x27;this is blog2&#x27;</span>,</span><br><span class="line">        <span class="attr">author</span>:<span class="string">&#x27;liangbo2&#x27;</span>,</span><br><span class="line">    &#125;</span><br><span class="line">],<span class="function"><span class="keyword">function</span> (<span class="params">err</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!err)&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;插入成功&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 查询</span></span><br><span class="line"><span class="comment">// Model.find(conditions,[projection],[options],[callback])</span></span><br><span class="line"><span class="comment">// Model.findById(id,[projection],[options],[callback])</span></span><br><span class="line"><span class="comment">// Model.findOne(conditions,[projection],[options],[callback])</span></span><br><span class="line"><span class="comment">// projection:投影,options:查询选项(如skip,limit)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 查询title为XXX的文章,显示他的标题,作者,(不显示id),跳过前面3行</span></span><br><span class="line"><span class="comment">// -_id表示不显示id列</span></span><br><span class="line">BlogModel.find(&#123;<span class="attr">title</span>:<span class="string">&#x27;XXX&#x27;</span>&#125;,&#123;<span class="string">&#x27;title author -_id&#x27;</span>&#125;,&#123;<span class="attr">skip</span>:<span class="number">3</span>&#125;,<span class="function"><span class="keyword">function</span>(<span class="params">err,docs</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(!err)&#123;</span><br><span class="line">        <span class="comment">// 查询成功直接返回查询结果</span></span><br><span class="line">        <span class="built_in">console</span>.log(docs);</span><br><span class="line">        <span class="built_in">console</span>.log(docs[<span class="number">0</span>].author);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>通过find()查询的结果,返回的对象就是Document文档对象</p>
<p>有点类似于Django的Model,mongoose中的Document对象就是Model的实例</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 修改</span></span><br><span class="line"><span class="comment">// Model.update(conditions,doc,[options],[callback])</span></span><br><span class="line"><span class="comment">// Model.updateMany(conditions,doc,[options],[callback])</span></span><br><span class="line"><span class="comment">// Model.updateOne(conditions,doc,[options],[callback])</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> BlogModel = mongoose.model(<span class="string">&#x27;Blog&#x27;</span>, blogSchema);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将标题为XXX的文章对应的作者改为liangbo</span></span><br><span class="line">BlogModel.update(&#123;<span class="attr">title</span>:<span class="string">&#x27;XXX&#x27;</span>&#125;,&#123;<span class="attr">$set</span>:&#123;<span class="attr">author</span>:<span class="string">&#x27;liangbo&#x27;</span>&#125;&#125;,<span class="function"><span class="keyword">function</span> (<span class="params">err</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(!err)&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;修改成功&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 删除</span></span><br><span class="line"><span class="comment">// Model.remove(conditions,[callback])</span></span><br><span class="line"><span class="comment">// Model.deleteOne(conditions,[callback])</span></span><br><span class="line"><span class="comment">// Model.deleteMany(conditions,[callback])</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> BlogModel = mongoose.model(<span class="string">&#x27;Blog&#x27;</span>, blogSchema);</span><br><span class="line"></span><br><span class="line">BlogModel.remove(&#123;<span class="attr">title</span>:<span class="string">&#x27;XXX&#x27;</span>&#125;,<span class="function"><span class="keyword">function</span> (<span class="params">err</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(!err)&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;删除成功&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>Count:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Model.count(conditions,[callback])</span></span><br><span class="line"></span><br><span class="line">BlogModel.count(&#123;<span class="attr">title</span>:<span class="string">&#x27;XXX&#x27;</span>&#125;,<span class="function"><span class="keyword">function</span> (<span class="params">err,count</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(!err)&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;一共有&#x27;</span>,count);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<hr>
<p>document</p>
<p>Document是Model的实例,和Django不同的是Model查询结果是<code>查询集(queryset)</code>,mongoose通过Model查询的结果都是Document</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> mongoose = <span class="built_in">require</span>(<span class="string">&#x27;mongoose&#x27;</span>);</span><br><span class="line"></span><br><span class="line">Mongoose.connect(<span class="string">&#x27;mongodb://localhost:27017/test_db&#x27;</span>,&#123;<span class="attr">useMongoClient</span>:<span class="literal">true</span>&#125;);</span><br><span class="line"></span><br><span class="line">mongoose.connection.once(<span class="string">&#x27;open&#x27;</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;数据库连接成功&#x27;</span>)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> mongoose = <span class="built_in">require</span>(<span class="string">&#x27;mongoose&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> Schema = mongoose.Schema;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> blogSchema = <span class="keyword">new</span> Schema(&#123;</span><br><span class="line">    <span class="attr">title</span>:  <span class="built_in">String</span>,</span><br><span class="line">    <span class="attr">author</span>: <span class="built_in">String</span>,</span><br><span class="line">    <span class="attr">body</span>:   <span class="built_in">String</span>,</span><br><span class="line">    <span class="attr">comments</span>: [&#123; <span class="attr">body</span>: <span class="built_in">String</span>, <span class="attr">date</span>: <span class="built_in">Date</span> &#125;],</span><br><span class="line">    <span class="comment">// 设置默认值</span></span><br><span class="line">    <span class="attr">date</span>: &#123; <span class="attr">type</span>: <span class="built_in">Date</span>, </span><br><span class="line">           <span class="attr">default</span>: <span class="built_in">Date</span>.now</span><br><span class="line">          &#125;,</span><br><span class="line">    <span class="attr">hidden</span>: <span class="built_in">Boolean</span>,</span><br><span class="line">    <span class="attr">meta</span>: &#123;</span><br><span class="line">      <span class="attr">votes</span>: <span class="built_in">Number</span>,</span><br><span class="line">      <span class="attr">favs</span>:  <span class="built_in">Number</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> BlogModel = mongoose.model(<span class="string">&#x27;Blog&#x27;</span>, blogSchema);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建文档对象</span></span><br><span class="line"><span class="keyword">var</span> blog = <span class="keyword">new</span> BlogModel(&#123;</span><br><span class="line">    <span class="attr">title</span>:<span class="string">&#x27;XXX&#x27;</span>,</span><br><span class="line">    <span class="attr">author</span>:<span class="string">&#x27;liangbo&#x27;</span>,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>Document的方式:</p>
<ul>
<li>save</li>
<li>equals(doc) </li>
<li>id </li>
<li>get(path,[type]) </li>
<li>set(path, value, [type]) </li>
<li>update(update, [options], [callback]) </li>
<li>save([callback]) </li>
<li>remove([callback]) </li>
<li>isNew </li>
<li>isInit(path) </li>
<li>toJSON()</li>
<li>toObject():转化为普通的js对象</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Model#save([options],[fn])</span></span><br><span class="line">blog.save(<span class="function"><span class="keyword">function</span>(<span class="params">err</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(!err)&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;保存成功&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>这种方法和DJango的Model操作及其相似,可以使用Model.create方法创建行,也可以使用document.save创建行</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">StudentModel.findOne(&#123;&#125;,<span class="function"><span class="keyword">function</span> (<span class="params">err,doc</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!err)&#123;</span><br><span class="line">        doc.update(&#123;<span class="attr">$set</span>:&#123;<span class="attr">age</span>:<span class="number">28</span>&#125;&#125;,<span class="function"><span class="keyword">function</span> (<span class="params">err</span>)</span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (!err)&#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">&#x27;修改成功&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// or</span></span><br><span class="line">StudentModel.findOne(&#123;&#125;,<span class="function"><span class="keyword">function</span> (<span class="params">err,doc</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!err)&#123;</span><br><span class="line">        doc.age = <span class="number">18</span>;</span><br><span class="line">        doc.save();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>





</div></div><div class="post-main post-comment"></div></article><link rel="stylesheet" type="text/css" href="/css/font.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.css"><script src="//cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script><script src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script>$(document).ready(function() {
  $(".fancybox").fancybox();
});
</script></body></html>
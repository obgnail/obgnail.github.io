<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content=" id=&quot;第四章：迭代器与生成器&quot;&gt;&lt;a href=&quot;#第四章：迭代器与生成器&quot; class=&quot;headerlink&quot; title=&quot;第四章：迭代器与生成器&quot;&gt;&lt;/a&gt;第四章：迭代器与生成器&lt;/h2&gt;&lt;h3 id=&quot;4-1-手动遍历迭代器&quot;&gt;&lt;a href=&quot;#4-1-手动遍历迭代器&quot; class=&quot;headerlink&quot; title=&quot;4.1 手动遍历迭代器&quot;&gt;&lt;/a&gt;4.1 手动遍历迭代器&lt;/h3&gt;&lt;p&gt;为了手动的遍历可迭代对象，使用 next() 函数并在代码中捕获 StopIteration 异常。"><link rel="stylesheet" type="text/css" href="/css/normalize.css"><link rel="stylesheet" type="text/css" href="/css/highlight.css"><link rel="stylesheet" type="text/css" href="/css/noise.css"><title>python-cookbook4_第四章_迭代器与生成器 | 凉薄的自动书记人偶</title><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><meta name="generator" content="Hexo 5.4.0"></head><body><article class="wrapper"><div class="post-main"><div class="nav"><nav class="container"><a class="sidebar-nav-item active" href="/">Home</a><a class="sidebar-nav-item" href="/archives">Tags</a><a class="sidebar-nav-item" href="/About">About</a></nav><div class="container post-meta"><div class="post-tags"><a class="post-tag-link" href="/tags/Python/" rel="tag">Python</a></div><div class="post-time">2019-07-27</div></div></div><div class="container post-header"><h1>python-cookbook4_第四章_迭代器与生成器</h1></div><div class="container post-toc"><details class="toc"><summary class="toc-accordion">Table of Contents</summary><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E5%9B%9B%E7%AB%A0%EF%BC%9A%E8%BF%AD%E4%BB%A3%E5%99%A8%E4%B8%8E%E7%94%9F%E6%88%90%E5%99%A8"><span class="toc-number">1.</span> <span class="toc-text">第四章：迭代器与生成器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-%E6%89%8B%E5%8A%A8%E9%81%8D%E5%8E%86%E8%BF%AD%E4%BB%A3%E5%99%A8"><span class="toc-number">1.1.</span> <span class="toc-text">4.1 手动遍历迭代器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-%E4%BB%A3%E7%90%86%E8%BF%AD%E4%BB%A3"><span class="toc-number">1.2.</span> <span class="toc-text">4.2 代理迭代</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-%E4%BD%BF%E7%94%A8%E7%94%9F%E6%88%90%E5%99%A8%E5%88%9B%E5%BB%BA%E6%96%B0%E7%9A%84%E8%BF%AD%E4%BB%A3%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.3.</span> <span class="toc-text">4.3 使用生成器创建新的迭代模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-4-%E5%AE%9E%E7%8E%B0%E8%BF%AD%E4%BB%A3%E5%99%A8%E5%8D%8F%E8%AE%AE"><span class="toc-number">1.4.</span> <span class="toc-text">4.4 实现迭代器协议</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-5-%E5%8F%8D%E5%90%91%E8%BF%AD%E4%BB%A3"><span class="toc-number">1.5.</span> <span class="toc-text">4.5 反向迭代</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-6-%E5%B8%A6%E6%9C%89%E5%A4%96%E9%83%A8%E7%8A%B6%E6%80%81%E7%9A%84%E7%94%9F%E6%88%90%E5%99%A8%E5%87%BD%E6%95%B0"><span class="toc-number">1.6.</span> <span class="toc-text">4.6 带有外部状态的生成器函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-7-%E8%BF%AD%E4%BB%A3%E5%99%A8%E5%88%87%E7%89%87"><span class="toc-number">1.7.</span> <span class="toc-text">4.7 迭代器切片</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-8-%E8%B7%B3%E8%BF%87%E5%8F%AF%E8%BF%AD%E4%BB%A3%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%BC%80%E5%A7%8B%E9%83%A8%E5%88%86"><span class="toc-number">1.8.</span> <span class="toc-text">4.8 跳过可迭代对象的开始部分</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-9-%E6%8E%92%E5%88%97%E7%BB%84%E5%90%88%E7%9A%84%E8%BF%AD%E4%BB%A3"><span class="toc-number">1.9.</span> <span class="toc-text">4.9 排列组合的迭代</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-10-%E5%BA%8F%E5%88%97%E4%B8%8A%E7%B4%A2%E5%BC%95%E5%80%BC%E8%BF%AD%E4%BB%A3"><span class="toc-number">1.10.</span> <span class="toc-text">4.10 序列上索引值迭代</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-11-%E5%90%8C%E6%97%B6%E8%BF%AD%E4%BB%A3%E5%A4%9A%E4%B8%AA%E5%BA%8F%E5%88%97"><span class="toc-number">1.11.</span> <span class="toc-text">4.11 同时迭代多个序列</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-12-%E4%B8%8D%E5%90%8C%E9%9B%86%E5%90%88%E4%B8%8A%E5%85%83%E7%B4%A0%E7%9A%84%E8%BF%AD%E4%BB%A3"><span class="toc-number">1.12.</span> <span class="toc-text">4.12 不同集合上元素的迭代</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-13-%E5%88%9B%E5%BB%BA%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E7%AE%A1%E9%81%93"><span class="toc-number">1.13.</span> <span class="toc-text">4.13 创建数据处理管道</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-14-%E5%B1%95%E5%BC%80%E5%B5%8C%E5%A5%97%E7%9A%84%E5%BA%8F%E5%88%97"><span class="toc-number">1.14.</span> <span class="toc-text">4.14 展开嵌套的序列</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-15-%E9%A1%BA%E5%BA%8F%E8%BF%AD%E4%BB%A3%E5%90%88%E5%B9%B6%E5%90%8E%E7%9A%84%E6%8E%92%E5%BA%8F%E8%BF%AD%E4%BB%A3%E5%AF%B9%E8%B1%A1"><span class="toc-number">1.15.</span> <span class="toc-text">4.15 顺序迭代合并后的排序迭代对象</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-16-%E8%BF%AD%E4%BB%A3%E5%99%A8%E4%BB%A3%E6%9B%BF-while-%E6%97%A0%E9%99%90%E5%BE%AA%E7%8E%AF"><span class="toc-number">1.16.</span> <span class="toc-text">4.16 迭代器代替 while 无限循环</span></a></li></ol></li></ol></details></div><div class="container post-content"><h2 id="第四章：迭代器与生成器"><a href="#第四章：迭代器与生成器" class="headerlink" title="第四章：迭代器与生成器"></a>第四章：迭代器与生成器</h2><h3 id="4-1-手动遍历迭代器"><a href="#4-1-手动遍历迭代器" class="headerlink" title="4.1 手动遍历迭代器"></a>4.1 手动遍历迭代器</h3><p>为了手动的遍历可迭代对象，使用 next() 函数并在代码中捕获 StopIteration 异常。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">manual_iter</span>():</span></span><br><span class="line">	<span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;/etc/passwd&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">		<span class="keyword">try</span>:</span><br><span class="line">			<span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">				line = <span class="built_in">next</span>(f)</span><br><span class="line">				<span class="built_in">print</span>(line, end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">		<span class="keyword">except</span> StopIteration:</span><br><span class="line">			<span class="keyword">pass</span></span><br></pre></td></tr></table></figure>



<h3 id="4-2-代理迭代"><a href="#4-2-代理迭代" class="headerlink" title="4.2 代理迭代"></a>4.2 代理迭代</h3><p>只需要定义一个 <code>__iter__() </code>方法，将迭代操作代理到容器内部的对象上去。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Node</span>:</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, value</span>):</span></span><br><span class="line">		self._value = value</span><br><span class="line">		self._children = []</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__repr__</span>(<span class="params">self</span>):</span></span><br><span class="line">		<span class="keyword">return</span> <span class="string">&#x27;Node(&#123;!r&#125;)&#x27;</span>.<span class="built_in">format</span>(self._value)</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">add_child</span>(<span class="params">self, node</span>):</span></span><br><span class="line">		self._children.append(node)</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__iter__</span>(<span class="params">self</span>):</span></span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">iter</span>(self._children)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">	root = Node(<span class="number">0</span>)</span><br><span class="line">	child1 = Node(<span class="number">1</span>)</span><br><span class="line">	child2 = Node(<span class="number">2</span>)</span><br><span class="line">	root.add_child(child1)</span><br><span class="line">	root.add_child(child2)</span><br><span class="line">	<span class="keyword">for</span> ch <span class="keyword">in</span> root:</span><br><span class="line">		<span class="built_in">print</span>(ch)</span><br><span class="line">		<span class="comment"># Node(1)</span></span><br><span class="line">		<span class="comment"># Node(2)</span></span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li>Python 的迭代器协议需要 <code>__iter__() </code>方法返回一个实现了<code>__next__()</code>方法的<br>迭代器对象。</li>
<li>如果你<strong>只是迭代其他容器的内容</strong>,称为<code>代理迭代</code>，你无须担心底层是怎样实现的。你所要做的只是传递迭代请求既可。</li>
</ul>
</blockquote>
<h3 id="4-3-使用生成器创建新的迭代模式"><a href="#4-3-使用生成器创建新的迭代模式" class="headerlink" title="4.3 使用生成器创建新的迭代模式"></a>4.3 使用生成器创建新的迭代模式</h3><p>yield 语句</p>
<blockquote>
<ul>
<li>一个生成器函数主要特征是它只会回应在迭代中使用到的 next 操作。</li>
<li>一旦生成器函数返回退出，迭代终止。</li>
<li>我们在迭代中通常使用的 for 语句会自动处理这些细节，所以你无需担心。</li>
</ul>
</blockquote>
<h3 id="4-4-实现迭代器协议"><a href="#4-4-实现迭代器协议" class="headerlink" title="4.4 实现迭代器协议"></a>4.4 实现迭代器协议</h3><p>Python 的迭代协议要求一个<code>__iter__()</code>方法返回一个特殊的迭代器对象，这个迭代器对象实现了<code>__next__()</code>方法并通过 StopIteration 异常标识迭代的完成。</p>
<h3 id="4-5-反向迭代"><a href="#4-5-反向迭代" class="headerlink" title="4.5 反向迭代"></a>4.5 反向迭代</h3><p>能够反向迭代的要求(二选一)</p>
<ul>
<li>对象的大小可预先确定</li>
<li>对象实现了<code>__reversed__()</code>方法</li>
</ul>
<p>如果两者都不符合，那你必须先将对象转换为一个列表才行，</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">f = <span class="built_in">open</span>(<span class="string">&#x27;somefile&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> <span class="built_in">reversed</span>(<span class="built_in">list</span>(f)):</span><br><span class="line">	<span class="built_in">print</span>(line, end=<span class="string">&#x27;&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>使用<code>__reversed__()</code>方法</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CountDown</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, start</span>):</span></span><br><span class="line">		self.start = start</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__iter__</span>(<span class="params">self</span>):</span></span><br><span class="line">		num = self.start</span><br><span class="line">		<span class="keyword">while</span> num &gt;= <span class="number">0</span>:</span><br><span class="line">			<span class="keyword">yield</span> num</span><br><span class="line">			num -= <span class="number">1</span></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__reversed__</span>(<span class="params">self</span>):</span></span><br><span class="line">		num = <span class="number">0</span></span><br><span class="line">		<span class="keyword">while</span> num &lt;= self.start:</span><br><span class="line">			<span class="keyword">yield</span> num</span><br><span class="line">			num += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">c = CountDown(<span class="number">20</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> num <span class="keyword">in</span> c:</span><br><span class="line">	<span class="built_in">print</span>(num)</span><br><span class="line"><span class="keyword">for</span> num <span class="keyword">in</span> <span class="built_in">reversed</span>(c):</span><br><span class="line">	<span class="built_in">print</span>(num)</span><br></pre></td></tr></table></figure>

<p>定义一个反向迭代器可以使得代码非常的高效，因为它不再需要将数据填充到一个列表中然后再去反向迭代这个列表。</p>
<h3 id="4-6-带有外部状态的生成器函数"><a href="#4-6-带有外部状态的生成器函数" class="headerlink" title="4.6 带有外部状态的生成器函数"></a>4.6 带有外部状态的生成器函数</h3><p>想让你的生成器暴露外部状态给用户</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> deque</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">linehistory</span>:</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, lines, histlen=<span class="number">3</span></span>):</span></span><br><span class="line">		self.lines = lines</span><br><span class="line">		self.history = deque(maxlen=histlen)</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__iter__</span>(<span class="params">self</span>):</span></span><br><span class="line">		<span class="keyword">for</span> lineno, line <span class="keyword">in</span> <span class="built_in">enumerate</span>(self.lines, <span class="number">1</span>):</span><br><span class="line">			self.history.append((lineno, line))</span><br><span class="line">			<span class="keyword">yield</span> line</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">clear</span>(<span class="params">self</span>):</span></span><br><span class="line">		self.history.clear()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;somefile.txt&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">	lines = linehistory(f)</span><br><span class="line">	<span class="keyword">for</span> line <span class="keyword">in</span> lines:</span><br><span class="line">		<span class="comment"># 最后一句触发if</span></span><br><span class="line">		<span class="keyword">if</span> <span class="string">&#x27;python&#x27;</span> <span class="keyword">in</span> line:</span><br><span class="line">			<span class="keyword">for</span> lineno, hline <span class="keyword">in</span> lines.history:</span><br><span class="line">				<span class="built_in">print</span>(<span class="string">&#x27;&#123;&#125;:&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(lineno, hline), end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># somefile.txt内容如下:</span></span><br><span class="line"><span class="comment"># hello world</span></span><br><span class="line"><span class="comment"># this is a test</span></span><br><span class="line"><span class="comment"># of iterating over lines with a history</span></span><br><span class="line"><span class="comment"># python is fun</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 打印如下:</span></span><br><span class="line"><span class="comment"># 2:this is a test</span></span><br><span class="line"><span class="comment"># 3:of iterating over lines with a history</span></span><br><span class="line"><span class="comment"># 4:python is fun</span></span><br></pre></td></tr></table></figure>



<h3 id="4-7-迭代器切片"><a href="#4-7-迭代器切片" class="headerlink" title="4.7 迭代器切片"></a>4.7 迭代器切片</h3><p>函数 <strong>itertools.islice()</strong> 适用于在迭代器和生成器上做切片操作。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">count</span>(<span class="params">n</span>):</span></span><br><span class="line">	<span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">		<span class="keyword">yield</span> n</span><br><span class="line">		n += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">c = count(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> itertools.islice(c,<span class="number">10</span>,<span class="number">15</span>):</span><br><span class="line">	<span class="built_in">print</span>(x)</span><br><span class="line"><span class="comment"># 10</span></span><br><span class="line"><span class="comment"># 11</span></span><br><span class="line"><span class="comment"># 12</span></span><br><span class="line"><span class="comment"># 13</span></span><br><span class="line"><span class="comment"># 14</span></span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li>迭代器和生成器不能使用标准的切片操作，因为它们的长度事先我们并不知道</li>
<li>函数 islice() 返回一个可以生成指定元素的迭代器，它<strong>通过遍历并丢弃直到切片开始索引位置的所有元素。然后才开始一个个的返回元素</strong>，并直到切片结束索引位置。</li>
<li><strong>islice() 会消耗掉传入的迭代器中的数据</strong>。必须考虑到迭代器是不可逆的这个事实</li>
</ul>
</blockquote>
<h3 id="4-8-跳过可迭代对象的开始部分"><a href="#4-8-跳过可迭代对象的开始部分" class="headerlink" title="4.8 跳过可迭代对象的开始部分"></a>4.8 跳过可迭代对象的开始部分</h3><p>itertools.dropwhile() 函数 : <strong>只是跳过开始部分</strong></p>
<blockquote>
<ul>
<li>使用时，你给它传递一个函数对象和一个可迭代对象。它会返回一个迭代器对象，丢弃原有序列中直到函数返回 Flase 之前的所有元素，然后返回后面所有元素。</li>
<li>简单来说,该函数起到过滤作用,具体使用就类似于filter<br>==满足条件的值都会丢弃直到有元素不满足为止==</li>
</ul>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">count</span>(<span class="params">n</span>):</span></span><br><span class="line">	num = <span class="number">1</span></span><br><span class="line">	<span class="keyword">while</span> num &lt;= n:</span><br><span class="line">		<span class="keyword">yield</span> num</span><br><span class="line">		num += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 因为1%2==1,满足条件舍弃,2%2==0.不满足,所以之后的都保留</span></span><br><span class="line"><span class="keyword">for</span> num <span class="keyword">in</span> itertools.dropwhile(<span class="keyword">lambda</span> num:num % <span class="number">2</span> == <span class="number">1</span> ,count(<span class="number">4</span>)):</span><br><span class="line">	<span class="built_in">print</span>(num)</span><br><span class="line"><span class="comment"># 2</span></span><br><span class="line"><span class="comment"># 3</span></span><br><span class="line"><span class="comment"># 4</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>函数 dropwhile() 和 islice() 其实就是两个帮助函数，为的就是避免写出下面这种冗余代码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;/etc/passwd&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line"><span class="comment"># Skip over initial comments</span></span><br><span class="line">	<span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">		line = <span class="built_in">next</span>(f, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">		<span class="keyword">if</span> <span class="keyword">not</span> line.startswith(<span class="string">&#x27;#&#x27;</span>):</span><br><span class="line">			<span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Process remaining lines</span></span><br><span class="line"><span class="keyword">while</span> line:</span><br><span class="line">	<span class="comment"># Replace with useful processing</span></span><br><span class="line">	<span class="built_in">print</span>(line, end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">	line = <span class="built_in">next</span>(f, <span class="literal">None</span>)</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="4-9-排列组合的迭代"><a href="#4-9-排列组合的迭代" class="headerlink" title="4.9 排列组合的迭代"></a>4.9 排列组合的迭代</h3><p>迭代遍历一个集合中元素的所有可能的排列或组合</p>
<blockquote>
<p>itertools 模块提供了三个函数 :</p>
<ul>
<li>itertools.permutations() : 排序</li>
<li>itertools.combinations() : 组合</li>
<li>itertools.combinations_with_replacement() : 组合,但是允许同一个元素被选择多次</li>
</ul>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> permutations</span><br><span class="line"></span><br><span class="line">items = [<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;c&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 排列</span></span><br><span class="line"><span class="keyword">for</span> p <span class="keyword">in</span> permutations(items):</span><br><span class="line">	<span class="built_in">print</span>(p)</span><br><span class="line"><span class="comment"># (&#x27;a&#x27;, &#x27;b&#x27;, &#x27;c&#x27;)</span></span><br><span class="line"><span class="comment"># (&#x27;a&#x27;, &#x27;c&#x27;, &#x27;b&#x27;)</span></span><br><span class="line"><span class="comment"># (&#x27;b&#x27;, &#x27;a&#x27;, &#x27;c&#x27;)</span></span><br><span class="line"><span class="comment"># (&#x27;b&#x27;, &#x27;c&#x27;, &#x27;a&#x27;)</span></span><br><span class="line"><span class="comment"># (&#x27;c&#x27;, &#x27;a&#x27;, &#x27;b&#x27;)</span></span><br><span class="line"><span class="comment"># (&#x27;c&#x27;, &#x27;b&#x27;, &#x27;a&#x27;)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 在排列后,对元组切片</span></span><br><span class="line"><span class="keyword">for</span> p <span class="keyword">in</span> permutations(items,<span class="number">2</span>):</span><br><span class="line">	<span class="built_in">print</span>(p)</span><br><span class="line"><span class="comment"># (&#x27;a&#x27;, &#x27;b&#x27;)</span></span><br><span class="line"><span class="comment"># (&#x27;a&#x27;, &#x27;c&#x27;)</span></span><br><span class="line"><span class="comment"># (&#x27;b&#x27;, &#x27;a&#x27;)</span></span><br><span class="line"><span class="comment"># (&#x27;b&#x27;, &#x27;c&#x27;)</span></span><br><span class="line"><span class="comment"># (&#x27;c&#x27;, &#x27;a&#x27;)</span></span><br><span class="line"><span class="comment"># (&#x27;c&#x27;, &#x27;b&#x27;)</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> combinations</span><br><span class="line"></span><br><span class="line">items = [<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;c&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 排列</span></span><br><span class="line"><span class="keyword">for</span> p <span class="keyword">in</span> combinations(items,<span class="number">3</span>):</span><br><span class="line">    <span class="built_in">print</span>(p)</span><br><span class="line"><span class="comment"># (&#x27;a&#x27;, &#x27;b&#x27;, &#x27;c&#x27;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 在排列后,对元组切片</span></span><br><span class="line"><span class="keyword">for</span> p <span class="keyword">in</span> combinations(items,<span class="number">2</span>):</span><br><span class="line">    <span class="built_in">print</span>(p)</span><br><span class="line"><span class="comment"># (&#x27;a&#x27;, &#x27;b&#x27;)</span></span><br><span class="line"><span class="comment"># (&#x27;a&#x27;, &#x27;c&#x27;)</span></span><br><span class="line"><span class="comment"># (&#x27;b&#x27;, &#x27;c&#x27;)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> p <span class="keyword">in</span> combinations(items,<span class="number">1</span>):</span><br><span class="line">    <span class="built_in">print</span>(p)</span><br><span class="line"><span class="comment"># (&#x27;a&#x27;,)</span></span><br><span class="line"><span class="comment"># (&#x27;b&#x27;,)</span></span><br><span class="line"><span class="comment"># (&#x27;c&#x27;,)</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> combinations_with_replacement</span><br><span class="line"></span><br><span class="line">items = [<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;c&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 排列</span></span><br><span class="line"><span class="keyword">for</span> p <span class="keyword">in</span> combinations_with_replacement(items,<span class="number">3</span>):</span><br><span class="line">    <span class="built_in">print</span>(p)</span><br><span class="line"><span class="comment"># (&#x27;a&#x27;, &#x27;a&#x27;, &#x27;a&#x27;)</span></span><br><span class="line"><span class="comment"># (&#x27;a&#x27;, &#x27;a&#x27;, &#x27;b&#x27;)</span></span><br><span class="line"><span class="comment"># (&#x27;a&#x27;, &#x27;a&#x27;, &#x27;c&#x27;)</span></span><br><span class="line"><span class="comment"># (&#x27;a&#x27;, &#x27;b&#x27;, &#x27;b&#x27;)</span></span><br><span class="line"><span class="comment"># (&#x27;a&#x27;, &#x27;b&#x27;, &#x27;c&#x27;)</span></span><br><span class="line"><span class="comment"># (&#x27;a&#x27;, &#x27;c&#x27;, &#x27;c&#x27;)</span></span><br><span class="line"><span class="comment"># (&#x27;b&#x27;, &#x27;b&#x27;, &#x27;b&#x27;)</span></span><br><span class="line"><span class="comment"># (&#x27;b&#x27;, &#x27;b&#x27;, &#x27;c&#x27;)</span></span><br><span class="line"><span class="comment"># (&#x27;b&#x27;, &#x27;c&#x27;, &#x27;c&#x27;)</span></span><br><span class="line"><span class="comment"># (&#x27;c&#x27;, &#x27;c&#x27;, &#x27;c&#x27;)</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>当我们碰到看上去有些复杂的迭代问题时，最好可以先去看看 itertools 模块。</p>
</blockquote>
<h3 id="4-10-序列上索引值迭代"><a href="#4-10-序列上索引值迭代" class="headerlink" title="4.10 序列上索引值迭代"></a>4.10 序列上索引值迭代</h3><p>想在迭代一个序列的同时跟踪正在被处理的元素索引。</p>
<p> enumerate() 函数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 简单统计单词数量</span></span><br><span class="line">word_summary = defaultdict(<span class="built_in">list</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;myfile.txt&#x27;</span>, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    lines = f.readlines()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> idx, line <span class="keyword">in</span> <span class="built_in">enumerate</span>(lines):</span><br><span class="line"><span class="comment"># Create a list of words in current line</span></span><br><span class="line">    words = [w.strip().lower() <span class="keyword">for</span> w <span class="keyword">in</span> line.split()]</span><br><span class="line">    <span class="keyword">for</span> word <span class="keyword">in</span> words:</span><br><span class="line">        word_summary[word].append(idx)</span><br></pre></td></tr></table></figure>

<p>如果你处理完文件后打印 word_summary ，会发现它是一个字典 (准确来讲是一个defaultdict )，对于每个单词有一个 key ，每个 key 对应的值是一个由这个单词出现的行号组成的列表。</p>
<h3 id="4-11-同时迭代多个序列"><a href="#4-11-同时迭代多个序列" class="headerlink" title="4.11 同时迭代多个序列"></a>4.11 同时迭代多个序列</h3><p>同时迭代多个序列，每次分别从一个序列中取一个元素。</p>
<ul>
<li>zip() 函数</li>
<li>itertools.zip_longest() 函数</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">list1 = [<span class="string">&#x27;hyl&#x27;</span>,<span class="string">&#x27;dsz&#x27;</span>,<span class="string">&#x27;czj&#x27;</span>]</span><br><span class="line">list2 = [<span class="number">98</span>,<span class="number">97</span>,<span class="number">96</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> <span class="built_in">zip</span>(list1,list2):</span><br><span class="line">	<span class="built_in">print</span>(item)</span><br><span class="line"><span class="comment"># (&#x27;hyl&#x27;, 98)</span></span><br><span class="line"><span class="comment"># (&#x27;dsz&#x27;, 97)</span></span><br><span class="line"><span class="comment"># (&#x27;czj&#x27;, 96)</span></span><br></pre></td></tr></table></figure>



<h3 id="4-12-不同集合上元素的迭代"><a href="#4-12-不同集合上元素的迭代" class="headerlink" title="4.12 不同集合上元素的迭代"></a>4.12 不同集合上元素的迭代</h3><p>itertools.chain() 方法</p>
<h3 id="4-13-创建数据处理管道"><a href="#4-13-创建数据处理管道" class="headerlink" title="4.13 创建数据处理管道"></a>4.13 创建数据处理管道</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> fnmatch</span><br><span class="line"><span class="keyword">import</span> gzip</span><br><span class="line"><span class="keyword">import</span> bz2</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gen_find</span>(<span class="params">filepat, top</span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    Find all filenames in a directory tree that match a shell wildcard pattern</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> path, dirlist, filelist <span class="keyword">in</span> os.walk(top):</span><br><span class="line">        <span class="keyword">for</span> name <span class="keyword">in</span> fnmatch.<span class="built_in">filter</span>(filelist, filepat):</span><br><span class="line">            <span class="keyword">yield</span> os.path.join(path, name)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gen_opener</span>(<span class="params">filenames</span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    Open a sequence of filenames one at a time producing a file object.</span></span><br><span class="line"><span class="string">    The file is closed immediately when proceeding to the next iteration. </span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> filename <span class="keyword">in</span> filenames:</span><br><span class="line">        <span class="keyword">if</span> filename.endswith(<span class="string">&#x27;.gz&#x27;</span>):</span><br><span class="line">            f = gzip.<span class="built_in">open</span>(filename, <span class="string">&#x27;rt&#x27;</span>)</span><br><span class="line">        <span class="keyword">elif</span> filename.endswith(<span class="string">&#x27;.bz2&#x27;</span>):</span><br><span class="line">            f = bz2.<span class="built_in">open</span>(filename, <span class="string">&#x27;rt&#x27;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            f = <span class="built_in">open</span>(filename, <span class="string">&#x27;rt&#x27;</span>)</span><br><span class="line">        <span class="keyword">yield</span> f</span><br><span class="line">        f.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gen_concatenate</span>(<span class="params">iterators</span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    Chain a sequence of iterators together into a single sequence.</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> it <span class="keyword">in</span> iterators:</span><br><span class="line">        <span class="keyword">yield</span> <span class="keyword">from</span> it</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gen_grep</span>(<span class="params">pattern, lines</span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    Look for a regex pattern in a sequence of lines</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    pat = re.<span class="built_in">compile</span>(pattern)</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> lines:</span><br><span class="line">        <span class="keyword">if</span> pat.search(line):</span><br><span class="line">            <span class="keyword">yield</span> line</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Example 1</span></span><br><span class="line">    lognames = gen_find(<span class="string">&#x27;access-log*&#x27;</span>, <span class="string">&#x27;www&#x27;</span>)</span><br><span class="line">    files = gen_opener(lognames)</span><br><span class="line">    lines = gen_concatenate(files)</span><br><span class="line">    pylines = gen_grep(<span class="string">&#x27;(?i)python&#x27;</span>, lines)</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> pylines:</span><br><span class="line">        <span class="built_in">print</span>(line)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Example 2</span></span><br><span class="line">    lognames = gen_find(<span class="string">&#x27;access-log*&#x27;</span>, <span class="string">&#x27;www&#x27;</span>)</span><br><span class="line">    files = gen_opener(lognames)</span><br><span class="line">    lines = gen_concatenate(files)</span><br><span class="line">    pylines = gen_grep(<span class="string">&#x27;(?i)python&#x27;</span>, lines)</span><br><span class="line">    bytecolumn = (line.rsplit(<span class="literal">None</span>,<span class="number">1</span>)[<span class="number">1</span>] <span class="keyword">for</span> line <span class="keyword">in</span> pylines)</span><br><span class="line">    <span class="built_in">bytes</span> = (<span class="built_in">int</span>(x) <span class="keyword">for</span> x <span class="keyword">in</span> bytecolumn <span class="keyword">if</span> x != <span class="string">&#x27;-&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;Total&#x27;</span>, <span class="built_in">sum</span>(<span class="built_in">bytes</span>))</span><br></pre></td></tr></table></figure>



<h3 id="4-14-展开嵌套的序列"><a href="#4-14-展开嵌套的序列" class="headerlink" title="4.14 展开嵌套的序列"></a>4.14 展开嵌套的序列</h3><blockquote>
<p>使用<code>yield</code>和<code>yield from</code></p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections.abc <span class="keyword">import</span> Iterable</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">flatten</span>(<span class="params">alist</span>):</span></span><br><span class="line">	<span class="keyword">for</span> ele <span class="keyword">in</span> alist:</span><br><span class="line">		<span class="keyword">if</span> <span class="built_in">isinstance</span>(ele,Iterable):</span><br><span class="line">			<span class="keyword">yield</span> <span class="keyword">from</span> flatten(ele)</span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			<span class="keyword">yield</span> ele</span><br><span class="line"></span><br><span class="line">items = [<span class="number">1</span>, <span class="number">2</span>, [<span class="number">3</span>, <span class="number">4</span>, [<span class="number">5</span>, <span class="number">6</span>], <span class="number">7</span>], <span class="number">8</span>]	</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">list</span>(flatten(items)))	</span><br><span class="line"><span class="comment"># [1, 2, 3, 4, 5, 6, 7, 8]</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>yield from 返回所有子例程的值</strong></p>
<p>当然也可以改成:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">flatten</span>(<span class="params">items, ignore_types=(<span class="params"><span class="built_in">str</span>, <span class="built_in">bytes</span></span>)</span>):</span></span><br><span class="line">	<span class="keyword">for</span> x <span class="keyword">in</span> items:</span><br><span class="line">		<span class="keyword">if</span> <span class="built_in">isinstance</span>(x, Iterable) <span class="keyword">and</span> <span class="keyword">not</span> <span class="built_in">isinstance</span>(x, ignore_types):</span><br><span class="line">			<span class="keyword">for</span> i <span class="keyword">in</span> flatten(x):</span><br><span class="line">				<span class="keyword">yield</span> i</span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			<span class="keyword">yield</span> x</span><br></pre></td></tr></table></figure>
</blockquote>
<p>对比:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections.abc <span class="keyword">import</span> Iterable</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">flatten</span>(<span class="params">alist</span>):</span></span><br><span class="line">    res = []</span><br><span class="line">    <span class="keyword">for</span> ele <span class="keyword">in</span> alist:</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(ele,Iterable):</span><br><span class="line">            res.extend(flatten(ele))</span><br><span class="line">        <span class="keyword">else</span>:  </span><br><span class="line">            res.append(ele)</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line">items = [<span class="number">1</span>, <span class="number">2</span>, [<span class="number">3</span>, <span class="number">4</span>, [<span class="number">5</span>, <span class="number">6</span>], <span class="number">7</span>], <span class="number">8</span>]   </span><br><span class="line"><span class="built_in">print</span>(flatten(items))</span><br><span class="line"><span class="comment"># [1, 2, 3, 4, 5, 6, 7, 8]</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意:<br>口诀中的<code>假设函数能用</code>的意思是 :</p>
<ul>
<li><strong>假设函数能用,考虑后续主函数该如何处理</strong> </li>
<li>例如 : 方法二的<code>flatten(ele)</code>如果能用,那么就会返回[3, 4, 5, 6, 7, 8],接下来要考虑如何处理,这里就可以使用extend接受这个列表</li>
<li>同理 : 方法一的<code>flatten(ele)</code>如果能用,那么他就会不断的yield出值,此时我们就可以yield from他了</li>
</ul>
</blockquote>
<h3 id="4-15-顺序迭代合并后的排序迭代对象"><a href="#4-15-顺序迭代合并后的排序迭代对象" class="headerlink" title="4.15 顺序迭代合并后的排序迭代对象"></a>4.15 顺序迭代合并后的排序迭代对象</h3><p>你有一系列排序序列，想将它们合并后得到一个排序序列并在上面迭代遍历。</p>
<blockquote>
<p>使用heapq.merge() 函数</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> heapq</span><br><span class="line"></span><br><span class="line">a = [<span class="number">1</span>, <span class="number">4</span>, <span class="number">7</span>, <span class="number">10</span>]</span><br><span class="line">b = [<span class="number">2</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">11</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 自动对两个元素进行排序</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">list</span>(heapq.merge(a,b)))</span><br><span class="line"><span class="comment"># [1, 2, 4, 5, 6, 7, 10, 11]</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>heapq.merge有点类似于<code>collections.ChainMap</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> ChainMap</span><br><span class="line"></span><br><span class="line">a = &#123;<span class="string">&#x27;name&#x27;</span>:<span class="string">&#x27;hyl&#x27;</span>&#125;</span><br><span class="line">b = &#123;<span class="string">&#x27;age&#x27;</span>:<span class="number">20</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(ChainMap(a,b))</span><br><span class="line"><span class="comment"># ChainMap(&#123;&#x27;name&#x27;: &#x27;hyl&#x27;&#125;, &#123;&#x27;age&#x27;: 20&#125;)</span></span><br></pre></td></tr></table></figure>

<ul>
<li>heapq.merge能使用堆排序,每次都最小值</li>
<li>collections.ChainMap是用于合并字典的,heapq.merge适用于合并生成器/迭代器的</li>
<li>强调的是 heapq.merge() 需要所有输入序列必须是排过序的。</li>
</ul>
</blockquote>
<h3 id="4-16-迭代器代替-while-无限循环"><a href="#4-16-迭代器代替-while-无限循环" class="headerlink" title="4.16 迭代器代替 while 无限循环"></a>4.16 迭代器代替 while 无限循环</h3><p>你在代码中使用 while 循环来迭代处理数据，因为它需要调用某个函数或者和一<br>般迭代模式不同的测试条件。能不能<strong>用迭代器来重写这个循环</strong>呢？</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">CHUNKSIZE = <span class="number">8192</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">reader</span>(<span class="params">s</span>):</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        data = s.recv(CHUNKSIZE)</span><br><span class="line">        <span class="keyword">if</span> data == <span class="string">b&#x27;&#x27;</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        process_data(data)</span><br></pre></td></tr></table></figure>

<p>使用迭代器重写whille循环:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">reader2</span>(<span class="params">s</span>):</span></span><br><span class="line">    <span class="keyword">for</span> chunk <span class="keyword">in</span> <span class="built_in">iter</span>(<span class="keyword">lambda</span>: s.recv(CHUNKSIZE), <span class="string">b&#x27;&#x27;</span>):</span><br><span class="line">        process_data(data)</span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li>iter 函数一个鲜为人知的特性是它接受一个可选的 callable 对象和一个标记 (结<br>尾) 值作为输入参数。</li>
<li>当以这种方式使用的时候，它会创建一个迭代器，这个迭代器会不断调用 callable 对象<strong>直到返回值和标记值相等为止</strong>。</li>
</ul>
</blockquote>
</div></div></article><link rel="stylesheet" type="text/css" href="/css/font.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.css"><script src="//cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script><script src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script>$(document).ready(function() {
  $(".fancybox").fancybox();
});
</script></body></html>
<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content=" id=&quot;第一章：数据结构和算法&quot;&gt;&lt;a href=&quot;#第一章：数据结构和算法&quot; class=&quot;headerlink&quot; title=&quot;第一章：数据结构和算法&quot;&gt;&lt;/a&gt;第一章：数据结构和算法&lt;/h2&gt;&lt;h3 id=&quot;1-1-解压序列赋值给多个变量&quot;&gt;&lt;a href=&quot;#1-1-解压序列赋值给多个变量&quot; class=&quot;headerlink&quot; title=&quot;1.1 解压序列赋值给多个变量&quot;&gt;&lt;/a&gt;1.1 解压序列赋值给多个变量&lt;/h3&gt;&lt;p&gt;实际上,元组拆包适合用在任何&lt;strong&gt;可迭代对象&lt;/strong&gt;上面，包括字符串，文件对象，迭代器和生成器。"><link rel="stylesheet" type="text/css" href="/css/normalize.css"><link rel="stylesheet" type="text/css" href="/css/highlight.css"><link rel="stylesheet" type="text/css" href="/css/noise.css"><title>python-cookbook1_第一章_数据结构和算法 | 凉薄的自动书记人偶</title><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><meta name="generator" content="Hexo 5.4.0"></head><body><article class="wrapper"><div class="post-main"><div class="nav"><nav class="container"><a class="sidebar-nav-item active" href="/">Home</a></nav><div class="container post-meta"><div class="post-tags"><a class="post-tag-none-link" href="/tags/Python/" rel="tag">Python</a></div><div class="post-time">2019-07-26</div></div></div><div class="container post-header"><h1>python-cookbook1_第一章_数据结构和算法</h1></div><div class="container post-toc"><details class="toc"><summary class="toc-accordion">Table of Contents</summary><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E7%AB%A0%EF%BC%9A%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%92%8C%E7%AE%97%E6%B3%95"><span class="toc-number">1.</span> <span class="toc-text">第一章：数据结构和算法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-%E8%A7%A3%E5%8E%8B%E5%BA%8F%E5%88%97%E8%B5%8B%E5%80%BC%E7%BB%99%E5%A4%9A%E4%B8%AA%E5%8F%98%E9%87%8F"><span class="toc-number">1.1.</span> <span class="toc-text">1.1 解压序列赋值给多个变量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-%E4%BF%9D%E7%95%99%E6%9C%80%E5%90%8E-N-%E4%B8%AA%E5%85%83%E7%B4%A0"><span class="toc-number">1.2.</span> <span class="toc-text">1.3 保留最后 N 个元素</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-4-%E6%9F%A5%E6%89%BE%E6%9C%80%E5%A4%A7%E6%88%96%E6%9C%80%E5%B0%8F%E7%9A%84-N-%E4%B8%AA%E5%85%83%E7%B4%A0"><span class="toc-number">1.3.</span> <span class="toc-text">1.4 查找最大或最小的 N 个元素</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-5-%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E4%BC%98%E5%85%88%E7%BA%A7%E9%98%9F%E5%88%97"><span class="toc-number">1.4.</span> <span class="toc-text">1.5 实现一个优先级队列</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-6-%E5%AD%97%E5%85%B8%E4%B8%AD%E7%9A%84%E9%94%AE%E6%98%A0%E5%B0%84%E5%A4%9A%E4%B8%AA%E5%80%BC"><span class="toc-number">1.5.</span> <span class="toc-text">1.6 字典中的键映射多个值</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-7-%E5%AD%97%E5%85%B8%E6%8E%92%E5%BA%8F"><span class="toc-number">1.6.</span> <span class="toc-text">1.7 字典排序</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-8-%E5%AD%97%E5%85%B8%E7%9A%84%E8%BF%90%E7%AE%97"><span class="toc-number">1.7.</span> <span class="toc-text">1.8 字典的运算</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-9-%E6%9F%A5%E6%89%BE%E4%B8%A4%E5%AD%97%E5%85%B8%E7%9A%84%E7%9B%B8%E5%90%8C%E7%82%B9"><span class="toc-number">1.8.</span> <span class="toc-text">1.9 查找两字典的相同点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-10-%E5%88%A0%E9%99%A4%E5%BA%8F%E5%88%97%E7%9B%B8%E5%90%8C%E5%85%83%E7%B4%A0%E5%B9%B6%E4%BF%9D%E6%8C%81%E9%A1%BA%E5%BA%8F"><span class="toc-number">1.9.</span> <span class="toc-text">1.10 删除序列相同元素并保持顺序</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-11-%E5%91%BD%E5%90%8D%E5%88%87%E7%89%87"><span class="toc-number">1.10.</span> <span class="toc-text">1.11 命名切片</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-12-%E5%BA%8F%E5%88%97%E4%B8%AD%E5%87%BA%E7%8E%B0%E6%AC%A1%E6%95%B0%E6%9C%80%E5%A4%9A%E7%9A%84%E5%85%83%E7%B4%A0"><span class="toc-number">1.11.</span> <span class="toc-text">1.12 序列中出现次数最多的元素</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-13-%E9%80%9A%E8%BF%87%E6%9F%90%E4%B8%AA%E5%85%B3%E9%94%AE%E5%AD%97%E6%8E%92%E5%BA%8F%E4%B8%80%E4%B8%AA%E5%AD%97%E5%85%B8%E5%88%97%E8%A1%A8"><span class="toc-number">1.12.</span> <span class="toc-text">1.13 通过某个关键字排序一个字典列表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-14-%E6%8E%92%E5%BA%8F%E4%B8%8D%E6%94%AF%E6%8C%81%E5%8E%9F%E7%94%9F%E6%AF%94%E8%BE%83%E7%9A%84%E5%AF%B9%E8%B1%A1"><span class="toc-number">1.13.</span> <span class="toc-text">1.14 排序不支持原生比较的对象</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-15-%E9%80%9A%E8%BF%87%E6%9F%90%E4%B8%AA%E5%AD%97%E6%AE%B5%E5%B0%86%E8%AE%B0%E5%BD%95%E5%88%86%E7%BB%84"><span class="toc-number">1.14.</span> <span class="toc-text">1.15 通过某个字段将记录分组</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-16-%E8%BF%87%E6%BB%A4%E5%BA%8F%E5%88%97%E5%85%83%E7%B4%A0"><span class="toc-number">1.15.</span> <span class="toc-text">1.16 过滤序列元素</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-17-%E4%BB%8E%E5%AD%97%E5%85%B8%E4%B8%AD%E6%8F%90%E5%8F%96%E5%AD%90%E9%9B%86"><span class="toc-number">1.16.</span> <span class="toc-text">1.17 从字典中提取子集</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-18-%E6%98%A0%E5%B0%84%E5%90%8D%E7%A7%B0%E5%88%B0%E5%BA%8F%E5%88%97%E5%85%83%E7%B4%A0"><span class="toc-number">1.17.</span> <span class="toc-text">1.18 映射名称到序列元素</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-19-%E8%BD%AC%E6%8D%A2%E5%B9%B6%E5%90%8C%E6%97%B6%E8%AE%A1%E7%AE%97%E6%95%B0%E6%8D%AE"><span class="toc-number">1.18.</span> <span class="toc-text">1.19 转换并同时计算数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-20-%E5%90%88%E5%B9%B6%E5%A4%9A%E4%B8%AA%E5%AD%97%E5%85%B8%E6%88%96%E6%98%A0%E5%B0%84"><span class="toc-number">1.19.</span> <span class="toc-text">1.20 合并多个字典或映射</span></a></li></ol></li></ol></details></div><div class="container post-content"><h2 id="第一章：数据结构和算法"><a href="#第一章：数据结构和算法" class="headerlink" title="第一章：数据结构和算法"></a>第一章：数据结构和算法</h2><h3 id="1-1-解压序列赋值给多个变量"><a href="#1-1-解压序列赋值给多个变量" class="headerlink" title="1.1 解压序列赋值给多个变量"></a>1.1 解压序列赋值给多个变量</h3><p>实际上,元组拆包适合用在任何<strong>可迭代对象</strong>上面，包括字符串，文件对象，迭代器和生成器。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gen</span>():</span></span><br><span class="line">	<span class="keyword">yield</span> <span class="number">1</span></span><br><span class="line">	<span class="keyword">yield</span> <span class="number">2</span></span><br><span class="line"></span><br><span class="line">g = gen()</span><br><span class="line"></span><br><span class="line">a,b = g</span><br><span class="line"><span class="built_in">print</span>(a,b)  <span class="comment"># 1 2</span></span><br><span class="line"></span><br><span class="line">mystr = <span class="string">&#x27;456&#x27;</span></span><br><span class="line">a,b,c = mystr</span><br><span class="line"><span class="built_in">print</span>(a,b,c)  <span class="comment"># 4 5 6</span></span><br></pre></td></tr></table></figure>

<p>所以,有一个引申用法:<br>用于<strong>快速掐头去尾</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">alist  = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>]</span><br><span class="line"></span><br><span class="line">_,*alist,_ = alist</span><br><span class="line"><span class="built_in">print</span>(alist)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(alist))</span><br><span class="line"><span class="comment"># [2, 3]</span></span><br><span class="line"><span class="comment"># &lt;class &#x27;list&#x27;&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>解压出的 alist变量永远都是列表类型，不管解压的数量是多少（包括 0 个）。</p>
</blockquote>
<p>特别常用于<code>split</code>:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">line = <span class="string">&#x27;nobody:*:-2:-2:Unprivileged User:/var/empty:/usr/bin/false&#x27;</span> </span><br><span class="line">uname, *fields, homedir, sh = line.split(<span class="string">&#x27;:&#x27;</span>) </span><br><span class="line"><span class="built_in">print</span>(uname)</span><br><span class="line"><span class="built_in">print</span>(homedir)</span><br><span class="line"><span class="built_in">print</span>(sh)</span><br></pre></td></tr></table></figure>

<p>甚至还可以用于递归:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">items = [<span class="number">1</span>, <span class="number">10</span>, <span class="number">7</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">9</span>] </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sum</span>(<span class="params">items</span>):</span></span><br><span class="line">    head, *tail = items</span><br><span class="line">    <span class="keyword">return</span> head + <span class="built_in">sum</span>(tail) <span class="keyword">if</span> tail <span class="keyword">else</span> head</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">sum</span>(items))</span><br></pre></td></tr></table></figure>

<blockquote>
<p>迭代解压语法:</p>
<ul>
<li><strong>解压不确定个数</strong>或<strong>任意个数元素的可迭代对象</strong></li>
<li>理论上来说可以和切片互换</li>
<li>经常==用它来快速截取需要的元素==</li>
</ul>
</blockquote>
<h3 id="1-3-保留最后-N-个元素"><a href="#1-3-保留最后-N-个元素" class="headerlink" title="1.3 保留最后 N 个元素"></a>1.3 保留最后 N 个元素</h3><p><strong>保留有限历史记录使用 collections.deque</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> deque</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">search</span>(<span class="params">lines, pattern, history=<span class="number">5</span></span>):</span></span><br><span class="line">    previous_lines = deque(maxlen=history)</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> lines:</span><br><span class="line">        <span class="keyword">if</span> pattern <span class="keyword">in</span> line:</span><br><span class="line">            <span class="keyword">yield</span> line, previous_lines</span><br><span class="line">        previous_lines.append(line)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Example use on a file</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;somefile.txt&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="keyword">for</span> line, prevlines <span class="keyword">in</span> search(f, <span class="string">&#x27;python&#x27;</span>, <span class="number">5</span>):</span><br><span class="line">            <span class="keyword">for</span> pline <span class="keyword">in</span> prevlines:</span><br><span class="line">                <span class="built_in">print</span>(pline, end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">            <span class="built_in">print</span>(line, end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;-&#x27;</span>*<span class="number">20</span>)</span><br></pre></td></tr></table></figure>





<h3 id="1-4-查找最大或最小的-N-个元素"><a href="#1-4-查找最大或最小的-N-个元素" class="headerlink" title="1.4 查找最大或最小的 N 个元素"></a>1.4 查找最大或最小的 N 个元素</h3><p>heapq 模块两个函数：<strong>nlargest()</strong> 和 <strong>nsmallest()</strong> </p>
<blockquote>
<p>heapq :heap queue堆队列</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> heapq</span><br><span class="line"></span><br><span class="line">nums = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>]</span><br><span class="line"><span class="built_in">print</span>(heapq.nlargest(<span class="number">3</span>,nums))</span><br><span class="line"><span class="built_in">print</span>(heapq.nsmallest(<span class="number">3</span>,nums))</span><br><span class="line"><span class="comment"># [7, 6, 5]</span></span><br><span class="line"><span class="comment"># [1, 2, 3]</span></span><br></pre></td></tr></table></figure>

<p>就像max有key参数可以使用一样,nlargest也有</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> heapq <span class="keyword">import</span> nlargest</span><br><span class="line"></span><br><span class="line">adict = [&#123;<span class="string">&#x27;name&#x27;</span>:<span class="number">13</span> ,<span class="string">&#x27;score&#x27;</span>:<span class="number">10</span>&#125;,</span><br><span class="line">		 &#123;<span class="string">&#x27;name&#x27;</span>:<span class="number">456</span>,<span class="string">&#x27;score&#x27;</span>:<span class="number">120</span>&#125;,</span><br><span class="line">		 &#123;<span class="string">&#x27;name&#x27;</span>:<span class="number">74</span> ,<span class="string">&#x27;score&#x27;</span>:<span class="number">103</span>&#125;,</span><br><span class="line">		 &#123;<span class="string">&#x27;name&#x27;</span>:<span class="number">58</span> ,<span class="string">&#x27;score&#x27;</span>:<span class="number">140</span>&#125;]</span><br><span class="line"></span><br><span class="line">x = <span class="built_in">max</span>(adict,key=<span class="keyword">lambda</span> x: x[<span class="string">&#x27;name&#x27;</span>])</span><br><span class="line"><span class="built_in">print</span>(x)   <span class="comment"># &#123;&#x27;name&#x27;: 456, &#x27;score&#x27;: 120&#125;</span></span><br><span class="line"></span><br><span class="line">y = nlargest(<span class="number">2</span>,adict,key=<span class="keyword">lambda</span> x: x[<span class="string">&#x27;score&#x27;</span>])</span><br><span class="line"><span class="built_in">print</span>(y)   <span class="comment"># [&#123;&#x27;name&#x27;: 58, &#x27;score&#x27;: 140&#125;, &#123;&#x27;name&#x27;: 456, &#x27;score&#x27;: 120&#125;]</span></span><br></pre></td></tr></table></figure>

<p>或者使用<code>heapq.heappop</code>查找最小或最大的 N 个元素:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> heapq</span><br><span class="line"></span><br><span class="line">x = [<span class="number">9</span>,<span class="number">5</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">9</span>,<span class="number">4</span>,<span class="number">2</span>,<span class="number">6</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将x进行堆排序</span></span><br><span class="line">heapq.heapify(x)</span><br><span class="line"><span class="built_in">print</span>(x)  <span class="comment"># [1, 2, 5, 2, 3, 9, 9, 4, 5, 6]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 弹出第一个,并且继续进行堆排序</span></span><br><span class="line"><span class="built_in">print</span>(heapq.heappop(x))  <span class="comment"># 1</span></span><br><span class="line"><span class="built_in">print</span>(x)  <span class="comment"># [2, 2, 5, 4, 3, 9, 9, 6, 5]</span></span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li>因为<strong>堆排序后第一个值 heap[0] 永远是最小的元素</strong>.所以只需执行N次heapq.heappop(x)即可</li>
<li>由于 push 和 pop 操作时间复杂度为 O(log N)，其中 N 是堆的大小，因此就算是 N 很大的时候它们运行 速度也依旧很快。 </li>
</ul>
</blockquote>
<p>总结:</p>
<blockquote>
<ul>
<li>当要查找的元素个数相对比较小的时候，使用函数 nlargest() 和 nsmallest() </li>
<li>仅仅想查找唯一的最小或最大（N=1）的元素的话，使用 min() 和 max() 函数</li>
<li>如果 N 的大小和集合大小接近的时候，通常先排序这个集合然后再使用切片操作（sorted(items)[:N] 或者是 sorted(items)[-N:] ）</li>
</ul>
</blockquote>
<h3 id="1-5-实现一个优先级队列"><a href="#1-5-实现一个优先级队列" class="headerlink" title="1.5 实现一个优先级队列"></a>1.5 实现一个优先级队列</h3><ul>
<li>按优先级排序的队列</li>
<li>在这个队列上面每次 pop 操作总是返回优先级最高的那个元素</li>
<li>如果两个有着相同优先级的元素（foo 和 grok ），pop 操作按照它们被插入到队列的顺序返回。</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> heapq</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PriorityQueue</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        self._queue = []</span><br><span class="line">        self._index = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">push</span>(<span class="params">self, item, priority</span>):</span></span><br><span class="line">    	<span class="comment"># 将一个元组作为堆排序的元素插入堆</span></span><br><span class="line"></span><br><span class="line">    	<span class="comment"># -priority:优先级越高-priotity就越小,越容易排到前面</span></span><br><span class="line"></span><br><span class="line">    	<span class="comment"># 当-priority相同时,就比较self._index,保证按照被插入到队列的顺序返回</span></span><br><span class="line">        heapq.heappush(self._queue, (-priority, self._index, item))</span><br><span class="line">        self._index += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">pop</span>(<span class="params">self</span>):</span></span><br><span class="line">    	<span class="comment"># 每次弹出第一个</span></span><br><span class="line">        <span class="keyword">return</span> heapq.heappop(self._queue)[-<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># Example use</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Item</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name</span>):</span></span><br><span class="line">        self.name = name</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;Item(&#123;!r&#125;)&#x27;</span>.<span class="built_in">format</span>(self.name)</span><br><span class="line"></span><br><span class="line">q = PriorityQueue()</span><br><span class="line">q.push(Item(<span class="string">&#x27;foo&#x27;</span>), <span class="number">1</span>)</span><br><span class="line">q.push(Item(<span class="string">&#x27;bar&#x27;</span>), <span class="number">5</span>)</span><br><span class="line">q.push(Item(<span class="string">&#x27;spam&#x27;</span>), <span class="number">4</span>)</span><br><span class="line">q.push(Item(<span class="string">&#x27;grok&#x27;</span>), <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Should be bar:&quot;</span>, q.pop())</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Should be spam:&quot;</span>, q.pop())</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Should be foo:&quot;</span>, q.pop())</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Should be grok:&quot;</span>, q.pop())</span><br><span class="line"><span class="comment"># Should be bar: Item(&#x27;bar&#x27;)</span></span><br><span class="line"><span class="comment"># Should be spam: Item(&#x27;spam&#x27;)</span></span><br><span class="line"><span class="comment"># Should be foo: Item(&#x27;foo&#x27;)</span></span><br><span class="line"><span class="comment"># Should be grok: Item(&#x27;grok&#x27;)</span></span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li>函数<code> heapq.heappush()</code>和 <code>heapq. heappop() </code>分别在队列上插入和删除第一个元素，然后执行堆排序</li>
<li>执行效果就是<strong>保证第一个元素拥有最高优先级</strong></li>
</ul>
</blockquote>
<blockquote>
<p>代码总结:</p>
<ol>
<li><p>tuple是可以比较的</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">tuple1 = (<span class="number">2</span>,<span class="number">3</span>)</span><br><span class="line">tuple2 = (<span class="number">3</span>,<span class="number">6</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(tuple1 &gt; tuple2)</span><br></pre></td></tr></table></figure></li>
<li><p><code>heapq.heappush(heap,item)</code>,将item放入heap中</p>
</li>
<li><p>所以我们可以将元组作为item插入到heap中</p>
</li>
</ol>
</blockquote>
<h3 id="1-6-字典中的键映射多个值"><a href="#1-6-字典中的键映射多个值" class="headerlink" title="1.6 字典中的键映射多个值"></a>1.6 字典中的键映射多个值</h3><p>defaultdict 会<strong>自动初始化每个 key 对应的值</strong>，所以你只需要关注添加元素操作了。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> defaultdict</span><br><span class="line"></span><br><span class="line"><span class="comment"># dict的值是一个list</span></span><br><span class="line">d1 = defaultdict(<span class="built_in">list</span>)</span><br><span class="line"></span><br><span class="line">d1[<span class="string">&#x27;a&#x27;</span>].append(<span class="number">1</span>)</span><br><span class="line"><span class="built_in">print</span>(d1)</span><br><span class="line"><span class="comment"># defaultdict(&lt;class &#x27;list&#x27;&gt;, &#123;&#x27;a&#x27;: [1]&#125;)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">d2 = defaultdict(<span class="built_in">set</span>)</span><br><span class="line">d2[<span class="string">&#x27;a&#x27;</span>].add(<span class="number">2</span>)</span><br><span class="line"><span class="built_in">print</span>(d2)</span><br><span class="line"><span class="comment"># defaultdict(&lt;class &#x27;set&#x27;&gt;, &#123;&#x27;a&#x27;: &#123;2&#125;&#125;)</span></span><br></pre></td></tr></table></figure>



<h3 id="1-7-字典排序"><a href="#1-7-字典排序" class="headerlink" title="1.7 字典排序"></a>1.7 字典排序</h3><p>OrderedDict 类 : 在迭代操作的时候它会<strong>保持元素被插入时的顺序</strong></p>
<p>当你想要构建一个将来需要序列化或编码成其他格式的映射的时候，OrderedDict<br>是非常有用的</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> OrderedDict</span><br><span class="line"></span><br><span class="line">d = OrderedDict()</span><br><span class="line"></span><br><span class="line">d[<span class="string">&#x27;a&#x27;</span>] = <span class="number">1</span></span><br><span class="line">d[<span class="string">&#x27;b&#x27;</span>] = <span class="number">2</span></span><br><span class="line">d[<span class="string">&#x27;c&#x27;</span>] = <span class="number">3</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(d)</span><br><span class="line"><span class="comment"># OrderedDict([(&#x27;a&#x27;, 1), (&#x27;b&#x27;, 2), (&#x27;c&#x27;, 3)])</span></span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li>OrderedDict 内部<strong>维护着一个根据键插入顺序排序的双向链表</strong>。每次当一个新的<br>元素插入进来的时候，它会被放到链表的尾部。对于一个已经存在的键的重复赋值不会改变键的顺序。</li>
<li>需要注意的是，一个 OrderedDict 的大小是一个普通字典的两倍，因为它内部维<br>护着另外一个链表。</li>
</ul>
</blockquote>
<h3 id="1-8-字典的运算"><a href="#1-8-字典的运算" class="headerlink" title="1.8 字典的运算"></a>1.8 字典的运算</h3><p>在数据字典中执行一些计算操作（比如求最小值、最大值、排序等等）</p>
<p>就像前面说的,元组是可以比较的,所以我们可以使用zip,将其打包成为元组:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">prices = &#123;</span><br><span class="line"><span class="string">&#x27;ACME&#x27;</span>: <span class="number">45.23</span>,</span><br><span class="line"><span class="string">&#x27;AAPL&#x27;</span>: <span class="number">612.78</span>,</span><br><span class="line"><span class="string">&#x27;IBM&#x27;</span>: <span class="number">205.55</span>,</span><br><span class="line"><span class="string">&#x27;HPQ&#x27;</span>: <span class="number">37.20</span>,</span><br><span class="line"><span class="string">&#x27;FB&#x27;</span>: <span class="number">10.75</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">max_num = <span class="built_in">max</span>(<span class="built_in">zip</span>(prices.values(),prices.keys()))</span><br><span class="line"><span class="built_in">print</span>(max_num)</span><br><span class="line"><span class="comment"># (612.78, &#x27;AAPL&#x27;)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">min_num = <span class="built_in">min</span>(prices,key=<span class="keyword">lambda</span> x: prices[x])</span><br><span class="line"><span class="built_in">print</span>(min_num)</span><br><span class="line"><span class="comment"># FB</span></span><br><span class="line"></span><br><span class="line">sorted_dict = <span class="built_in">sorted</span>(<span class="built_in">zip</span>(prices.values(),prices.keys()))</span><br><span class="line"><span class="built_in">print</span>(sorted_dict)</span><br><span class="line"><span class="comment"># [(10.75, &#x27;FB&#x27;), (37.2, &#x27;HPQ&#x27;), (45.23, &#x27;ACME&#x27;), (205.55, &#x27;IBM&#x27;), (612.78, &#x27;AAPL&#x27;)]</span></span><br></pre></td></tr></table></figure>

<p>总结,对于找出字典最大值有两种方式</p>
<ul>
<li><p>使用zip</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">min_num = <span class="built_in">min</span>(<span class="built_in">zip</span>(prices.values(),prices.keys()))</span><br></pre></td></tr></table></figure></li>
<li><p>使用max的key参数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">min_num = <span class="built_in">min</span>(prices,key=<span class="keyword">lambda</span> x:prices[x])</span><br></pre></td></tr></table></figure></li>
</ul>
<blockquote>
<p>注意:</p>
<ul>
<li><code>min_num = min(prices,key=lambda x:prices[x])</code>中的==x指的是第一个参数的迭代元素,也就是字典的键==</li>
<li>同理<code>min_num = min([(1,2),(1,3),(1,4)],key=lambda x:x[-1])</code>这里的x指的是[(1,2),(1,3),(1,4)]的迭代元素,也就是(1,2),(1,3),(1,4)</li>
</ul>
</blockquote>
<p>根据值来找对应的键:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">prices = &#123;</span><br><span class="line"><span class="string">&#x27;ACME&#x27;</span>: <span class="number">45.23</span>,</span><br><span class="line"><span class="string">&#x27;AAPL&#x27;</span>: <span class="number">612.78</span>,</span><br><span class="line"><span class="string">&#x27;IBM&#x27;</span>: <span class="number">205.55</span>,</span><br><span class="line"><span class="string">&#x27;HPQ&#x27;</span>: <span class="number">37.20</span>,</span><br><span class="line"><span class="string">&#x27;FB&#x27;</span>: <span class="number">10.75</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">x = [val <span class="keyword">for</span> val <span class="keyword">in</span> <span class="built_in">zip</span>(prices.values(),prices.keys())]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> score,name <span class="keyword">in</span> x:</span><br><span class="line">	<span class="keyword">if</span> score == <span class="number">205.55</span>:</span><br><span class="line">		<span class="built_in">print</span>(name)</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>对于两个复杂对象的比较,总是要想到zip</strong></p>
</blockquote>
<h3 id="1-9-查找两字典的相同点"><a href="#1-9-查找两字典的相同点" class="headerlink" title="1.9 查找两字典的相同点"></a>1.9 查找两字典的相同点</h3><p>使用集合运算</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">a = &#123;</span><br><span class="line"><span class="string">&#x27;x&#x27;</span> : <span class="number">1</span>,</span><br><span class="line"><span class="string">&#x27;y&#x27;</span> : <span class="number">2</span>,</span><br><span class="line"><span class="string">&#x27;z&#x27;</span> : <span class="number">3</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">b = &#123;</span><br><span class="line"><span class="string">&#x27;w&#x27;</span> : <span class="number">10</span>,</span><br><span class="line"><span class="string">&#x27;x&#x27;</span> : <span class="number">11</span>,</span><br><span class="line"><span class="string">&#x27;y&#x27;</span> : <span class="number">2</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">res1 = a.keys() &amp; b.keys()</span><br><span class="line">res2 = a.keys() | b.keys()</span><br><span class="line">res3 = a.keys() - b.keys()</span><br><span class="line"></span><br><span class="line">res4 = a.items() &amp; b.items()</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(res1)  <span class="comment"># &#123;&#x27;y&#x27;, &#x27;x&#x27;&#125;</span></span><br><span class="line"><span class="built_in">print</span>(res2)  <span class="comment"># &#123;&#x27;y&#x27;, &#x27;w&#x27;, &#x27;x&#x27;, &#x27;z&#x27;&#125;</span></span><br><span class="line"><span class="built_in">print</span>(res3)  <span class="comment"># &#123;&#x27;z&#x27;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(res4)  <span class="comment"># &#123;(&#x27;y&#x27;, 2)&#125;</span></span><br></pre></td></tr></table></figure>

<p>在构造字典的时候,从字典中删除某些键:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">a = &#123;</span><br><span class="line"><span class="string">&#x27;x&#x27;</span> : <span class="number">1</span>,</span><br><span class="line"><span class="string">&#x27;y&#x27;</span> : <span class="number">2</span>,</span><br><span class="line"><span class="string">&#x27;z&#x27;</span> : <span class="number">3</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">res = &#123;key:a[key] <span class="keyword">for</span> key <span class="keyword">in</span> a.keys() - &#123;<span class="string">&#x27;x&#x27;</span>&#125;&#125;</span><br><span class="line"><span class="built_in">print</span>(res) <span class="comment"># &#123;&#x27;z&#x27;: 3, &#x27;y&#x27;: 2&#125;</span></span><br></pre></td></tr></table></figure>



<h3 id="1-10-删除序列相同元素并保持顺序"><a href="#1-10-删除序列相同元素并保持顺序" class="headerlink" title="1.10 删除序列相同元素并保持顺序"></a>1.10 删除序列相同元素并保持顺序</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dedupe</span>(<span class="params">items</span>):</span></span><br><span class="line">    seen = <span class="built_in">set</span>()</span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> items:</span><br><span class="line">        <span class="keyword">if</span> item <span class="keyword">not</span> <span class="keyword">in</span> seen:</span><br><span class="line">            <span class="keyword">yield</span> item</span><br><span class="line">            seen.add(item)</span><br><span class="line"></span><br><span class="line">a = [<span class="number">1</span>, <span class="number">5</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">9</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">10</span>]</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">list</span>(dedupe(a)))</span><br><span class="line"><span class="comment"># [1, 5, 2, 9, 10]</span></span><br></pre></td></tr></table></figure>

<p>添加一个函数key参数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dedupe</span>(<span class="params">items, key=<span class="literal">None</span></span>):</span></span><br><span class="line">    seen = <span class="built_in">set</span>()</span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> items:</span><br><span class="line">        val = item <span class="keyword">if</span> key <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">else</span> key(item)</span><br><span class="line">        <span class="keyword">if</span> val <span class="keyword">not</span> <span class="keyword">in</span> seen:</span><br><span class="line">            <span class="keyword">yield</span> item</span><br><span class="line">            seen.add(val)</span><br><span class="line"></span><br><span class="line">a = [ &#123;<span class="string">&#x27;x&#x27;</span>:<span class="number">1</span>, <span class="string">&#x27;y&#x27;</span>:<span class="number">2</span>&#125;, &#123;<span class="string">&#x27;x&#x27;</span>:<span class="number">1</span>, <span class="string">&#x27;y&#x27;</span>:<span class="number">3</span>&#125;, &#123;<span class="string">&#x27;x&#x27;</span>:<span class="number">1</span>, <span class="string">&#x27;y&#x27;</span>:<span class="number">2</span>&#125;, &#123;<span class="string">&#x27;x&#x27;</span>:<span class="number">2</span>, <span class="string">&#x27;y&#x27;</span>:<span class="number">4</span>&#125;]</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">list</span>(dedupe(a, key=<span class="keyword">lambda</span> d: (d[<span class="string">&#x27;x&#x27;</span>],d[<span class="string">&#x27;y&#x27;</span>]))))</span><br><span class="line"><span class="comment"># [&#123;&#x27;x&#x27;: 1, &#x27;y&#x27;: 2&#125;, &#123;&#x27;x&#x27;: 1, &#x27;y&#x27;: 3&#125;, &#123;&#x27;x&#x27;: 2, &#x27;y&#x27;: 4&#125;]</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">list</span>(dedupe(a, key=<span class="keyword">lambda</span> d: d[<span class="string">&#x27;x&#x27;</span>])))</span><br><span class="line"><span class="comment"># [&#123;&#x27;x&#x27;: 1, &#x27;y&#x27;: 2&#125;, &#123;&#x27;x&#x27;: 2, &#x27;y&#x27;: 4&#125;]</span></span><br></pre></td></tr></table></figure>



<h3 id="1-11-命名切片"><a href="#1-11-命名切片" class="headerlink" title="1.11 命名切片"></a>1.11 命名切片</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">record = <span class="string">&#x27;....................100 .......513.25 ..........&#x27;</span></span><br><span class="line">cost = <span class="built_in">int</span>(record[<span class="number">20</span>:<span class="number">23</span>]) * <span class="built_in">float</span>(record[<span class="number">31</span>:<span class="number">37</span>])</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(cost)  <span class="comment"># 51325.0</span></span><br></pre></td></tr></table></figure>

<p>硬编码不可取,应改为:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SHARES = <span class="built_in">slice</span>(<span class="number">20</span>,<span class="number">23</span>)</span><br><span class="line">PRICE = <span class="built_in">slice</span>(<span class="number">31</span>,<span class="number">37</span>)</span><br><span class="line">cost = <span class="built_in">int</span>(record[SHARES]) * <span class="built_in">float</span>(record[PRICE])</span><br><span class="line"><span class="built_in">print</span>(cost)  <span class="comment"># # 51325.0</span></span><br></pre></td></tr></table></figure>



<h3 id="1-12-序列中出现次数最多的元素"><a href="#1-12-序列中出现次数最多的元素" class="headerlink" title="1.12 序列中出现次数最多的元素"></a>1.12 序列中出现次数最多的元素</h3><p>使用collections.Counter</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> Counter</span><br><span class="line"></span><br><span class="line">x = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">4</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">5</span>,<span class="number">2</span>,<span class="number">6</span>,<span class="number">2</span>,<span class="number">6</span>,<span class="number">5</span>,<span class="number">2</span>,<span class="number">6</span>]</span><br><span class="line">c = Counter(x)</span><br><span class="line"><span class="built_in">print</span>(c)  <span class="comment"># Counter(&#123;2: 7, 5: 4, 6: 4, 1: 3, 3: 2, 4: 1&#125;)</span></span><br><span class="line"><span class="built_in">print</span>(c.most_common())  <span class="comment"># [(2, 7), (5, 4), (6, 4), (1, 3), (3, 2), (4, 1)]</span></span><br></pre></td></tr></table></figure>



<h3 id="1-13-通过某个关键字排序一个字典列表"><a href="#1-13-通过某个关键字排序一个字典列表" class="headerlink" title="1.13 通过某个关键字排序一个字典列表"></a>1.13 通过某个关键字排序一个字典列表</h3><p>你有一个字典列表，你想根据某个或某几个字典字段来排序这个列表。</p>
<p><strong>使用 operator 模块的 itemgetter 函数</strong></p>
<blockquote>
<p>operator.itemgetter函数获取的不是值，而是定义了一个函数，通过该函数作用到对象上才能获取值。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> operator <span class="keyword">import</span> itemgetter</span><br><span class="line"></span><br><span class="line">get_first = itemgetter(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">alist1 = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>]</span><br><span class="line">alist2 = [<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">2</span>]</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(get_first(alist1))</span><br><span class="line"><span class="built_in">print</span>(get_first(alist2))</span><br></pre></td></tr></table></figure>
</blockquote>
<p>使用itemgetter通过某个关键字排序一个字典列表 :</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> operator <span class="keyword">import</span> itemgetter</span><br><span class="line"></span><br><span class="line">rows = [</span><br><span class="line">&#123;<span class="string">&#x27;fname&#x27;</span>: <span class="string">&#x27;Brian&#x27;</span>, <span class="string">&#x27;lname&#x27;</span>: <span class="string">&#x27;Jones&#x27;</span>, <span class="string">&#x27;uid&#x27;</span>: <span class="number">1003</span>&#125;,</span><br><span class="line">&#123;<span class="string">&#x27;fname&#x27;</span>: <span class="string">&#x27;David&#x27;</span>, <span class="string">&#x27;lname&#x27;</span>: <span class="string">&#x27;Beazley&#x27;</span>, <span class="string">&#x27;uid&#x27;</span>: <span class="number">1002</span>&#125;,</span><br><span class="line">&#123;<span class="string">&#x27;fname&#x27;</span>: <span class="string">&#x27;John&#x27;</span>, <span class="string">&#x27;lname&#x27;</span>: <span class="string">&#x27;Cleese&#x27;</span>, <span class="string">&#x27;uid&#x27;</span>: <span class="number">1001</span>&#125;,</span><br><span class="line">&#123;<span class="string">&#x27;fname&#x27;</span>: <span class="string">&#x27;Big&#x27;</span>, <span class="string">&#x27;lname&#x27;</span>: <span class="string">&#x27;Jones&#x27;</span>, <span class="string">&#x27;uid&#x27;</span>: <span class="number">1004</span>&#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">rows_by_fname = <span class="built_in">sorted</span>(rows, key=itemgetter(<span class="string">&#x27;fname&#x27;</span>))</span><br><span class="line">rows_by_uid = <span class="built_in">sorted</span>(rows, key=itemgetter(<span class="string">&#x27;uid&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(rows_by_fname)</span><br><span class="line"><span class="comment"># [&#123;&#x27;fname&#x27;: &#x27;Big&#x27;, &#x27;lname&#x27;: &#x27;Jones&#x27;, &#x27;uid&#x27;: 1004&#125;, &#123;&#x27;fname&#x27;: &#x27;Brian&#x27;, &#x27;lname&#x27;: &#x27;Jones&#x27;, &#x27;uid&#x27;: 1003&#125;, &#123;&#x27;fname&#x27;: &#x27;David&#x27;, &#x27;lname&#x27;: &#x27;Beazley&#x27;, &#x27;uid&#x27;: 1002&#125;, &#123;&#x27;fname&#x27;: &#x27;John&#x27;, &#x27;lname&#x27;: &#x27;Cleese&#x27;, &#x27;uid&#x27;: 1001&#125;]</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(rows_by_uid)</span><br><span class="line"><span class="comment"># [&#123;&#x27;fname&#x27;: &#x27;John&#x27;, &#x27;lname&#x27;: &#x27;Cleese&#x27;, &#x27;uid&#x27;: 1001&#125;, &#123;&#x27;fname&#x27;: &#x27;David&#x27;, &#x27;lname&#x27;: &#x27;Beazley&#x27;, &#x27;uid&#x27;: 1002&#125;, &#123;&#x27;fname&#x27;: &#x27;Brian&#x27;, &#x27;lname&#x27;: &#x27;Jones&#x27;, &#x27;uid&#x27;: 1003&#125;, &#123;&#x27;fname&#x27;: &#x27;Big&#x27;, &#x27;lname&#x27;: &#x27;Jones&#x27;, &#x27;uid&#x27;: 1004&#125;]</span></span><br></pre></td></tr></table></figure>

<p>或者:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">rows = [</span><br><span class="line">&#123;<span class="string">&#x27;fname&#x27;</span>: <span class="string">&#x27;Brian&#x27;</span>, <span class="string">&#x27;lname&#x27;</span>: <span class="string">&#x27;Jones&#x27;</span>, <span class="string">&#x27;uid&#x27;</span>: <span class="number">1003</span>&#125;,</span><br><span class="line">&#123;<span class="string">&#x27;fname&#x27;</span>: <span class="string">&#x27;David&#x27;</span>, <span class="string">&#x27;lname&#x27;</span>: <span class="string">&#x27;Beazley&#x27;</span>, <span class="string">&#x27;uid&#x27;</span>: <span class="number">1002</span>&#125;,</span><br><span class="line">&#123;<span class="string">&#x27;fname&#x27;</span>: <span class="string">&#x27;John&#x27;</span>, <span class="string">&#x27;lname&#x27;</span>: <span class="string">&#x27;Cleese&#x27;</span>, <span class="string">&#x27;uid&#x27;</span>: <span class="number">1001</span>&#125;,</span><br><span class="line">&#123;<span class="string">&#x27;fname&#x27;</span>: <span class="string">&#x27;Big&#x27;</span>, <span class="string">&#x27;lname&#x27;</span>: <span class="string">&#x27;Jones&#x27;</span>, <span class="string">&#x27;uid&#x27;</span>: <span class="number">1004</span>&#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="built_in">sorted</span>(rows,key=<span class="keyword">lambda</span> x:x[<span class="string">&#x27;fname&#x27;</span>])</span><br><span class="line"><span class="built_in">print</span>(rows)</span><br></pre></td></tr></table></figure>



<p>itemgetter() 函数也支持多个 keys,实现<strong>主要关键字和次要关键字的排序</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> operator <span class="keyword">import</span> itemgetter</span><br><span class="line"></span><br><span class="line">rows = [</span><br><span class="line">&#123;<span class="string">&#x27;fname&#x27;</span>: <span class="string">&#x27;Brian&#x27;</span>, <span class="string">&#x27;lname&#x27;</span>: <span class="string">&#x27;Jones&#x27;</span>, <span class="string">&#x27;uid&#x27;</span>: <span class="number">1003</span>&#125;,</span><br><span class="line">&#123;<span class="string">&#x27;fname&#x27;</span>: <span class="string">&#x27;David&#x27;</span>, <span class="string">&#x27;lname&#x27;</span>: <span class="string">&#x27;Beazley&#x27;</span>, <span class="string">&#x27;uid&#x27;</span>: <span class="number">1002</span>&#125;,</span><br><span class="line">&#123;<span class="string">&#x27;fname&#x27;</span>: <span class="string">&#x27;John&#x27;</span>, <span class="string">&#x27;lname&#x27;</span>: <span class="string">&#x27;Cleese&#x27;</span>, <span class="string">&#x27;uid&#x27;</span>: <span class="number">1001</span>&#125;,</span><br><span class="line">&#123;<span class="string">&#x27;fname&#x27;</span>: <span class="string">&#x27;Big&#x27;</span>, <span class="string">&#x27;lname&#x27;</span>: <span class="string">&#x27;Jones&#x27;</span>, <span class="string">&#x27;uid&#x27;</span>: <span class="number">1004</span>&#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">rows_by_fname_and_uid = <span class="built_in">sorted</span>(rows, key=itemgetter(<span class="string">&#x27;fname&#x27;</span>,<span class="string">&#x27;uid&#x27;</span>))</span><br><span class="line"><span class="built_in">print</span>(rows_by_fname_and_uid)</span><br><span class="line"><span class="comment"># [&#123;&#x27;fname&#x27;: &#x27;Big&#x27;, &#x27;lname&#x27;: &#x27;Jones&#x27;, &#x27;uid&#x27;: 1004&#125;, &#123;&#x27;fname&#x27;: &#x27;Brian&#x27;, &#x27;lname&#x27;: &#x27;Jones&#x27;, &#x27;uid&#x27;: 1003&#125;, &#123;&#x27;fname&#x27;: &#x27;David&#x27;, &#x27;lname&#x27;: &#x27;Beazley&#x27;, &#x27;uid&#x27;: 1002&#125;, &#123;&#x27;fname&#x27;: &#x27;John&#x27;, &#x27;lname&#x27;: &#x27;Cleese&#x27;, &#x27;uid&#x27;: 1001&#125;]</span></span><br></pre></td></tr></table></figure>



<h3 id="1-14-排序不支持原生比较的对象"><a href="#1-14-排序不支持原生比较的对象" class="headerlink" title="1.14 排序不支持原生比较的对象"></a>1.14 排序不支持原生比较的对象</h3><p>你想排序类型相同的对象，但是他们不支持原生的比较操作。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, user_id</span>):</span></span><br><span class="line">        self.user_id = user_id</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;User(&#123;&#125;)&#x27;</span>.<span class="built_in">format</span>(self.user_id)</span><br><span class="line"></span><br><span class="line">users = [User(each_num) <span class="keyword">for</span> each_num <span class="keyword">in</span> (<span class="number">5</span>,<span class="number">2</span>,<span class="number">6</span>)]</span><br><span class="line"><span class="built_in">print</span>(users)  </span><br><span class="line"><span class="comment"># [User(5), User(2), User(6)]</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">sorted</span>(users,key=<span class="keyword">lambda</span> x:x.user_id))</span><br><span class="line"><span class="comment"># [User(2), User(5), User(6)]</span></span><br></pre></td></tr></table></figure>

<p>或者使用attrgetter:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> operator <span class="keyword">import</span> attrgetter</span><br><span class="line"></span><br><span class="line">get_userid = attrgetter(<span class="string">&#x27;user_id&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, user_id</span>):</span></span><br><span class="line">        self.user_id = user_id</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;User(&#123;&#125;)&#x27;</span>.<span class="built_in">format</span>(self.user_id)</span><br><span class="line"></span><br><span class="line">users = [User(each_num) <span class="keyword">for</span> each_num <span class="keyword">in</span> (<span class="number">5</span>,<span class="number">2</span>,<span class="number">6</span>)]</span><br><span class="line"><span class="built_in">print</span>(users)  </span><br><span class="line"><span class="comment"># [User(5), User(2), User(6)]</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">sorted</span>(users,key=get_userid))</span><br><span class="line"><span class="comment"># [User(2), User(5), User(6)]</span></span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li>不管是attrgetter还是itemgetter,都支持多个参数</li>
<li>也就是受,可以使用这两个参数来实现主要关键字和次要关键字的排序</li>
</ul>
</blockquote>
<h3 id="1-15-通过某个字段将记录分组"><a href="#1-15-通过某个字段将记录分组" class="headerlink" title="1.15 通过某个字段将记录分组"></a>1.15 通过某个字段将记录分组</h3><p>你有一个字典或者实例的序列，然后你想根据某个特定的字段比如 date 来<strong>分组迭</strong><br><strong>代</strong>访问。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> groupby</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">rows = [</span><br><span class="line">&#123;<span class="string">&#x27;address&#x27;</span>: <span class="string">&#x27;5412 N CLARK&#x27;</span>, <span class="string">&#x27;date&#x27;</span>: <span class="string">&#x27;07/01/2012&#x27;</span>&#125;,</span><br><span class="line">&#123;<span class="string">&#x27;address&#x27;</span>: <span class="string">&#x27;5148 N CLARK&#x27;</span>, <span class="string">&#x27;date&#x27;</span>: <span class="string">&#x27;07/04/2012&#x27;</span>&#125;,</span><br><span class="line">&#123;<span class="string">&#x27;address&#x27;</span>: <span class="string">&#x27;5800 E 58TH&#x27;</span>, <span class="string">&#x27;date&#x27;</span>: <span class="string">&#x27;07/02/2012&#x27;</span>&#125;,</span><br><span class="line">&#123;<span class="string">&#x27;address&#x27;</span>: <span class="string">&#x27;2122 N CLARK&#x27;</span>, <span class="string">&#x27;date&#x27;</span>: <span class="string">&#x27;07/03/2012&#x27;</span>&#125;,</span><br><span class="line">&#123;<span class="string">&#x27;address&#x27;</span>: <span class="string">&#x27;5645 N RAVENSWOOD&#x27;</span>, <span class="string">&#x27;date&#x27;</span>: <span class="string">&#x27;07/02/2012&#x27;</span>&#125;,</span><br><span class="line">&#123;<span class="string">&#x27;address&#x27;</span>: <span class="string">&#x27;1060 W ADDISON&#x27;</span>, <span class="string">&#x27;date&#x27;</span>: <span class="string">&#x27;07/02/2012&#x27;</span>&#125;,</span><br><span class="line">&#123;<span class="string">&#x27;address&#x27;</span>: <span class="string">&#x27;4801 N BROADWAY&#x27;</span>, <span class="string">&#x27;date&#x27;</span>: <span class="string">&#x27;07/01/2012&#x27;</span>&#125;,</span><br><span class="line">&#123;<span class="string">&#x27;address&#x27;</span>: <span class="string">&#x27;1039 W GRANVILLE&#x27;</span>, <span class="string">&#x27;date&#x27;</span>: <span class="string">&#x27;07/04/2012&#x27;</span>&#125;,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> each <span class="keyword">in</span> groupby(rows,key=<span class="keyword">lambda</span> x:x[<span class="string">&#x27;date&#x27;</span>]):</span><br><span class="line">	<span class="built_in">print</span>(each)</span><br><span class="line"><span class="comment"># (&#x27;07/01/2012&#x27;, &lt;itertools._grouper object at 0x0000021DAEBFDB38&gt;)</span></span><br><span class="line"><span class="comment"># (&#x27;07/04/2012&#x27;, &lt;itertools._grouper object at 0x0000021DAEBFDBA8&gt;)</span></span><br><span class="line"><span class="comment"># (&#x27;07/02/2012&#x27;, &lt;itertools._grouper object at 0x0000021DAEBFDB70&gt;)</span></span><br><span class="line"><span class="comment"># (&#x27;07/03/2012&#x27;, &lt;itertools._grouper object at 0x0000021DAEBFDB38&gt;)</span></span><br><span class="line"><span class="comment"># (&#x27;07/02/2012&#x27;, &lt;itertools._grouper object at 0x0000021DAEBFDBA8&gt;)</span></span><br><span class="line"><span class="comment"># (&#x27;07/01/2012&#x27;, &lt;itertools._grouper object at 0x0000021DAEBFDB70&gt;)</span></span><br><span class="line"><span class="comment"># (&#x27;07/04/2012&#x27;, &lt;itertools._grouper object at 0x0000021DAEBFDB38&gt;)</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> groupby</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">rows = [</span><br><span class="line">&#123;<span class="string">&#x27;address&#x27;</span>: <span class="string">&#x27;5412 N CLARK&#x27;</span>, <span class="string">&#x27;date&#x27;</span>: <span class="string">&#x27;07/01/2012&#x27;</span>&#125;,</span><br><span class="line">&#123;<span class="string">&#x27;address&#x27;</span>: <span class="string">&#x27;5148 N CLARK&#x27;</span>, <span class="string">&#x27;date&#x27;</span>: <span class="string">&#x27;07/04/2012&#x27;</span>&#125;,</span><br><span class="line">&#123;<span class="string">&#x27;address&#x27;</span>: <span class="string">&#x27;5800 E 58TH&#x27;</span>, <span class="string">&#x27;date&#x27;</span>: <span class="string">&#x27;07/02/2012&#x27;</span>&#125;,</span><br><span class="line">&#123;<span class="string">&#x27;address&#x27;</span>: <span class="string">&#x27;2122 N CLARK&#x27;</span>, <span class="string">&#x27;date&#x27;</span>: <span class="string">&#x27;07/03/2012&#x27;</span>&#125;,</span><br><span class="line">&#123;<span class="string">&#x27;address&#x27;</span>: <span class="string">&#x27;5645 N RAVENSWOOD&#x27;</span>, <span class="string">&#x27;date&#x27;</span>: <span class="string">&#x27;07/02/2012&#x27;</span>&#125;,</span><br><span class="line">&#123;<span class="string">&#x27;address&#x27;</span>: <span class="string">&#x27;1060 W ADDISON&#x27;</span>, <span class="string">&#x27;date&#x27;</span>: <span class="string">&#x27;07/02/2012&#x27;</span>&#125;,</span><br><span class="line">&#123;<span class="string">&#x27;address&#x27;</span>: <span class="string">&#x27;4801 N BROADWAY&#x27;</span>, <span class="string">&#x27;date&#x27;</span>: <span class="string">&#x27;07/01/2012&#x27;</span>&#125;,</span><br><span class="line">&#123;<span class="string">&#x27;address&#x27;</span>: <span class="string">&#x27;1039 W GRANVILLE&#x27;</span>, <span class="string">&#x27;date&#x27;</span>: <span class="string">&#x27;07/04/2012&#x27;</span>&#125;,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> date,val <span class="keyword">in</span> groupby(rows,key=<span class="keyword">lambda</span> x:x[<span class="string">&#x27;date&#x27;</span>]):</span><br><span class="line">	<span class="built_in">print</span>(date)</span><br><span class="line">	<span class="keyword">for</span> item <span class="keyword">in</span> val:</span><br><span class="line">		<span class="built_in">print</span>(item)</span><br><span class="line"><span class="comment"># 07/01/2012</span></span><br><span class="line"><span class="comment"># &#123;&#x27;address&#x27;: &#x27;5412 N CLARK&#x27;, &#x27;date&#x27;: &#x27;07/01/2012&#x27;&#125;</span></span><br><span class="line"><span class="comment"># 07/04/2012</span></span><br><span class="line"><span class="comment"># &#123;&#x27;address&#x27;: &#x27;5148 N CLARK&#x27;, &#x27;date&#x27;: &#x27;07/04/2012&#x27;&#125;</span></span><br><span class="line"><span class="comment"># 07/02/2012</span></span><br><span class="line"><span class="comment"># &#123;&#x27;address&#x27;: &#x27;5800 E 58TH&#x27;, &#x27;date&#x27;: &#x27;07/02/2012&#x27;&#125;</span></span><br><span class="line"><span class="comment"># 07/03/2012</span></span><br><span class="line"><span class="comment"># &#123;&#x27;address&#x27;: &#x27;2122 N CLARK&#x27;, &#x27;date&#x27;: &#x27;07/03/2012&#x27;&#125;</span></span><br><span class="line"><span class="comment"># 07/02/2012</span></span><br><span class="line"><span class="comment"># &#123;&#x27;address&#x27;: &#x27;5645 N RAVENSWOOD&#x27;, &#x27;date&#x27;: &#x27;07/02/2012&#x27;&#125;</span></span><br><span class="line"><span class="comment"># &#123;&#x27;address&#x27;: &#x27;1060 W ADDISON&#x27;, &#x27;date&#x27;: &#x27;07/02/2012&#x27;&#125;</span></span><br><span class="line"><span class="comment"># 07/01/2012</span></span><br><span class="line"><span class="comment"># &#123;&#x27;address&#x27;: &#x27;4801 N BROADWAY&#x27;, &#x27;date&#x27;: &#x27;07/01/2012&#x27;&#125;</span></span><br><span class="line"><span class="comment"># 07/04/2012</span></span><br><span class="line"><span class="comment"># &#123;&#x27;address&#x27;: &#x27;1039 W GRANVILLE&#x27;, &#x27;date&#x27;: &#x27;07/04/2012&#x27;&#125;</span></span><br></pre></td></tr></table></figure>

<p>也可以使用defaultdict:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> defaultdict</span><br><span class="line"></span><br><span class="line">rows = [</span><br><span class="line">&#123;<span class="string">&#x27;address&#x27;</span>: <span class="string">&#x27;5412 N CLARK&#x27;</span>, <span class="string">&#x27;date&#x27;</span>: <span class="string">&#x27;07/01/2012&#x27;</span>&#125;,</span><br><span class="line">&#123;<span class="string">&#x27;address&#x27;</span>: <span class="string">&#x27;5148 N CLARK&#x27;</span>, <span class="string">&#x27;date&#x27;</span>: <span class="string">&#x27;07/04/2012&#x27;</span>&#125;,</span><br><span class="line">&#123;<span class="string">&#x27;address&#x27;</span>: <span class="string">&#x27;5800 E 58TH&#x27;</span>, <span class="string">&#x27;date&#x27;</span>: <span class="string">&#x27;07/02/2012&#x27;</span>&#125;,</span><br><span class="line">&#123;<span class="string">&#x27;address&#x27;</span>: <span class="string">&#x27;2122 N CLARK&#x27;</span>, <span class="string">&#x27;date&#x27;</span>: <span class="string">&#x27;07/03/2012&#x27;</span>&#125;,</span><br><span class="line">&#123;<span class="string">&#x27;address&#x27;</span>: <span class="string">&#x27;5645 N RAVENSWOOD&#x27;</span>, <span class="string">&#x27;date&#x27;</span>: <span class="string">&#x27;07/02/2012&#x27;</span>&#125;,</span><br><span class="line">&#123;<span class="string">&#x27;address&#x27;</span>: <span class="string">&#x27;1060 W ADDISON&#x27;</span>, <span class="string">&#x27;date&#x27;</span>: <span class="string">&#x27;07/02/2012&#x27;</span>&#125;,</span><br><span class="line">&#123;<span class="string">&#x27;address&#x27;</span>: <span class="string">&#x27;4801 N BROADWAY&#x27;</span>, <span class="string">&#x27;date&#x27;</span>: <span class="string">&#x27;07/01/2012&#x27;</span>&#125;,</span><br><span class="line">&#123;<span class="string">&#x27;address&#x27;</span>: <span class="string">&#x27;1039 W GRANVILLE&#x27;</span>, <span class="string">&#x27;date&#x27;</span>: <span class="string">&#x27;07/04/2012&#x27;</span>&#125;,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">d = defaultdict(<span class="built_in">list</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> row <span class="keyword">in</span> rows:</span><br><span class="line">    d[row[<span class="string">&#x27;date&#x27;</span>]].append(row[<span class="string">&#x27;address&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(d)</span><br><span class="line"><span class="comment"># defaultdict(&lt;class &#x27;list&#x27;&gt;, &#123;&#x27;07/01/2012&#x27;: [&#x27;5412 N CLARK&#x27;, &#x27;4801 N BROADWAY&#x27;], &#x27;07/04/2012&#x27;: [&#x27;5148 N CLARK&#x27;, &#x27;1039 W GRANVILLE&#x27;], &#x27;07/02/2012&#x27;: [&#x27;5800 E 58TH&#x27;, &#x27;5645 N RAVENSWOOD&#x27;, &#x27;1060 W ADDISON&#x27;], &#x27;07/03/2012&#x27;: [&#x27;2122 N CLARK&#x27;]&#125;)</span></span><br></pre></td></tr></table></figure>



<h3 id="1-16-过滤序列元素"><a href="#1-16-过滤序列元素" class="headerlink" title="1.16 过滤序列元素"></a>1.16 过滤序列元素</h3><p>列表解析</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mylist = [<span class="number">1</span>, <span class="number">4</span>, -<span class="number">5</span>, <span class="number">10</span>, -<span class="number">7</span>, <span class="number">2</span>, <span class="number">3</span>, -<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">new_list = [num <span class="keyword">for</span> num <span class="keyword">in</span> mylist <span class="keyword">if</span> num &gt; <span class="number">0</span>]</span><br><span class="line"><span class="built_in">print</span>(new_list)  <span class="comment"># [1, 4, 10, 2, 3]</span></span><br></pre></td></tr></table></figure>

<p>filter</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mylist = [<span class="number">1</span>, <span class="number">4</span>, -<span class="number">5</span>, <span class="number">10</span>, -<span class="number">7</span>, <span class="number">2</span>, <span class="number">3</span>, -<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">x = <span class="built_in">list</span>(<span class="built_in">filter</span>(<span class="keyword">lambda</span> x:x&gt;<span class="number">0</span>,mylist))</span><br><span class="line"><span class="built_in">print</span>(x)  <span class="comment"># [1, 4, 10, 2, 3]</span></span><br></pre></td></tr></table></figure>



<blockquote>
<p>关于列表解析有一点需要注意,那就是if的位置:</p>
<ul>
<li><p>if放后面</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mylist = [<span class="number">1</span>, <span class="number">4</span>, -<span class="number">5</span>, <span class="number">10</span>, -<span class="number">7</span>, <span class="number">2</span>, <span class="number">3</span>, -<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">clip_pos = [n <span class="keyword">for</span> n <span class="keyword">in</span> mylist <span class="keyword">if</span> n &lt; <span class="number">0</span>]</span><br><span class="line"><span class="built_in">print</span>(clip_pos)  <span class="comment"># [-5, -7, -1]</span></span><br></pre></td></tr></table></figure></li>
<li><p>if放前面:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mylist = [<span class="number">1</span>, <span class="number">4</span>, -<span class="number">5</span>, <span class="number">10</span>, -<span class="number">7</span>, <span class="number">2</span>, <span class="number">3</span>, -<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">clip_pos = [n <span class="keyword">if</span> n &lt; <span class="number">0</span> <span class="keyword">else</span> <span class="number">0</span> <span class="keyword">for</span> n <span class="keyword">in</span> mylist]</span><br><span class="line"><span class="built_in">print</span>(clip_pos)  <span class="comment"># [0, 0, -5, 0, -7, 0, 0, -1]</span></span><br></pre></td></tr></table></figure></li>
<li><p><strong>if放后面不能使用else,放前面可以使用else</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mylist = [<span class="number">1</span>, <span class="number">4</span>, -<span class="number">5</span>, <span class="number">10</span>, -<span class="number">7</span>, <span class="number">2</span>, <span class="number">3</span>, -<span class="number">1</span>]</span><br><span class="line">clip_pos = [n <span class="keyword">for</span> n <span class="keyword">in</span> mylist <span class="keyword">if</span> n &lt; <span class="number">0</span> <span class="keyword">else</span> <span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(clip_pos)  <span class="comment"># SyntaxError: invalid syntax</span></span><br></pre></td></tr></table></figure></li>
</ul>
</blockquote>
<blockquote>
<p>itertools.compress() ，它以一个 iterable 对象和一个相对应的 Boolean 选择器序列作为输入参数。然后输出 iterable 对象中对应选择器为 True 的元素。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> compress</span><br><span class="line"></span><br><span class="line">addresses = [</span><br><span class="line"><span class="string">&#x27;5412 N CLARK&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;5148 N CLARK&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;5800 E 58TH&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;2122 N CLARK&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;5645 N RAVENSWOOD&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;1060 W ADDISON&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;4801 N BROADWAY&#x27;</span>,</span><br><span class="line"><span class="string">&#x27;1039 W GRANVILLE&#x27;</span>,</span><br><span class="line">]</span><br><span class="line">counts = [ <span class="number">0</span>, <span class="number">3</span>, <span class="number">10</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">7</span>, <span class="number">6</span>, <span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">more5 = [n &gt; <span class="number">5</span> <span class="keyword">for</span> n <span class="keyword">in</span> counts]</span><br><span class="line"><span class="built_in">print</span>(more5)</span><br><span class="line"><span class="comment"># [False, False, True, False, False, True, True, False]</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">list</span>(compress(addresses, more5)))</span><br><span class="line"><span class="comment"># [&#x27;5800 E 58TH&#x27;, &#x27;1060 W ADDISON&#x27;, &#x27;4801 N BROADWAY&#x27;]</span></span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="1-17-从字典中提取子集"><a href="#1-17-从字典中提取子集" class="headerlink" title="1.17 从字典中提取子集"></a>1.17 从字典中提取子集</h3><p>构造一个字典，它是另外一个字典的子集。</p>
<p>最简单的方式是使用字典推导。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">prices = &#123;</span><br><span class="line"><span class="string">&#x27;ACME&#x27;</span>: <span class="number">45.23</span>,</span><br><span class="line"><span class="string">&#x27;AAPL&#x27;</span>: <span class="number">612.78</span>,</span><br><span class="line"><span class="string">&#x27;IBM&#x27;</span>: <span class="number">205.55</span>,</span><br><span class="line"><span class="string">&#x27;HPQ&#x27;</span>: <span class="number">37.20</span>,</span><br><span class="line"><span class="string">&#x27;FB&#x27;</span>: <span class="number">10.75</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">tech_names = &#123;<span class="string">&#x27;AAPL&#x27;</span>, <span class="string">&#x27;IBM&#x27;</span>, <span class="string">&#x27;HPQ&#x27;</span>, <span class="string">&#x27;MSFT&#x27;</span>&#125;</span><br><span class="line">p2 = &#123;key: value <span class="keyword">for</span> key, value <span class="keyword">in</span> prices.items() <span class="keyword">if</span> key <span class="keyword">in</span> tech_names&#125;</span><br><span class="line"><span class="built_in">print</span>(p2)</span><br></pre></td></tr></table></figure>



<h3 id="1-18-映射名称到序列元素"><a href="#1-18-映射名称到序列元素" class="headerlink" title="1.18 映射名称到序列元素"></a>1.18 映射名称到序列元素</h3><p>collections.namedtuple() 函数通过使用一个普通的元组对象来帮你解决这个问<br>题。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> namedtuple</span><br><span class="line"></span><br><span class="line">Subscriber = namedtuple(<span class="string">&#x27;Subscriber&#x27;</span>, [<span class="string">&#x27;addr&#x27;</span>, <span class="string">&#x27;joined&#x27;</span>])</span><br><span class="line">sub = Subscriber(<span class="string">&#x27;jonesy@example.com&#x27;</span>, <span class="string">&#x27;2012-10-19&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(sub)</span><br><span class="line"><span class="comment"># Subscriber(addr=&#x27;jonesy@example.com&#x27;, joined=&#x27;2012-10-19&#x27;)</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(sub.addr)</span><br><span class="line"><span class="comment"># jonesy@example.com</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(sub.joined)</span><br><span class="line"><span class="comment"># 2012-10-19</span></span><br></pre></td></tr></table></figure>

<p>namedtuple 的实例支持所有的普通元组操作，比如索引和解压。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">addr, joined = sub</span><br><span class="line"><span class="built_in">print</span>(addr)    <span class="comment"># jonesy@example.com</span></span><br><span class="line"><span class="built_in">print</span>(joined)  <span class="comment"># 2012-10-19</span></span><br></pre></td></tr></table></figure>

<p>命名元组另一个用途就是作为<strong>替代字典</strong>，因为字典存储需要更多的内存空间。如果你需要构建一个非常大的包含字典的数据结构，那么使用命名元组会更加高效。</p>
<blockquote>
<p>注意:<br>因为元组是不可修改的,所以不能修改命名元素的属性值</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> namedtuple</span><br><span class="line"></span><br><span class="line">Subscriber = namedtuple(<span class="string">&#x27;Subscriber&#x27;</span>, [<span class="string">&#x27;addr&#x27;</span>, <span class="string">&#x27;joined&#x27;</span>])</span><br><span class="line">sub = Subscriber(<span class="string">&#x27;jonesy@example.com&#x27;</span>, <span class="string">&#x27;2012-10-19&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(sub)</span><br><span class="line"><span class="comment"># Subscriber(addr=&#x27;jonesy@example.com&#x27;, joined=&#x27;2012-10-19&#x27;)</span></span><br><span class="line"></span><br><span class="line">sub.addr = <span class="string">&#x27;xxx&#x27;</span>  <span class="comment"># AttributeError: can&#x27;t set attribute</span></span><br></pre></td></tr></table></figure>

<p>如果真的需要改变属性的值，那么可以使用命名元组实例的 _replace() 方法</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> namedtuple</span><br><span class="line"></span><br><span class="line">Subscriber = namedtuple(<span class="string">&#x27;Subscriber&#x27;</span>, [<span class="string">&#x27;addr&#x27;</span>, <span class="string">&#x27;joined&#x27;</span>])</span><br><span class="line">sub = Subscriber(<span class="string">&#x27;jonesy@example.com&#x27;</span>, <span class="string">&#x27;2012-10-19&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(sub)</span><br><span class="line"><span class="comment"># Subscriber(addr=&#x27;jonesy@example.com&#x27;, joined=&#x27;2012-10-19&#x27;)</span></span><br><span class="line"></span><br><span class="line">sub = sub._replace(addr=<span class="string">&#x27;xxx&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(sub)</span><br><span class="line"><span class="comment"># Subscriber(addr=&#x27;xxx&#x27;, joined=&#x27;2012-10-19&#x27;)</span></span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="1-19-转换并同时计算数据"><a href="#1-19-转换并同时计算数据" class="headerlink" title="1.19 转换并同时计算数据"></a>1.19 转换并同时计算数据</h3><p>你需要在数据序列上执行聚集函数（比如 sum() , min() , max() ），但是首先你需<br>要先转换或者过滤数据</p>
<p>使用生成器表达式参数:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">num = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>]</span><br><span class="line"></span><br><span class="line">res = <span class="built_in">sum</span>(x**<span class="number">2</span> <span class="keyword">for</span> x <span class="keyword">in</span> num)</span><br><span class="line"><span class="built_in">print</span>(res)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">files = os.listdir(<span class="string">&#x27;dirname&#x27;</span>)</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">any</span>(name.endswith(<span class="string">&#x27;.py&#x27;</span>) <span class="keyword">for</span> name <span class="keyword">in</span> files):</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">&#x27;There be python!&#x27;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">&#x27;Sorry, no python.&#x27;</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Output a tuple as CSV</span></span><br><span class="line">s = (<span class="string">&#x27;ACME&#x27;</span>, <span class="number">50</span>, <span class="number">123.45</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;,&#x27;</span>.join(<span class="built_in">str</span>(x) <span class="keyword">for</span> x <span class="keyword">in</span> s))</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Data reduction across fields of a data structure</span></span><br><span class="line">portfolio = [</span><br><span class="line">&#123;<span class="string">&#x27;name&#x27;</span>:<span class="string">&#x27;GOOG&#x27;</span>, <span class="string">&#x27;shares&#x27;</span>: <span class="number">50</span>&#125;,</span><br><span class="line">&#123;<span class="string">&#x27;name&#x27;</span>:<span class="string">&#x27;YHOO&#x27;</span>, <span class="string">&#x27;shares&#x27;</span>: <span class="number">75</span>&#125;,</span><br><span class="line">&#123;<span class="string">&#x27;name&#x27;</span>:<span class="string">&#x27;AOL&#x27;</span>, <span class="string">&#x27;shares&#x27;</span>: <span class="number">20</span>&#125;,</span><br><span class="line">&#123;<span class="string">&#x27;name&#x27;</span>:<span class="string">&#x27;SCOX&#x27;</span>, <span class="string">&#x27;shares&#x27;</span>: <span class="number">65</span>&#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">min_shares = <span class="built_in">min</span>(s[<span class="string">&#x27;shares&#x27;</span>] <span class="keyword">for</span> s <span class="keyword">in</span> portfolio)</span><br></pre></td></tr></table></figure>



<h3 id="1-20-合并多个字典或映射"><a href="#1-20-合并多个字典或映射" class="headerlink" title="1.20 合并多个字典或映射"></a>1.20 合并多个字典或映射</h3><p>现在有多个字典或者映射，你想将它们从逻辑上合并为一个单一的映射后执行某<br>些操作，比如查找值或者检查某些键是否存在。</p>
<p>使用 collections 模块中的 ChainMap 类</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> ChainMap</span><br><span class="line"></span><br><span class="line">a = &#123;<span class="string">&#x27;x&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;z&#x27;</span>: <span class="number">3</span> &#125;</span><br><span class="line">b = &#123;<span class="string">&#x27;y&#x27;</span>: <span class="number">2</span>, <span class="string">&#x27;z&#x27;</span>: <span class="number">4</span> &#125;</span><br><span class="line">c = ChainMap(a,b)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(c[<span class="string">&#x27;x&#x27;</span>]) <span class="comment"># Outputs 1 (from a)</span></span><br><span class="line"><span class="built_in">print</span>(c[<span class="string">&#x27;y&#x27;</span>]) <span class="comment"># Outputs 2 (from b)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 重要 : 如果出现重复键，那么第一次出现的映射值会被返回。</span></span><br><span class="line"><span class="built_in">print</span>(c[<span class="string">&#x27;z&#x27;</span>]) <span class="comment"># Outputs 3 (from a)</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>ChainMap 类只是在内部创建了一个容纳这些字典的列表并重新定义了一些常见的字典操作来遍历这个列表。</p>
<p>所以<code>print(c[&#39;z&#39;]) </code>才会为3</p>
</blockquote>
<blockquote>
<p>ChainMap 引用原来的字典，它自己不创建新的字典。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">a = &#123;<span class="string">&#x27;x&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;z&#x27;</span>: <span class="number">3</span> &#125;</span><br><span class="line">b = &#123;<span class="string">&#x27;y&#x27;</span>: <span class="number">2</span>, <span class="string">&#x27;z&#x27;</span>: <span class="number">4</span> &#125;</span><br><span class="line"></span><br><span class="line">merged = ChainMap(a, b)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(merged[<span class="string">&#x27;x&#x27;</span>])  <span class="comment"># 1</span></span><br><span class="line">a[<span class="string">&#x27;x&#x27;</span>] = <span class="number">42</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(merged[<span class="string">&#x27;x&#x27;</span>]) <span class="comment"># 42</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
</blockquote>
</div></div><div class="post-main post-comment"></div></article><link rel="stylesheet" type="text/css" href="/css/font.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.css"><script src="//cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script><script src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script>$(document).ready(function() {
  $(".fancybox").fancybox();
});
</script></body></html>
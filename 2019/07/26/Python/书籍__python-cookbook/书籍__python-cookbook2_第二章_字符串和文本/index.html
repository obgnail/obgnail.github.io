<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content=" id=&quot;第二章：字符串和文本&quot;&gt;&lt;a href=&quot;#第二章：字符串和文本&quot; class=&quot;headerlink&quot; title=&quot;第二章：字符串和文本&quot;&gt;&lt;/a&gt;第二章：字符串和文本&lt;/h2&gt;&lt;h3 id=&quot;2-1-使用多个界定符分割字符串&quot;&gt;&lt;a href=&quot;#2-1-使用多个界定符分割字符串&quot; class=&quot;headerlink&quot; title=&quot;2.1 使用多个界定符分割字符串&quot;&gt;&lt;/a&gt;2.1 使用多个界定符分割字符串&lt;/h3&gt;&lt;p&gt;将一个字符串分割为多个字段，但是分隔符 (还有周围的空格) 并不是固定的。"><link rel="stylesheet" type="text/css" href="/css/normalize.css"><link rel="stylesheet" type="text/css" href="/css/highlight.css"><link rel="stylesheet" type="text/css" href="/css/noise.css"><title>python-cookbook2_第二章_字符串和文本 | 凉薄的自动书记人偶</title><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><meta name="generator" content="Hexo 5.4.0"></head><body><article class="wrapper"><div class="post-main"><div class="nav"><nav class="container"><a class="sidebar-nav-item active" href="/">Home</a></nav><div class="container post-meta"><div class="post-tags"><a class="post-tag-none-link" href="/tags/Python/" rel="tag">Python</a></div><div class="post-time">2019-07-26</div></div></div><div class="container post-header"><h1>python-cookbook2_第二章_字符串和文本</h1></div><div class="container post-toc"><details class="toc"><summary class="toc-accordion">Table of Contents</summary><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E7%AB%A0%EF%BC%9A%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%92%8C%E6%96%87%E6%9C%AC"><span class="toc-number">1.</span> <span class="toc-text">第二章：字符串和文本</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-%E4%BD%BF%E7%94%A8%E5%A4%9A%E4%B8%AA%E7%95%8C%E5%AE%9A%E7%AC%A6%E5%88%86%E5%89%B2%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="toc-number">1.1.</span> <span class="toc-text">2.1 使用多个界定符分割字符串</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%BC%80%E5%A4%B4%E6%88%96%E7%BB%93%E5%B0%BE%E5%8C%B9%E9%85%8D"><span class="toc-number">1.2.</span> <span class="toc-text">2.2 字符串开头或结尾匹配</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-%E7%94%A8-Shell-%E9%80%9A%E9%85%8D%E7%AC%A6%E5%8C%B9%E9%85%8D%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="toc-number">1.3.</span> <span class="toc-text">2.3 用 Shell 通配符匹配字符串</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%8C%B9%E9%85%8D%E5%92%8C%E6%90%9C%E7%B4%A2"><span class="toc-number">1.4.</span> <span class="toc-text">2.4 字符串匹配和搜索</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-5-%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%90%9C%E7%B4%A2%E5%92%8C%E6%9B%BF%E6%8D%A2"><span class="toc-number">1.5.</span> <span class="toc-text">2.5 字符串搜索和替换</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-6-%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%BF%BD%E7%95%A5%E5%A4%A7%E5%B0%8F%E5%86%99%E7%9A%84%E6%90%9C%E7%B4%A2%E6%9B%BF%E6%8D%A2"><span class="toc-number">1.6.</span> <span class="toc-text">2.6 字符串忽略大小写的搜索替换</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-7-%E6%9C%80%E7%9F%AD%E5%8C%B9%E9%85%8D%E6%A8%A1%E5%BC%8F-%E9%9D%9E%E8%B4%AA%E5%A9%AA%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.7.</span> <span class="toc-text">2.7 最短匹配模式(非贪婪模式)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-8-%E5%A4%9A%E8%A1%8C%E5%8C%B9%E9%85%8D%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.8.</span> <span class="toc-text">2.8 多行匹配模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-9-%E5%B0%86-Unicode-%E6%96%87%E6%9C%AC%E6%A0%87%E5%87%86%E5%8C%96"><span class="toc-number">1.9.</span> <span class="toc-text">2.9 将 Unicode 文本标准化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-10-%E5%9C%A8%E6%AD%A3%E5%88%99%E5%BC%8F%E4%B8%AD%E4%BD%BF%E7%94%A8-Unico"><span class="toc-number">1.10.</span> <span class="toc-text">2.10 在正则式中使用 Unico</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-11-%E5%88%A0%E9%99%A4%E5%AD%97%E7%AC%A6%E4%B8%B2%E4%B8%AD%E4%B8%8D%E9%9C%80%E8%A6%81%E7%9A%84%E5%AD%97%E7%AC%A6"><span class="toc-number">1.11.</span> <span class="toc-text">2.11 删除字符串中不需要的字符</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-12-%E5%AE%A1%E6%9F%A5%E6%B8%85%E7%90%86%E6%96%87%E6%9C%AC%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="toc-number">1.12.</span> <span class="toc-text">2.12 审查清理文本字符串</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-13-%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%AF%B9%E9%BD%90"><span class="toc-number">1.13.</span> <span class="toc-text">2.13 字符串对齐</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-14-%E5%90%88%E5%B9%B6%E6%8B%BC%E6%8E%A5%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="toc-number">1.14.</span> <span class="toc-text">2.14 合并拼接字符串</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-15-%E5%AD%97%E7%AC%A6%E4%B8%B2%E4%B8%AD%E6%8F%92%E5%85%A5%E5%8F%98%E9%87%8F"><span class="toc-number">1.15.</span> <span class="toc-text">2.15 字符串中插入变量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-16-%E4%BB%A5%E6%8C%87%E5%AE%9A%E5%88%97%E5%AE%BD%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="toc-number">1.16.</span> <span class="toc-text">2.16 以指定列宽格式化字符串</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-17-%E5%9C%A8%E5%AD%97%E7%AC%A6%E4%B8%B2%E4%B8%AD%E5%A4%84%E7%90%86-html-%E5%92%8C-xml"><span class="toc-number">1.17.</span> <span class="toc-text">2.17 在字符串中处理 html 和 xml</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-18-%E5%AD%97%E7%AC%A6%E4%B8%B2%E4%BB%A4%E7%89%8C%E8%A7%A3%E6%9E%90"><span class="toc-number">1.18.</span> <span class="toc-text">2.18 字符串令牌解析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-19-%E5%AE%9E%E7%8E%B0%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84%E9%80%92%E5%BD%92%E4%B8%8B%E9%99%8D%E5%88%86%E6%9E%90%E5%99%A8"><span class="toc-number">1.19.</span> <span class="toc-text">2.19 实现一个简单的递归下降分析器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-20-%E5%AD%97%E8%8A%82%E5%AD%97%E7%AC%A6%E4%B8%B2%E4%B8%8A%E7%9A%84%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%93%8D%E4%BD%9C"><span class="toc-number">1.20.</span> <span class="toc-text">2.20 字节字符串上的字符串操作</span></a></li></ol></li></ol></details></div><div class="container post-content"><h2 id="第二章：字符串和文本"><a href="#第二章：字符串和文本" class="headerlink" title="第二章：字符串和文本"></a>第二章：字符串和文本</h2><h3 id="2-1-使用多个界定符分割字符串"><a href="#2-1-使用多个界定符分割字符串" class="headerlink" title="2.1 使用多个界定符分割字符串"></a>2.1 使用多个界定符分割字符串</h3><p>将一个字符串分割为多个字段，但是分隔符 (还有周围的空格) 并不是固定的。</p>
<blockquote>
<p>使用 re.split() 方法 ：允许你为指定多个分隔符</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">line = <span class="string">&#x27;asdf fjdk; afed, fjek,asdf, foo&#x27;</span></span><br><span class="line">x = re.split(<span class="string">r&#x27;[\s;,]\s*&#x27;</span>,line) </span><br><span class="line"><span class="built_in">print</span>(x)</span><br><span class="line"><span class="comment"># [&#x27;asdf&#x27;, &#x27;fjdk&#x27;, &#x27;afed&#x27;, &#x27;fjek&#x27;, &#x27;asdf&#x27;, &#x27;foo&#x27;]</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意:<br>如果加了分组,那么就会连分组一起保留:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">line = <span class="string">&#x27;asdf fjdk; afed, fjek,asdf, foo&#x27;</span></span><br><span class="line"></span><br><span class="line">x = re.split(<span class="string">r&#x27;([\s;,]\s*)&#x27;</span>,line) </span><br><span class="line"><span class="built_in">print</span>(x)</span><br><span class="line"><span class="comment"># [&#x27;asdf&#x27;, &#x27; &#x27;, &#x27;fjdk&#x27;, &#x27;; &#x27;, &#x27;afed&#x27;, &#x27;, &#x27;, &#x27;fjek&#x27;, &#x27;,&#x27;, &#x27;asdf&#x27;, &#x27;, &#x27;, &#x27;foo&#x27;]</span></span><br></pre></td></tr></table></figure>

<p>如果你不想保留分割字符串，但仍然需要使用到括号来分组正则表达式的话，确保你的分组是<strong>非捕获分组</strong>，形如 (?:…) 。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">re.split(<span class="string">r&#x27;(?:,|;|\s)\s*&#x27;</span>, line)</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="2-2-字符串开头或结尾匹配"><a href="#2-2-字符串开头或结尾匹配" class="headerlink" title="2.2 字符串开头或结尾匹配"></a>2.2 字符串开头或结尾匹配</h3><p>str.startswith() 或者是 str.endswith() 方法。</p>
<blockquote>
<p>注意 : 参数可以是一个元组,表示<code>或</code>的关系</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">string = <span class="string">&#x27;trainingfile/training1.py&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(string.endswith(<span class="string">&#x27;.py&#x27;</span>))</span><br><span class="line"></span><br><span class="line">filenames = [ <span class="string">&#x27;Makefile&#x27;</span>, <span class="string">&#x27;foo.c&#x27;</span>, <span class="string">&#x27;bar.py&#x27;</span>, <span class="string">&#x27;spam.c&#x27;</span>, <span class="string">&#x27;spam.h&#x27;</span> ]</span><br><span class="line"><span class="built_in">print</span>([name <span class="keyword">for</span> name <span class="keyword">in</span> filenames <span class="keyword">if</span> name.endswith((<span class="string">&#x27;.c&#x27;</span>, <span class="string">&#x27;.h&#x27;</span>))])</span><br><span class="line"><span class="comment"># [&#x27;foo.c&#x27;, &#x27;spam.c&#x27;, &#x27;spam.h&#x27;]</span></span><br></pre></td></tr></table></figure>



<h3 id="2-3-用-Shell-通配符匹配字符串"><a href="#2-3-用-Shell-通配符匹配字符串" class="headerlink" title="2.3 用 Shell 通配符匹配字符串"></a>2.3 用 Shell 通配符匹配字符串</h3><p>fnmatch 模块提供了两个函数——fnmatch() 和 fnmatchcase() </p>
<p>fnmatch() 函数匹配能力介于简单的字符串方法和强大的正则表达式之间。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> fnmatch <span class="keyword">import</span> fnmatch, fnmatchcase</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(fnmatch(<span class="string">&#x27;foo.txt&#x27;</span>, <span class="string">&#x27;*.txt&#x27;</span>))   <span class="comment"># True</span></span><br><span class="line"><span class="built_in">print</span>(fnmatch(<span class="string">&#x27;foo.txt&#x27;</span>, <span class="string">&#x27;?oo.txt&#x27;</span>))  <span class="comment"># True</span></span><br><span class="line"><span class="built_in">print</span>(fnmatch(<span class="string">&#x27;Dat45.csv&#x27;</span>, <span class="string">&#x27;Dat[0-9]*&#x27;</span>))  <span class="comment"># True</span></span><br></pre></td></tr></table></figure>



<h3 id="2-4-字符串匹配和搜索"><a href="#2-4-字符串匹配和搜索" class="headerlink" title="2.4 字符串匹配和搜索"></a>2.4 字符串匹配和搜索</h3><p>str.find()<br>re.match()<br>re.search()<br>re.findall()<br>re.finditer()</p>
<h3 id="2-5-字符串搜索和替换"><a href="#2-5-字符串搜索和替换" class="headerlink" title="2.5 字符串搜索和替换"></a>2.5 字符串搜索和替换</h3><p>str.replace()</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">text = <span class="string">&#x27;yeah, but no, but yeah, but no, but yeah&#x27;</span></span><br><span class="line"></span><br><span class="line">x = text.replace(<span class="string">&#x27;but&#x27;</span>,<span class="string">&#x27;...&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(x)</span><br><span class="line"><span class="comment"># yeah, ... no, ... yeah, ... no, ... yeah</span></span><br></pre></td></tr></table></figure>

<p>re.sub()</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line">text = <span class="string">&#x27;Today is 11/27/2012. PyCon starts 3/13/2013.&#x27;</span></span><br><span class="line">new = re.sub(<span class="string">r&#x27;(\d&#123;1,2&#125;)/(\d&#123;2&#125;)/(\d&#123;4&#125;)&#x27;</span>,<span class="string">r&#x27;\1-\2-\3&#x27;</span>,text)</span><br><span class="line"><span class="built_in">print</span>(new)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>re.sub甚至可以传入回调函数:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">from</span> calendar <span class="keyword">import</span> month_abbr</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">datepat = re.<span class="built_in">compile</span>(<span class="string">r&#x27;(\d+)/(\d+)/(\d+)&#x27;</span>)</span><br><span class="line">text = <span class="string">&#x27;Today is 11/27/2012. PyCon starts 3/13/2013.&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">change_date</span>(<span class="params">m</span>):</span></span><br><span class="line">	mon_name = month_abbr[<span class="built_in">int</span>(m.group(<span class="number">1</span>))]</span><br><span class="line">	<span class="keyword">return</span> <span class="string">&#x27;&#123;&#125; &#123;&#125; &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(m.group(<span class="number">2</span>), mon_name, m.group(<span class="number">3</span>))</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(datepat.sub(change_date, text))</span><br><span class="line"><span class="comment"># Today is 27 Nov 2012. PyCon starts 13 Mar 2013.</span></span><br></pre></td></tr></table></figure>
</blockquote>
<p>re.subn()知道有发生了多少次替换</p>
<h3 id="2-6-字符串忽略大小写的搜索替换"><a href="#2-6-字符串忽略大小写的搜索替换" class="headerlink" title="2.6 字符串忽略大小写的搜索替换"></a>2.6 字符串忽略大小写的搜索替换</h3><p>re.IGNORECASE 标志参数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">text = <span class="string">&#x27;UPPER PYTHON, lower python, Mixed Python&#x27;</span></span><br><span class="line"></span><br><span class="line">res = re.findall(<span class="string">r&#x27;python&#x27;</span>,text,re.I)</span><br><span class="line"><span class="built_in">print</span>(res)  <span class="comment"># [&#x27;PYTHON&#x27;, &#x27;python&#x27;, &#x27;Python&#x27;]</span></span><br></pre></td></tr></table></figure>



<h3 id="2-7-最短匹配模式-非贪婪模式"><a href="#2-7-最短匹配模式-非贪婪模式" class="headerlink" title="2.7 最短匹配模式(非贪婪模式)"></a>2.7 最短匹配模式(非贪婪模式)</h3><p>模式中的 * 操作符<strong>后面</strong>加上? 修饰符</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">str_pat = re.<span class="built_in">compile</span>(<span class="string">r&#x27;\&quot;(.*)\&quot;&#x27;</span>)</span><br><span class="line">str_pat = re.<span class="built_in">compile</span>(<span class="string">r&#x27;\&quot;(.*?)\&quot;&#x27;</span>)</span><br></pre></td></tr></table></figure>



<h3 id="2-8-多行匹配模式"><a href="#2-8-多行匹配模式" class="headerlink" title="2.8 多行匹配模式"></a>2.8 多行匹配模式</h3><p>标志参数 re.DOTALL</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">text = <span class="string">&#x27;&#x27;&#x27;UPPER 7PYTHON, lower python, Mixed </span></span><br><span class="line"><span class="string">Py7thon&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">res = re.findall(<span class="string">r&#x27;7(.*?)7&#x27;</span>,text,re.S)</span><br><span class="line"><span class="built_in">print</span>(res)</span><br><span class="line"><span class="comment"># [&#x27;PYTHON, lower python, Mixed \n\nPy&#x27;]</span></span><br></pre></td></tr></table></figure>



<h3 id="2-9-将-Unicode-文本标准化"><a href="#2-9-将-Unicode-文本标准化" class="headerlink" title="2.9 将 Unicode 文本标准化"></a>2.9 将 Unicode 文本标准化</h3><p>在 Unicode 中，<strong>某些字符能够用多个合法的编码表示</strong>，需要确保所有字符串在底层有相同的表示。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">s1 = <span class="string">&#x27;Spicy Jalape\u00f1o&#x27;</span></span><br><span class="line">s2 = <span class="string">&#x27;Spicy Jalapen\u0303o&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(s1,s2)     <span class="comment"># Spicy Jalapeño Spicy Jalapeño</span></span><br><span class="line"><span class="built_in">print</span>(s1 == s2)  <span class="comment"># False</span></span><br><span class="line"><span class="built_in">print</span>(s1 <span class="keyword">is</span> s2)  <span class="comment"># False</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(s1),<span class="built_in">len</span>(s2))  <span class="comment"># 14 15</span></span><br></pre></td></tr></table></figure>

<p><strong>使用 unicodedata 模块先将文本标准化</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> unicodedata</span><br><span class="line"></span><br><span class="line">s1 = <span class="string">&#x27;Spicy Jalape\u00f1o&#x27;</span></span><br><span class="line">s2 = <span class="string">&#x27;Spicy Jalapen\u0303o&#x27;</span></span><br><span class="line"></span><br><span class="line">s1 = unicodedata.normalize(<span class="string">&#x27;NFC&#x27;</span>,s1)</span><br><span class="line">s2 = unicodedata.normalize(<span class="string">&#x27;NFC&#x27;</span>,s2)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(s1,s2)     <span class="comment"># Spicy Jalapeño Spicy Jalapeño</span></span><br><span class="line"><span class="built_in">print</span>(s1 == s2)  <span class="comment"># True</span></span><br><span class="line"><span class="built_in">print</span>(s1 <span class="keyword">is</span> s2)  <span class="comment"># False</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(s1),<span class="built_in">len</span>(s2))  <span class="comment"># 14 14</span></span><br></pre></td></tr></table></figure>



<h3 id="2-10-在正则式中使用-Unico"><a href="#2-10-在正则式中使用-Unico" class="headerlink" title="2.10 在正则式中使用 Unico"></a>2.10 在正则式中使用 Unico</h3><p>默认情况下 <strong>re 模块已经对一些 Unicode 字符类有了基本的支持</strong>。比如，\d 已经匹配任意的 unicode 数字字符</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">num = re.<span class="built_in">compile</span>(<span class="string">&#x27;\d+&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(num.match(<span class="string">&#x27;123&#x27;</span>))</span><br><span class="line"><span class="comment"># &lt;re.Match object; span=(0, 3), match=&#x27;123&#x27;&gt;</span></span><br><span class="line"><span class="built_in">print</span>(num.match(<span class="string">&#x27;\u0661\u0662\u0663&#x27;</span>))</span><br><span class="line"><span class="comment"># &lt;re.Match object; span=(0, 3), match=&#x27;١٢٣&#x27;&gt;</span></span><br></pre></td></tr></table></figure>



<h3 id="2-11-删除字符串中不需要的字符"><a href="#2-11-删除字符串中不需要的字符" class="headerlink" title="2.11 删除字符串中不需要的字符"></a>2.11 删除字符串中不需要的字符</h3><p>strip()<br>lstrip()<br>rstrip() </p>
<blockquote>
<p>注意 : strip()删除的是开始或结尾<strong>指定字符</strong>,不单单是空白</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">text = <span class="string">&#x27;12345678589&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(text.strip(<span class="string">&#x27;19&#x27;</span>)) <span class="comment"># 234567858</span></span><br><span class="line"><span class="built_in">print</span>(text.lstrip(<span class="string">&#x27;19&#x27;</span>)) <span class="comment"># 2345678589</span></span><br><span class="line"><span class="built_in">print</span>(text.rstrip(<span class="string">&#x27;19&#x27;</span>)) <span class="comment"># 1234567858</span></span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="2-12-审查清理文本字符串"><a href="#2-12-审查清理文本字符串" class="headerlink" title="2.12 审查清理文本字符串"></a>2.12 审查清理文本字符串</h3><p>你可能想消除整个区间上的字符或者去除变音符。使用<strong>str.translate()</strong></p>
<blockquote>
<p>str.translate():<br>构建一个映射表,让对应的字符串映射成另一个字符串</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">s = <span class="string">&#x27;pýtĥöñ\fis\tawesome\r\n&#x27;</span></span><br><span class="line">remap = &#123;</span><br><span class="line">	<span class="built_in">ord</span>(<span class="string">&#x27;\t&#x27;</span>) : <span class="string">&#x27; &#x27;</span>,</span><br><span class="line">	<span class="built_in">ord</span>(<span class="string">&#x27;\f&#x27;</span>) : <span class="string">&#x27; &#x27;</span>,</span><br><span class="line">	<span class="built_in">ord</span>(<span class="string">&#x27;\r&#x27;</span>) : <span class="literal">None</span> <span class="comment"># Deleted</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">a = s.translate(remap)</span><br><span class="line"><span class="built_in">print</span>(a)  <span class="comment"># pýtĥöñ is awesome</span></span><br></pre></td></tr></table></figure>



<h3 id="2-13-字符串对齐"><a href="#2-13-字符串对齐" class="headerlink" title="2.13 字符串对齐"></a>2.13 字符串对齐</h3><p>ljust()<br>rjust()<br>center()</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">text = <span class="string">&#x27;hyl&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(text.ljust(<span class="number">20</span>,<span class="string">&#x27;-&#x27;</span>))  <span class="comment"># hyl-----------------</span></span><br><span class="line"><span class="built_in">print</span>(text.rjust(<span class="number">20</span>,<span class="string">&#x27;-&#x27;</span>))  <span class="comment"># -----------------hyl</span></span><br><span class="line"><span class="built_in">print</span>(text.center(<span class="number">20</span>,<span class="string">&#x27;-&#x27;</span>)) <span class="comment"># --------hyl---------</span></span><br></pre></td></tr></table></figure>

<p> format() </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">text = <span class="string">&#x27;hyl&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">format</span>(text,<span class="string">&#x27;&gt;20s&#x27;</span>))</span><br><span class="line"><span class="comment">#                 hyl</span></span><br></pre></td></tr></table></figure>



<h3 id="2-14-合并拼接字符串"><a href="#2-14-合并拼接字符串" class="headerlink" title="2.14 合并拼接字符串"></a>2.14 合并拼接字符串</h3><p>join() </p>
<blockquote>
<p>python的接口是鸭子类型,所以join不仅支持可迭代对象,还<strong>支持生成器</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gen</span>():</span></span><br><span class="line">	<span class="keyword">for</span> num <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">9</span>):</span><br><span class="line">		<span class="keyword">yield</span> <span class="built_in">str</span>(num)</span><br><span class="line"></span><br><span class="line">g = gen()</span><br><span class="line"></span><br><span class="line">x = <span class="string">&#x27;&#x27;</span>.join(g)</span><br><span class="line"><span class="built_in">print</span>(x)</span><br><span class="line"><span class="comment"># 012345678</span></span><br></pre></td></tr></table></figure>
</blockquote>
<p>当我们使用加号 (+) 操作符去连接大量的字符串的时候是非常低效率的，因为加号连接</p>
<ol>
<li><strong>引起内存复制</strong></li>
<li><strong>引起垃圾回收操作</strong></li>
</ol>
<blockquote>
<p>下面的代码建议不能写:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">s = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> p <span class="keyword">in</span> parts:</span><br><span class="line">s += p</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>而是应该<strong>先收集所有的字符串片段然后再将它们连接起来</strong> :</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">s = <span class="string">&#x27;&#x27;</span>.join(parts)</span><br></pre></td></tr></table></figure>

<p>还可以使用生成器:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">data = [<span class="string">&#x27;ACME&#x27;</span>, <span class="number">50</span>, <span class="number">91.1</span>]</span><br><span class="line"><span class="string">&#x27;,&#x27;</span>.join(<span class="built_in">str</span>(d) <span class="keyword">for</span> d <span class="keyword">in</span> data)</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="2-15-字符串中插入变量"><a href="#2-15-字符串中插入变量" class="headerlink" title="2.15 字符串中插入变量"></a>2.15 字符串中插入变量</h3><p>format()<br>format_map() : 待被替换的变量在变量域中找</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">name = <span class="string">&#x27;hyl&#x27;</span></span><br><span class="line">age = <span class="number">21</span> </span><br><span class="line"></span><br><span class="line">text = <span class="string">&#x27;my name is &#123;name&#125; , i am &#123;age&#125; year old&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(text.format_map(<span class="built_in">vars</span>()))</span><br><span class="line"><span class="comment"># my name is hyl , i am 21 year old</span></span><br></pre></td></tr></table></figure>

<p>format 和 format_map() 的一个缺陷就是它们并不能处理变量缺失的情况</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">name = <span class="string">&#x27;hyl&#x27;</span></span><br><span class="line">age = <span class="number">21</span> </span><br><span class="line"></span><br><span class="line">text = <span class="string">&#x27;my name is &#123;name&#125; , i am &#123;age&#125; year old&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(text.<span class="built_in">format</span>(name=<span class="string">&#x27;hyl&#x27;</span>))  <span class="comment"># KeyError: &#x27;age&#x27;</span></span><br></pre></td></tr></table></figure>

<p>为此,我们可以定义一个继承dict,实现<code>__messing__</code>的类:</p>
<blockquote>
<p><code>__messing__</code>方法可以让你定义如何处理缺失的值。</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">safesub</span>(<span class="params"><span class="built_in">dict</span></span>):</span></span><br><span class="line">	<span class="string">&quot;&quot;&quot; 防止 key 找不到&quot;&quot;&quot;</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__missing__</span>(<span class="params">self, key</span>):</span></span><br><span class="line">		<span class="keyword">return</span> <span class="string">&#x27;&#123;&#x27;</span> + key + <span class="string">&#x27;&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line">a = safesub()</span><br><span class="line"><span class="built_in">print</span>(a[<span class="string">&#x27;XXX&#x27;</span>])  <span class="comment"># &#123;XXX&#125;</span></span><br><span class="line"></span><br><span class="line">s = <span class="string">&#x27;&#123;name&#125; has &#123;n&#125; messages.&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(s.format_map(safesub(<span class="built_in">vars</span>())))  <span class="comment"># &#123;name&#125; has &#123;n&#125; messages.</span></span><br></pre></td></tr></table></figure>



<p>我们甚至可以将其封装起来:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sub</span>(<span class="params">text</span>):</span></span><br><span class="line">    <span class="keyword">return</span> text.format_map(safesub(sys._getframe(<span class="number">1</span>).f_locals))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">safesub</span>(<span class="params"><span class="built_in">dict</span></span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot; 防止 key 找不到&quot;&quot;&quot;</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__missing__</span>(<span class="params">self, key</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;&#123;&#x27;</span> + key + <span class="string">&#x27;&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">name = <span class="string">&#x27;Guido&#x27;</span></span><br><span class="line">n = <span class="number">37</span></span><br><span class="line"><span class="built_in">print</span>(sub(<span class="string">&#x27;Hello &#123;name&#125;&#x27;</span>))  <span class="comment"># Hello Guido</span></span><br></pre></td></tr></table></figure>

<p>这其实就是<code>f-string</code></p>
<h3 id="2-16-以指定列宽格式化字符串"><a href="#2-16-以指定列宽格式化字符串" class="headerlink" title="2.16 以指定列宽格式化字符串"></a>2.16 以指定列宽格式化字符串</h3><p>有一些长字符串，想以<strong>指定的列宽</strong>将它们重新格式化。</p>
<p>使用 textwrap 模块</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> textwrap</span><br><span class="line"></span><br><span class="line">s = <span class="string">&#x27;&#x27;&#x27;Look into my eyes, look into my eyes, the eyes, the eyes, </span></span><br><span class="line"><span class="string">the eyes, not around the eyes, don&#x27;t look around the eyes, </span></span><br><span class="line"><span class="string">look into my eyes, you&#x27;re under.&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(textwrap.fill(s,<span class="number">70</span>))</span><br><span class="line"><span class="comment"># Look into my eyes, look into my eyes, the eyes, the eyes, the eyes,</span></span><br><span class="line"><span class="comment"># not around the eyes, don&#x27;t look around the eyes, look into my eyes,</span></span><br><span class="line"><span class="comment"># you&#x27;re under.</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(textwrap.fill(s,<span class="number">70</span>,initial_indent=<span class="string">&#x27;  &#x27;</span>))</span><br><span class="line"><span class="comment">#   Look into my eyes, look into my eyes, the eyes, the eyes, the eyes,</span></span><br><span class="line"><span class="comment"># not around the eyes, don&#x27;t look around the eyes, look into my eyes,</span></span><br><span class="line"><span class="comment"># you&#x27;re under.</span></span><br></pre></td></tr></table></figure>



<h3 id="2-17-在字符串中处理-html-和-xml"><a href="#2-17-在字符串中处理-html-和-xml" class="headerlink" title="2.17 在字符串中处理 html 和 xml"></a>2.17 在字符串中处理 html 和 xml</h3><ul>
<li>将 HTML 或者 XML 实体如 &entity; 或 &#code; 替换为对应的文本。</li>
<li>转换文本中特定的字符 (比如 &lt;, &gt;, 或 &amp;)。</li>
</ul>
<p> html.escape()</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> html</span><br><span class="line"></span><br><span class="line">s = <span class="string">&#x27;Elements are written as &quot;&lt;tag&gt;text&lt;/tag&gt;&quot;.&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(html.escape(s))</span><br><span class="line"><span class="comment"># Elements are written as &amp;quot;&amp;lt;tag&amp;gt;text&amp;lt;/tag&amp;gt;&amp;quot;.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 禁止转义引号</span></span><br><span class="line"><span class="built_in">print</span>(html.escape(s, quote=<span class="literal">False</span>))</span><br><span class="line"><span class="comment"># Elements are written as &quot;&amp;lt;tag&amp;gt;text&amp;lt;/tag&amp;gt;&quot;.</span></span><br></pre></td></tr></table></figure>



<h3 id="2-18-字符串令牌解析"><a href="#2-18-字符串令牌解析" class="headerlink" title="2.18 字符串令牌解析"></a>2.18 字符串令牌解析</h3><p>你有一个字符串，想从左至右将其解析为一个令牌流。</p>
<blockquote>
<ul>
<li>令牌化是指在分隔符的基础上<strong>将一个字符串分割为若干个子字符串</strong>。</li>
<li>例如，分隔符；分割字符串<code>ac;bd;def;e</code>为四个子字符串ac，bd，def和e。</li>
</ul>
</blockquote>
<ul>
<li>模式对象有一个 scanner() 方法</li>
<li>这个方法会创建一个 scanner 对象，在这个对象上不断的调用 match() 方法会一步步的扫描目标文本，每步一个匹配。</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">text = <span class="string">&#x27;foo = 23 + 42 * 10&#x27;</span></span><br><span class="line"></span><br><span class="line">tokens = [(<span class="string">&#x27;NAME&#x27;</span>, <span class="string">&#x27;foo&#x27;</span>), (<span class="string">&#x27;EQ&#x27;</span>,<span class="string">&#x27;=&#x27;</span>), (<span class="string">&#x27;NUM&#x27;</span>, <span class="string">&#x27;23&#x27;</span>), (<span class="string">&#x27;PLUS&#x27;</span>,<span class="string">&#x27;+&#x27;</span>),</span><br><span class="line">	(<span class="string">&#x27;NUM&#x27;</span>, <span class="string">&#x27;42&#x27;</span>), (<span class="string">&#x27;TIMES&#x27;</span>, <span class="string">&#x27;*&#x27;</span>), (<span class="string">&#x27;NUM&#x27;</span>, <span class="string">&#x27;10&#x27;</span>)]</span><br><span class="line"></span><br><span class="line">NAME = <span class="string">r&#x27;(?P&lt;NAME&gt;[a-zA-Z_][a-zA-Z_0-9]*)&#x27;</span></span><br><span class="line">NUM = <span class="string">r&#x27;(?P&lt;NUM&gt;\d+)&#x27;</span></span><br><span class="line">PLUS = <span class="string">r&#x27;(?P&lt;PLUS&gt;\+)&#x27;</span></span><br><span class="line">TIMES = <span class="string">r&#x27;(?P&lt;TIMES&gt;\*)&#x27;</span></span><br><span class="line">EQ = <span class="string">r&#x27;(?P&lt;EQ&gt;=)&#x27;</span></span><br><span class="line">WS = <span class="string">r&#x27;(?P&lt;WS&gt;\s+)&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;|&#x27;</span>.join([NAME, NUM, PLUS, TIMES, EQ, WS]))</span><br><span class="line"><span class="comment"># (?P&lt;NAME&gt;[a-zA-Z_][a-zA-Z_0-9]*)|(?P&lt;NUM&gt;\d+)|(?P&lt;PLUS&gt;\+)|(?P&lt;TIMES&gt;\*)|(?P&lt;EQ&gt;=)|(?P&lt;WS&gt;\s+)</span></span><br><span class="line"></span><br><span class="line">master_pat = re.<span class="built_in">compile</span>(<span class="string">&#x27;|&#x27;</span>.join([NAME, NUM, PLUS, TIMES, EQ, WS]))</span><br><span class="line">scanner = master_pat.scanner(<span class="string">&#x27;foo = 42&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(scanner.match())</span><br><span class="line"><span class="comment"># &lt;re.Match object; span=(0, 3), match=&#x27;foo&#x27;&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(scanner.match())</span><br><span class="line"><span class="comment"># &lt;re.Match object; span=(3, 4), match=&#x27; &#x27;&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(scanner.match())</span><br><span class="line"><span class="comment"># &lt;re.Match object; span=(4, 5), match=&#x27;=&#x27;&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(scanner.match())</span><br><span class="line"><span class="comment"># &lt;re.Match object; span=(5, 6), match=&#x27; &#x27;&gt;</span></span><br></pre></td></tr></table></figure>

<p>所以我们可以将其转为生成器:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">generate_tokens</span>(<span class="params">pat, text</span>):</span></span><br><span class="line">	Token = namedtuple(<span class="string">&#x27;Token&#x27;</span>, [<span class="string">&#x27;type&#x27;</span>, <span class="string">&#x27;value&#x27;</span>])</span><br><span class="line">	scanner = pat.scanner(text)</span><br><span class="line">	<span class="keyword">for</span> m <span class="keyword">in</span> <span class="built_in">iter</span>(scanner.match, <span class="literal">None</span>):</span><br><span class="line">		<span class="keyword">yield</span> Token(m.lastgroup, m.group())</span><br></pre></td></tr></table></figure>



<h3 id="2-19-实现一个简单的递归下降分析器"><a href="#2-19-实现一个简单的递归下降分析器" class="headerlink" title="2.19 实现一个简单的递归下降分析器"></a>2.19 实现一个简单的递归下降分析器</h3><p>你想根据一组语法规则解析文本并执行命令，或者构造一个代表输入的抽象语法树。</p>
<p>(看不懂,略)</p>
<h3 id="2-20-字节字符串上的字符串操作"><a href="#2-20-字节字符串上的字符串操作" class="headerlink" title="2.20 字节字符串上的字符串操作"></a>2.20 字节字符串上的字符串操作</h3><p>在字节字符串上执行普通的文本操作 (比如移除，搜索和替换)。<br><strong>字节字符串同样也支持大部分和文本字符串一样的内置操作</strong></p>
<ul>
<li><p>字节字符串的索引操作返回整数而不是单独字符。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">a = <span class="string">&#x27;Hello World&#x27;</span></span><br><span class="line">a[<span class="number">0</span>]  <span class="comment"># H</span></span><br><span class="line"></span><br><span class="line">b = <span class="string">b&#x27;Hello World&#x27;</span></span><br><span class="line">b[<span class="number">0</span>]  <span class="comment"># 72</span></span><br></pre></td></tr></table></figure></li>
<li><p>字节字符串不会提供一个美观的字符串表示，也不能很好的打印出来，除<br>非它们先被解码为一个文本字符串。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">s = <span class="string">b&#x27;Hello World&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(s)  <span class="comment"># b&#x27;Hello World&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(s.decode(<span class="string">&#x27;ascii&#x27;</span>))  <span class="comment"># Hello World</span></span><br></pre></td></tr></table></figure></li>
<li><p>不存在任何适用于字节字符串的格式化操作</p>
</li>
</ul>
</div></div><div class="post-main post-comment"></div></article><link rel="stylesheet" type="text/css" href="/css/font.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.css"><script src="//cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script><script src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script>$(document).ready(function() {
  $(".fancybox").fancybox();
});
</script></body></html>
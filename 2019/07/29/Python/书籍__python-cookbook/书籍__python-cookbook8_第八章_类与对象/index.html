<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content=" id=&quot;第八章：类与对象&quot;&gt;&lt;a href=&quot;#第八章：类与对象&quot; class=&quot;headerlink&quot; title=&quot;第八章：类与对象&quot;&gt;&lt;/a&gt;第八章：类与对象&lt;/h2&gt;&lt;h3 id=&quot;8-1-改变对象的字符串显示&quot;&gt;&lt;a href=&quot;#8-1-改变对象的字符串显示&quot; class=&quot;headerlink&quot; title=&quot;8.1 改变对象的字符串显示&quot;&gt;&lt;/a&gt;8.1 改变对象的字符串显示&lt;/h3&gt;&lt;p&gt;&lt;code&gt;__str__() &lt;/code&gt;和 &lt;code&gt;__repr__()&lt;/code&gt; 方法。"><link rel="stylesheet" type="text/css" href="/css/normalize.css"><link rel="stylesheet" type="text/css" href="/css/highlight.css"><link rel="stylesheet" type="text/css" href="/css/noise.css"><title>python-cookbook8_第八章_类与对象 | 凉薄的自动书记人偶</title><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><meta name="generator" content="Hexo 5.4.0"></head><body><article class="wrapper"><div class="post-main"><div class="nav"><nav class="container"><a class="sidebar-nav-item active" href="/">Home</a><a class="sidebar-nav-item" href="/archives">Tags</a><a class="sidebar-nav-item" href="/About">About</a></nav><div class="container post-meta"><div class="post-tags"><a class="post-tag-link" href="/tags/Python/" rel="tag">Python</a></div><div class="post-time">2019-07-29</div></div></div><div class="container post-header"><h1>python-cookbook8_第八章_类与对象</h1></div><div class="container post-toc"><details class="toc"><summary class="toc-accordion">Table of Contents</summary><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E5%85%AB%E7%AB%A0%EF%BC%9A%E7%B1%BB%E4%B8%8E%E5%AF%B9%E8%B1%A1"><span class="toc-number">1.</span> <span class="toc-text">第八章：类与对象</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#8-1-%E6%94%B9%E5%8F%98%E5%AF%B9%E8%B1%A1%E7%9A%84%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%98%BE%E7%A4%BA"><span class="toc-number">1.1.</span> <span class="toc-text">8.1 改变对象的字符串显示</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-2-%E8%87%AA%E5%AE%9A%E4%B9%89%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9A%84%E6%A0%BC%E5%BC%8F%E5%8C%96"><span class="toc-number">1.2.</span> <span class="toc-text">8.2 自定义字符串的格式化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-3-%E8%AE%A9%E5%AF%B9%E8%B1%A1%E6%94%AF%E6%8C%81%E4%B8%8A%E4%B8%8B%E6%96%87%E7%AE%A1%E7%90%86%E5%8D%8F%E8%AE%AE"><span class="toc-number">1.3.</span> <span class="toc-text">8.3 让对象支持上下文管理协议</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-4-%E5%88%9B%E5%BB%BA%E5%A4%A7%E9%87%8F%E5%AF%B9%E8%B1%A1%E6%97%B6%E8%8A%82%E7%9C%81%E5%86%85%E5%AD%98%E6%96%B9%E6%B3%95"><span class="toc-number">1.4.</span> <span class="toc-text">8.4 创建大量对象时节省内存方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-5-%E5%9C%A8%E7%B1%BB%E4%B8%AD%E5%B0%81%E8%A3%85%E5%B1%9E%E6%80%A7%E5%90%8D"><span class="toc-number">1.5.</span> <span class="toc-text">8.5 在类中封装属性名</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-6-%E5%88%9B%E5%BB%BA%E5%8F%AF%E7%AE%A1%E7%90%86%E7%9A%84%E5%B1%9E%E6%80%A7"><span class="toc-number">1.6.</span> <span class="toc-text">8.6 创建可管理的属性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-7-%E8%B0%83%E7%94%A8%E7%88%B6%E7%B1%BB%E6%96%B9%E6%B3%95"><span class="toc-number">1.7.</span> <span class="toc-text">8.7 调用父类方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-8-%E5%AD%90%E7%B1%BB%E4%B8%AD%E6%89%A9%E5%B1%95-property"><span class="toc-number">1.8.</span> <span class="toc-text">8.8 子类中扩展 property</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-9-%E5%88%9B%E5%BB%BA%E6%96%B0%E7%9A%84%E7%B1%BB%E6%88%96%E5%AE%9E%E4%BE%8B%E5%B1%9E%E6%80%A7"><span class="toc-number">1.9.</span> <span class="toc-text">8.9 创建新的类或实例属性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-10-%E4%BD%BF%E7%94%A8%E5%BB%B6%E8%BF%9F%E8%AE%A1%E7%AE%97%E5%B1%9E%E6%80%A7-%E9%87%8D%E8%A6%81"><span class="toc-number">1.10.</span> <span class="toc-text">8.10 使用延迟计算属性(重要)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-11-%E7%AE%80%E5%8C%96%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E7%9A%84%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="toc-number">1.11.</span> <span class="toc-text">8.11 简化数据结构的初始化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-12-%E5%AE%9A%E4%B9%89%E6%8E%A5%E5%8F%A3%E6%88%96%E8%80%85%E6%8A%BD%E8%B1%A1%E5%9F%BA%E7%B1%BB"><span class="toc-number">1.12.</span> <span class="toc-text">8.12 定义接口或者抽象基类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-13-%E5%AE%9E%E7%8E%B0%E6%95%B0%E6%8D%AE%E6%A8%A1%E5%9E%8B%E7%9A%84%E7%B1%BB%E5%9E%8B%E7%BA%A6%E6%9D%9F"><span class="toc-number">1.13.</span> <span class="toc-text">8.13 实现数据模型的类型约束</span></a></li></ol></li></ol></details></div><div class="container post-content"><h2 id="第八章：类与对象"><a href="#第八章：类与对象" class="headerlink" title="第八章：类与对象"></a>第八章：类与对象</h2><h3 id="8-1-改变对象的字符串显示"><a href="#8-1-改变对象的字符串显示" class="headerlink" title="8.1 改变对象的字符串显示"></a>8.1 改变对象的字符串显示</h3><p><code>__str__() </code>和 <code>__repr__()</code> 方法。</p>
<blockquote>
<ul>
<li><code>__repr__()</code> 方法返回一个实例的<strong>代码表示形式</strong>，通常用来重新构造这个实例。内置的 repr() 函数返回这个字符串，跟我们使用交互式解释器显示的值是一样的。</li>
<li><code>__str__() </code>方法将实例转换为一个字符串，使用 str() 或 print() 函数会输出这个字<br>符串。</li>
</ul>
</blockquote>
<h3 id="8-2-自定义字符串的格式化"><a href="#8-2-自定义字符串的格式化" class="headerlink" title="8.2 自定义字符串的格式化"></a>8.2 自定义字符串的格式化</h3><p>定义 <code>__format__() </code>方法</p>
<h3 id="8-3-让对象支持上下文管理协议"><a href="#8-3-让对象支持上下文管理协议" class="headerlink" title="8.3 让对象支持上下文管理协议"></a>8.3 让对象支持上下文管理协议</h3><p>实现 <code>__enter__()</code> 和<code>__exit__()</code>方法。</p>
<h3 id="8-4-创建大量对象时节省内存方法"><a href="#8-4-创建大量对象时节省内存方法" class="headerlink" title="8.4 创建大量对象时节省内存方法"></a>8.4 创建大量对象时节省内存方法</h3><p>给类添加 <code>__slots__</code><strong>属性</strong>来极大的减少实例所占的内存。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Date</span>:</span></span><br><span class="line">	__slots__ = [<span class="string">&#x27;year&#x27;</span>, <span class="string">&#x27;month&#x27;</span>, <span class="string">&#x27;day&#x27;</span>]</span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, year, month, day</span>):</span></span><br><span class="line">		self.year = year</span><br><span class="line">		self.month = month</span><br><span class="line">		self.day = day</span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li>当你定义 <code>__slots__ </code>后，Python 就会为实例使用一种<strong>更加紧凑的内部</strong>表示。</li>
<li>实例通过一个很小的固定大小的数组来构建，而不是为每个实例定义一个字典，这跟元组或列表很类似。</li>
<li>在<code> __slots__</code> 中列出的属性名在内部被映射到这个数组的指定小标上。</li>
<li>使用 slots 一个不好的地方就是我们不能再给实例添加新的属性了，只能使用在<code>__slots__</code> 中定义的那些属性名。</li>
</ul>
</blockquote>
<blockquote>
<ul>
<li>关于 <code>__slots__</code> 的一个常见误区是它可以作为一个封装工具来防止用户给实例增<br>加新的属性。</li>
<li>尽管使用 slots 可以达到这样的目的，但是这个并不是它的初衷。<code>__slots__</code>更多的是用来作为一个内存优化工具。</li>
</ul>
</blockquote>
<h3 id="8-5-在类中封装属性名"><a href="#8-5-在类中封装属性名" class="headerlink" title="8.5 在类中封装属性名"></a>8.5 在类中封装属性名</h3><p>约定是任何以单下划线 _ 开头的名字都应该是内部实现。</p>
<blockquote>
<p>类定义中使用两个下划线 (__) 开头的命名 :</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span>:</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">		self.__private = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__private_method</span>(<span class="params">self</span>):</span></span><br><span class="line">		<span class="keyword">pass</span></span><br><span class="line">		</span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">public_method</span>(<span class="params">self</span>):</span></span><br><span class="line">		<span class="keyword">pass</span></span><br><span class="line">		self.__private_method()</span><br></pre></td></tr></table></figure>

<ul>
<li>使用双下划线开始会导致<strong>访问名称变成其他形式</strong>。</li>
<li>比如，在前面的类 B 中，私有属性<code>__private </code>,<code>__private_method</code>会被分别重命名为 <code>_B__private </code>和 <code>_B__private_method</code> 。</li>
<li>这时候你可能会问这样重命名的目的是什么，答案就是继承——这种属性通过继承是无法被覆盖的。</li>
</ul>
</blockquote>
<blockquote>
<ul>
<li>两种不同的编码约定 (单下划线和双下划线) 来命名私有属性</li>
<li>到底哪种方式好呢？大多数而言，你应该让你的非公共名称<strong>以单下划线开头</strong>。</li>
<li>如果你清楚你的代码会涉及到子类，并且==有些内部属性应该在子类中隐藏起<br>来==，那么才考虑使用双下划线方案。</li>
</ul>
</blockquote>
<h3 id="8-6-创建可管理的属性"><a href="#8-6-创建可管理的属性" class="headerlink" title="8.6 创建可管理的属性"></a>8.6 创建可管理的属性</h3><p>给某个实例 attribute 增加除访问与修改之外的其他处理逻辑，比如类型检查或合法性验证。</p>
<p>自定义某个属性的一种简单方法是将它定义为一个 <strong>property</strong>。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>:</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, first_name</span>):</span></span><br><span class="line">		self.first_name = first_name</span><br><span class="line"></span><br><span class="line"><span class="meta">	@property</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">first_name</span>(<span class="params">self</span>):</span></span><br><span class="line">		<span class="keyword">return</span> self._first_name</span><br><span class="line"></span><br><span class="line"><span class="meta">	@first_name.setter</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">first_name</span>(<span class="params">self, value</span>):</span></span><br><span class="line">		<span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">isinstance</span>(value, <span class="built_in">str</span>):</span><br><span class="line">			<span class="keyword">raise</span> TypeError(<span class="string">&#x27;Expected a string&#x27;</span>)</span><br><span class="line">		self._first_name = value</span><br><span class="line"></span><br><span class="line"><span class="meta">	@first_name.deleter</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">first_name</span>(<span class="params">self</span>):</span></span><br><span class="line">		<span class="keyword">raise</span> AttributeError(<span class="string">&quot;Can&#x27;t delete attribute&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>如果只是定义getter,并不定义setter和delete的话,可以将方法改为属性访问:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> math</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Circle</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, radius</span>):</span></span><br><span class="line">        self.radius = radius</span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">area</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> math.pi * self.radius ** <span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">diameter</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.radius * <span class="number">2</span></span><br><span class="line">        </span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">perimeter</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">2</span> * math.pi * self.radius</span><br></pre></td></tr></table></figure>



<h3 id="8-7-调用父类方法"><a href="#8-7-调用父类方法" class="headerlink" title="8.7 调用父类方法"></a>8.7 调用父类方法</h3><p>在子类中调用父类的某个已经被覆盖的方法。</p>
<p>使用 super() 函数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>:</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">spam</span>(<span class="params">self</span>):</span></span><br><span class="line">		<span class="built_in">print</span>(<span class="string">&#x27;A.spam&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span>(<span class="params">A</span>):</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">spam</span>(<span class="params">self</span>):</span></span><br><span class="line">		<span class="built_in">print</span>(<span class="string">&#x27;B.spam&#x27;</span>)</span><br><span class="line">		<span class="built_in">super</span>().spam() <span class="comment"># Call parent spam()</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Python 是如何实现继承的</p>
<ul>
<li><p>对于定义的每一个类，Python 会计算出一个所谓的方法解析顺序 (MRO) 列表。这个 MRO列表就是一个简单的所有基类的线性顺序表。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(C.__mro__)</span><br><span class="line">(&lt;<span class="class"><span class="keyword">class</span> &#x27;<span class="title">__main__</span>.<span class="title">C</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">__main__</span>.<span class="title">A</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">__main__</span>.<span class="title">B</span>&#x27;&gt;,</span></span><br><span class="line"><span class="class">&lt;<span class="title">class</span> &#x27;<span class="title">__main__</span>.<span class="title">Base</span>&#x27;&gt;, &lt;<span class="title">class</span> &#x27;<span class="title">object</span>&#x27;&gt;)</span></span><br></pre></td></tr></table></figure></li>
<li><p>为了实现继承，<strong>Python 会在 MRO 列表上从左到右开始查找基类，直到找到第一个匹配这个属性的类为止</strong>。</p>
</li>
</ul>
</blockquote>
<h3 id="8-8-子类中扩展-property"><a href="#8-8-子类中扩展-property" class="headerlink" title="8.8 子类中扩展 property"></a>8.8 子类中扩展 property</h3><p>在子类中，你想要扩展定义在父类中的 property 的功能</p>
<blockquote>
<ul>
<li><p>在子类中扩展一个 property 可能会引起很多不易察觉的问题，因为一个 property<br>其实是 getter、setter 和 deleter 方法的集合，而不是单个方法。</p>
</li>
<li><p>因此，当你扩展一个 property 的时候，你需要先确定你是否要重新定义所有的方法还是说只修改其中某一个。</p>
</li>
<li><p>全部三个方法的重新定义:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>:</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name</span>):</span></span><br><span class="line">		self.name = name</span><br><span class="line"></span><br><span class="line"><span class="meta">	@property</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">name</span>(<span class="params">self</span>):</span></span><br><span class="line">		<span class="keyword">return</span> self._name</span><br><span class="line"></span><br><span class="line"><span class="meta">	@name.setter</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">name</span>(<span class="params">self, value</span>):</span></span><br><span class="line">		<span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">isinstance</span>(value, <span class="built_in">str</span>):</span><br><span class="line">			<span class="keyword">raise</span> TypeError(<span class="string">&#x27;Expected a string&#x27;</span>)</span><br><span class="line">			self._name = value</span><br><span class="line"></span><br><span class="line"><span class="meta">	@name.deleter</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">name</span>(<span class="params">self</span>):</span></span><br><span class="line">		<span class="keyword">raise</span> AttributeError(<span class="string">&quot;Can&#x27;t delete attribute&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SubPerson</span>(<span class="params">Person</span>):</span></span><br><span class="line"><span class="meta">	@property</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">name</span>(<span class="params">self</span>):</span></span><br><span class="line">		<span class="built_in">print</span>(<span class="string">&#x27;Getting name&#x27;</span>)</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">super</span>().name</span><br><span class="line"></span><br><span class="line"><span class="meta">	@name.setter</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">name</span>(<span class="params">self, value</span>):</span></span><br><span class="line">		<span class="built_in">print</span>(<span class="string">&#x27;Setting name to&#x27;</span>, value)</span><br><span class="line">		<span class="built_in">super</span>(SubPerson, SubPerson).name.__set__(self, value)</span><br><span class="line"></span><br><span class="line"><span class="meta">	@name.deleter</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">name</span>(<span class="params">self</span>):</span></span><br><span class="line">		<span class="built_in">print</span>(<span class="string">&#x27;Deleting name&#x27;</span>)</span><br><span class="line">		<span class="built_in">super</span>(SubPerson, SubPerson).name.__delete__(self)</span><br></pre></td></tr></table></figure></li>
<li><p>单个方法的重新定义:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SubPerson</span>(<span class="params">Person</span>):</span></span><br><span class="line"><span class="meta">	@Person.name.getter</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">name</span>(<span class="params">self</span>):</span></span><br><span class="line">		<span class="built_in">print</span>(<span class="string">&#x27;Getting name&#x27;</span>)</span><br><span class="line">		<span class="keyword">return</span> <span class="built_in">super</span>().name</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SubPerson</span>(<span class="params">Person</span>):</span></span><br><span class="line"><span class="meta">	@Person.name.setter</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">name</span>(<span class="params">self, value</span>):</span></span><br><span class="line">		<span class="built_in">print</span>(<span class="string">&#x27;Setting name to&#x27;</span>, value)</span><br><span class="line">		<span class="built_in">super</span>(SubPerson, SubPerson).name.__set__(self, value)</span><br></pre></td></tr></table></figure></li>
</ul>
</blockquote>
<blockquote>
<p>简单来说:</p>
<ul>
<li><p>三个方法的重新定义:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@property</span></span><br></pre></td></tr></table></figure></li>
<li><p>只重新定义一个方法:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Person.name.getter</span></span><br></pre></td></tr></table></figure></li>
<li><p>也就是说 :<br><strong>获取方法的唯一途径是使用类变量</strong>而不是实例变量来访问它。<br>这也是为什么我们要使用super(SubPerson, SubPerson) 的原因。</p>
</li>
</ul>
</blockquote>
<h3 id="8-9-创建新的类或实例属性"><a href="#8-9-创建新的类或实例属性" class="headerlink" title="8.9 创建新的类或实例属性"></a>8.9 创建新的类或实例属性</h3><p>创建一个新的拥有一些额外功能的实例属性类型，比如类型检查。</p>
<p>通过描述器类</p>
<blockquote>
<ul>
<li>描述器就是一个实现了三个核心的属性访问操作 (get, set, delete) 的类，分别为 <code>__get__()</code> 、<code>__set__()</code> 和 <code>__delete__()</code> 这三个特殊的方法。</li>
<li>这些方法接受一个实例作为输入，之后相应的操作实例底层的字典。</li>
<li>为了使用描述器，需将这个<strong>描述器的实例作为类属性</strong>放到一个类的定义中。</li>
</ul>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Integer</span>:</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name</span>):</span></span><br><span class="line">		self.name = name</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__get__</span>(<span class="params">self, instance, cls</span>):</span></span><br><span class="line">		<span class="keyword">if</span> instance <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">			<span class="keyword">return</span> self</span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			<span class="keyword">return</span> instance.__dict__[self.name]</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__set__</span>(<span class="params">self, instance, value</span>):</span></span><br><span class="line">		<span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">isinstance</span>(value, <span class="built_in">int</span>):</span><br><span class="line">			<span class="keyword">raise</span> TypeError(<span class="string">&#x27;Expected an int&#x27;</span>)</span><br><span class="line">		instance.__dict__[self.name] = value</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__delete__</span>(<span class="params">self, instance</span>):</span></span><br><span class="line">		<span class="keyword">del</span> instance.__dict__[self.name]</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Point</span>:</span></span><br><span class="line">	x = Integer(<span class="string">&#x27;x&#x27;</span>)</span><br><span class="line">	y = Integer(<span class="string">&#x27;y&#x27;</span>)</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, x, y</span>):</span></span><br><span class="line">		self.x = x</span><br><span class="line">		self.y = y</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意:<br>==描述器只能在类级别被定义，而不能为每个实例单独定义==。</p>
</blockquote>
<h3 id="8-10-使用延迟计算属性-重要"><a href="#8-10-使用延迟计算属性-重要" class="headerlink" title="8.10 使用延迟计算属性(重要)"></a>8.10 使用延迟计算属性(重要)</h3><p>你想将一个只读属性定义成一个 property，并且只在访问的时候才会计算结果。但是一旦被访问后，你希望结果值被缓存起来，不用每次都去计算。</p>
<p>定义一个延迟属性的一种高效方法是通过使用一个描述器类</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">lazyproperty</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, func</span>):</span></span><br><span class="line">        self.func = func</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 使用 __get__() 方法在实例中存储计算出来的值</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__get__</span>(<span class="params">self, instance, cls</span>):</span></span><br><span class="line">        <span class="keyword">if</span> instance <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">return</span> self</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            value = self.func(instance)</span><br><span class="line">            <span class="comment"># 将值存储成实例的属性</span></span><br><span class="line">            <span class="built_in">setattr</span>(instance, self.func.__name__, value)</span><br><span class="line">            <span class="keyword">return</span> value</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Circle</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, radius</span>):</span></span><br><span class="line">        self.radius = radius</span><br><span class="line"></span><br><span class="line"><span class="meta">    @lazyproperty</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">area</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> math.pi * self.radius ** <span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @lazyproperty</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">perimeter</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">2</span> * math.pi * self.radius</span><br><span class="line"></span><br><span class="line">c = Circle(<span class="number">4.0</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(c.radius)  </span><br><span class="line"><span class="comment"># 4.0</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">vars</span>(c))</span><br><span class="line"><span class="comment"># &#123;&#x27;radius&#x27;: 4.0&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(c.area)</span><br><span class="line"><span class="comment"># 50.26548245743669</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">vars</span>(c))</span><br><span class="line"><span class="comment"># &#123;&#x27;radius&#x27;: 4.0, &#x27;area&#x27;: 50.26548245743669&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(c.perimeter)</span><br><span class="line"><span class="comment"># 25.132741228718345</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">vars</span>(c))</span><br><span class="line"><span class="comment"># &#123;&#x27;radius&#x27;: 4.0, &#x27;area&#x27;: 50.26548245743669, &#x27;perimeter&#x27;: 25.132741228718345&#125;</span></span><br></pre></td></tr></table></figure>

<p>这种方案有一个小缺陷就是计算出的值被创建后是可以被修改的。<br>我们可以稍微修改属性名:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">lazyproperty</span>(<span class="params">func</span>):</span></span><br><span class="line">	name = <span class="string">&#x27;_lazy_&#x27;</span> + func.__name__</span><br><span class="line"></span><br><span class="line"><span class="meta">	@property</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">lazy</span>(<span class="params">self</span>):</span></span><br><span class="line">		<span class="keyword">if</span> <span class="built_in">hasattr</span>(self, name):</span><br><span class="line">			<span class="keyword">return</span> <span class="built_in">getattr</span>(self, name)</span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			value = func(self)</span><br><span class="line">			<span class="built_in">setattr</span>(self, name, value)</span><br><span class="line">			<span class="keyword">return</span> value</span><br><span class="line">			</span><br><span class="line">	<span class="keyword">return</span> lazy</span><br></pre></td></tr></table></figure>



<h3 id="8-11-简化数据结构的初始化"><a href="#8-11-简化数据结构的初始化" class="headerlink" title="8.11 简化数据结构的初始化"></a>8.11 简化数据结构的初始化</h3><p>一个基类中写一个公用的<code>__init__()</code>函数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> math</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Structure1</span>:</span></span><br><span class="line">	<span class="comment"># 指定预期字段的类变量</span></span><br><span class="line">	_fields = []</span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, *args</span>):</span></span><br><span class="line">		<span class="keyword">if</span> <span class="built_in">len</span>(args) != <span class="built_in">len</span>(self._fields):</span><br><span class="line">			<span class="keyword">raise</span> TypeError(<span class="string">&#x27;Expected &#123;&#125; arguments&#x27;</span>.<span class="built_in">format</span>(<span class="built_in">len</span>(self._fields)))</span><br><span class="line"></span><br><span class="line">		<span class="comment"># 设置变量</span></span><br><span class="line">		<span class="keyword">for</span> name, value <span class="keyword">in</span> <span class="built_in">zip</span>(self._fields, args):</span><br><span class="line">			<span class="built_in">setattr</span>(self, name, value)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Stock</span>(<span class="params">Structure1</span>):</span></span><br><span class="line">	_fields = [<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;shares&#x27;</span>, <span class="string">&#x27;price&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Point</span>(<span class="params">Structure1</span>):</span></span><br><span class="line">	_fields = [<span class="string">&#x27;x&#x27;</span>, <span class="string">&#x27;y&#x27;</span>]</span><br><span class="line">	</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Circle</span>(<span class="params">Structure1</span>):</span></span><br><span class="line">	_fields = [<span class="string">&#x27;radius&#x27;</span>]</span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">area</span>(<span class="params">self</span>):</span></span><br><span class="line">		<span class="keyword">return</span> math.pi * self.radius ** <span class="number">2</span></span><br></pre></td></tr></table></figure>

<p>如果还想支持关键字参数，可以将关键字参数设置为实例属性：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Structure2</span>:</span></span><br><span class="line">	_fields = []</span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, *args, **kwargs</span>):</span></span><br><span class="line">		<span class="keyword">if</span> <span class="built_in">len</span>(args) &gt; <span class="built_in">len</span>(self._fields):</span><br><span class="line">			<span class="keyword">raise</span> TypeError(<span class="string">&#x27;Expected &#123;&#125; arguments&#x27;</span>.<span class="built_in">format</span>(<span class="built_in">len</span>(self._fields)))</span><br><span class="line"></span><br><span class="line">		<span class="comment"># 设置所有位置参数</span></span><br><span class="line">		<span class="keyword">for</span> name, value <span class="keyword">in</span> <span class="built_in">zip</span>(self._fields, args):</span><br><span class="line">			<span class="built_in">setattr</span>(self, name, value)</span><br><span class="line"></span><br><span class="line">		<span class="comment"># 设置其余关键字参数(因为关键字参数在位置参数后面,所以使用切片)</span></span><br><span class="line">		<span class="keyword">for</span> name <span class="keyword">in</span> self._fields[<span class="built_in">len</span>(args):]:</span><br><span class="line">			<span class="built_in">setattr</span>(self, name, kwargs.pop(name))</span><br><span class="line"></span><br><span class="line">		<span class="comment"># 检查是否有任何剩余的未知参数</span></span><br><span class="line">		<span class="keyword">if</span> kwargs:</span><br><span class="line">			<span class="keyword">raise</span> TypeError(<span class="string">&#x27;Invalid argument(s): &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(<span class="string">&#x27;,&#x27;</span>.join(kwargs)))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">Stock</span>(<span class="params">Structure2</span>):</span></span><br><span class="line">		_fields = [<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;shares&#x27;</span>, <span class="string">&#x27;price&#x27;</span>]</span><br><span class="line"></span><br><span class="line">	s1 = Stock(<span class="string">&#x27;ACME&#x27;</span>, <span class="number">50</span>, <span class="number">91.1</span>)</span><br><span class="line">	s2 = Stock(<span class="string">&#x27;ACME&#x27;</span>, <span class="number">50</span>, price=<span class="number">91.1</span>)</span><br><span class="line">	s3 = Stock(<span class="string">&#x27;ACME&#x27;</span>, shares=<span class="number">50</span>, price=<span class="number">91.1</span>)</span><br></pre></td></tr></table></figure>

<p>甚至你还能传入额外的属性:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">extra_args = kwargs.keys() - self._fields</span><br><span class="line"><span class="keyword">for</span> name <span class="keyword">in</span> extra_args:</span><br><span class="line">	<span class="built_in">setattr</span>(self, name, kwargs.pop(name))</span><br></pre></td></tr></table></figure>



<h3 id="8-12-定义接口或者抽象基类"><a href="#8-12-定义接口或者抽象基类" class="headerlink" title="8.12 定义接口或者抽象基类"></a>8.12 定义接口或者抽象基类</h3><p>使用 abc 模块可以很轻松的定义抽象基类：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> abc <span class="keyword">import</span> ABCMeta, abstractmethod</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">IStream</span>(<span class="params">metaclass=ABCMeta</span>):</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">read</span>(<span class="params">self, maxbytes=-<span class="number">1</span></span>):</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">        </span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">write</span>(<span class="params">self, data</span>):</span></span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>抽象类的目的就是让别的类继承它并实现特定的抽象方法</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SocketStream</span>(<span class="params">IStream</span>):</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">read</span>(<span class="params">self, maxbytes=-<span class="number">1</span></span>):</span></span><br><span class="line">		<span class="keyword">pass</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">write</span>(<span class="params">self, data</span>):</span></span><br><span class="line">		<span class="keyword">pass</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<p>抽象基类的一个主要用途是<strong>在代码中检查某些类是否为特定类型</strong>，实现了特定接口</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">serialize</span>(<span class="params">obj, stream</span>):</span></span><br><span class="line">	<span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">isinstance</span>(stream, IStream):</span><br><span class="line">		<span class="keyword">raise</span> TypeError(<span class="string">&#x27;Expected an IStream&#x27;</span>)</span><br><span class="line">		<span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="8-13-实现数据模型的类型约束"><a href="#8-13-实现数据模型的类型约束" class="headerlink" title="8.13 实现数据模型的类型约束"></a>8.13 实现数据模型的类型约束</h3></div></div></article><link rel="stylesheet" type="text/css" href="/css/font.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.css"><script src="//cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script><script src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script>$(document).ready(function() {
  $(".fancybox").fancybox();
});
</script></body></html>
<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content=" id=&quot;loggiing-模块&quot;&gt;&lt;a href=&quot;#loggiing-模块&quot; class=&quot;headerlink&quot; title=&quot;loggiing 模块&quot;&gt;&lt;/a&gt;loggiing 模块&lt;/h2&gt;&lt;p&gt;日志级别大小关系为：CRITICAL &amp;gt; ERROR &amp;gt; WARNING &amp;gt; INFO &amp;gt; DEBUG &amp;gt; NOTSET"><link rel="stylesheet" type="text/css" href="/css/normalize.css"><link rel="stylesheet" type="text/css" href="/css/highlight.css"><link rel="stylesheet" type="text/css" href="/css/noise.css"><title>logging | 凉薄的自动书记人偶</title><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><meta name="generator" content="Hexo 5.4.0"></head><body><article class="wrapper"><div class="post-main"><div class="nav"><nav class="container"><a class="sidebar-nav-item active" href="/">Home</a></nav><div class="container post-meta"><div class="post-tags"><a class="post-tag-none-link" href="/tags/Python/" rel="tag">Python</a></div><div class="post-time">2019-07-28</div></div></div><div class="container post-header"><h1>logging</h1></div><div class="container post-toc"><details class="toc"><summary class="toc-accordion">Table of Contents</summary><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#loggiing-%E6%A8%A1%E5%9D%97"><span class="toc-number">1.</span> <span class="toc-text">loggiing 模块</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%B0%E5%BD%95%E6%97%A5%E5%BF%97%E5%88%B0%E6%96%87%E4%BB%B6"><span class="toc-number">1.1.</span> <span class="toc-text">记录日志到文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8E%E5%A4%9A%E4%B8%AA%E6%A8%A1%E5%9D%97%E8%AE%B0%E5%BD%95%E6%97%A5%E5%BF%97"><span class="toc-number">1.2.</span> <span class="toc-text">从多个模块记录日志</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%B0%E5%BD%95%E5%8F%98%E9%87%8F%E6%95%B0%E6%8D%AE"><span class="toc-number">1.3.</span> <span class="toc-text">记录变量数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E6%98%BE%E7%A4%BA%E6%B6%88%E6%81%AF%E7%9A%84%E6%A0%BC%E5%BC%8F"><span class="toc-number">1.4.</span> <span class="toc-text">自定义显示消息的格式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8%E6%B6%88%E6%81%AF%E4%B8%AD%E6%98%BE%E7%A4%BA%E6%97%A5%E6%9C%9F-%E6%97%B6%E9%97%B4"><span class="toc-number">1.5.</span> <span class="toc-text">在消息中显示日期&#x2F;时间</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%9B%E9%98%B6%E6%95%99%E7%A8%8B"><span class="toc-number">2.</span> <span class="toc-text">进阶教程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%A5%E5%BF%97%E8%AE%B0%E5%BD%95%E6%B5%81%E7%A8%8B%E7%9A%84%E6%95%B4%E4%BD%93%E6%A1%86%E6%9E%B6"><span class="toc-number">2.1.</span> <span class="toc-text">日志记录流程的整体框架</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%A5%E5%BF%97%E8%AE%B0%E5%BD%95%E7%9A%84%E7%9B%B8%E5%85%B3%E7%94%A8%E6%B3%95"><span class="toc-number">2.2.</span> <span class="toc-text">日志记录的相关用法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#basicConfig-%E7%9A%84%E5%8F%82%E6%95%B0"><span class="toc-number">2.3.</span> <span class="toc-text">basicConfig 的参数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Handler"><span class="toc-number">2.4.</span> <span class="toc-text">Handler</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Formatter"><span class="toc-number">2.5.</span> <span class="toc-text">Formatter</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8D%95%E8%8E%B7-Traceback"><span class="toc-number">2.6.</span> <span class="toc-text">捕获 Traceback</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E5%85%B1%E4%BA%AB"><span class="toc-number">2.7.</span> <span class="toc-text">配置共享</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E9%85%8D%E7%BD%AE"><span class="toc-number">2.8.</span> <span class="toc-text">文件配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%A5%E5%BF%97%E8%AE%B0%E5%BD%95%E4%BD%BF%E7%94%A8%E5%B8%B8%E8%A7%81%E8%AF%AF%E5%8C%BA"><span class="toc-number">2.9.</span> <span class="toc-text">日志记录使用常见误区</span></a></li></ol></li></ol></details></div><div class="container post-content"><h2 id="loggiing-模块"><a href="#loggiing-模块" class="headerlink" title="loggiing 模块"></a>loggiing 模块</h2><p>日志级别大小关系为：CRITICAL &gt; ERROR &gt; WARNING &gt; INFO &gt; DEBUG &gt; NOTSET</p>
<table>
<thead>
<tr>
<th align="left">级别</th>
<th align="left">何时使用</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>DEBUG</code></td>
<td align="left">细节信息，仅当诊断问题时适用。</td>
</tr>
<tr>
<td align="left"><code>INFO</code></td>
<td align="left">确认程序按预期运行</td>
</tr>
<tr>
<td align="left"><code>WARNING</code></td>
<td align="left">表明有已经或即将发生的意外（例如：磁盘空间不足）。程序仍按预期进行</td>
</tr>
<tr>
<td align="left"><code>ERROR</code></td>
<td align="left">由于严重的问题，程序的某些功能已经不能正常执行</td>
</tr>
<tr>
<td align="left"><code>CRITICAL</code></td>
<td align="left">严重的错误，表明程序已不能继续执行</td>
</tr>
</tbody></table>
<p>默认级别是 <code>WARNING</code> 。</p>
<h3 id="记录日志到文件"><a href="#记录日志到文件" class="headerlink" title="记录日志到文件"></a>记录日志到文件</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"></span><br><span class="line">logging.basicConfig(filename=<span class="string">&#x27;test.log&#x27;</span>,level=logging.DEBUG)</span><br><span class="line"></span><br><span class="line">logging.debug(<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line">logging.info(<span class="string">&#x27;info&#x27;</span>)</span><br><span class="line">logging.warning(<span class="string">&#x27;warning&#x27;</span>)</span><br><span class="line">logging.error(<span class="string">&#x27;error&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>文件内容如下:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">DEBUG:root:debug</span><br><span class="line">INFO:root:info</span><br><span class="line">WARNING:root:warning</span><br><span class="line">ERROR:root:error</span><br></pre></td></tr></table></figure>



<h3 id="从多个模块记录日志"><a href="#从多个模块记录日志" class="headerlink" title="从多个模块记录日志"></a>从多个模块记录日志</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mylib.py</span></span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">do_something</span>():</span></span><br><span class="line">    logging.info(<span class="string">&#x27;Doing something&#x27;</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># myapp.py</span></span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="keyword">import</span> mylib</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    logging.basicConfig(filename=<span class="string">&#x27;myapp.log&#x27;</span>, level=logging.INFO)</span><br><span class="line">    logging.info(<span class="string">&#x27;Started&#x27;</span>)</span><br><span class="line">    mylib.do_something()</span><br><span class="line">    logging.info(<span class="string">&#x27;Finished&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>



<h3 id="记录变量数据"><a href="#记录变量数据" class="headerlink" title="记录变量数据"></a>记录变量数据</h3><p>将可变数据合并到事件描述消息中使用旧的 %-s形式的字符串格式化</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"></span><br><span class="line">base_debug = <span class="string">&#x27;%s before you %s&#x27;</span></span><br><span class="line">logging.debug(base_debug,<span class="string">&#x27;Look&#x27;</span>,<span class="string">&#x27;leap&#x27;</span>)</span><br></pre></td></tr></table></figure>



<h3 id="自定义显示消息的格式"><a href="#自定义显示消息的格式" class="headerlink" title="自定义显示消息的格式"></a>自定义显示消息的格式</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"></span><br><span class="line">logging.basicConfig(<span class="built_in">format</span>=<span class="string">&#x27;%(levelname)s --- %(message)s&#x27;</span>,level=logging.DEBUG)</span><br><span class="line"></span><br><span class="line">logging.debug(<span class="string">&#x27;AAAA&#x27;</span>)</span><br><span class="line">logging.info(<span class="string">&#x27;BBBB&#x27;</span>)</span><br><span class="line">logging.warning(<span class="string">&#x27;CCCC&#x27;</span>)</span><br><span class="line"><span class="comment"># DEBUG --- AAAA</span></span><br><span class="line"><span class="comment"># INFO --- BBBB</span></span><br><span class="line"><span class="comment"># WARNING --- CCCC</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>%(name)s Logger的名字<br>%(levelname)s 文本形式的日志级别<br>%(message)s 用户输出的消息<br>%(asctime)s 字符串形式的当前时间。默认格式是 “2003-07-08 16:49:45,896”。逗号后面的是毫秒<br>%(levelno)s 数字形式的日志级别<br>%(pathname)s 调用日志输出函数的模块的完整路径名，可能没有<br>%(filename)s 调用日志输出函数的模块的文件名<br>%(module)s  调用日志输出函数的模块名<br>%(funcName)s 调用日志输出函数的函数名<br>%(lineno)d 调用日志输出函数的语句所在的代码行<br>%(created)f 当前时间，用UNIX标准的表示时间的浮 点数表示<br>%(relativeCreated)d 输出日志信息时的，自Logger创建以 来的毫秒数<br>%(thread)d 线程ID。可能没有<br>%(threadName)s 线程名。可能没有<br>%(process)d 进程ID。可能没有</p>
</blockquote>
<h3 id="在消息中显示日期-时间"><a href="#在消息中显示日期-时间" class="headerlink" title="在消息中显示日期/时间"></a>在消息中显示日期/时间</h3><ul>
<li>在格式字符串中放置<code>&#39;%(asctime)s&#39;</code></li>
<li>控制时间格式 : datefmt 参数</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"></span><br><span class="line">logging.basicConfig(<span class="built_in">format</span>=<span class="string">&#x27;%(levelname)s --- %(asctime)s --- %(message)s&#x27;</span>,level=logging.DEBUG)</span><br><span class="line"></span><br><span class="line">logging.debug(<span class="string">&#x27;AAAA&#x27;</span>)</span><br><span class="line">logging.info(<span class="string">&#x27;BBBB&#x27;</span>)</span><br><span class="line">logging.warning(<span class="string">&#x27;CCCC&#x27;</span>)</span><br><span class="line"><span class="comment"># DEBUG --- 2019-07-28 12:09:48,528 --- AAAA</span></span><br><span class="line"><span class="comment"># INFO --- 2019-07-28 12:09:48,528 --- BBBB</span></span><br><span class="line"><span class="comment"># WARNING --- 2019-07-28 12:09:48,528 --- CCCC</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"></span><br><span class="line">logging.basicConfig(<span class="built_in">format</span>=<span class="string">&#x27;%(levelname)s --- %(asctime)s --- %(message)s&#x27;</span>,datefmt=<span class="string">&#x27;%m/%d/%Y %I:%M:%S %p&#x27;</span> ,level=logging.DEBUG)</span><br><span class="line"></span><br><span class="line">logging.debug(<span class="string">&#x27;AAAA&#x27;</span>)</span><br><span class="line">logging.info(<span class="string">&#x27;BBBB&#x27;</span>)</span><br><span class="line">logging.warning(<span class="string">&#x27;CCCC&#x27;</span>)</span><br><span class="line"><span class="comment"># DEBUG --- 07/28/2019 12:11:40 PM --- AAAA</span></span><br><span class="line"><span class="comment"># INFO --- 07/28/2019 12:11:40 PM --- BBBB</span></span><br><span class="line"><span class="comment"># WARNING --- 07/28/2019 12:11:40 PM --- CCCC</span></span><br></pre></td></tr></table></figure>





<h2 id="进阶教程"><a href="#进阶教程" class="headerlink" title="进阶教程"></a>进阶教程</h2><h3 id="日志记录流程的整体框架"><a href="#日志记录流程的整体框架" class="headerlink" title="日志记录流程的整体框架"></a>日志记录流程的整体框架</h3><p><img src="/images/1564305056644.png" alt="1564305056644"></p>
<ul>
<li>Logger：即 Logger Main Class，是我们进行日志记录时创建的对象，我们可以调用它的方法传入日志模板和信息，来生成一条条日志记录，称作 Log Record。</li>
<li>Log Record：就代指生成的一条条日志记录。</li>
<li>Handler：即用来处理日志记录的类，它可以将 Log Record 输出到我们指定的日志位置和存储形式等，如我们可以指定将日志通过 FTP 协议记录到远程的服务器上，Handler 就会帮我们完成这些事情。</li>
<li>Formatter：实际上生成的 Log Record 也是一个个对象，那么我们想要把它们保存成一条条我们想要的日志文本的话，就需要有一个格式化的过程，那么这个过程就由 Formatter 来完成，返回的就是日志字符串，然后传回给 Handler 来处理。</li>
<li>Filter：另外保存日志的时候我们可能不需要全部保存，我们可能只需要保存我们想要的部分就可以了，所以保存前还需要进行一下过滤，留下我们想要的日志，如只保存某个级别的日志，或只保存包含某个关键字的日志等，那么这个过滤过程就交给 Filter 来完成。</li>
<li>Parent Handler：Handler 之间可以存在分层关系，以使得不同 Handler 之间共享相同功能的代码</li>
</ul>
<h3 id="日志记录的相关用法"><a href="#日志记录的相关用法" class="headerlink" title="日志记录的相关用法"></a>日志记录的相关用法</h3><p>总的来说 logging 模块相比 print 有这么几个优点：</p>
<ul>
<li>可以在 logging 模块中设置日志等级，在不同的版本（如开发环境、生产环境）上通过设置不同的输出等级来记录对应的日志，非常灵活。</li>
<li>print 的输出信息都会输出到标准输出流中，而 logging 模块就更加灵活，可以设置输出到任意位置，如写入文件、写入远程服务器等。</li>
<li>logging 模块具有灵活的配置和格式化功能，如配置输出当前模块信息、运行时间等，相比 print 的字符串格式化更加方便易用。</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line">logging.basicConfig(level=logging.INFO, <span class="built_in">format</span>=<span class="string">&#x27;%(asctime)s - %(name)s - %(levelname)s - %(message)s&#x27;</span>)</span><br><span class="line"><span class="comment"># 声明了一个 Logger 对象，它就是日志输出的主类</span></span><br><span class="line"><span class="comment"># 传入了模块的名称，这里直接使用 __name__ 来代替了，就是模块的名称</span></span><br><span class="line">logger = logging.getLogger(__name__)</span><br><span class="line"> </span><br><span class="line">logger.info(<span class="string">&#x27;This is a log info&#x27;</span>)</span><br><span class="line">logger.debug(<span class="string">&#x27;Debugging&#x27;</span>)</span><br><span class="line">logger.warning(<span class="string">&#x27;Warning exists&#x27;</span>)</span><br><span class="line">logger.info(<span class="string">&#x27;Finish&#x27;</span>)</span><br><span class="line"><span class="comment"># 2019-07-28 14:51:35,360 - __main__ - INFO - This is a log info</span></span><br><span class="line"><span class="comment"># 2019-07-28 14:51:35,360 - __main__ - WARNING - Warning exists</span></span><br><span class="line"><span class="comment"># 2019-07-28 14:51:35,360 - __main__ - INFO - Finish</span></span><br></pre></td></tr></table></figure>



<h3 id="basicConfig-的参数"><a href="#basicConfig-的参数" class="headerlink" title="basicConfig 的参数"></a>basicConfig 的参数</h3><ul>
<li>filename：即日志输出的文件名，如果指定了这个信息之后，实际上会启用 FileHandler，而不再是 StreamHandler，这样日志信息便会输出到文件中了。</li>
<li>filemode：这个是指定日志文件的写入方式，有两种形式，一种是 w，一种是 a，分别代表清除后写入和追加写入。</li>
<li>format：指定日志信息的输出格式</li>
<li>datefmt：指定时间的输出格式。</li>
<li>style：如果 format 参数指定了，这个参数就可以指定格式化时的占位符风格，如 %、{、$ 等。</li>
<li>level：指定日志输出的类别，程序会输出大于等于此级别的信息。</li>
<li>stream：在没有指定 filename 的时候会默认使用 StreamHandler，这时 stream 可以指定初始化的文件流。</li>
<li>handlers：可以指定日志处理时所使用的 Handlers，必须是可迭代的。</li>
</ul>
<h3 id="Handler"><a href="#Handler" class="headerlink" title="Handler"></a>Handler</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"> </span><br><span class="line">logger = logging.getLogger(__name__)</span><br><span class="line">logger.setLevel(level=logging.INFO)</span><br><span class="line">handler = logging.FileHandler(<span class="string">&#x27;output.log&#x27;</span>)</span><br><span class="line">formatter = logging.Formatter(<span class="string">&#x27;%(asctime)s - %(name)s - %(levelname)s - %(message)s&#x27;</span>)</span><br><span class="line">handler.setFormatter(formatter)</span><br><span class="line">logger.addHandler(handler)</span><br><span class="line"> </span><br><span class="line">logger.info(<span class="string">&#x27;This is a log info&#x27;</span>)</span><br><span class="line">logger.debug(<span class="string">&#x27;Debugging&#x27;</span>)</span><br><span class="line">logger.warning(<span class="string">&#x27;Warning exists&#x27;</span>)</span><br><span class="line">logger.info(<span class="string">&#x27;Finish&#x27;</span>)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>可以看出设置的流程为:</p>
<ol>
<li>创建一个logger类</li>
<li>为logger类设置日志等级</li>
<li>创建一个headler</li>
<li>创建一个formatter</li>
<li>将formatter添加到headler</li>
<li>将这个headler添加到logger类上</li>
</ol>
</blockquote>
<p>logging 模块提供的 Handler 有：</p>
<ul>
<li>StreamHandler：<br>logging.StreamHandler；日志输出到流，可以是 sys.stderr，sys.stdout 或者文件。</li>
<li>FileHandler：<br>logging.FileHandler；日志输出到文件。</li>
<li>BaseRotatingHandler：<br>logging.handlers.BaseRotatingHandler；基本的日志回滚方式。</li>
<li>RotatingHandler：<br>logging.handlers.RotatingHandler；日志回滚方式，支持日志文件最大数量和日志文件回滚。</li>
<li>TimeRotatingHandler：<br>logging.handlers.TimeRotatingHandler；日志回滚方式，在一定时间区域内回滚日志文件。</li>
<li>SocketHandler：<br>logging.handlers.SocketHandler；远程输出日志到TCP/IP sockets。</li>
<li>DatagramHandler：<br>logging.handlers.DatagramHandler；远程输出日志到UDP sockets。</li>
<li>SMTPHandler：<br>logging.handlers.SMTPHandler；远程输出日志到邮件地址。</li>
<li>SysLogHandler：<br>logging.handlers.SysLogHandler；日志输出到syslog。</li>
<li>NTEventLogHandler：<br>logging.handlers.NTEventLogHandler；远程输出日志到Windows NT/2000/XP的事件日志。</li>
<li>MemoryHandler：<br>logging.handlers.MemoryHandler；日志输出到内存中的指定buffer。</li>
<li>HTTPHandler：<br>logging.handlers.HTTPHandler；通过”GET”或者”POST”远程输出到HTTP服务器。</li>
</ul>
<blockquote>
<p>所以,我们可以如下设置:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 创建logger</span></span><br><span class="line">logger = logging.getLogger(__name__)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建两个headler</span></span><br><span class="line">handler1 = logging.FileHandler(<span class="string">&#x27;output.log&#x27;</span>)</span><br><span class="line">handler2 = logging.StreamHandler(sys.stdout)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 为两个headler设置日志等级</span></span><br><span class="line">handler1.setLevel(level=logging.DEBUG)</span><br><span class="line">handler2.setLevel(level=logging.INFO)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建formatter</span></span><br><span class="line">formatter = logging.Formatter(<span class="string">&#x27;%(asctime)s - %(name)s - %(levelname)s - %(message)s&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 为两个headler设置formatter</span></span><br><span class="line">handler1.setFormatter(formatter)</span><br><span class="line">handler2.setFormatter(formatter)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将headler添加到logger上</span></span><br><span class="line">logger.addHandler(handler1)</span><br><span class="line">logger.addHandler(handler2)</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">logger.info(<span class="string">&#x27;This is a log info&#x27;</span>)</span><br><span class="line">logger.debug(<span class="string">&#x27;Debugging&#x27;</span>)</span><br><span class="line">logger.warning(<span class="string">&#x27;Warning exists&#x27;</span>)</span><br><span class="line">logger.info(<span class="string">&#x27;Finish&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>这样,日志就可以同时输出到标准流和文件上了</p>
<p>或者:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="keyword">from</span> logging.handlers <span class="keyword">import</span> HTTPHandler</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"> </span><br><span class="line">logger = logging.getLogger(__name__)</span><br><span class="line">logger.setLevel(level=logging.DEBUG)</span><br><span class="line"> </span><br><span class="line"><span class="comment"># StreamHandler</span></span><br><span class="line">stream_handler = logging.StreamHandler(sys.stdout)</span><br><span class="line">stream_handler.setLevel(level=logging.DEBUG)</span><br><span class="line">logger.addHandler(stream_handler)</span><br><span class="line"> </span><br><span class="line"><span class="comment"># FileHandler</span></span><br><span class="line">file_handler = logging.FileHandler(<span class="string">&#x27;output.log&#x27;</span>)</span><br><span class="line">file_handler.setLevel(level=logging.INFO)</span><br><span class="line">formatter = logging.Formatter(<span class="string">&#x27;%(asctime)s - %(name)s - %(levelname)s - %(message)s&#x27;</span>)</span><br><span class="line">file_handler.setFormatter(formatter)</span><br><span class="line">logger.addHandler(file_handler)</span><br><span class="line"> </span><br><span class="line"><span class="comment"># HTTPHandler</span></span><br><span class="line">http_handler = HTTPHandler(host=<span class="string">&#x27;localhost:8001&#x27;</span>, url=<span class="string">&#x27;log&#x27;</span>, method=<span class="string">&#x27;POST&#x27;</span>)</span><br><span class="line">logger.addHandler(http_handler)</span><br><span class="line"> </span><br><span class="line"><span class="comment"># Log</span></span><br><span class="line">logger.info(<span class="string">&#x27;This is a log info&#x27;</span>)</span><br><span class="line">logger.debug(<span class="string">&#x27;Debugging&#x27;</span>)</span><br><span class="line">logger.warning(<span class="string">&#x27;Warning exists&#x27;</span>)</span><br><span class="line">logger.info(<span class="string">&#x27;Finish&#x27;</span>)</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="Formatter"><a href="#Formatter" class="headerlink" title="Formatter"></a>Formatter</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"> </span><br><span class="line">logger = logging.getLogger(__name__)</span><br><span class="line">logger.setLevel(level=logging.WARN)</span><br><span class="line">formatter = logging.Formatter(fmt=<span class="string">&#x27;%(asctime)s - %(name)s - %(levelname)s - %(message)s&#x27;</span>, datefmt=<span class="string">&#x27;%Y/%m/%d %H:%M:%S&#x27;</span>)</span><br><span class="line">handler = logging.StreamHandler()</span><br><span class="line">handler.setFormatter(formatter)</span><br><span class="line">logger.addHandler(handler)</span><br><span class="line"> </span><br><span class="line"><span class="comment"># Log</span></span><br><span class="line">logger.debug(<span class="string">&#x27;Debugging&#x27;</span>)</span><br><span class="line">logger.critical(<span class="string">&#x27;Critical Something&#x27;</span>)</span><br><span class="line">logger.error(<span class="string">&#x27;Error Occurred&#x27;</span>)</span><br><span class="line">logger.warning(<span class="string">&#x27;Warning exists&#x27;</span>)</span><br><span class="line">logger.info(<span class="string">&#x27;Finished&#x27;</span>)</span><br></pre></td></tr></table></figure>



<h3 id="捕获-Traceback"><a href="#捕获-Traceback" class="headerlink" title="捕获 Traceback"></a>捕获 Traceback</h3><p>如果遇到错误，我们更希望报错时出现的详细 Traceback 信息，便于调试，利用 logging 模块我们可以非常方便地实现这个记录，我们用一个实例来感受一下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"> </span><br><span class="line">logger = logging.getLogger(__name__)</span><br><span class="line">logger.setLevel(level=logging.DEBUG)</span><br><span class="line"> </span><br><span class="line"><span class="comment"># Formatter</span></span><br><span class="line">formatter = logging.Formatter(<span class="string">&#x27;%(asctime)s - %(name)s - %(levelname)s - %(message)s&#x27;</span>)</span><br><span class="line"> </span><br><span class="line"><span class="comment"># FileHandler</span></span><br><span class="line">file_handler = logging.FileHandler(<span class="string">&#x27;output.log&#x27;</span>)</span><br><span class="line">file_handler.setFormatter(formatter)</span><br><span class="line">logger.addHandler(file_handler)</span><br><span class="line"> </span><br><span class="line"><span class="comment"># StreamHandler</span></span><br><span class="line">stream_handler = logging.StreamHandler()</span><br><span class="line">stream_handler.setFormatter(formatter)</span><br><span class="line">logger.addHandler(stream_handler)</span><br><span class="line"> </span><br><span class="line"><span class="comment"># Log</span></span><br><span class="line">logger.info(<span class="string">&#x27;Start&#x27;</span>)</span><br><span class="line">logger.warning(<span class="string">&#x27;Something maybe fail.&#x27;</span>)</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    result = <span class="number">10</span> / <span class="number">0</span></span><br><span class="line"><span class="keyword">except</span> Exception:</span><br><span class="line">    logger.error(<span class="string">&#x27;Faild to get result&#x27;</span>, exc_info=<span class="literal">True</span>)</span><br><span class="line">logger.info(<span class="string">&#x27;Finished&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2019-07-28 15:15:33,913 - __main__ - INFO - Start</span></span><br><span class="line"><span class="comment"># 2019-07-28 15:15:33,913 - __main__ - WARNING - Something maybe fail.</span></span><br><span class="line"><span class="comment"># 2019-07-28 15:15:33,914 - __main__ - ERROR - Faild to get result</span></span><br><span class="line"><span class="comment"># Traceback (most recent call last):</span></span><br><span class="line"><span class="comment">#   File &quot;D:\trainingfile\training1.py&quot;, line 23, in &lt;module&gt;</span></span><br><span class="line"><span class="comment">#     result = 10 / 0</span></span><br><span class="line"><span class="comment"># ZeroDivisionError: division by zero</span></span><br><span class="line"><span class="comment"># 2019-07-28 15:15:33,915 - __main__ - INFO - Finished</span></span><br></pre></td></tr></table></figure>



<h3 id="配置共享"><a href="#配置共享" class="headerlink" title="配置共享"></a>配置共享</h3><p>logging 模块提供了父子模块共享配置的机制，会根据 Logger 的名称来自动加载父模块的配置。</p>
<blockquote>
<ul>
<li><p>logging模块保证在同一个python解释器内，<strong>多次调用logging.getLogger(‘log_name’)都会返回同一个logger实例</strong>，即使是在多个模块的情况下。</p>
</li>
<li><p>所以典型的多模块场景下使用logging的方式是==在main模块中配置logging，这个配置会作用于多个的子模块，然后在其他模块中直接通过getLogger获取Logger对象即可==。</p>
</li>
<li><p>获取方式是:</p>
<ol>
<li><p>子模块mod.py：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">logger = logging.getLogger(<span class="string">&#x27;main.mod&#x27;</span>)</span><br></pre></td></tr></table></figure></li>
<li><p>子子模块submod.py：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">logger = logging.getLogger(<span class="string">&#x27;main.mod.submod&#x27;</span>)</span><br></pre></td></tr></table></figure></li>
</ol>
</li>
</ul>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># main.py</span></span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="keyword">import</span> core  <span class="comment"># 本地库</span></span><br><span class="line"> </span><br><span class="line">logger = logging.getLogger(<span class="string">&#x27;main&#x27;</span>)</span><br><span class="line">logger.setLevel(level=logging.DEBUG)</span><br><span class="line"> </span><br><span class="line"><span class="comment"># Handler</span></span><br><span class="line">handler = logging.FileHandler(<span class="string">&#x27;result.log&#x27;</span>)</span><br><span class="line">handler.setLevel(logging.INFO)</span><br><span class="line">formatter = logging.Formatter(<span class="string">&#x27;%(asctime)s - %(name)s - %(levelname)s - %(message)s&#x27;</span>)</span><br><span class="line">handler.setFormatter(formatter)</span><br><span class="line">logger.addHandler(handler)</span><br><span class="line"> </span><br><span class="line">logger.info(<span class="string">&#x27;Main Info&#x27;</span>)</span><br><span class="line">logger.debug(<span class="string">&#x27;Main Debug&#x27;</span>)</span><br><span class="line">logger.error(<span class="string">&#x27;Main Error&#x27;</span>)</span><br><span class="line">core.run()</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># core.py</span></span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"> </span><br><span class="line">logger = logging.getLogger(<span class="string">&#x27;main.core&#x27;</span>)</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run</span>():</span></span><br><span class="line">    logger.info(<span class="string">&#x27;Core Info&#x27;</span>)</span><br><span class="line">    logger.debug(<span class="string">&#x27;Core Debug&#x27;</span>)</span><br><span class="line">    logger.error(<span class="string">&#x27;Core Error&#x27;</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">2019-07-28 15:20:59,638 - main - INFO - Main Info</span><br><span class="line">2019-07-28 15:20:59,639 - main - ERROR - Main Error</span><br><span class="line">2019-07-28 15:21:09,279 - main - INFO - Main Info</span><br><span class="line">2019-07-28 15:21:09,279 - main - ERROR - Main Error</span><br><span class="line">2019-07-28 15:21:09,279 - main.core - INFO - Core Info</span><br><span class="line">2019-07-28 15:21:09,279 - main.core - ERROR - Core Error</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>logger = logging.getLogger(&#39;main.core&#39;)</code> :<br>这里我们定义了 Logger 的名称为 main.core，注意这里开头是 main，即刚才我们在 main.py 里面的 Logger 的名称，这样 core.py 里面的 Logger 就会复用 main.py 里面的 Logger 配置，而不用再去配置一次了。</p>
</blockquote>
<h3 id="文件配置"><a href="#文件配置" class="headerlink" title="文件配置"></a>文件配置</h3><p>首先我们定义一个 yaml 配置文件：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="number">1</span></span><br><span class="line"><span class="attr">formatters:</span></span><br><span class="line">  <span class="attr">brief:</span></span><br><span class="line">    <span class="attr">format:</span> <span class="string">&quot;%(asctime)s - %(message)s&quot;</span></span><br><span class="line">  <span class="attr">simple:</span></span><br><span class="line">    <span class="attr">format:</span> <span class="string">&quot;%(asctime)s - %(name)s - %(levelname)s - %(message)s&quot;</span></span><br><span class="line"><span class="attr">handlers:</span></span><br><span class="line">  <span class="attr">console:</span></span><br><span class="line">    <span class="attr">class :</span> <span class="string">logging.StreamHandler</span></span><br><span class="line">    <span class="attr">formatter:</span> <span class="string">brief</span></span><br><span class="line">    <span class="attr">level   :</span> <span class="string">INFO</span></span><br><span class="line">    <span class="attr">stream  :</span> <span class="string">ext://sys.stdout</span></span><br><span class="line">  <span class="attr">file:</span></span><br><span class="line">    <span class="attr">class :</span> <span class="string">logging.FileHandler</span></span><br><span class="line">    <span class="attr">formatter:</span> <span class="string">simple</span></span><br><span class="line">    <span class="attr">level:</span> <span class="string">DEBUG</span></span><br><span class="line">    <span class="attr">filename:</span> <span class="string">debug.log</span></span><br><span class="line">  <span class="attr">error:</span></span><br><span class="line">    <span class="attr">class:</span> <span class="string">logging.handlers.RotatingFileHandler</span></span><br><span class="line">    <span class="attr">level:</span> <span class="string">ERROR</span></span><br><span class="line">    <span class="attr">formatter:</span> <span class="string">simple</span></span><br><span class="line">    <span class="attr">filename:</span> <span class="string">error.log</span></span><br><span class="line">    <span class="attr">maxBytes:</span> <span class="number">10485760</span></span><br><span class="line">    <span class="attr">backupCount:</span> <span class="number">20</span></span><br><span class="line">    <span class="attr">encoding:</span> <span class="string">utf8</span></span><br><span class="line"><span class="attr">loggers:</span></span><br><span class="line">  <span class="attr">main.core:</span></span><br><span class="line">    <span class="attr">level:</span> <span class="string">DEBUG</span></span><br><span class="line">    <span class="attr">handlers:</span> [<span class="string">console</span>, <span class="string">file</span>, <span class="string">error</span>]</span><br><span class="line"><span class="attr">root:</span></span><br><span class="line">  <span class="attr">level:</span> <span class="string">DEBUG</span></span><br><span class="line">  <span class="attr">handlers:</span> [<span class="string">console</span>]</span><br></pre></td></tr></table></figure>

<p>我们定义了 formatters、handlers、loggers、root 等模块，实际上对应的就是各个 Formatter、Handler、Logger 的配置，参数和它们的构造方法都是相同的。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># main.py</span></span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="keyword">import</span> core</span><br><span class="line"><span class="keyword">import</span> yaml</span><br><span class="line"><span class="keyword">import</span> logging.config</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">setup_logging</span>(<span class="params">default_path=<span class="string">&#x27;config.yaml&#x27;</span>, default_level=logging.INFO</span>):</span></span><br><span class="line">    path = default_path</span><br><span class="line">    <span class="keyword">if</span> os.path.exists(path):</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(path, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">            config = yaml.load(f)</span><br><span class="line">            <span class="comment"># 读取设置</span></span><br><span class="line">            logging.config.dictConfig(config)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        logging.basicConfig(level=default_level)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">log</span>():</span></span><br><span class="line">    logging.debug(<span class="string">&#x27;Start&#x27;</span>)</span><br><span class="line">    logging.info(<span class="string">&#x27;Exec&#x27;</span>)</span><br><span class="line">    logging.info(<span class="string">&#x27;Finished&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    yaml_path = <span class="string">&#x27;config.yaml&#x27;</span></span><br><span class="line">    setup_logging(yaml_path)</span><br><span class="line">    log()</span><br><span class="line">    core.run()</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># core.py</span></span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"> </span><br><span class="line">logger = logging.getLogger(<span class="string">&#x27;main.core&#x27;</span>)</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run</span>():</span></span><br><span class="line">    logger.info(<span class="string">&#x27;Core Info&#x27;</span>)</span><br><span class="line">    logger.debug(<span class="string">&#x27;Core Debug&#x27;</span>)</span><br><span class="line">    logger.error(<span class="string">&#x27;Core Error&#x27;</span>)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>这里我们定义了一个 setup_logging() 方法，里面读取了 yaml 文件的配置，然后通过 dictConfig() 方法将配置项传给了 logging 模块进行全局初始化。</p>
</blockquote>
<h3 id="日志记录使用常见误区"><a href="#日志记录使用常见误区" class="headerlink" title="日志记录使用常见误区"></a>日志记录使用常见误区</h3><p>在日志输出的时候经常我们会用到字符串拼接的形式，很多情况下我们可能会使用字符串的 format() 来构造一个字符串，但这其实并不是一个好的方法，因为还有更好的方法，下面我们对比两个例子：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"> </span><br><span class="line">logging.basicConfig(level=logging.DEBUG, <span class="built_in">format</span>=<span class="string">&#x27;%(asctime)s - %(name)s - %(levelname)s - %(message)s&#x27;</span>)</span><br><span class="line"> </span><br><span class="line"><span class="comment"># bad</span></span><br><span class="line">logging.debug(<span class="string">&#x27;Hello &#123;0&#125;, &#123;1&#125;!&#x27;</span>.<span class="built_in">format</span>(<span class="string">&#x27;World&#x27;</span>, <span class="string">&#x27;Congratulations&#x27;</span>))</span><br><span class="line"><span class="comment"># good</span></span><br><span class="line">logging.debug(<span class="string">&#x27;Hello %s, %s!&#x27;</span>, <span class="string">&#x27;World&#x27;</span>, <span class="string">&#x27;Congratulations&#x27;</span>)</span><br></pre></td></tr></table></figure>



<p>在进行异常处理的时候，通常我们会直接将异常进行字符串格式化，但其实可以直接指定一个参数将 traceback 打印出来，示例如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"> </span><br><span class="line">logging.basicConfig(level=logging.DEBUG, <span class="built_in">format</span>=<span class="string">&#x27;%(asctime)s - %(name)s - %(levelname)s - %(message)s&#x27;</span>)</span><br><span class="line"> </span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    result = <span class="number">5</span> / <span class="number">0</span></span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">    <span class="comment"># bad</span></span><br><span class="line">    logging.error(<span class="string">&#x27;Error: %s&#x27;</span>, e)</span><br><span class="line">    <span class="comment"># good</span></span><br><span class="line">    logging.error(<span class="string">&#x27;Error&#x27;</span>, exc_info=<span class="literal">True</span>)</span><br><span class="line">    <span class="comment"># good</span></span><br><span class="line">    logging.exception(<span class="string">&#x27;Error&#x27;</span>)</span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li>如果我们直接使用字符串格式化的方法将错误输出的话，是不会包含 Traceback 信息的，</li>
<li>如果我们加上 exc_info 参数或者直接使用 exception() 方法打印的话，那就会输出 Traceback 信息了。</li>
</ul>
</blockquote>
</div></div><div class="post-main post-comment"></div></article><link rel="stylesheet" type="text/css" href="/css/font.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.css"><script src="//cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script><script src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script>$(document).ready(function() {
  $(".fancybox").fancybox();
});
</script></body></html>
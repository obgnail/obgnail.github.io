<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content=" id=&quot;第六章：数据编码和处理&quot;&gt;&lt;a href=&quot;#第六章：数据编码和处理&quot; class=&quot;headerlink&quot; title=&quot;第六章：数据编码和处理&quot;&gt;&lt;/a&gt;第六章：数据编码和处理&lt;/h2&gt;&lt;h3 id=&quot;6-1-读写-CSV-数据&quot;&gt;&lt;a href=&quot;#6-1-读写-CSV-数据&quot; class=&quot;headerlink&quot; title=&quot;6.1 读写 CSV 数据&quot;&gt;&lt;/a&gt;6.1 读写 CSV 数据&lt;/h3&gt;&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;import&lt;/span&gt; csv&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;with&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;open&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&amp;#x27;stocks.csv&amp;#x27;&lt;/span&gt;) &lt;span class=&quot;keyword&quot;&gt;as&lt;/span&gt; f:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    f_csv = csv.reader(f)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;# 跳过首行(表头)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    headers = &lt;span class=&quot;built_in&quot;&gt;next&lt;/span&gt;(f_csv)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; row &lt;span class=&quot;keyword&quot;&gt;in&lt;/span&gt; f_csv:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;print&lt;/span&gt;(row)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# [&amp;#x27;AA&amp;#x27;, &amp;#x27;39.48&amp;#x27;, &amp;#x27;6/11/2007&amp;#x27;, &amp;#x27;9:36am&amp;#x27;, &amp;#x27;-0.18&amp;#x27;, &amp;#x27;181800&amp;#x27;]&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;# [&amp;#x27;AIG&amp;#x27;, &amp;#x27;71.38&amp;#x27;, &amp;#x27;6/11/2007&amp;#x27;, &amp;#x27;9:36am&amp;#x27;, &amp;#x27;-0.15&amp;#x27;, &amp;#x27;195500&amp;#x27;]&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;经常使用的方式 : 使用&lt;strong&gt;命名元组&lt;/strong&gt;"><link rel="stylesheet" type="text/css" href="/css/normalize.css"><link rel="stylesheet" type="text/css" href="/css/highlight.css"><link rel="stylesheet" type="text/css" href="/css/noise.css"><title>python-cookbook6_第六章_数据编码和处理 | 凉薄的自动书记人偶</title><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><meta name="generator" content="Hexo 5.4.0"></head><body><article class="wrapper"><div class="post-main"><div class="nav"><nav class="container"><a class="sidebar-nav-item active" href="/">Home</a></nav><div class="container post-meta"><div class="post-tags"><a class="post-tag-none-link" href="/tags/Python/" rel="tag">Python</a></div><div class="post-time">2019-07-28</div></div></div><div class="container post-header"><h1>python-cookbook6_第六章_数据编码和处理</h1></div><div class="container post-toc"><details class="toc"><summary class="toc-accordion">Table of Contents</summary><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AC%AC%E5%85%AD%E7%AB%A0%EF%BC%9A%E6%95%B0%E6%8D%AE%E7%BC%96%E7%A0%81%E5%92%8C%E5%A4%84%E7%90%86"><span class="toc-number">1.</span> <span class="toc-text">第六章：数据编码和处理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1-%E8%AF%BB%E5%86%99-CSV-%E6%95%B0%E6%8D%AE"><span class="toc-number">1.1.</span> <span class="toc-text">6.1 读写 CSV 数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-%E8%AF%BB%E5%86%99-JSON-%E6%95%B0%E6%8D%AE"><span class="toc-number">1.2.</span> <span class="toc-text">6.2 读写 JSON 数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-3-%E8%A7%A3%E6%9E%90%E7%AE%80%E5%8D%95%E7%9A%84-XML-%E6%95%B0%E6%8D%AE"><span class="toc-number">1.3.</span> <span class="toc-text">6.3 解析简单的 XML 数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-4-%E5%A2%9E%E9%87%8F%E5%BC%8F%E8%A7%A3%E6%9E%90%E5%A4%A7%E5%9E%8B-XML-%E6%96%87%E4%BB%B6"><span class="toc-number">1.4.</span> <span class="toc-text">6.4 增量式解析大型 XML 文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-5-%E5%B0%86%E5%AD%97%E5%85%B8%E8%BD%AC%E6%8D%A2%E4%B8%BA-XML"><span class="toc-number">1.5.</span> <span class="toc-text">6.5 将字典转换为 XML</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-6-%E8%A7%A3%E6%9E%90%E5%92%8C%E4%BF%AE%E6%94%B9-XML"><span class="toc-number">1.6.</span> <span class="toc-text">6.6 解析和修改 XML</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-7-%E5%88%A9%E7%94%A8%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4%E8%A7%A3%E6%9E%90-XML-%E6%96%87%E6%A1%A3"><span class="toc-number">1.7.</span> <span class="toc-text">6.7 利用命名空间解析 XML 文档</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-8-%E4%B8%8E%E5%85%B3%E7%B3%BB%E5%9E%8B%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E4%BA%A4%E4%BA%92"><span class="toc-number">1.8.</span> <span class="toc-text">6.8 与关系型数据库的交互</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-9-%E7%BC%96%E7%A0%81%E5%92%8C%E8%A7%A3%E7%A0%81%E5%8D%81%E5%85%AD%E8%BF%9B%E5%88%B6%E6%95%B0"><span class="toc-number">1.9.</span> <span class="toc-text">6.9 编码和解码十六进制数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-10-%E7%BC%96%E7%A0%81%E8%A7%A3%E7%A0%81-Base64-%E6%95%B0%E6%8D%AE"><span class="toc-number">1.10.</span> <span class="toc-text">6.10 编码解码 Base64 数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-11-%E8%AF%BB%E5%86%99%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%95%B0%E7%BB%84%E6%95%B0%E6%8D%AE"><span class="toc-number">1.11.</span> <span class="toc-text">6.11 读写二进制数组数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-12-%E8%AF%BB%E5%8F%96%E5%B5%8C%E5%A5%97%E5%92%8C%E5%8F%AF%E5%8F%98%E9%95%BF%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%95%B0%E6%8D%AE"><span class="toc-number">1.12.</span> <span class="toc-text">6.12 读取嵌套和可变长二进制数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-13-%E6%95%B0%E6%8D%AE%E7%9A%84%E7%B4%AF%E5%8A%A0%E4%B8%8E%E7%BB%9F%E8%AE%A1%E6%93%8D%E4%BD%9C"><span class="toc-number">1.13.</span> <span class="toc-text">6.13 数据的累加与统计操作</span></a></li></ol></li></ol></details></div><div class="container post-content"><h2 id="第六章：数据编码和处理"><a href="#第六章：数据编码和处理" class="headerlink" title="第六章：数据编码和处理"></a>第六章：数据编码和处理</h2><h3 id="6-1-读写-CSV-数据"><a href="#6-1-读写-CSV-数据" class="headerlink" title="6.1 读写 CSV 数据"></a>6.1 读写 CSV 数据</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> csv</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;stocks.csv&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f_csv = csv.reader(f)</span><br><span class="line">    <span class="comment"># 跳过首行(表头)</span></span><br><span class="line">    headers = <span class="built_in">next</span>(f_csv)</span><br><span class="line">    <span class="keyword">for</span> row <span class="keyword">in</span> f_csv:</span><br><span class="line">        <span class="built_in">print</span>(row)</span><br><span class="line"><span class="comment"># [&#x27;AA&#x27;, &#x27;39.48&#x27;, &#x27;6/11/2007&#x27;, &#x27;9:36am&#x27;, &#x27;-0.18&#x27;, &#x27;181800&#x27;]</span></span><br><span class="line"><span class="comment"># [&#x27;AIG&#x27;, &#x27;71.38&#x27;, &#x27;6/11/2007&#x27;, &#x27;9:36am&#x27;, &#x27;-0.15&#x27;, &#x27;195500&#x27;]</span></span><br></pre></td></tr></table></figure>

<p>经常使用的方式 : 使用<strong>命名元组</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> csv</span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> namedtuple</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;stocks.csv&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f_csv = csv.reader(f)</span><br><span class="line">    <span class="comment"># 使用表头作为命名元组的属性</span></span><br><span class="line">    Row = namedtuple(<span class="string">&#x27;Row&#x27;</span>, <span class="built_in">next</span>(f_csv))</span><br><span class="line">    <span class="keyword">for</span> r <span class="keyword">in</span> f_csv:</span><br><span class="line">        row = Row(*r)</span><br><span class="line">        <span class="built_in">print</span>(row)</span><br><span class="line"><span class="comment"># Row(Symbol=&#x27;AA&#x27;, Price=&#x27;39.48&#x27;, Date=&#x27;6/11/2007&#x27;, Time=&#x27;9:36am&#x27;, Change=&#x27;-0.18&#x27;, Volume=&#x27;181800&#x27;)</span></span><br><span class="line"><span class="comment"># Row(Symbol=&#x27;AIG&#x27;, Price=&#x27;71.38&#x27;, Date=&#x27;6/11/2007&#x27;, Time=&#x27;9:36am&#x27;, Change=&#x27;-0.15&#x27;, Volume=&#x27;195500&#x27;)</span></span><br></pre></td></tr></table></figure>

<p>当然,最经常使用的还是将<code>csv.reader</code>阅读器改为<code>csv.DictReader</code>:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> csv</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;stocks.csv&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f_csv = csv.DictReader(f)</span><br><span class="line">    <span class="keyword">for</span> row <span class="keyword">in</span> f_csv:</span><br><span class="line">        <span class="built_in">print</span>(row)</span><br><span class="line"><span class="comment"># OrderedDict([(&#x27;Symbol&#x27;, &#x27;AA&#x27;), (&#x27;Price&#x27;, &#x27;39.48&#x27;), (&#x27;Date&#x27;, &#x27;6/11/2007&#x27;), (&#x27;Time&#x27;, &#x27;9:36am&#x27;), (&#x27;Change&#x27;, &#x27;-0.18&#x27;), (&#x27;Volume&#x27;, &#x27;181800&#x27;)])</span></span><br><span class="line"><span class="comment"># OrderedDict([(&#x27;Symbol&#x27;, &#x27;AIG&#x27;), (&#x27;Price&#x27;, &#x27;71.38&#x27;), (&#x27;Date&#x27;, &#x27;6/11/2007&#x27;), (&#x27;Time&#x27;, &#x27;9:36am&#x27;), (&#x27;Change&#x27;, &#x27;-0.15&#x27;), (&#x27;Volume&#x27;, &#x27;195500&#x27;)])</span></span><br></pre></td></tr></table></figure>



<p>阅读需要<code>阅读器(reader)</code>,写入自然也需要<code>写入器(writer)</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> csv</span><br><span class="line"></span><br><span class="line">headers = [<span class="string">&#x27;Symbol&#x27;</span>,<span class="string">&#x27;Price&#x27;</span>,<span class="string">&#x27;Date&#x27;</span>,<span class="string">&#x27;Time&#x27;</span>,<span class="string">&#x27;Change&#x27;</span>,<span class="string">&#x27;Volume&#x27;</span>]</span><br><span class="line">rows = [(<span class="string">&#x27;AA&#x27;</span>, <span class="number">39.48</span>, <span class="string">&#x27;6/11/2007&#x27;</span>, <span class="string">&#x27;9:36am&#x27;</span>, -<span class="number">0.18</span>, <span class="number">181800</span>),</span><br><span class="line">		(<span class="string">&#x27;AIG&#x27;</span>, <span class="number">71.38</span>, <span class="string">&#x27;6/11/2007&#x27;</span>, <span class="string">&#x27;9:36am&#x27;</span>, -<span class="number">0.15</span>, <span class="number">195500</span>),</span><br><span class="line">		(<span class="string">&#x27;AXP&#x27;</span>, <span class="number">62.58</span>, <span class="string">&#x27;6/11/2007&#x27;</span>, <span class="string">&#x27;9:36am&#x27;</span>, -<span class="number">0.46</span>, <span class="number">935000</span>),</span><br><span class="line">		]</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;my.csv&#x27;</span>,<span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">	f_csv = csv.writer(f)</span><br><span class="line">	f_csv.writerow(headers)</span><br><span class="line">	f_csv.writerows(rows)</span><br></pre></td></tr></table></figure>

<p>同样也有<code>DictWriter</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> csv</span><br><span class="line"></span><br><span class="line">headers = [<span class="string">&#x27;Symbol&#x27;</span>, <span class="string">&#x27;Price&#x27;</span>, <span class="string">&#x27;Date&#x27;</span>, <span class="string">&#x27;Time&#x27;</span>, <span class="string">&#x27;Change&#x27;</span>, <span class="string">&#x27;Volume&#x27;</span>]</span><br><span class="line"></span><br><span class="line">rows = [&#123;<span class="string">&#x27;Symbol&#x27;</span>:<span class="string">&#x27;AA&#x27;</span>, <span class="string">&#x27;Price&#x27;</span>:<span class="number">39.48</span>, <span class="string">&#x27;Date&#x27;</span>:<span class="string">&#x27;6/11/2007&#x27;</span>,</span><br><span class="line">		 <span class="string">&#x27;Time&#x27;</span>:<span class="string">&#x27;9:36am&#x27;</span>, <span class="string">&#x27;Change&#x27;</span>:-<span class="number">0.18</span>, <span class="string">&#x27;Volume&#x27;</span>:<span class="number">181800</span>&#125;,</span><br><span class="line"></span><br><span class="line">		&#123;<span class="string">&#x27;Symbol&#x27;</span>:<span class="string">&#x27;AIG&#x27;</span>, <span class="string">&#x27;Price&#x27;</span>: <span class="number">71.38</span>, <span class="string">&#x27;Date&#x27;</span>:<span class="string">&#x27;6/11/2007&#x27;</span>,</span><br><span class="line">		<span class="string">&#x27;Time&#x27;</span>:<span class="string">&#x27;9:36am&#x27;</span>, <span class="string">&#x27;Change&#x27;</span>:-<span class="number">0.15</span>, <span class="string">&#x27;Volume&#x27;</span>: <span class="number">195500</span>&#125;,</span><br><span class="line"></span><br><span class="line">		&#123;<span class="string">&#x27;Symbol&#x27;</span>:<span class="string">&#x27;AXP&#x27;</span>, <span class="string">&#x27;Price&#x27;</span>: <span class="number">62.58</span>, <span class="string">&#x27;Date&#x27;</span>:<span class="string">&#x27;6/11/2007&#x27;</span>,</span><br><span class="line">		<span class="string">&#x27;Time&#x27;</span>:<span class="string">&#x27;9:36am&#x27;</span>, <span class="string">&#x27;Change&#x27;</span>:-<span class="number">0.46</span>, <span class="string">&#x27;Volume&#x27;</span>: <span class="number">935000</span>&#125;,</span><br><span class="line">		]</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;my.csv&#x27;</span>,<span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">	f_csv = csv.DictWriter(f,headers)</span><br><span class="line">	f_csv.writeheader()</span><br><span class="line">	f_csv.writerows(rows)</span><br></pre></td></tr></table></figure>



<p>csv 产生的数据都是字符串类型的，它不会做任何其他类型的转换。<br>如果你需要做这样的类型转换，你必须自己手动去实现。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">col_types = [<span class="built_in">str</span>, <span class="built_in">float</span>, <span class="built_in">str</span>, <span class="built_in">str</span>, <span class="built_in">float</span>, <span class="built_in">int</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;stocks.csv&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f_csv = csv.reader(f)</span><br><span class="line">    headers = <span class="built_in">next</span>(f_csv)</span><br><span class="line">    <span class="keyword">for</span> row <span class="keyword">in</span> f_csv:</span><br><span class="line">        <span class="comment"># Apply conversions to the row items</span></span><br><span class="line">        row = <span class="built_in">tuple</span>(convert(value) <span class="keyword">for</span> convert, value <span class="keyword">in</span> <span class="built_in">zip</span>(col_types, row))</span><br><span class="line">        <span class="built_in">print</span>(row)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">field_types = [ (<span class="string">&#x27;Price&#x27;</span>, <span class="built_in">float</span>),</span><br><span class="line">                (<span class="string">&#x27;Change&#x27;</span>, <span class="built_in">float</span>),</span><br><span class="line">                (<span class="string">&#x27;Volume&#x27;</span>, <span class="built_in">int</span>) ]</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;stocks.csv&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="keyword">for</span> row <span class="keyword">in</span> csv.DictReader(f):</span><br><span class="line">        row.update((key, conversion(row[key])) </span><br><span class="line">                   <span class="keyword">for</span> key, conversion <span class="keyword">in</span> field_types)</span><br><span class="line">        <span class="built_in">print</span>(row)</span><br></pre></td></tr></table></figure>



<h3 id="6-2-读写-JSON-数据"><a href="#6-2-读写-JSON-数据" class="headerlink" title="6.2 读写 JSON 数据"></a>6.2 读写 JSON 数据</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">data = &#123;</span><br><span class="line">	<span class="string">&#x27;name&#x27;</span> : <span class="string">&#x27;ACME&#x27;</span>,</span><br><span class="line">	<span class="string">&#x27;shares&#x27;</span> : <span class="number">100</span>,</span><br><span class="line">	<span class="string">&#x27;price&#x27;</span> : <span class="number">542.23</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">json_str = json.dumps(data)</span><br><span class="line">data = json.loads(json_str)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>在 web 应用程序中，顶层对象最好是一个<strong>字典</strong>。</p>
</blockquote>
<p>我们在获取嵌套json数据的时候可以使用pprint,使打印更美观</p>
<blockquote>
<p>pprint模块 – pretty print , 美观打印</p>
<ul>
<li> print()和pprint()<strong>功能基本一样</strong>，唯一的区别就是pprint()模块打印出来的数据结构更加完整，每行为一个数据结构，更加方便阅读打印输出结果。</li>
<li>格式化工具会生成数据结构的一些表示，不仅可以由解释器正确地解析，而且便于人类阅读。输出尽可能放在一行上，分解为多行时则需要缩进。</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pprint <span class="keyword">import</span> pprint</span><br><span class="line"></span><br><span class="line">data = (<span class="string">&quot;test&quot;</span>, [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>,<span class="string">&#x27;test&#x27;</span>, <span class="number">4</span>, <span class="number">5</span>], <span class="string">&quot;This is a string!&quot;</span>,&#123;<span class="string">&#x27;age&#x27;</span>:<span class="number">23</span>, <span class="string">&#x27;gender&#x27;</span>:<span class="string">&#x27;F&#x27;</span>&#125;)</span><br><span class="line"><span class="built_in">print</span>(data)</span><br><span class="line"><span class="comment"># (&#x27;test&#x27;, [1, 2, 3, &#x27;test&#x27;, 4, 5], &#x27;This is a string!&#x27;, &#123;&#x27;age&#x27;: 23, &#x27;gender&#x27;: &#x27;F&#x27;&#125;)</span></span><br><span class="line"></span><br><span class="line">pprint(data)</span><br><span class="line"><span class="comment"># (&#x27;test&#x27;,</span></span><br><span class="line"><span class="comment">#  [1, 2, 3, &#x27;test&#x27;, 4, 5],</span></span><br><span class="line"><span class="comment">#  &#x27;This is a string!&#x27;,</span></span><br><span class="line"><span class="comment">#  &#123;&#x27;age&#x27;: 23, &#x27;gender&#x27;: &#x27;F&#x27;&#125;)</span></span><br></pre></td></tr></table></figure>
</blockquote>
<p>我们还可以使用<code>object_pairs_hook</code>参数,迅速修改类型:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> OrderedDict</span><br><span class="line"></span><br><span class="line">s = <span class="string">&#x27;&#123;&quot;name&quot;: &quot;ACME&quot;, &quot;shares&quot;: 50, &quot;price&quot;: 490.1&#125;&#x27;</span></span><br><span class="line">data = json.loads(s)</span><br><span class="line"><span class="built_in">print</span>(data)</span><br><span class="line"><span class="comment"># &#123;&#x27;name&#x27;: &#x27;ACME&#x27;, &#x27;shares&#x27;: 50, &#x27;price&#x27;: 490.1&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用object_pairs_hook将其转为OrderedDict</span></span><br><span class="line">data = json.loads(s,object_pairs_hook=OrderedDict)</span><br><span class="line"><span class="built_in">print</span>(data)</span><br><span class="line"><span class="comment"># OrderedDict([(&#x27;name&#x27;, &#x27;ACME&#x27;), (&#x27;shares&#x27;, 50), (&#x27;price&#x27;, 490.1)])</span></span><br></pre></td></tr></table></figure>

<p>json是不支持序列化实例对象的,不过我们可以设计一个函数<strong>将实例对象的属性制作成字典,反序列化的时候再赋值回去</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">serialize_instance</span>(<span class="params">obj</span>):</span></span><br><span class="line">	d = &#123; <span class="string">&#x27;__classname__&#x27;</span> : <span class="built_in">type</span>(obj).__name__ &#125;</span><br><span class="line">	d.update(<span class="built_in">vars</span>(obj))</span><br><span class="line">	<span class="keyword">return</span> d</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">unserialize_object</span>(<span class="params">d</span>):</span></span><br><span class="line">	clsname = d.pop(<span class="string">&#x27;__classname__&#x27;</span>, <span class="literal">None</span>)</span><br><span class="line">	<span class="keyword">if</span> clsname:</span><br><span class="line">		cls = classes[clsname]</span><br><span class="line">		obj = cls.__new__(cls) <span class="comment"># Make instance without calling __init__</span></span><br><span class="line">		<span class="keyword">for</span> key, value <span class="keyword">in</span> d.items():</span><br><span class="line">			<span class="built_in">setattr</span>(obj, key, value)</span><br><span class="line">		<span class="keyword">return</span> obj</span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		<span class="keyword">return</span> d</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, name</span>):</span></span><br><span class="line">		self.name = name</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">classes = &#123;</span><br><span class="line">	<span class="string">&quot;Person&quot;</span>: Person</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">me = Person(<span class="string">&#x27;heyingliang&#x27;</span>)</span><br><span class="line"></span><br><span class="line">j = json.dumps(me,default=serialize_instance)</span><br><span class="line"><span class="built_in">print</span>(j)</span><br><span class="line"><span class="comment"># &#123;&quot;__classname__&quot;: &quot;Person&quot;, &quot;name&quot;: &quot;heyingliang&quot;&#125;</span></span><br><span class="line"></span><br><span class="line">a = json.loads(j,object_hook=unserialize_object)</span><br><span class="line"><span class="built_in">print</span>(a)</span><br><span class="line"><span class="comment"># &lt;__main__.Person object at 0x000001FF1750AC18&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(a.name)</span><br><span class="line"><span class="comment"># heyingliang</span></span><br></pre></td></tr></table></figure>



<h3 id="6-3-解析简单的-XML-数据"><a href="#6-3-解析简单的-XML-数据" class="headerlink" title="6.3 解析简单的 XML 数据"></a>6.3 解析简单的 XML 数据</h3><p>使用 xml.etree.ElementTree 模块</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> urllib.request <span class="keyword">import</span> urlopen</span><br><span class="line"><span class="keyword">from</span> xml.etree.ElementTree <span class="keyword">import</span> parse</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Download the RSS feed and parse it</span></span><br><span class="line">u = urlopen(<span class="string">&#x27;http://planet.python.org/rss20.xml&#x27;</span>)</span><br><span class="line">doc = parse(u)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Extract and output tags of interest</span></span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> doc.iterfind(<span class="string">&#x27;channel/item&#x27;</span>):</span><br><span class="line">	title = item.findtext(<span class="string">&#x27;title&#x27;</span>)</span><br><span class="line">	date = item.findtext(<span class="string">&#x27;pubDate&#x27;</span>)</span><br><span class="line">	link = item.findtext(<span class="string">&#x27;link&#x27;</span>)</span><br><span class="line">	<span class="built_in">print</span>(title)</span><br><span class="line">	<span class="built_in">print</span>(date)</span><br><span class="line">	<span class="built_in">print</span>(link)</span><br><span class="line">	<span class="built_in">print</span>()</span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li>doc代表根标签</li>
<li>doc.iterfind(‘channel/item’)表示 : 寻找channel标签下的item标签</li>
</ul>
</blockquote>
<p>有两种解析器 :</p>
<ul>
<li>from xml.etree.ElementTree import parse</li>
<li>from xml.etree.cElementTree import parse</li>
</ul>
<blockquote>
<p>cElementTree 是C语言实现的,ElementTree 是python实现的.</p>
<p>尽量使用C语言版</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">from</span> xml.etree.cElementTree <span class="keyword">import</span> parse</span><br><span class="line"><span class="keyword">except</span> ImportError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="keyword">from</span> xml.etree.ElementTree <span class="keyword">import</span> parse</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="6-4-增量式解析大型-XML-文件"><a href="#6-4-增量式解析大型-XML-文件" class="headerlink" title="6.4 增量式解析大型 XML 文件"></a>6.4 增量式解析大型 XML 文件</h3><p>使用迭代器和生成器</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> xml.etree.ElementTree <span class="keyword">import</span> iterparse</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">parse_and_remove</span>(<span class="params">filename, path</span>):</span></span><br><span class="line">    path_parts = path.split(<span class="string">&#x27;/&#x27;</span>)</span><br><span class="line">    doc = iterparse(filename, (<span class="string">&#x27;start&#x27;</span>, <span class="string">&#x27;end&#x27;</span>))</span><br><span class="line">    <span class="comment"># Skip the root element</span></span><br><span class="line">    <span class="built_in">next</span>(doc)</span><br><span class="line"></span><br><span class="line">    tag_stack = []</span><br><span class="line">    elem_stack = []</span><br><span class="line">    <span class="keyword">for</span> event, elem <span class="keyword">in</span> doc:</span><br><span class="line">        <span class="keyword">if</span> event == <span class="string">&#x27;start&#x27;</span>:</span><br><span class="line">            tag_stack.append(elem.tag)</span><br><span class="line">            elem_stack.append(elem)</span><br><span class="line">        <span class="keyword">elif</span> event == <span class="string">&#x27;end&#x27;</span>:</span><br><span class="line">            <span class="keyword">if</span> tag_stack == path_parts:</span><br><span class="line">                <span class="keyword">yield</span> elem</span><br><span class="line">                elem_stack[-<span class="number">2</span>].remove(elem)</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                tag_stack.pop()</span><br><span class="line">                elem_stack.pop()</span><br><span class="line">            <span class="keyword">except</span> IndexError:</span><br><span class="line">                <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Find zip code with most potholes</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> Counter</span><br><span class="line">potholes_by_zip = Counter()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> pothole <span class="keyword">in</span> parse_and_remove(<span class="string">&#x27;potholes.xml&#x27;</span>, <span class="string">&#x27;row/row&#x27;</span>):</span><br><span class="line">    potholes_by_zip[pothole.findtext(<span class="string">&#x27;zip&#x27;</span>)] += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> zipcode, num <span class="keyword">in</span> potholes_by_zip.most_common():</span><br><span class="line">    <span class="built_in">print</span>(zipcode, num)</span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li>iterparse() 方法允许对 XML 文档进行增量操作。</li>
<li>使用时，你需要提供文件名和一个包含下面一种或多种类型的事件列表：start , end, start-ns 和 end-ns 。</li>
<li>由 iterparse() 创建的迭代器会产生形如 (event, elem) 的元组，其中 event 是上述事件列表中的某一个，而 elem 是相应的 XML 元素。</li>
</ul>
</blockquote>
<h3 id="6-5-将字典转换为-XML"><a href="#6-5-将字典转换为-XML" class="headerlink" title="6.5 将字典转换为 XML"></a>6.5 将字典转换为 XML</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> xml.etree.ElementTree <span class="keyword">import</span> Element</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dict_to_xml</span>(<span class="params">tag, d</span>):</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">Turn a simple dict of key/value pairs into XML</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">	elem = Element(tag)</span><br><span class="line">	<span class="keyword">for</span> key, val <span class="keyword">in</span> d.items():</span><br><span class="line">		child = Element(key)</span><br><span class="line">		child.text = <span class="built_in">str</span>(val)</span><br><span class="line">		elem.append(child)</span><br><span class="line">	<span class="keyword">return</span> elem</span><br></pre></td></tr></table></figure>



<h3 id="6-6-解析和修改-XML"><a href="#6-6-解析和修改-XML" class="headerlink" title="6.6 解析和修改 XML"></a>6.6 解析和修改 XML</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> xml.etree.ElementTree <span class="keyword">import</span> parse, Element</span><br></pre></td></tr></table></figure>



<h3 id="6-7-利用命名空间解析-XML-文档"><a href="#6-7-利用命名空间解析-XML-文档" class="headerlink" title="6.7 利用命名空间解析 XML 文档"></a>6.7 利用命名空间解析 XML 文档</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">XMLNamespaces</span>:</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, **kwargs</span>):</span></span><br><span class="line">		self.namespaces = &#123;&#125;</span><br><span class="line">		<span class="keyword">for</span> name, uri <span class="keyword">in</span> kwargs.items():</span><br><span class="line">			self.register(name, uri)</span><br><span class="line">			</span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">register</span>(<span class="params">self, name, uri</span>):</span></span><br><span class="line">		self.namespaces[name] = <span class="string">&#x27;&#123;&#x27;</span>+uri+<span class="string">&#x27;&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__call__</span>(<span class="params">self, path</span>):</span></span><br><span class="line">		<span class="keyword">return</span> path.format_map(self.namespaces)</span><br></pre></td></tr></table></figure>



<h3 id="6-8-与关系型数据库的交互"><a href="#6-8-与关系型数据库的交互" class="headerlink" title="6.8 与关系型数据库的交互"></a>6.8 与关系型数据库的交互</h3><p>sqlite3 模块</p>
<ol>
<li>连接到数据库 : connect() 函数</li>
<li>创建一个游标 : .cursor() 函数</li>
<li>执行语句 : execute() 函数</li>
<li>提交语句 : commit() 函数</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sqlite3</span><br><span class="line"></span><br><span class="line">db = sqlite3.connect(<span class="string">&#x27;database.db&#x27;</span>)</span><br><span class="line">c = db.cursor()</span><br><span class="line">c.execute(<span class="string">&#x27;create table portfolio (symbol text, shares integer, pricereal)&#x27;</span>)</span><br></pre></td></tr></table></figure>



<h3 id="6-9-编码和解码十六进制数"><a href="#6-9-编码和解码十六进制数" class="headerlink" title="6.9 编码和解码十六进制数"></a>6.9 编码和解码十六进制数</h3><ul>
<li>将一个十六进制字符串解码成一个字节字符串</li>
<li>将一个字节字符串编码成一个十六进制字符串。</li>
</ul>
<p>binascii模块。</p>
<blockquote>
<p>binascii : 二进制数据和asccii数据的互换</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"></span><br><span class="line">s = <span class="string">b&#x27;hello&#x27;</span></span><br><span class="line">h = binascii.b2a_hex(s)</span><br><span class="line"><span class="built_in">print</span>(h)  <span class="comment"># b&#x27;68656c6c6f&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(binascii.a2b_hex(h))  <span class="comment"># b&#x27;hello&#x27;</span></span><br></pre></td></tr></table></figure>



<h3 id="6-10-编码解码-Base64-数据"><a href="#6-10-编码解码-Base64-数据" class="headerlink" title="6.10 编码解码 Base64 数据"></a>6.10 编码解码 Base64 数据</h3><blockquote>
<ul>
<li>base64是一种用64个可打印字符编码任意二进制的方法。</li>
<li>Base64的出现是为了解决不同编码（ASCII、GBK、Unicode等）导致的问题。各国语言不一样，计算机系统中所使用的字符编码不一样</li>
<li>说白了,和ascii,utf8一样,<strong>base64就是一种编码方案</strong>,</li>
</ul>
</blockquote>
<p>base64 模块中两个函数 b64encode() and b64decode()</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">s = <span class="string">b&#x27;hello&#x27;</span></span><br><span class="line">a = base64.b64encode(s)</span><br><span class="line"><span class="built_in">print</span>(a)  <span class="comment"># b&#x27;aGVsbG8=&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(base64.b64decode(a))  <span class="comment"># b&#x27;hello&#x27;</span></span><br></pre></td></tr></table></figure>



<h3 id="6-11-读写二进制数组数据"><a href="#6-11-读写二进制数组数据" class="headerlink" title="6.11 读写二进制数组数据"></a>6.11 读写二进制数组数据</h3><p>读写一个二进制数组的结构化数据到 Python 元组中</p>
<p>使用 struct 模块处理二进制数据</p>
<blockquote>
<p>对于需要<strong>编码和解码二进制数据</strong>的程序而言，通常会使用 struct 模块。</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> struct <span class="keyword">import</span> Struct</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将元组序列写入结构的二进制文件</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">write_records</span>(<span class="params">records, <span class="built_in">format</span>, f</span>):</span></span><br><span class="line">	record_struct = Struct(<span class="built_in">format</span>)</span><br><span class="line">	<span class="keyword">for</span> r <span class="keyword">in</span> records:</span><br><span class="line">		f.write(record_struct.pack(*r))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">	records = [ (<span class="number">1</span>, <span class="number">2.3</span>, <span class="number">4.5</span>),</span><br><span class="line">				(<span class="number">6</span>, <span class="number">7.8</span>, <span class="number">9.0</span>),</span><br><span class="line">				(<span class="number">12</span>, <span class="number">13.4</span>, <span class="number">56.7</span>) ]</span><br><span class="line"></span><br><span class="line">	<span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;data.b&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">		write_records(records, <span class="string">&#x27;&lt;idd&#x27;</span>, f)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> struct <span class="keyword">import</span> Struct</span><br><span class="line"></span><br><span class="line"><span class="comment"># 从二进制文件 以块状形式 读取出元组</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">read_records</span>(<span class="params"><span class="built_in">format</span>, f</span>):</span></span><br><span class="line">	record_struct = Struct(<span class="built_in">format</span>)</span><br><span class="line">	chunks = <span class="built_in">iter</span>(<span class="keyword">lambda</span>: f.read(record_struct.size), <span class="string">b&#x27;&#x27;</span>)</span><br><span class="line">	<span class="comment"># 返回生成器</span></span><br><span class="line">	<span class="keyword">return</span> (record_struct.unpack(chunk) <span class="keyword">for</span> chunk <span class="keyword">in</span> chunks)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">	<span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;data.b&#x27;</span>,<span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">		<span class="keyword">for</span> rec <span class="keyword">in</span> read_records(<span class="string">&#x27;&lt;idd&#x27;</span>, f):</span><br><span class="line">			<span class="keyword">pass</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> struct <span class="keyword">import</span> Struct</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将整个文件一次性读取到一个字节字符串</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">unpack_records</span>(<span class="params"><span class="built_in">format</span>, data</span>):</span></span><br><span class="line">	record_struct = Struct(<span class="built_in">format</span>)</span><br><span class="line">	<span class="comment"># 读取整个长度</span></span><br><span class="line">	<span class="keyword">return</span> (record_struct.unpack_from(data, offset)</span><br><span class="line">			<span class="keyword">for</span> offset <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(data), record_struct.size))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">	<span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;data.b&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">		data = f.read()</span><br><span class="line">	<span class="keyword">for</span> rec <span class="keyword">in</span> unpack_records(<span class="string">&#x27;&lt;idd&#x27;</span>, data):</span><br><span class="line">		<span class="keyword">pass</span></span><br></pre></td></tr></table></figure>



<h3 id="6-12-读取嵌套和可变长二进制数据"><a href="#6-12-读取嵌套和可变长二进制数据" class="headerlink" title="6.12 读取嵌套和可变长二进制数据"></a>6.12 读取嵌套和可变长二进制数据</h3><p>struct 模块可被用来编码/解码几乎所有类型的二进制的数据结构。</p>
<p>很难,看不懂,略</p>
<h3 id="6-13-数据的累加与统计操作"><a href="#6-13-数据的累加与统计操作" class="headerlink" title="6.13 数据的累加与统计操作"></a>6.13 数据的累加与统计操作</h3><p>处理一个很大的数据集并需要计算数据总和或其他统计量。</p>
<p>Pandas 库 </p>
</div></div><div class="post-main post-comment"></div></article><link rel="stylesheet" type="text/css" href="/css/font.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.css"><script src="//cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script><script src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script>$(document).ready(function() {
  $(".fancybox").fancybox();
});
</script></body></html>
<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content=" id=&quot;第14章-数据分析案例&quot;&gt;&lt;a href=&quot;#第14章-数据分析案例&quot; class=&quot;headerlink&quot; title=&quot;第14章 数据分析案例&quot;&gt;&lt;/a&gt;第14章 数据分析案例&lt;/h1&gt;&lt;h2 id=&quot;14-1-来⾃Bitly的USA-gov数据&quot;&gt;&lt;a href=&quot;#14-1-来⾃Bitly的USA-gov数据&quot; class=&quot;headerlink&quot; title=&quot;14.1 来⾃Bitly的USA.gov数据&quot;&gt;&lt;/a&gt;14.1 来⾃Bitly的USA.gov数据&lt;/h2&gt;&lt;p&gt;读取json数据:"><link rel="stylesheet" type="text/css" href="/css/normalize.css"><link rel="stylesheet" type="text/css" href="/css/highlight.css"><link rel="stylesheet" type="text/css" href="/css/noise.css"><title>利用Python进行数据分析11_第14章_数据分析案例 | 凉薄的自动书记人偶</title><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><meta name="generator" content="Hexo 5.4.0"></head><body><article class="wrapper"><div class="post-main"><div class="nav"><nav class="container"><a class="sidebar-nav-item active" href="/">Home</a><a class="sidebar-nav-item" href="/archives">Tags</a><a class="sidebar-nav-item" href="/About">About</a></nav><div class="container post-meta"><div class="post-tags"><a class="post-tag-link" href="/tags/Python/" rel="tag">Python</a></div><div class="post-time">2019-05-15</div></div></div><div class="container post-header"><h1>利用Python进行数据分析11_第14章_数据分析案例</h1></div><div class="container post-toc"><details class="toc"><summary class="toc-accordion">Table of Contents</summary><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC14%E7%AB%A0-%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90%E6%A1%88%E4%BE%8B"><span class="toc-number">1.</span> <span class="toc-text">第14章 数据分析案例</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#14-1-%E6%9D%A5%E2%BE%83Bitly%E7%9A%84USA-gov%E6%95%B0%E6%8D%AE"><span class="toc-number">1.1.</span> <span class="toc-text">14.1 来⾃Bitly的USA.gov数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#14-2-MovieLens-1M%E6%95%B0%E6%8D%AE%E9%9B%86"><span class="toc-number">1.2.</span> <span class="toc-text">14.2 MovieLens 1M数据集</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#14-3-1880-2010%E5%B9%B4%E9%97%B4%E5%85%A8%E7%BE%8E%E5%A9%B4%E2%BC%89%E5%A7%93%E5%90%8D"><span class="toc-number">1.3.</span> <span class="toc-text">14.3 1880-2010年间全美婴⼉姓名</span></a></li></ol></li></ol></details></div><div class="container post-content"><h1 id="第14章-数据分析案例"><a href="#第14章-数据分析案例" class="headerlink" title="第14章 数据分析案例"></a>第14章 数据分析案例</h1><h2 id="14-1-来⾃Bitly的USA-gov数据"><a href="#14-1-来⾃Bitly的USA-gov数据" class="headerlink" title="14.1 来⾃Bitly的USA.gov数据"></a>14.1 来⾃Bitly的USA.gov数据</h2><p>读取json数据:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">path = <span class="string">&#x27;datasets/bitly_usagov/example.txt&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">open</span>(path).readline())</span><br><span class="line"><span class="comment"># &#123; &quot;a&quot;: &quot;Mozilla\/5.0 (Windows NT 6.1; WOW64) AppleWebKit\</span></span><br><span class="line"><span class="comment"># /535.11 (KHTML, like Gecko) Chrome\/17.0.963.78 Safari\</span></span><br><span class="line"><span class="comment"># /535.11&quot;, &quot;c&quot;: &quot;US&quot;, &quot;nk&quot;: 1, &quot;tz&quot;: &quot;America\/New_York&quot;,</span></span><br><span class="line"><span class="comment">#  &quot;gr&quot;: &quot;MA&quot;, &quot;g&quot;: &quot;A6qOVH&quot;, &quot;h&quot;: &quot;wfLQtf&quot;, &quot;l&quot;: &quot;orofrog&quot;,</span></span><br><span class="line"><span class="comment">#   &quot;al&quot;: &quot;en-US,en;q=0.8&quot;, &quot;hh&quot;: &quot;1.usa.gov&quot;, &quot;r&quot;: </span></span><br><span class="line"><span class="comment">#   &quot;http:\/\/www.facebook.com\/l\/7AQEFzjSi\/1.usa.gov\/wfLQtf&quot;, &quot;u&quot;: </span></span><br><span class="line"><span class="comment">#   &quot;http:\/\/www.ncbi.nlm.nih.gov\/pubmed\/22415991&quot;, &quot;t&quot;: 1331923247, </span></span><br><span class="line"><span class="comment">#   &quot;hc&quot;: 1331822918, &quot;cy&quot;: &quot;Danvers&quot;, &quot;ll&quot;: [ 42.576698, -70.954903 ] &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(path) <span class="keyword">as</span> f:</span><br><span class="line">	records = [json.loads(line) <span class="keyword">for</span> line <span class="keyword">in</span> f.readlines()]</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(records[<span class="number">0</span>])</span><br><span class="line"><span class="comment"># &#123;&#x27;a&#x27;: &#x27;Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/535.11 (KHTML, like Gecko) Chrome/17.0.963.78 Safari/535.11&#x27;, </span></span><br><span class="line"><span class="comment"># &#x27;c&#x27;: &#x27;US&#x27;, &#x27;nk&#x27;: 1, &#x27;tz&#x27;: &#x27;America/New_York&#x27;, &#x27;gr&#x27;: &#x27;MA&#x27;, &#x27;g&#x27;: &#x27;A6qOVH&#x27;, &#x27;h&#x27;: &#x27;wfLQtf&#x27;, &#x27;l&#x27;: &#x27;orofrog&#x27;,</span></span><br><span class="line"><span class="comment">#  &#x27;al&#x27;: &#x27;en-US,en;q=0.8&#x27;, &#x27;hh&#x27;: &#x27;1.usa.gov&#x27;, &#x27;r&#x27;: &#x27;http://www.facebook.com/l/7AQEFzjSi/1.usa.gov/wfLQtf&#x27;,</span></span><br><span class="line"><span class="comment">#   &#x27;u&#x27;: &#x27;http://www.ncbi.nlm.nih.gov/pubmed/22415991&#x27;, &#x27;t&#x27;: 1331923247, &#x27;hc&#x27;: 1331822918, &#x27;cy&#x27;: &#x27;Danvers&#x27;, </span></span><br><span class="line"><span class="comment">#   &#x27;ll&#x27;: [42.576698, -70.954903]&#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># records[0]就是一个字典</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(records[<span class="number">0</span>]))</span><br><span class="line"><span class="comment"># &lt;class &#x27;dict&#x27;&gt;</span></span><br></pre></td></tr></table></figure>



<p>⽤纯Python代码对时区进⾏计数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">path = <span class="string">&#x27;datasets/bitly_usagov/example.txt&#x27;</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(path) <span class="keyword">as</span> f:</span><br><span class="line">	records = [json.loads(line) <span class="keyword">for</span> line <span class="keyword">in</span> f.readlines()]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 因为并不是所有的字典都有tz键,所以先判断一下</span></span><br><span class="line">time_zones = [rec[<span class="string">&#x27;tz&#x27;</span>] <span class="keyword">for</span> rec <span class="keyword">in</span> records <span class="keyword">if</span> <span class="string">&#x27;tz&#x27;</span> <span class="keyword">in</span> rec]</span><br><span class="line"><span class="comment"># 结果在存在空值</span></span><br><span class="line"><span class="built_in">print</span>(time_zones[:<span class="number">10</span>])</span><br><span class="line"><span class="comment"># [&#x27;America/New_York&#x27;, &#x27;America/Denver&#x27;, &#x27;America/New_York&#x27;, </span></span><br><span class="line"><span class="comment"># &#x27;America/Sao_Paulo&#x27;, &#x27;America/New_York&#x27;, &#x27;America/New_York&#x27;, </span></span><br><span class="line"><span class="comment"># &#x27;Europe/Warsaw&#x27;, &#x27;&#x27;, &#x27;&#x27;, &#x27;&#x27;]</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> defaultdict</span><br><span class="line"></span><br><span class="line"><span class="comment"># 对序列计数</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_counts</span>(<span class="params">sequence</span>):</span></span><br><span class="line">	<span class="comment"># # values will initialize to 0</span></span><br><span class="line">    counts = defaultdict(<span class="built_in">int</span>) </span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> sequence:</span><br><span class="line">        counts[x] += <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> counts</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">counts = get_counts(time_zones)</span><br><span class="line"><span class="built_in">print</span>(counts[<span class="string">&#x27;America/New_York&#x27;</span>])</span><br><span class="line"><span class="comment"># 1251</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 对全部的时区计数</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(time_zones))</span><br><span class="line"><span class="comment"># 3440</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 得到前n位的时区及其计数值</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">top_counts</span>(<span class="params">count_dict, n=<span class="number">10</span></span>):</span></span><br><span class="line">    value_key_pairs = [(count, tz) <span class="keyword">for</span> tz, count <span class="keyword">in</span> count_dict.items()]</span><br><span class="line">    value_key_pairs.sort()</span><br><span class="line">    <span class="keyword">return</span> value_key_pairs[-n:]</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(top_counts(counts))</span><br><span class="line"><span class="comment"># [(33, &#x27;America/Sao_Paulo&#x27;), (35, &#x27;Europe/Madrid&#x27;),...]</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> Counter</span><br><span class="line">counts = Counter(time_zones)</span><br><span class="line"><span class="built_in">print</span>(counts.most_common(<span class="number">10</span>))</span><br><span class="line"><span class="comment"># [(&#x27;America/New_York&#x27;, 1251), (&#x27;&#x27;, 521), ...]</span></span><br></pre></td></tr></table></figure>



<p>⽤pandas对时区进⾏计数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">path = <span class="string">&#x27;datasets/bitly_usagov/example.txt&#x27;</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(path) <span class="keyword">as</span> f:</span><br><span class="line">	records = [json.loads(line) <span class="keyword">for</span> line <span class="keyword">in</span> f.readlines()]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">frame = pd.DataFrame(records)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(frame.info())</span><br><span class="line"><span class="comment"># &lt;class &#x27;pandas.core.frame.DataFrame&#x27;&gt;</span></span><br><span class="line"><span class="comment"># RangeIndex: 3560 entries, 0 to 3559</span></span><br><span class="line"><span class="comment"># Data columns (total 18 columns):</span></span><br><span class="line"><span class="comment"># _heartbeat_    120 non-null float64</span></span><br><span class="line"><span class="comment"># a              3440 non-null object</span></span><br><span class="line"><span class="comment"># al             3094 non-null object</span></span><br><span class="line"><span class="comment"># c              2919 non-null object</span></span><br><span class="line"><span class="comment"># cy             2919 non-null object</span></span><br><span class="line"><span class="comment"># g              3440 non-null object</span></span><br><span class="line"><span class="comment"># gr             2919 non-null object</span></span><br><span class="line"><span class="comment"># h              3440 non-null object</span></span><br><span class="line"><span class="comment"># hc             3440 non-null float64</span></span><br><span class="line"><span class="comment"># hh             3440 non-null object</span></span><br><span class="line"><span class="comment"># kw             93 non-null object</span></span><br><span class="line"><span class="comment"># l              3440 non-null object</span></span><br><span class="line"><span class="comment"># ll             2919 non-null object</span></span><br><span class="line"><span class="comment"># nk             3440 non-null float64</span></span><br><span class="line"><span class="comment"># r              3440 non-null object</span></span><br><span class="line"><span class="comment"># t              3440 non-null float64</span></span><br><span class="line"><span class="comment"># tz             3440 non-null object</span></span><br><span class="line"><span class="comment"># u              3440 non-null object</span></span><br><span class="line"><span class="comment"># dtypes: float64(4), object(14)</span></span><br><span class="line"><span class="comment"># memory usage: 500.7+ KB</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取tx列的前10个.(对应之前代码:获取每个字典的tz键的值)</span></span><br><span class="line"><span class="built_in">print</span>(frame[<span class="string">&#x27;tz&#x27;</span>][:<span class="number">10</span>])</span><br><span class="line"><span class="comment"># 0     America/New_York</span></span><br><span class="line"><span class="comment"># 1       America/Denver</span></span><br><span class="line"><span class="comment"># 2     America/New_York</span></span><br><span class="line"><span class="comment"># 3    America/Sao_Paulo</span></span><br><span class="line"><span class="comment"># 4     America/New_York</span></span><br><span class="line"><span class="comment"># 5     America/New_York</span></span><br><span class="line"><span class="comment"># 6        Europe/Warsaw</span></span><br><span class="line"><span class="comment"># 7                     </span></span><br><span class="line"><span class="comment"># 8                     </span></span><br><span class="line"><span class="comment"># 9                     </span></span><br><span class="line"><span class="comment"># Name: tz, dtype: object</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 对tz列根据值计数</span></span><br><span class="line">tz_counts = frame[<span class="string">&#x27;tz&#x27;</span>].value_counts()</span><br><span class="line"><span class="built_in">print</span>(tz_counts[:<span class="number">10</span>])</span><br><span class="line"><span class="comment"># America/New_York       1251</span></span><br><span class="line"><span class="comment">#                         521</span></span><br><span class="line"><span class="comment"># America/Chicago         400</span></span><br><span class="line"><span class="comment"># America/Los_Angeles     382</span></span><br><span class="line"><span class="comment"># America/Denver          191</span></span><br><span class="line"><span class="comment"># Europe/London            74</span></span><br><span class="line"><span class="comment"># Asia/Tokyo               37</span></span><br><span class="line"><span class="comment"># Pacific/Honolulu         36</span></span><br><span class="line"><span class="comment"># Europe/Madrid            35</span></span><br><span class="line"><span class="comment"># America/Sao_Paulo        33</span></span><br><span class="line"><span class="comment"># Name: tz, dtype: int64</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 填充NA</span></span><br><span class="line">clean_tz = frame[<span class="string">&#x27;tz&#x27;</span>].fillna(<span class="string">&#x27;Missing&#x27;</span>)</span><br><span class="line"><span class="comment"># 空字符串改为Unkown</span></span><br><span class="line">clean_tz[clean_tz == <span class="string">&#x27;&#x27;</span>] = <span class="string">&#x27;Unknown&#x27;</span></span><br><span class="line">tz_counts = clean_tz.value_counts()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 清洗后的数据</span></span><br><span class="line"><span class="built_in">print</span>(tz_counts[:<span class="number">10</span>])</span><br><span class="line"><span class="comment"># America/New_York       1251</span></span><br><span class="line"><span class="comment"># Unknown                 521</span></span><br><span class="line"><span class="comment"># America/Chicago         400</span></span><br><span class="line"><span class="comment"># America/Los_Angeles     382</span></span><br><span class="line"><span class="comment"># America/Denver          191</span></span><br><span class="line"><span class="comment"># Missing                 120</span></span><br><span class="line"><span class="comment"># Europe/London            74</span></span><br><span class="line"><span class="comment"># Asia/Tokyo               37</span></span><br><span class="line"><span class="comment"># Pacific/Honolulu         36</span></span><br><span class="line"><span class="comment"># Europe/Madrid            35</span></span><br><span class="line"><span class="comment"># Name: tz, dtype: int64</span></span><br></pre></td></tr></table></figure>

<p>我们可以⽤matplotlib可视化这个数据</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> seaborn <span class="keyword">as</span> sns</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">subset = tz_counts[:<span class="number">10</span>]</span><br><span class="line">sns.barplot(y=subset.index, x=subset.values)</span><br><span class="line"></span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>

<p><img src="/images/1557920958047.png" alt="1557920958047"></p>
<p>继续做后续处理:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 将a列截短一点</span></span><br><span class="line">results = pd.Series([x.split()[<span class="number">0</span>] <span class="keyword">for</span> x <span class="keyword">in</span> frame.a.dropna()])</span><br><span class="line"><span class="built_in">print</span>(results[:<span class="number">5</span>])</span><br><span class="line"><span class="comment"># 0               Mozilla/5.0</span></span><br><span class="line"><span class="comment"># 1    GoogleMaps/RochesterNY</span></span><br><span class="line"><span class="comment"># 2               Mozilla/4.0</span></span><br><span class="line"><span class="comment"># 3               Mozilla/5.0</span></span><br><span class="line"><span class="comment"># 4               Mozilla/5.0</span></span><br><span class="line"><span class="comment"># dtype: object</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(results.value_counts()[:<span class="number">8</span>])</span><br><span class="line"><span class="comment"># Mozilla/5.0                 2594</span></span><br><span class="line"><span class="comment"># Mozilla/4.0                  601</span></span><br><span class="line"><span class="comment"># GoogleMaps/RochesterNY       121</span></span><br><span class="line"><span class="comment"># Opera/9.80                    34</span></span><br><span class="line"><span class="comment"># TEST_INTERNET_AGENT           24</span></span><br><span class="line"><span class="comment"># GoogleProducer                21</span></span><br><span class="line"><span class="comment"># Mozilla/6.0                    5</span></span><br><span class="line"><span class="comment"># BlackBerry8520/5.0.0.681       4</span></span><br><span class="line"><span class="comment"># dtype: int64</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="comment"># 丢弃a列为空的行</span></span><br><span class="line">cframe = frame[frame.a.notnull()]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 按Windows和⾮Windows⽤户添加一个os列</span></span><br><span class="line">cframe[<span class="string">&#x27;os&#x27;</span>] = np.where(cframe[<span class="string">&#x27;a&#x27;</span>].<span class="built_in">str</span>.contains(<span class="string">&#x27;Windows&#x27;</span>),<span class="string">&#x27;Windows&#x27;</span>, <span class="string">&#x27;Not Windows&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(cframe[<span class="string">&#x27;os&#x27;</span>][:<span class="number">5</span>])</span><br><span class="line"><span class="comment"># 0        Windows</span></span><br><span class="line"><span class="comment"># 1    Not Windows</span></span><br><span class="line"><span class="comment"># 2        Windows</span></span><br><span class="line"><span class="comment"># 3    Not Windows</span></span><br><span class="line"><span class="comment"># 4        Windows</span></span><br><span class="line"><span class="comment"># Name: os, dtype: object</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 按时区和系统分组操作</span></span><br><span class="line">by_tz_os = cframe.groupby([<span class="string">&#x27;tz&#x27;</span>, <span class="string">&#x27;os&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用size计数</span></span><br><span class="line">agg_counts = by_tz_os.size().unstack().fillna(<span class="number">0</span>)</span><br><span class="line"><span class="built_in">print</span>(agg_counts[:<span class="number">10</span>])</span><br><span class="line"><span class="comment"># os                              Not Windows  Windows</span></span><br><span class="line"><span class="comment"># tz                                                  </span></span><br><span class="line"><span class="comment">#                                       245.0    276.0</span></span><br><span class="line"><span class="comment"># Africa/Cairo                            0.0      3.0</span></span><br><span class="line"><span class="comment"># Africa/Casablanca                       0.0      1.0</span></span><br><span class="line"><span class="comment"># Africa/Ceuta                            0.0      2.0</span></span><br><span class="line"><span class="comment"># Africa/Johannesburg                     0.0      1.0</span></span><br><span class="line"><span class="comment"># Africa/Lusaka                           0.0      1.0</span></span><br><span class="line"><span class="comment"># America/Anchorage                       4.0      1.0</span></span><br><span class="line"><span class="comment"># America/Argentina/Buenos_Aires          1.0      0.0</span></span><br><span class="line"><span class="comment"># America/Argentina/Cordoba               0.0      1.0</span></span><br><span class="line"><span class="comment"># America/Argentina/Mendoza               0.0      1.0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 排序(升序)</span></span><br><span class="line">indexer = agg_counts.<span class="built_in">sum</span>(<span class="number">1</span>).argsort()</span><br><span class="line"><span class="built_in">print</span>(indexer[:<span class="number">10</span>])</span><br><span class="line"><span class="comment"># tz</span></span><br><span class="line"><span class="comment">#                                   24</span></span><br><span class="line"><span class="comment"># Africa/Cairo                      20</span></span><br><span class="line"><span class="comment"># Africa/Casablanca                 21</span></span><br><span class="line"><span class="comment"># Africa/Ceuta                      92</span></span><br><span class="line"><span class="comment"># Africa/Johannesburg               87</span></span><br><span class="line"><span class="comment"># Africa/Lusaka                     53</span></span><br><span class="line"><span class="comment"># America/Anchorage                 54</span></span><br><span class="line"><span class="comment"># America/Argentina/Buenos_Aires    57</span></span><br><span class="line"><span class="comment"># America/Argentina/Cordoba         26</span></span><br><span class="line"><span class="comment"># America/Argentina/Mendoza         55</span></span><br><span class="line"><span class="comment"># dtype: int64</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 截取最后10⾏最⼤值：</span></span><br><span class="line">count_subset = agg_counts.take(indexer[-<span class="number">10</span>:])</span><br><span class="line"><span class="built_in">print</span>(count_subset)</span><br><span class="line"><span class="comment"># os                   Not Windows  Windows</span></span><br><span class="line"><span class="comment"># tz                                       </span></span><br><span class="line"><span class="comment"># America/Sao_Paulo           13.0     20.0</span></span><br><span class="line"><span class="comment"># Europe/Madrid               16.0     19.0</span></span><br><span class="line"><span class="comment"># Pacific/Honolulu             0.0     36.0</span></span><br><span class="line"><span class="comment"># Asia/Tokyo                   2.0     35.0</span></span><br><span class="line"><span class="comment"># Europe/London               43.0     31.0</span></span><br><span class="line"><span class="comment"># America/Denver             132.0     59.0</span></span><br><span class="line"><span class="comment"># America/Los_Angeles        130.0    252.0</span></span><br><span class="line"><span class="comment"># America/Chicago            115.0    285.0</span></span><br><span class="line"><span class="comment">#                            245.0    276.0</span></span><br><span class="line"><span class="comment"># America/New_York           339.0    912.0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># nlargest即n largest:最大的n个值</span></span><br><span class="line"><span class="built_in">print</span>(agg_counts.<span class="built_in">sum</span>(<span class="number">1</span>).nlargest(<span class="number">10</span>))</span><br><span class="line"><span class="comment"># tz</span></span><br><span class="line"><span class="comment"># America/New_York       1251.0</span></span><br><span class="line"><span class="comment">#                         521.0</span></span><br><span class="line"><span class="comment"># America/Chicago         400.0</span></span><br><span class="line"><span class="comment"># America/Los_Angeles     382.0</span></span><br><span class="line"><span class="comment"># America/Denver          191.0</span></span><br><span class="line"><span class="comment"># Europe/London            74.0</span></span><br><span class="line"><span class="comment"># Asia/Tokyo               37.0</span></span><br><span class="line"><span class="comment"># Pacific/Honolulu         36.0</span></span><br><span class="line"><span class="comment"># Europe/Madrid            35.0</span></span><br><span class="line"><span class="comment"># America/Sao_Paulo        33.0</span></span><br><span class="line"><span class="comment"># dtype: float64</span></span><br></pre></td></tr></table></figure>

<p>我们将数据制作成图:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 重新排列数据以便绘图</span></span><br><span class="line">count_subset = count_subset.stack()</span><br><span class="line">count_subset.name = <span class="string">&#x27;total&#x27;</span></span><br><span class="line">count_subset = count_subset.reset_index()</span><br><span class="line"><span class="built_in">print</span>(count_subset[:<span class="number">10</span>])</span><br><span class="line"><span class="comment">#                   tz           os  total</span></span><br><span class="line"><span class="comment"># 0  America/Sao_Paulo  Not Windows   13.0</span></span><br><span class="line"><span class="comment"># 1  America/Sao_Paulo      Windows   20.0</span></span><br><span class="line"><span class="comment"># 2      Europe/Madrid  Not Windows   16.0</span></span><br><span class="line"><span class="comment"># 3      Europe/Madrid      Windows   19.0</span></span><br><span class="line"><span class="comment"># 4   Pacific/Honolulu  Not Windows    0.0</span></span><br><span class="line"><span class="comment"># 5   Pacific/Honolulu      Windows   36.0</span></span><br><span class="line"><span class="comment"># 6         Asia/Tokyo  Not Windows    2.0</span></span><br><span class="line"><span class="comment"># 7         Asia/Tokyo      Windows   35.0</span></span><br><span class="line"><span class="comment"># 8      Europe/London  Not Windows   43.0</span></span><br><span class="line"><span class="comment"># 9      Europe/London      Windows   31.0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 最常出现时区的Windows和非Windows⽤户</span></span><br><span class="line">sns.barplot(x=<span class="string">&#x27;total&#x27;</span>, y=<span class="string">&#x27;tz&#x27;</span>, hue=<span class="string">&#x27;os&#x27;</span>,  data=count_subset)</span><br><span class="line"></span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>

<p><img src="/images/1557922486137.png" alt="1557922486137"></p>
<p>最常出现时区的Windows和⾮Windows⽤户的百分⽐</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">norm_total</span>(<span class="params">group</span>):</span></span><br><span class="line">    group[<span class="string">&#x27;normed_total&#x27;</span>] = group.total / group.total.<span class="built_in">sum</span>()</span><br><span class="line">    <span class="keyword">return</span> group</span><br><span class="line"></span><br><span class="line">results = count_subset.groupby(<span class="string">&#x27;tz&#x27;</span>).apply(norm_total)</span><br><span class="line"></span><br><span class="line">sns.barplot(x=<span class="string">&#x27;normed_total&#x27;</span>, y=<span class="string">&#x27;tz&#x27;</span>, hue=<span class="string">&#x27;os&#x27;</span>,  data=results)</span><br><span class="line"></span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>

<p><img src="/images/1557922581414.png" alt="1557922581414"></p>
<hr>
<h2 id="14-2-MovieLens-1M数据集"><a href="#14-2-MovieLens-1M数据集" class="headerlink" title="14.2 MovieLens 1M数据集"></a>14.2 MovieLens 1M数据集</h2><p>数据准备:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line"><span class="comment"># 缩小显示</span></span><br><span class="line">pd.options.display.max_rows = <span class="number">10</span></span><br><span class="line"></span><br><span class="line">unames = [<span class="string">&#x27;user_id&#x27;</span>, <span class="string">&#x27;gender&#x27;</span>, <span class="string">&#x27;age&#x27;</span>, <span class="string">&#x27;occupation&#x27;</span>, <span class="string">&#x27;zip&#x27;</span>]</span><br><span class="line">users = pd.read_table(<span class="string">&#x27;datasets/movielens/users.dat&#x27;</span>, sep=<span class="string">&#x27;::&#x27;</span>,</span><br><span class="line">                      header=<span class="literal">None</span>, names=unames)</span><br><span class="line"></span><br><span class="line">rnames = [<span class="string">&#x27;user_id&#x27;</span>, <span class="string">&#x27;movie_id&#x27;</span>, <span class="string">&#x27;rating&#x27;</span>, <span class="string">&#x27;timestamp&#x27;</span>]</span><br><span class="line">ratings = pd.read_table(<span class="string">&#x27;datasets/movielens/ratings.dat&#x27;</span>, sep=<span class="string">&#x27;::&#x27;</span>,</span><br><span class="line">                        header=<span class="literal">None</span>, names=rnames)</span><br><span class="line"></span><br><span class="line">mnames = [<span class="string">&#x27;movie_id&#x27;</span>, <span class="string">&#x27;title&#x27;</span>, <span class="string">&#x27;genres&#x27;</span>]</span><br><span class="line">movies = pd.read_table(<span class="string">&#x27;datasets/movielens/movies.dat&#x27;</span>, sep=<span class="string">&#x27;::&#x27;</span>,</span><br><span class="line">                       header=<span class="literal">None</span>, names=mnames)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(users[:<span class="number">5</span>])</span><br><span class="line"><span class="comment">#    user_id gender  age  occupation    zip</span></span><br><span class="line"><span class="comment"># 0        1      F    1          10  48067</span></span><br><span class="line"><span class="comment"># 1        2      M   56          16  70072</span></span><br><span class="line"><span class="comment"># 2        3      M   25          15  55117</span></span><br><span class="line"><span class="comment"># 3        4      M   45           7  02460</span></span><br><span class="line"><span class="comment"># 4        5      M   25          20  55455</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(ratings[:<span class="number">5</span>])</span><br><span class="line"><span class="comment">#    user_id  movie_id  rating  timestamp</span></span><br><span class="line"><span class="comment"># 0        1      1193       5  978300760</span></span><br><span class="line"><span class="comment"># 1        1       661       3  978302109</span></span><br><span class="line"><span class="comment"># 2        1       914       3  978301968</span></span><br><span class="line"><span class="comment"># 3        1      3408       4  978300275</span></span><br><span class="line"><span class="comment"># 4        1      2355       5  978824291</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(movies[:<span class="number">5</span>])</span><br><span class="line"><span class="comment">#    movie_id              ...                                     genres</span></span><br><span class="line"><span class="comment"># 0         1              ...                Animation|Children&#x27;s|Comedy</span></span><br><span class="line"><span class="comment"># 1         2              ...               Adventure|Children&#x27;s|Fantasy</span></span><br><span class="line"><span class="comment"># 2         3              ...                             Comedy|Romance</span></span><br><span class="line"><span class="comment"># 3         4              ...                               Comedy|Drama</span></span><br><span class="line"><span class="comment"># 4         5              ...                                     Comedy</span></span><br></pre></td></tr></table></figure>

<p>女性最喜欢的电影:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># merge函数将ratings跟users合并到⼀起,然后再将movies也合并进去。</span></span><br><span class="line">data = pd.merge(pd.merge(ratings, users), movies)</span><br><span class="line"><span class="built_in">print</span>(data.iloc[<span class="number">0</span>])</span><br><span class="line"><span class="comment"># user_id                                            1</span></span><br><span class="line"><span class="comment"># movie_id                                        1193</span></span><br><span class="line"><span class="comment"># rating                                             5</span></span><br><span class="line"><span class="comment"># timestamp                                  978300760</span></span><br><span class="line"><span class="comment"># gender                                             F</span></span><br><span class="line"><span class="comment"># age                                                1</span></span><br><span class="line"><span class="comment"># occupation                                        10</span></span><br><span class="line"><span class="comment"># zip                                            48067</span></span><br><span class="line"><span class="comment"># title         One Flew Over the Cuckoo&#x27;s Nest (1975)</span></span><br><span class="line"><span class="comment"># genres                                         Drama</span></span><br><span class="line"><span class="comment"># Name: 0, dtype: object</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 按性别计算每部电影的平均得分</span></span><br><span class="line">mean_ratings = data.pivot_table(<span class="string">&#x27;rating&#x27;</span>, index=<span class="string">&#x27;title&#x27;</span>,</span><br><span class="line">                                columns=<span class="string">&#x27;gender&#x27;</span>, aggfunc=<span class="string">&#x27;mean&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(mean_ratings[:<span class="number">5</span>])</span><br><span class="line"><span class="comment"># gender                                F         M</span></span><br><span class="line"><span class="comment"># title                                            </span></span><br><span class="line"><span class="comment"># $1,000,000 Duck (1971)         3.375000  2.761905</span></span><br><span class="line"><span class="comment"># &#x27;Night Mother (1986)           3.388889  3.352941</span></span><br><span class="line"><span class="comment"># &#x27;Til There Was You (1997)      2.675676  2.733333</span></span><br><span class="line"><span class="comment"># &#x27;burbs, The (1989)             2.793478  2.962085</span></span><br><span class="line"><span class="comment"># ...And Justice for All (1979)  3.828571  3.689024</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ratings_by_title = data.groupby(<span class="string">&#x27;title&#x27;</span>).size()</span><br><span class="line"><span class="built_in">print</span>(ratings_by_title[:<span class="number">10</span>])</span><br><span class="line"><span class="comment"># title</span></span><br><span class="line"><span class="comment"># $1,000,000 Duck (1971)                37</span></span><br><span class="line"><span class="comment"># &#x27;Night Mother (1986)                  70</span></span><br><span class="line"><span class="comment"># &#x27;Til There Was You (1997)             52</span></span><br><span class="line"><span class="comment"># &#x27;burbs, The (1989)                   303</span></span><br><span class="line"><span class="comment"># ...And Justice for All (1979)        199</span></span><br><span class="line"><span class="comment"># 1-900 (1994)                           2</span></span><br><span class="line"><span class="comment"># 10 Things I Hate About You (1999)    700</span></span><br><span class="line"><span class="comment"># 101 Dalmatians (1961)                565</span></span><br><span class="line"><span class="comment"># 101 Dalmatians (1996)                364</span></span><br><span class="line"><span class="comment"># 12 Angry Men (1957)                  616</span></span><br><span class="line"><span class="comment"># dtype: int64</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 过滤掉评分数据不够250条的电影</span></span><br><span class="line">active_titles = ratings_by_title.index[ratings_by_title &gt;= <span class="number">250</span>]</span><br><span class="line"><span class="built_in">print</span>(active_titles)</span><br><span class="line"><span class="comment"># Index([&#x27;&#x27;burbs, The (1989)&#x27;, &#x27;10 Things I Hate About You (1999)&#x27;,</span></span><br><span class="line"><span class="comment">#        &#x27;101 Dalmatians (1961)&#x27;, &#x27;101 Dalmatians (1996)&#x27;, &#x27;12 Angry Men (1957)&#x27;,</span></span><br><span class="line"><span class="comment">#        &#x27;13th Warrior, The (1999)&#x27;, &#x27;2 Days in the Valley (1996)&#x27;,</span></span><br><span class="line"><span class="comment">#        &#x27;20,000 Leagues Under the Sea (1954)&#x27;, &#x27;2001: A Space Odyssey (1968)&#x27;,</span></span><br><span class="line"><span class="comment">#        &#x27;2010 (1984)&#x27;,</span></span><br><span class="line"><span class="comment">#        ...</span></span><br><span class="line"><span class="comment">#        &#x27;X-Men (2000)&#x27;, &#x27;Year of Living Dangerously (1982)&#x27;,</span></span><br><span class="line"><span class="comment">#        &#x27;Yellow Submarine (1968)&#x27;, &#x27;You&#x27;ve Got Mail (1998)&#x27;,</span></span><br><span class="line"><span class="comment">#        &#x27;Young Frankenstein (1974)&#x27;, &#x27;Young Guns (1988)&#x27;,</span></span><br><span class="line"><span class="comment">#        &#x27;Young Guns II (1990)&#x27;, &#x27;Young Sherlock Holmes (1985)&#x27;,</span></span><br><span class="line"><span class="comment">#        &#x27;Zero Effect (1998)&#x27;, &#x27;eXistenZ (1999)&#x27;],</span></span><br><span class="line"><span class="comment">#       dtype=&#x27;object&#x27;, name=&#x27;title&#x27;, length=1216)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 去掉评分数据不够250条的电影,再求平均值</span></span><br><span class="line">mean_ratings = mean_ratings.loc[active_titles]</span><br><span class="line"><span class="built_in">print</span>(mean_ratings)</span><br><span class="line"><span class="comment"># gender                                    F         M</span></span><br><span class="line"><span class="comment"># title                                                </span></span><br><span class="line"><span class="comment"># &#x27;burbs, The (1989)                 2.793478  2.962085</span></span><br><span class="line"><span class="comment"># 10 Things I Hate About You (1999)  3.646552  3.311966</span></span><br><span class="line"><span class="comment"># 101 Dalmatians (1961)              3.791444  3.500000</span></span><br><span class="line"><span class="comment"># 101 Dalmatians (1996)              3.240000  2.911215</span></span><br><span class="line"><span class="comment"># 12 Angry Men (1957)                4.184397  4.328421</span></span><br><span class="line"><span class="comment"># ...                                     ...       ...</span></span><br><span class="line"><span class="comment"># Young Guns (1988)                  3.371795  3.425620</span></span><br><span class="line"><span class="comment"># Young Guns II (1990)               2.934783  2.904025</span></span><br><span class="line"><span class="comment"># Young Sherlock Holmes (1985)       3.514706  3.363344</span></span><br><span class="line"><span class="comment"># Zero Effect (1998)                 3.864407  3.723140</span></span><br><span class="line"><span class="comment"># eXistenZ (1999)                    3.098592  3.289086</span></span><br><span class="line"><span class="comment"># [1216 rows x 2 columns]</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 分组排序(降序)</span></span><br><span class="line"><span class="comment"># 得出女性最喜欢的电影</span></span><br><span class="line">top_female_ratings = mean_ratings.sort_values(by=<span class="string">&#x27;F&#x27;</span>, ascending=<span class="literal">False</span>)</span><br><span class="line"><span class="built_in">print</span>(top_female_ratings[:<span class="number">10</span>])</span><br><span class="line"><span class="comment"># gender                                                     F         M</span></span><br><span class="line"><span class="comment"># title                                                                 </span></span><br><span class="line"><span class="comment"># Close Shave, A (1995)                               4.644444  4.473795</span></span><br><span class="line"><span class="comment"># Wrong Trousers, The (1993)                          4.588235  4.478261</span></span><br><span class="line"><span class="comment"># Sunset Blvd. (a.k.a. Sunset Boulevard) (1950)       4.572650  4.464589</span></span><br><span class="line"><span class="comment"># Wallace &amp; Gromit: The Best of Aardman Animation...  4.563107  4.385075</span></span><br><span class="line"><span class="comment"># Schindler&#x27;s List (1993)                             4.562602  4.491415</span></span><br><span class="line"><span class="comment"># Shawshank Redemption, The (1994)                    4.539075  4.560625</span></span><br><span class="line"><span class="comment"># Grand Day Out, A (1992)                             4.537879  4.293255</span></span><br><span class="line"><span class="comment"># To Kill a Mockingbird (1962)                        4.536667  4.372611</span></span><br><span class="line"><span class="comment"># Creature Comforts (1990)                            4.513889  4.272277</span></span><br><span class="line"><span class="comment"># Usual Suspects, The (1995)                          4.513317  4.518248</span></span><br></pre></td></tr></table></figure>

<p>计算评分分歧</p>
<p>假设我们想要找出男性和⼥性观众分歧最⼤的电影。⼀个办法是给mean_ratings加上⼀个⽤于存放平均得分之差的列，并对其进⾏排序：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">mean_ratings[<span class="string">&#x27;diff&#x27;</span>] = mean_ratings[<span class="string">&#x27;M&#x27;</span>] - mean_ratings[<span class="string">&#x27;F&#x27;</span>]</span><br><span class="line">sorted_by_diff = mean_ratings.sort_values(by=<span class="string">&#x27;diff&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(sorted_by_diff[:<span class="number">10</span>])</span><br><span class="line"><span class="comment"># gender                                        F         M      diff</span></span><br><span class="line"><span class="comment"># title                                                              </span></span><br><span class="line"><span class="comment"># Dirty Dancing (1987)                   3.790378  2.959596 -0.830782</span></span><br><span class="line"><span class="comment"># Jumpin&#x27; Jack Flash (1986)              3.254717  2.578358 -0.676359</span></span><br><span class="line"><span class="comment"># Grease (1978)                          3.975265  3.367041 -0.608224</span></span><br><span class="line"><span class="comment"># Little Women (1994)                    3.870588  3.321739 -0.548849</span></span><br><span class="line"><span class="comment"># Steel Magnolias (1989)                 3.901734  3.365957 -0.535777</span></span><br><span class="line"><span class="comment"># Anastasia (1997)                       3.800000  3.281609 -0.518391</span></span><br><span class="line"><span class="comment"># Rocky Horror Picture Show, The (1975)  3.673016  3.160131 -0.512885</span></span><br><span class="line"><span class="comment"># Color Purple, The (1985)               4.158192  3.659341 -0.498851</span></span><br><span class="line"><span class="comment"># Age of Innocence, The (1993)           3.827068  3.339506 -0.487561</span></span><br><span class="line"><span class="comment"># Free Willy (1993)                      2.921348  2.438776 -0.482573</span></span><br></pre></td></tr></table></figure>

<p>求标准差:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 按标题分组的评级标准差</span></span><br><span class="line">rating_std_by_title = data.groupby(<span class="string">&#x27;title&#x27;</span>)[<span class="string">&#x27;rating&#x27;</span>].std()</span><br><span class="line">rating_std_by_title = rating_std_by_title.loc[active_titles]</span><br><span class="line"><span class="comment"># 降序排列</span></span><br><span class="line"><span class="built_in">print</span>(rating_std_by_title.sort_values(ascending=<span class="literal">False</span>)[:<span class="number">10</span>])</span><br><span class="line"><span class="comment"># title</span></span><br><span class="line"><span class="comment"># Dumb &amp; Dumber (1994)                     1.321333</span></span><br><span class="line"><span class="comment"># Blair Witch Project, The (1999)          1.316368</span></span><br><span class="line"><span class="comment"># Natural Born Killers (1994)              1.307198</span></span><br><span class="line"><span class="comment"># Tank Girl (1995)                         1.277695</span></span><br><span class="line"><span class="comment"># Rocky Horror Picture Show, The (1975)    1.260177</span></span><br><span class="line"><span class="comment"># Eyes Wide Shut (1999)                    1.259624</span></span><br><span class="line"><span class="comment"># Evita (1996)                             1.253631</span></span><br><span class="line"><span class="comment"># Billy Madison (1995)                     1.249970</span></span><br><span class="line"><span class="comment"># Fear and Loathing in Las Vegas (1998)    1.246408</span></span><br><span class="line"><span class="comment"># Bicentennial Man (1999)                  1.245533</span></span><br><span class="line"><span class="comment"># Name: rating, dtype: float64</span></span><br></pre></td></tr></table></figure>



<hr>
<h2 id="14-3-1880-2010年间全美婴⼉姓名"><a href="#14-3-1880-2010年间全美婴⼉姓名" class="headerlink" title="14.3 1880-2010年间全美婴⼉姓名"></a>14.3 1880-2010年间全美婴⼉姓名</h2></div></div></article><link rel="stylesheet" type="text/css" href="/css/font.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.css"><script src="//cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script><script src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script>$(document).ready(function() {
  $(".fancybox").fancybox();
});
</script></body></html>
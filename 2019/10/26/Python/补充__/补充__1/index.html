<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content=" id=&quot;del-的坑&quot;&gt;&lt;a href=&quot;#del-的坑&quot; class=&quot;headerlink&quot; title=&quot;__del__的坑&quot;&gt;&lt;/a&gt;__del__的坑&lt;/h3&gt;&lt;blockquote&gt;
&lt;p&gt;del是删除引用。&lt;br&gt;对象引用为0的时候会调用&lt;code&gt;__del__&lt;/code&gt;。"><link rel="stylesheet" type="text/css" href="/css/normalize.css"><link rel="stylesheet" type="text/css" href="/css/highlight.css"><link rel="stylesheet" type="text/css" href="/css/noise.css"><title>1 | 凉薄的自动书记人偶</title><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><meta name="generator" content="Hexo 5.4.0"></head><body><article class="wrapper"><div class="post-main"><div class="nav"><nav class="container"><a class="sidebar-nav-item active" href="/">Home</a><a class="sidebar-nav-item" href="/archives">Tags</a><a class="sidebar-nav-item" href="/About">About</a></nav><div class="container post-meta"><div class="post-tags"><a class="post-tag-link" href="/tags/Python/" rel="tag">Python</a></div><div class="post-time">2019-10-26</div></div></div><div class="container post-header"><h1>1</h1></div><div class="container post-toc"><details class="toc"><summary class="toc-accordion">Table of Contents</summary><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#del-%E7%9A%84%E5%9D%91"><span class="toc-number">1.</span> <span class="toc-text">__del__的坑</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%B4%E6%8E%A5%E5%B0%86%E6%96%87%E4%BB%B6%E6%95%B0%E6%8D%AE%E8%AF%BB%E5%8F%96%E5%88%B0%E7%BC%93%E5%86%B2%E5%8C%BA"><span class="toc-number">2.</span> <span class="toc-text">直接将文件数据读取到缓冲区</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F"><span class="toc-number">3.</span> <span class="toc-text">单例模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#enumerate%E5%87%BD%E6%95%B0"><span class="toc-number">4.</span> <span class="toc-text">enumerate函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%91%E7%9A%84%E9%81%8D%E5%8E%86"><span class="toc-number">5.</span> <span class="toc-text">树的遍历</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#lambda%E9%85%8D%E5%90%88sorted%E7%9A%84key%E5%8F%82%E6%95%B0"><span class="toc-number">6.</span> <span class="toc-text">lambda配合sorted的key参数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Python%E7%9A%84%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86"><span class="toc-number">7.</span> <span class="toc-text">Python的内存管理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#0-%E5%9C%B0%E5%9D%80"><span class="toc-number">7.1.</span> <span class="toc-text">0. 地址</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-Python%E5%8F%98%E9%87%8F%E3%80%81%E5%AF%B9%E8%B1%A1%E3%80%81%E5%BC%95%E7%94%A8%E3%80%81%E5%AD%98%E5%82%A8"><span class="toc-number">7.2.</span> <span class="toc-text">1. Python变量、对象、引用、存储</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-Python%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86%E6%9C%BA%E5%88%B6%E5%92%8C%E6%93%8D%E4%BD%9C%E5%AF%B9%E5%8F%98%E9%87%8F%E7%9A%84%E5%BD%B1%E5%93%8D"><span class="toc-number">7.3.</span> <span class="toc-text">2. Python内存管理机制和操作对变量的影响</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#2-1-%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86%E6%9C%BA%E5%88%B6"><span class="toc-number">7.3.1.</span> <span class="toc-text">2.1 内存管理机制</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2-2-%E5%90%84%E7%A7%8D%E6%93%8D%E4%BD%9C%E5%AF%B9%E5%8F%98%E9%87%8F%E5%9C%B0%E5%9D%80%E7%9A%84%E6%94%B9%E5%8F%98"><span class="toc-number">7.3.2.</span> <span class="toc-text">2.2 各种操作对变量地址的改变</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E5%86%85%E5%AD%98%E6%B1%A0%E6%9C%BA%E5%88%B6"><span class="toc-number">7.4.</span> <span class="toc-text">3. 内存池机制</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-%E6%80%BB%E7%BB%93"><span class="toc-number">7.5.</span> <span class="toc-text">4. 总结</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A8%A1%E5%9D%97%E5%92%8C%E5%8C%85%E7%9A%84%E5%AF%BC%E5%85%A5%E6%9C%BA%E5%88%B6"><span class="toc-number">8.</span> <span class="toc-text">模块和包的导入机制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Python%E7%9A%84%E5%87%BD%E6%95%B0%E9%87%8D%E8%BD%BD%E6%9C%BA%E5%88%B6"><span class="toc-number">9.</span> <span class="toc-text">Python的函数重载机制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-number">10.</span> <span class="toc-text"></span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F"><span class="toc-number">11.</span> <span class="toc-text">代码执行顺序</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%8C%E6%AD%A5%E5%BC%82%E6%AD%A5-%E9%98%BB%E5%A1%9E%E9%9D%9E%E9%98%BB%E5%A1%9E%E4%B8%BE%E4%BE%8B"><span class="toc-number">12.</span> <span class="toc-text">同步异步,阻塞非阻塞举例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%9B%E7%A8%8B%E9%87%8C%E7%9A%84Queue"><span class="toc-number">13.</span> <span class="toc-text">进程里的Queue</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%89%B9%E6%80%A7%E4%B8%8E%E6%8F%8F%E8%BF%B0%E7%AC%A6"><span class="toc-number">14.</span> <span class="toc-text">特性与描述符</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%83%B5%E5%B0%B8%E8%BF%9B%E7%A8%8B%E4%B8%8E%E5%AD%A4%E5%84%BF%E8%BF%9B%E7%A8%8B"><span class="toc-number">15.</span> <span class="toc-text">僵尸进程与孤儿进程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Linux-%E4%BA%94%E7%A7%8DIO%E6%A8%A1%E5%9E%8B"><span class="toc-number">16.</span> <span class="toc-text">Linux 五种IO模型</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%94%A8%E6%88%B7%E7%A9%BA%E9%97%B4%E4%B8%8E%E5%86%85%E6%A0%B8%E7%A9%BA%E9%97%B4"><span class="toc-number">16.1.</span> <span class="toc-text">用户空间与内核空间</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%9B%E7%A8%8B%E5%88%87%E6%8D%A2"><span class="toc-number">16.2.</span> <span class="toc-text">进程切换</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%9B%E7%A8%8B%E7%9A%84%E9%98%BB%E5%A1%9E"><span class="toc-number">16.3.</span> <span class="toc-text">进程的阻塞</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E6%8F%8F%E8%BF%B0%E7%AC%A6"><span class="toc-number">16.4.</span> <span class="toc-text">文件描述符</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%93%E5%AD%98-IO"><span class="toc-number">16.5.</span> <span class="toc-text">缓存 IO</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Linux-IO%E6%A8%A1%E5%9E%8B"><span class="toc-number">16.6.</span> <span class="toc-text">Linux IO模型</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#I-O%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8%E6%8A%80%E6%9C%AF-multiplexing"><span class="toc-number">17.</span> <span class="toc-text">I&#x2F;O多路复用技术(multiplexing)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E7%9A%84%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F"><span class="toc-number">18.</span> <span class="toc-text">常用的设计模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F"><span class="toc-number">18.1.</span> <span class="toc-text">简单工厂模式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B7%A5%E5%8E%82%E6%96%B9%E6%B3%95%E6%A8%A1%E5%BC%8F"><span class="toc-number">18.2.</span> <span class="toc-text">工厂方法模式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8A%BD%E8%B1%A1%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F"><span class="toc-number">18.3.</span> <span class="toc-text">抽象工厂模式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BB%BA%E9%80%A0%E8%80%85%E6%A8%A1%E5%BC%8F"><span class="toc-number">18.4.</span> <span class="toc-text">建造者模式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8E%9F%E5%9E%8B%E6%A8%A1%E5%BC%8F"><span class="toc-number">18.5.</span> <span class="toc-text">原型模式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F-1"><span class="toc-number">18.6.</span> <span class="toc-text">单例模式</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%BA%94%E7%94%A8"><span class="toc-number">18.6.1.</span> <span class="toc-text">单例模式的应用</span></a></li></ol></li></ol></li></ol></details></div><div class="container post-content"><h3 id="del-的坑"><a href="#del-的坑" class="headerlink" title="__del__的坑"></a>__del__的坑</h3><blockquote>
<p>del是删除引用。<br>对象引用为0的时候会调用<code>__del__</code>。</p>
<p>如果在程序结束时,有些对象还存在(引用未到0),那么python解释器一样会自动调用它们的<code>__del__</code>方法来完成清理工作</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Hero</span>:</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__del__</span>(<span class="params">self</span>):</span></span><br><span class="line">		<span class="built_in">print</span>(<span class="string">&#x27;英雄已阵亡&#x27;</span>)</span><br><span class="line"></span><br><span class="line">man1 = Hero()</span><br><span class="line">man2 = man1</span><br><span class="line"></span><br><span class="line"><span class="keyword">del</span> man1</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;-------&#x27;</span>)</span><br><span class="line"><span class="keyword">del</span> man2</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;end&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># -------</span></span><br><span class="line"><span class="comment"># 英雄已阵亡</span></span><br><span class="line"><span class="comment"># end</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Hero</span>:</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__del__</span>(<span class="params">self</span>):</span></span><br><span class="line">		<span class="built_in">print</span>(<span class="string">&#x27;英雄已阵亡&#x27;</span>)</span><br><span class="line"></span><br><span class="line">man1 = Hero()</span><br><span class="line">man2 = man1</span><br><span class="line"></span><br><span class="line"><span class="keyword">del</span> man1</span><br><span class="line"><span class="comment"># 英雄已阵亡</span></span><br></pre></td></tr></table></figure>



<h3 id="直接将文件数据读取到缓冲区"><a href="#直接将文件数据读取到缓冲区" class="headerlink" title="直接将文件数据读取到缓冲区"></a>直接将文件数据读取到缓冲区</h3><blockquote>
<p>file.readinto(buf,size) : <strong>读取size个字节到文件缓冲器中</strong></p>
<ul>
<li>和普通 read() 方法不同的是，==readinto() 填充已存在的缓冲区而不是为新对象重新分配内存再返回它们。==</li>
<li><strong>有点像json.load,直接将文件数据读取到操作对象中,不必先读取到内容再到操作对象</strong>.因此，你可以使用它来避免大量的内存分配操作。</li>
</ul>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os.path</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">read_into_buffer</span>(<span class="params">filename</span>):</span></span><br><span class="line">    <span class="comment"># 新建一个缓冲器</span></span><br><span class="line">	buf = <span class="built_in">bytearray</span>(os.path.getsize(filename))</span><br><span class="line">	<span class="keyword">with</span> <span class="built_in">open</span>(filename, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">		<span class="comment"># 将数据填充进缓冲器中</span></span><br><span class="line">		f.readinto(buf)</span><br><span class="line">	<span class="keyword">return</span> buf</span><br><span class="line"></span><br><span class="line">buf = read_into_buffer(<span class="string">&#x27;sample.bin&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(buf)  <span class="comment"># bytearray(b&#x27;Hello World&#x27;)</span></span><br><span class="line"></span><br><span class="line">buf[<span class="number">0</span>:<span class="number">5</span>] = <span class="string">b&#x27;XXXXX&#x27;</span></span><br><span class="line">pirnt(buf)  <span class="comment"># bytearray(b&#x27;XXXXX World&#x27;)</span></span><br></pre></td></tr></table></figure>



<h3 id="单例模式"><a href="#单例模式" class="headerlink" title="单例模式"></a>单例模式</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>:</span></span><br><span class="line">    __instance = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__new__</span>(<span class="params">cls,*args,**kwargs</span>):</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> cls.__instance:</span><br><span class="line">            cls.__instance = <span class="built_in">super</span>().__new__(cls)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> cls.__instance</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self,name,age</span>):</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.age = age</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">A = Person(<span class="string">&#x27;A&#x27;</span>,<span class="number">21</span>)</span><br><span class="line">B = Person(<span class="string">&#x27;B&#x27;</span>,<span class="number">21</span>)</span><br><span class="line">C = Person(<span class="string">&#x27;C&#x27;</span>,<span class="number">21</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">id</span>(A)) <span class="comment"># 1925052742064</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">id</span>(B)) <span class="comment"># 1925052742064</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">id</span>(C)) <span class="comment"># 1925052742064</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>:</span></span><br><span class="line">    __instance = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__new__</span>(<span class="params">cls,*args,**kwargs</span>):</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> cls.__instance:</span><br><span class="line">            cls.__instance = <span class="built_in">super</span>().__new__(cls)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> cls.__instance</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span>(<span class="params">Person</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self,name,age,major</span>):</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.age = age</span><br><span class="line">        self.major = major</span><br><span class="line"></span><br><span class="line">s1 = Student(<span class="string">&#x27;hyl1&#x27;</span>,<span class="number">21</span>,<span class="string">&#x27;ds&#x27;</span>)</span><br><span class="line">s2 = Student(<span class="string">&#x27;hyl2&#x27;</span>,<span class="number">21</span>,<span class="string">&#x27;ds&#x27;</span>)</span><br><span class="line">s3 = Student(<span class="string">&#x27;hyl3&#x27;</span>,<span class="number">21</span>,<span class="string">&#x27;ds&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">id</span>(s1)) <span class="comment"># 2624760568464</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">id</span>(s2)) <span class="comment"># 2624760568464</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">id</span>(s3)) <span class="comment"># 2624760568464</span></span><br></pre></td></tr></table></figure>



<h3 id="enumerate函数"><a href="#enumerate函数" class="headerlink" title="enumerate函数"></a>enumerate函数</h3><blockquote>
<p>enumerate一般有两种作用</p>
<ul>
<li>方便迭代idx</li>
<li>方便计数</li>
</ul>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">alist = [<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;c&#x27;</span>,<span class="string">&#x27;d&#x27;</span>,<span class="string">&#x27;e&#x27;</span>,<span class="string">&#x27;f&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> char,idx <span class="keyword">in</span> <span class="built_in">enumerate</span>(alist,<span class="number">1</span>):</span><br><span class="line">    <span class="built_in">print</span>(char,idx)</span><br><span class="line"><span class="comment"># 1 a</span></span><br><span class="line"><span class="comment"># 2 b</span></span><br><span class="line"><span class="comment"># 3 c</span></span><br><span class="line"><span class="comment"># 4 d</span></span><br><span class="line"><span class="comment"># 5 e</span></span><br><span class="line"><span class="comment"># 6 f</span></span><br></pre></td></tr></table></figure>



<h3 id="树的遍历"><a href="#树的遍历" class="headerlink" title="树的遍历"></a>树的遍历</h3><ul>
<li>先序遍历：<br>在第一次遍历到节点时就执行操作，一般只是想遍历执行操作（或输出结果）可选用先序遍历；</li>
<li>中序遍历：<br><strong>对于二分搜索树，中序遍历的操作顺序（或输出结果顺序）是符合从小到大（或从大到小）顺序的</strong>，故要遍历输出排序好的结果需要使用中序遍历</li>
<li>后序遍历：<br>后续遍历的特点是执行操作时，肯定已经遍历过该节点的左右子节点，故适用于要进行破坏性操作的情况，比如<strong>删除所有节点</strong></li>
</ul>
<blockquote>
<p>一棵表达式树,中序遍历是他的中缀表达式,先序遍历是他的前缀表达式,后序遍历是他的后缀表达式</p>
</blockquote>
<h3 id="lambda配合sorted的key参数"><a href="#lambda配合sorted的key参数" class="headerlink" title="lambda配合sorted的key参数"></a>lambda配合sorted的key参数</h3><p>正数从小到大，负数从大到小</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">alist = [-<span class="number">5</span>,<span class="number">8</span>,<span class="number">0</span>,<span class="number">4</span>,<span class="number">9</span>,-<span class="number">4</span>,-<span class="number">20</span>,-<span class="number">2</span>,<span class="number">8</span>,<span class="number">2</span>,-<span class="number">4</span>]</span><br><span class="line">res = <span class="built_in">sorted</span>(alist,key=<span class="keyword">lambda</span> x:(x&lt;<span class="number">0</span> ,<span class="built_in">abs</span>(x)))</span><br><span class="line"><span class="built_in">print</span>(res)  <span class="comment"># [0, 2, 4, 8, 8, 9, -2, -4, -4, -5, -20]</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 列表嵌套字典的排序，根据年龄和姓名排序</span></span><br><span class="line"><span class="comment"># 年龄主要,姓名次要</span></span><br><span class="line"></span><br><span class="line">foo = [</span><br><span class="line">    &#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;zs&quot;</span>,<span class="string">&quot;age&quot;</span>:<span class="number">19</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;ll&quot;</span>,<span class="string">&quot;age&quot;</span>:<span class="number">54</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;wa&quot;</span>,<span class="string">&quot;age&quot;</span>:<span class="number">17</span>&#125;,</span><br><span class="line">    &#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;df&quot;</span>,<span class="string">&quot;age&quot;</span>:<span class="number">23</span>&#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">res = <span class="built_in">sorted</span>(foo,key=<span class="keyword">lambda</span> x:(x[<span class="string">&#x27;name&#x27;</span>],x[<span class="string">&#x27;age&#x27;</span>]))</span><br><span class="line"><span class="built_in">print</span>(res)  <span class="comment"># [&#123;&#x27;name&#x27;: &#x27;df&#x27;, &#x27;age&#x27;: 23&#125;, &#123;&#x27;name&#x27;: &#x27;ll&#x27;, &#x27;age&#x27;: 54&#125;, &#123;&#x27;name&#x27;: &#x27;wa&#x27;, &#x27;age&#x27;: 17&#125;, &#123;&#x27;name&#x27;: &#x27;zs&#x27;, &#x27;age&#x27;: 19&#125;]</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 列表嵌套元组，分别按字母和数字排序</span></span><br><span class="line">foo = [(<span class="string">&#x27;zs&#x27;</span>,<span class="number">19</span>),(<span class="string">&#x27;wa&#x27;</span>,<span class="number">17</span>),(<span class="string">&#x27;ll&#x27;</span>,<span class="number">54</span>),(<span class="string">&#x27;df&#x27;</span>,<span class="number">23</span>),]</span><br><span class="line">res = <span class="built_in">sorted</span>(foo,key=<span class="keyword">lambda</span> x: (x[<span class="number">0</span>],x[<span class="number">1</span>]))</span><br><span class="line"><span class="built_in">print</span>(res)  <span class="comment"># [(&#x27;df&#x27;, 23), (&#x27;ll&#x27;, 54), (&#x27;wa&#x27;, 17), (&#x27;zs&#x27;, 19)]</span></span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li>元组支持大小比较</li>
<li>给key传入元组就可以实现主要关键字和次要关键字</li>
</ul>
</blockquote>
<h3 id="Python的内存管理"><a href="#Python的内存管理" class="headerlink" title="Python的内存管理"></a>Python的内存管理</h3><h4 id="0-地址"><a href="#0-地址" class="headerlink" title="0. 地址"></a>0. <a target="_blank" rel="noopener" href="https://chenrudan.github.io/blog/2016/04/23/pythonmemorycontrol.html">地址</a></h4><h4 id="1-Python变量、对象、引用、存储"><a href="#1-Python变量、对象、引用、存储" class="headerlink" title="1. Python变量、对象、引用、存储"></a>1. Python变量、对象、引用、存储</h4><ul>
<li><p>python语言是一种解释性的编程语言，它不同于一些传统的编译语言，不<strong>是先编译成汇编再编程机器码</strong>，而是==在运行的过程中，逐句将指令解释成机器码==，</p>
</li>
<li><p>所以造就了python语言一些特别的地方。例如a=1，其中a是变量，1是对象。这里所谓的变量，它的意义类似一个指针，它本身是没有类型的，只有它指向的那个对象是什么类型，它才是什么类型，一旦把它指到别的地方，它的类型就变了，现在指向的是1，它的类型可以认为是int，假如接下来执行a=2.5，那么变量的类型就变了。甚至当先给a=1，a=a+1时，a的地址也会改变。而这里的1,2.5或者一个list一个dict就是一个被实例化的对象，<strong>对象拥有真正的资源与取值，当一个变量指向某个对象，被称为这个对象的产生了一个引用</strong>，一个对象可以有多个变量指向它，有多个引用。而一个变量可以随时指向另外的对象。同时一个变量可以指向另外一个变量，那么它们指向的那个对象的引用就增加了一个。</p>
</li>
<li><p>Python有个特别的机制，它会<strong>在解释器启动的时候事先分配好一些缓冲区</strong>，这些缓冲区部分是固定好取值，例如整数[-5,256]的内存地址是固定的。这块区域称为<code>小整数缓冲池</code></p>
<blockquote>
<p>这里的固定指这一次程序启动之后，这些数字在这个程序中的内存地址就不变了，但是启动新的python程序，两次的内存地址不一样</p>
<p><img src="/images/1565096817043.png" alt="1565096817043"></p>
</blockquote>
</li>
<li><p>有的缓冲区就可以重复利用。这样的机制就使得不需要python频繁的调用内存malloc和free。</p>
<blockquote>
<ul>
<li>针对string类型，它也有自己的缓冲区，也是分为固定缓冲区和可重复缓冲区，<strong>固定的是256个ASCII码字符</strong>。</li>
<li>一个有意思的现象 : 如果string中<strong>只有字母和数字</strong>，那么对a和b赋同样的值，它们的内存地址都相同。但是如果string对象中有其他字符，那么对两个变量赋相同的string值，它们的内存地址还是不一样的。</li>
</ul>
<p><img src="/images/1565143350889.png" alt="1565143350889"></p>
</blockquote>
</li>
<li><p>dict和list的缓冲区也是事先分配好，大小为80个对象。</p>
</li>
</ul>
<blockquote>
<p>因此<strong>变量的存储有三个区域</strong></p>
<ul>
<li>事先分配的静态内存</li>
<li>事先分配的可重复利用内存</li>
<li>需要通过malloc和free来控制的自由内存</li>
</ul>
</blockquote>
<h4 id="2-Python内存管理机制和操作对变量的影响"><a href="#2-Python内存管理机制和操作对变量的影响" class="headerlink" title="2. Python内存管理机制和操作对变量的影响"></a>2. Python内存管理机制和操作对变量的影响</h4><h5 id="2-1-内存管理机制"><a href="#2-1-内存管理机制" class="headerlink" title="2.1 内存管理机制"></a>2.1 内存管理机制</h5><ul>
<li><p>python的内存在底层也是由malloc和free的方式来分配和释放，只是它代替程序员决定什么时候分配什么时候释放，同时也提供接口让用户手动释放，因此它有自己的一套内存管理体系，主要通过两种机制来实现，一个是<code>引用计数</code>，一个是<code>垃圾回收</code>。前者负责确定当前变量是否需要释放，后者解决前者解决不了的循环引用问题以及提供手动释放的接口</p>
</li>
<li><p>引用计数(reference counting) :<br>针对可以重复利用的内存缓冲区和内存，python使用了一种引用计数的方式来控制和判断某块内存是否已经没有再被使用。即每个对象都有一个计数器count，记住了有多少个变量指向这个对象，当这个对象的引用计数器为0时，<strong>假如这个对象在缓冲区内，那么它地址空间不会被释放，而是等待下一次被使用，而非缓冲区的该释放就释放</strong>。</p>
<blockquote>
<p>可以使用sys.getrefcount来获取引用计数:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">a = [<span class="string">&#x27;dsz&#x27;</span>,<span class="string">&#x27;czj&#x27;</span>,<span class="string">&#x27;heyingliang&#x27;</span>]</span><br><span class="line"><span class="comment"># 二的原因是getrefcount本身产生一个临时引用</span></span><br><span class="line"><span class="built_in">print</span>(sys.getrefcount(a))  <span class="comment"># 2</span></span><br><span class="line">b = a</span><br><span class="line"><span class="built_in">print</span>(sys.getrefcount(a))  <span class="comment"># 3</span></span><br><span class="line"></span><br><span class="line">a = <span class="number">1</span></span><br><span class="line"><span class="comment"># 因为1属于静态内存,所以有很多个引用</span></span><br><span class="line"><span class="built_in">print</span>(sys.getrefcount(a))  <span class="comment"># 120</span></span><br></pre></td></tr></table></figure></blockquote>
</li>
<li><p>垃圾回收(Garbage Collection) : </p>
<ul>
<li><p>垃圾回收时，<strong>Python不能进行其它的任务</strong>，频繁的垃圾回收将大大降低Python的工作效率</p>
</li>
<li><p>python提供了del方法来删除某个变量，它的作用是让某个对象引用数减少1。</p>
</li>
<li><p><strong>当某个对象引用数变为0时并不是直接将它从内存空间中清除掉，而是采用垃圾回收机制gc模块</strong>，当这些引用数为0的变量规模达到一定规模，就自动启动垃圾回收，将那些引用数为0的对象所占的内存空间释放。</p>
</li>
<li><p>这里gc模块采用了分代回收方法，<br>这一策略的基本假设是，<strong>存活时间越久的对象，越不可能在后面的程序中变成垃圾</strong>。</p>
<blockquote>
<p>将对象根据存活的时间分为三“代”，他们对应的是3个链表</p>
<ul>
<li>所有新建的对象都是0代，当0代对象经过一次自动垃圾回收，没有被释放的对象会被归入1代，同理1代归入2代。</li>
<li>每次当0代对象中引用数为0的对象超过700个时，启动一次0代对象扫描垃圾回收，经过10次的0代回收，就进行一次0代和1代回收，1代回收次数超过10次，就会进行一次0代、1代和2代回收。</li>
<li>这里的几个值是通过查询get_threshold()返回(700,10,10)得到的。</li>
<li>get_threshold()返回的(700, 10, 10)返回的两个10。也就是说，<strong>每10次0代垃圾回收，会配合1次1代的垃圾回收；而每10次1代的垃圾回收，才会有1次的2代垃圾回收</strong>。</li>
<li>(700,10,10)可以通过gc中的set_threshold()方法重新设置。此外，gc模块还提供了手动回收的函数，即gc.collect()。</li>
</ul>
</blockquote>
</li>
<li><p>垃圾回收还有一个重要功能是，<strong>解决循环引用</strong>的问题 :</p>
<p>通常发生在某个变量a引用了自己或者变量a与b互相引用。</p>
<blockquote>
<ul>
<li><p>考虑引用自己的情况，可以从下面的例子中看到，a所指向的内存对象有3个引用，但是实际上只有两个变量，假如把这两个变量都del掉，对象引用个数还是1，没有变成0，这种情况下，如果只有引用计数的机制，那么这块没有用的内存会一直无法释放掉。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sys <span class="keyword">import</span> getrefcount</span><br><span class="line"><span class="keyword">import</span> gc</span><br><span class="line"></span><br><span class="line">a = []</span><br><span class="line">b = a</span><br><span class="line"><span class="built_in">print</span>(getrefcount(b)) <span class="comment"># 3</span></span><br><span class="line">a.append(a)</span><br><span class="line"><span class="built_in">print</span>(getrefcount(b)) <span class="comment"># 4</span></span><br><span class="line"><span class="keyword">del</span> a</span><br><span class="line"><span class="built_in">print</span>(getrefcount(b)) <span class="comment"># 3</span></span><br><span class="line"><span class="keyword">del</span> b</span><br><span class="line">unreachable = gc.collect()</span><br><span class="line"><span class="built_in">print</span>(unreachable) <span class="comment"># 1</span></span><br></pre></td></tr></table></figure></li>
<li><p>因此python的gc模块利用了<code>标记-清除</code>法，即认为有效的对象之间能通过有向图连接起来，其中图的节点是对象，而边是引用，下图中obj代表对象，ref代表引用，从一些不能被释放的对象节点出发(称为root object，<strong>一些全局引用或者函数栈中的引用</strong>，例如下图的obj_1，箭头表示obj_1引用了obj_2)遍历各代引用数不为0的对象。</p>
<p><img src="/images/gc_graph.png" alt="img"></p>
</li>
<li><p>在python源码中，<strong>每个变量不仅有一个引用计数，还有一个有效引用计数gc_ref</strong>，后者一开始等于前者，但是启动标记清除法开始遍历对象时，从root object出发(初始图中的gc_ref为(1,1,1,1,1,1,1))，当对象i引用了对象j时，将对象j的有效引用个数减去1，这样下图中各个对象有效引用个数变为了(1, 0, 0, 0, 0, 0, 0)，接着将所有对象分配到两个表中，一个是reachable对象表，一个是unreachable对象表，<strong>root object和在图中能够直接或者间接与它们相连的对象就放入reachable</strong>，而不能通过root object访问到且有效引用个数变为0的对象作为放入unreachable，从而通过这种方式来消去循环引用的影响。</p>
</li>
<li><p>步骤 : </p>
<ol>
<li>收集所有容器对象（循环引用只针对于容器对象，其他对象不会产生循环引用），使用双向链表（可以看作一个集合）对这些对象进行引用；之所以使用双向链表是为了方便快速的在容器集合中插入和删除对象. </li>
<li>针对每一个容器对象，使用变量gc_refs来记录当前对应的应用个数；</li>
<li>对于每一个容器对象, 找到所有其引用的对象, 将被引用对象的<code>gc_refs</code>值减1.</li>
<li>执行完步骤2以后所有<code>gc_refs</code>值还大于0的对象都<strong>被非容器对象引用着</strong>, 至少存在一个非循环引用. 因此 不能释放这些对象, 将他们放入另一个集合.</li>
<li>在步骤3中不能被释放的对象, 如果他们引用着某个对象, 被引用的对象也是不能被释放的, 因此将这些 对象也放入另一个集合中.</li>
<li>此时还剩下的对象都是无法到达的对象. 现在可以释放这些对象了.</li>
</ol>
</li>
</ul>
</blockquote>
</li>
</ul>
</li>
</ul>
<h5 id="2-2-各种操作对变量地址的改变"><a href="#2-2-各种操作对变量地址的改变" class="headerlink" title="2.2 各种操作对变量地址的改变"></a>2.2 各种操作对变量地址的改变</h5><p>当处理赋值、加减乘除时，这些操作实际上导致变量指向的对象发生了改变，已经不是原来的那个对象了，并不是通过这个变量来改变它指向的对象的值。</p>
<p><img src="/images/1565145488147.png" alt="1565145488147"></p>
<ul>
<li><p>实际使用中，可能需要的是将里面的内容给复制出来到一个新的地址空间，这里可以使用python的copy模块，copy模块分为两种拷贝，一种是浅拷贝，一种是深拷贝。</p>
</li>
<li><p>假设处理一个list对象，<strong>浅拷贝调用函数copy.copy()，产生了一块新的内存来存放list中的每个元素引用，也就是说每个元素的跟原来list中元素地址是一样的</strong>。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> copy</span><br><span class="line"></span><br><span class="line">l1 = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>]</span><br><span class="line">l2 = copy.copy(l1)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 父对象id不一致</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">id</span>(l1)) <span class="comment"># 2001776215304</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">id</span>(l2)) <span class="comment"># 2001776116616</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 子对象id一致</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">id</span>(l1[<span class="number">0</span>])) <span class="comment"># 140725038870272</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">id</span>(l2[<span class="number">0</span>])) <span class="comment"># 140725038870272</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="3-内存池机制"><a href="#3-内存池机制" class="headerlink" title="3. 内存池机制"></a>3. 内存池机制</h4><blockquote>
<ul>
<li>在Python中，许多时候申请的内存都是小块的内存，这些小块内存在申请后，很快又会被释放，由于这些内存的申请并不是为了创建对象，所以并没有对象一级的内存池机制。这就意味着Python在运行期间会大量地执行malloc和free的操作，频繁地在用户态和核心态之间进行切换，这将严重影响Python的执行效率。</li>
<li>为了加速Python的执行效率，Python引入了一个内存池机制，用于管理对小块内存的申请和释放。</li>
<li>内存池的概念就是<strong>预先在内存中申请一定数量的，大小相等的内存块留作备用</strong>，当有新的内存需求时，就先从内存池中分配内存给这个需求，不够了之后再申请新的内存。这样做最显著的优势就是能够减少内存碎片，提升效率。内存池的实现方式有很多，性能和适用范围也不一样。</li>
<li>对于Python对象，如整数，浮点数和List，都有其独立的私有内存池，对象间不共享他们的内存池。也就是说如果你分配又释放了大量的整数，用于缓存这些整数的内存就不能再分配给浮点数。</li>
</ul>
</blockquote>
<p>Python中有分为大内存和小内存：（256K为界限分大小内存）</p>
<ul>
<li>大内存使用malloc进行分配</li>
<li>小内存使用内存池进行分配</li>
</ul>
<p>Python的内存池(金字塔)</p>
<ul>
<li><p>第3层：<br>最上层，用户对Python对象的直接操作</p>
</li>
<li><p>第1层和第2层：<br>内存池，有Python的接口函数PyMem_Malloc实现</p>
<blockquote>
<p>若请求分配的内存在1~256字节之间就使用内存池管理系统进行分配，调用malloc函数分配内存，但是每次只会分配一块大小为256K的大块内存，不会调用free函数释放内存，将该内存块留在内存池中以便下次使用。</p>
</blockquote>
</li>
<li><p>第0层：<br>大内存—–若请求分配的内存大于256K，malloc函数分配内存，free函数释放内存。</p>
</li>
<li><p>第-1，-2层：<br>操作系统进行操作</p>
</li>
</ul>
<h4 id="4-总结"><a href="#4-总结" class="headerlink" title="4. 总结"></a>4. 总结</h4><p>先从较浅的层面来说，Python的内存管理机制可以从三个方面来讲</p>
<ul>
<li>垃圾回收</li>
<li>引用计数</li>
<li>内存池机制</li>
</ul>
<ol>
<li><p>python的内存回收机制以引用计数为主,标记-清除和分代回收为辅</p>
</li>
<li><p>python变量的存储有三个区域</p>
<ul>
<li>事先分配的静态内存</li>
<li>事先分配的可重复利用内存</li>
<li>需要通过malloc和free来控制的自由内存</li>
</ul>
</li>
<li><p>当某个对象引用数变为0时并不是直接将它从内存空间中清除掉，而是采用垃圾回收机制gc模块，当这些引用数为0的变量规模达到一定规模，就自动启动垃圾回收，将那些引用数为0的对象所占的内存空间释放。</p>
</li>
<li><p>引用计数针对可重复利用的内存和自由内存</p>
<blockquote>
<ul>
<li>每个对象都有一个计数器count，记住了有多少个变量指向这个对象，当这个对象的引用计数器为0时</li>
<li><strong>假如这个对象在缓冲区内，那么它地址空间不会被释放，而是等待下一次被使用，而非缓冲区的该释放就释放</strong>。</li>
</ul>
</blockquote>
</li>
<li><p>分代回收方法 :</p>
<blockquote>
<p>将对象根据存活的时间分为三<code>代</code>，</p>
<ul>
<li>所有新建的对象都是0代，当0代对象经过一次自动垃圾回收，没有被释放的对象会被归入1代，同理1代归入2代。</li>
<li>每次当0代对象中引用数为0的对象超过700个时，启动一次0代对象扫描垃圾回收，经过10次的0代回收，就进行一次0代和1代回收，1代回收次数超过10次，就会进行一次0代、1代和2代回收。</li>
<li>而这里的几个值是通过查询get_threshold()返回(700,10,10)得到的。此外，gc模块还提供了手动回收的函数，即gc.collect()。</li>
</ul>
</blockquote>
</li>
<li><p>标记-清除针对解决循环引用问题 :</p>
<blockquote>
<ul>
<li>每一次分代回收都会启用标记-清除</li>
<li>每个变量不仅有一个引用计数，还有一个有效引用计数<code>gc_ref</code>，</li>
<li>后者一开始等于前者，但是启动标记清除法开始遍历对象时，从root object(一些不能被释放的对象,一些全局引用或者函数栈中的引用)出发</li>
<li>root object和在图中能够直接或者间接与它们相连的对象就放入reachable</li>
<li>而不能通过root object访问到且有效引用个数变为0的对象作为放入unreachable，从而通过这种方式来消去循环引用的影响。</li>
</ul>
</blockquote>
</li>
</ol>
<h3 id="模块和包的导入机制"><a href="#模块和包的导入机制" class="headerlink" title="模块和包的导入机制"></a>模块和包的导入机制</h3><p>模块与包的不同的：</p>
<ul>
<li>模块 :  一个 <code>.py</code> 文件就是一个模块（module）</li>
<li>包 :  <code>__init__.py</code> 文件所在<strong>目录</strong>就是包（package）</li>
</ul>
<ol>
<li><p>第一次导入模块：<br>底层做了3件事情，</p>
<ul>
<li><p>在自己的命名空间执行被导入模块中的所有代码；</p>
</li>
<li><p>以模块名为名称创建一个模块对象，并将模块中所有的顶级变量（包括变量和函数）以属性的形式绑定在该模块对象上；</p>
</li>
<li><p><strong>在import位置引入该对象名称到当前命名空间</strong>。</p>
<blockquote>
<p>这就是在当前命名空间使用被导入模块中的属性时要使用“.”语法的原因</p>
</blockquote>
</li>
</ul>
</li>
<li><p>第二次导入模块：</p>
<p>直接执行第3步，即在import位置引入该对象名称到当前命名空间。</p>
<blockquote>
<p>原因是第一次导入之后，已经将前两步执行的结果存储到内存中，第二次导入时直接到相应的内存寻找即可，不需浪费更多内存于此。因此，第二次导入速度更快，且更节省内存</p>
</blockquote>
</li>
<li><p>import M和from A import B两种导入方式在底层执行机制的异同（重点）：</p>
<ul>
<li>两种导入方式第一次导入都会执行上述3步，</li>
<li>第二次或更多次导入则只会执行第三步，所以<strong>两种导入方式没有谁比谁更节省内存之说</strong>，不要认为后者只是导入了模块中的一部分就觉得后者比较省内存，实际都是会首先执行被导入模块中的所有内容，占的内存是相同的，区别在于是拿被导入模块中的哪些部分到当前命名空间中进行使用</li>
</ul>
</li>
</ol>
<ol start="4">
<li><p>被导入模块位置的检索顺序:</p>
<ul>
<li><p>第一级是内置模块，如sys模块，这类模块优先级最高；</p>
<blockquote>
<p>这些模块在 Python 解释器启动时就加载到了 <code>sys.modules</code>中缓存起来了</p>
</blockquote>
<blockquote>
<ul>
<li>内置模块不是标准库，是指 <code>sys.builtin_module_names</code>输出的字符串元祖。</li>
<li>解释器启动时确实会加载<code>buit-in module</code>，但是，执行<code>print(sys.builtin_module_names)</code>发现，<code>os</code>并不是<code>built-in module</code>。所以，解释器执行 python 文件时，不仅仅是加载了内置模块的！！！使用<code>sys.modules</code>可以看到实际启动时加载的所有模块。</li>
</ul>
</blockquote>
</li>
<li><p>第二级是sys.path路径列表。其中sys.path路径列表路径列表由四部分组成，分别是</p>
<ol>
<li>当前目录；</li>
<li>环境变量PYTHONPATH中指定的路径列表；</li>
<li>指定路径下的.pth文件中的文件路径列表；</li>
<li>python的安装路径及其中的lib库</li>
</ol>
</li>
</ul>
</li>
<li><p>import 的实际过程十分复杂，不过其大致过程可以简化为：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">import</span>(<span class="params">module_name</span>):</span></span><br><span class="line">    <span class="comment"># sys.modules 用于缓存，避免重复 import 带来的开销</span></span><br><span class="line">    <span class="keyword">if</span> module_name <span class="keyword">in</span> sys.modules:</span><br><span class="line">        <span class="keyword">return</span> sys.modules[module_name]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        module_path = find(module_name)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> module_path:</span><br><span class="line">            module = load(module_path)</span><br><span class="line">            sys.modules[module_name] = module</span><br><span class="line">            <span class="keyword">return</span> module</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span> ImportError</span><br></pre></td></tr></table></figure></li>
<li><p>import 会生成 .pyc 文件，.pyc 文件的执行速度不比 .py 快，但是加载速度更快</p>
</li>
</ol>
<h3 id="Python的函数重载机制"><a href="#Python的函数重载机制" class="headerlink" title="Python的函数重载机制"></a>Python的函数重载机制</h3><ul>
<li><code>重载</code>（overload）和<code>覆盖</code>（override），在C++，Java，C#等静态类型语言类型语言中，这两个概念同时存在。</li>
<li>重载是为了让同一个函数名（方法名）匹配不同的参数（个数不同，类型不同）</li>
<li>覆盖是为了实现多态，在相同名称的函数（方法）和参数，在不同的类中（父类，子类），有不同的实现。</li>
</ul>
<blockquote>
<p>函数重载 : <strong>名字相同但参数类型或个数不同时执行不同的函数</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> singledispatch</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@singledispatch</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span>(<span class="params">args</span>):</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;ordinary&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@func.register(<span class="params"><span class="built_in">str</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_func</span>(<span class="params">args</span>):</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;str&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@func.register(<span class="params"><span class="built_in">int</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_func</span>(<span class="params">args</span>):</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;int&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@func.register(<span class="params"><span class="built_in">list</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_func</span>(<span class="params">args</span>):</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;list&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    func(<span class="number">1</span>)      <span class="comment"># int</span></span><br><span class="line">    func(<span class="string">&#x27;h&#x27;</span>)    <span class="comment"># str</span></span><br><span class="line">    func([<span class="number">1</span>,<span class="number">2</span>])  <span class="comment"># list</span></span><br><span class="line">    func(<span class="built_in">object</span>) <span class="comment"># ordinary</span></span><br><span class="line">    func(<span class="keyword">lambda</span> x:x)  <span class="comment"># ordinary</span></span><br></pre></td></tr></table></figure>

<ul>
<li>只要不和原函数一样 , 重载函数的名字可以顺便取.<br>(就是说这里的三个<code>_func</code>可以改为A,B,C,D)</li>
<li><code>singledispatch</code>只支持根据第一个参数的类型来重载</li>
</ul>
</blockquote>
<h3 id=""><a href="#" class="headerlink" title=""></a></h3><h3 id="代码执行顺序"><a href="#代码执行顺序" class="headerlink" title="代码执行顺序"></a>代码执行顺序</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># evalsupport.py</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;&lt;[100]&gt; evalsupport module start&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">deco_alpha</span>(<span class="params">cls</span>):</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;&lt;[200]&gt; deco_alpha&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">inner_1</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;&lt;[300]&gt; deco_alpha:inner_1&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    cls.method_y = inner_1</span><br><span class="line">    <span class="keyword">return</span> cls</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MetaAleph</span>(<span class="params"><span class="built_in">type</span></span>):</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;&lt;[400]&gt; MetaAleph body&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">cls, name, bases, dic</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;&lt;[500]&gt; MetaAleph.__init__&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">inner_2</span>(<span class="params">self</span>):</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;&lt;[600]&gt; MetaAleph.__init__:inner_2&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        cls.method_z = inner_2</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;&lt;[700]&gt; evalsupport module end&#x27;</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># evaltime.py</span></span><br><span class="line"><span class="keyword">from</span> evalsupport <span class="keyword">import</span> deco_alpha</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;&lt;[1]&gt; evaltime module start&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ClassOne</span>():</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;&lt;[2]&gt; ClassOne body&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;&lt;[3]&gt; ClassOne.__init__&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__del__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;&lt;[4]&gt; ClassOne.__del__&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">method_x</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;&lt;[5]&gt; ClassOne.method_x&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">ClassTwo</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;&lt;[6]&gt; ClassTwo body&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@deco_alpha</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ClassThree</span>():</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;&lt;[7]&gt; ClassThree body&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">method_y</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;&lt;[8]&gt; ClassThree.method_y&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ClassFour</span>(<span class="params">ClassThree</span>):</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;&lt;[9]&gt; ClassFour body&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;&lt;[11]&gt; ClassOne tests&#x27;</span>, <span class="number">30</span> * <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    one = ClassOne()</span><br><span class="line">    one.method_x()</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;&lt;[12]&gt; ClassThree tests&#x27;</span>, <span class="number">30</span> * <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">    three = ClassThree()</span><br><span class="line">    three.method_y()</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;&lt;[13]&gt; ClassFour tests&#x27;</span>, <span class="number">30</span> * <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">    four = ClassFour()</span><br><span class="line">    four.method_y()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;&lt;[14]&gt; evaltime module end&#x27;</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># evaltime_meta.py</span></span><br><span class="line"><span class="keyword">from</span> evalsupport <span class="keyword">import</span> deco_alpha</span><br><span class="line"><span class="keyword">from</span> evalsupport <span class="keyword">import</span> MetaAleph</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;&lt;[1]&gt; evaltime_meta module start&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@deco_alpha</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ClassThree</span>():</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;&lt;[2]&gt; ClassThree body&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">method_y</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;&lt;[3]&gt; ClassThree.method_y&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ClassFour</span>(<span class="params">ClassThree</span>):</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;&lt;[4]&gt; ClassFour body&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">method_y</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;&lt;[5]&gt; ClassFour.method_y&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ClassFive</span>(<span class="params">metaclass=MetaAleph</span>):</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;&lt;[6]&gt; ClassFive body&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;&lt;[7]&gt; ClassFive.__init__&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">method_z</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;&lt;[8]&gt; ClassFive.method_y&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ClassSix</span>(<span class="params">ClassFive</span>):</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;&lt;[9]&gt; ClassSix body&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">method_z</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;&lt;[10]&gt; ClassSix.method_y&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;&lt;[11]&gt; ClassThree tests&#x27;</span>, <span class="number">30</span> * <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">    three = ClassThree()</span><br><span class="line">    three.method_y()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;&lt;[12]&gt; ClassFour tests&#x27;</span>, <span class="number">30</span> * <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">    four = ClassFour()</span><br><span class="line">    four.method_y()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;&lt;[13]&gt; ClassFive tests&#x27;</span>, <span class="number">30</span> * <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">    five = ClassFive()</span><br><span class="line">    five.method_z()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;&lt;[14]&gt; ClassSix tests&#x27;</span>, <span class="number">30</span> * <span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">    six = ClassSix()</span><br><span class="line">    six.method_z()</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;&lt;[15]&gt; evaltime_meta module end&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>运行<code>evaltime.py</code>,得到:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;[100]&gt; evalsupport module start  # 先运行被导入模块</span><br><span class="line">&lt;[400]&gt; MetaAleph body            # 运行类(但不运行类方法)</span><br><span class="line">&lt;[700]&gt; evalsupport module end</span><br><span class="line">&lt;[1]&gt; evaltime module start</span><br><span class="line">&lt;[2]&gt; ClassOne body</span><br><span class="line">&lt;[6]&gt; ClassTwo body               # 运行类里的类(但不运行类方法)</span><br><span class="line">&lt;[7]&gt; ClassThree body</span><br><span class="line">&lt;[200]&gt; deco_alpha                # 因为ClassThree被装饰,所以Class类一运行完就马上运行函数装饰器</span><br><span class="line">&lt;[9]&gt; ClassFour body</span><br><span class="line">&lt;[11]&gt; ClassOne tests ..............................</span><br><span class="line">&lt;[3]&gt; ClassOne.__init__</span><br><span class="line">&lt;[5]&gt; ClassOne.method_x</span><br><span class="line">&lt;[12]&gt; ClassThree tests ..............................</span><br><span class="line">&lt;[300]&gt; deco_alpha:inner_1        # 因为存在函数装饰器,调用three.method_y时就会运行inner_1函数的定义体</span><br><span class="line">&lt;[13]&gt; ClassFour tests ..............................</span><br><span class="line">&lt;[300]&gt; deco_alpha:inner_1</span><br><span class="line">&lt;[14]&gt; evaltime module end </span><br><span class="line">&lt;[4]&gt; ClassOne.__del__            # 在程序结束时,绑在全局变量one上的ClassOne实例才会被垃圾回收机制回收</span><br></pre></td></tr></table></figure>

<p>运行<code>evaltime_meta.py</code>,得到:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;[100]&gt; evalsupport module start</span><br><span class="line">&lt;[400]&gt; MetaAleph body</span><br><span class="line">&lt;[700]&gt; evalsupport module end</span><br><span class="line">&lt;[1]&gt; evaltime_meta module start</span><br><span class="line">&lt;[2]&gt; ClassThree body</span><br><span class="line">&lt;[200]&gt; deco_alpha</span><br><span class="line">&lt;[4]&gt; ClassFour body</span><br><span class="line">&lt;[6]&gt; ClassFive body</span><br><span class="line">&lt;[500]&gt; MetaAleph.__init__</span><br><span class="line">&lt;[9]&gt; ClassSix body</span><br><span class="line">&lt;[500]&gt; MetaAleph.__init__</span><br><span class="line">&lt;[11]&gt; ClassThree tests ..............................</span><br><span class="line">&lt;[300]&gt; deco_alpha:inner_1</span><br><span class="line">&lt;[12]&gt; ClassFour tests ..............................</span><br><span class="line">&lt;[5]&gt; ClassFour.method_y</span><br><span class="line">&lt;[13]&gt; ClassFive tests ..............................</span><br><span class="line">&lt;[7]&gt; ClassFive.__init__</span><br><span class="line">&lt;[600]&gt; MetaAleph.__init__:inner_2</span><br><span class="line">&lt;[14]&gt; ClassSix tests ..............................</span><br><span class="line">&lt;[7]&gt; ClassFive.__init__</span><br><span class="line">&lt;[600]&gt; MetaAleph.__init__:inner_2</span><br><span class="line">&lt;[15]&gt; evaltime_meta module end</span><br></pre></td></tr></table></figure>



<p>结论:</p>
<ol>
<li><p>扫描类的时候就会扫描类里面的定义体</p>
<blockquote>
<ul>
<li>这个步骤是为了知道这个类有什么属性</li>
<li>如果类里面还定义了类B(如:定义了描述符),那么一样也会扫描类B</li>
</ul>
</blockquote>
</li>
<li><p><strong>一个类如果被装饰了,那么在扫描完类里面的定义体后,立马就会去扫描装饰器</strong></p>
<blockquote>
<p>因为</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@deco_alpha</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ClassThree</span>():</span></span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>

<p>其实就等于:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ClassThree</span>():</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line">ClassThree = deco_alpha(ClassThree)</span><br></pre></td></tr></table></figure>

<p><strong>相当于直接运行了deco_alpha函数</strong></p>
</blockquote>
</li>
<li><p>一个类A如果有元类,那么类A在扫描完后马上就会执行元类</p>
</li>
<li><p>一个类A,继承了类B,类B有元类C,那么,类A在扫描完毕之后马上就会去扫描元类</p>
</li>
</ol>
<blockquote>
<p>注意<strong>这种偷偷更换类方法的做法</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">deco_alpha</span>(<span class="params">cls</span>):</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;&lt;[200]&gt; deco_alpha&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">inner_1</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;&lt;[300]&gt; deco_alpha:inner_1&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    cls.method_y = inner_1</span><br><span class="line">    <span class="keyword">return</span> cls</span><br><span class="line"></span><br><span class="line"><span class="meta">@deco_alpha</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ClassThree</span>():</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;&lt;[7]&gt; ClassThree body&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">method_y</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;&lt;[8]&gt; ClassThree.method_y&#x27;</span>)</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="同步异步-阻塞非阻塞举例"><a href="#同步异步-阻塞非阻塞举例" class="headerlink" title="同步异步,阻塞非阻塞举例"></a>同步异步,阻塞非阻塞举例</h3><p>以小明下载文件打个比方</p>
<ol>
<li><p>同步阻塞：小明一直盯着下载进度条，到 100% 的时候就完成。</p>
<blockquote>
<p>同步体现在：等待下载完成通知；</p>
<p>阻塞体现在：等待下载完成通知过程中，不能做其他任务处理；</p>
</blockquote>
</li>
<li><p>同步非阻塞：小明提交下载任务后就去干别的，每过一段时间就去瞄一眼进度条，看到 100% 就完成。</p>
<blockquote>
<p>同步体现在：等待下载完成通知；</p>
<p>非阻塞体现在：等待下载完成通知过程中，去干别的任务了，只是时不时会瞄一眼进度条；【小明必须要在两个任务间切换，关注下载进度】</p>
</blockquote>
</li>
<li><p>异步阻塞：小明换了个有下载完成通知功能的软件，下载完成就“叮”一声。不过小明仍然一直等待“叮”的声音（看起来很傻，不是吗）。</p>
<blockquote>
<p>异步体现在：下载完成“叮”一声通知；</p>
<p>阻塞体现在：等待下载完成“叮”一声通知过程中，不能做其他任务处理；</p>
</blockquote>
</li>
<li><p>异步非阻塞：仍然是那个会“叮”一声的下载软件，小明提交下载任务后就去干别的，听到“叮”的一声就知道完成了。</p>
<blockquote>
<p>异步体现在：下载完成“叮”一声通知；</p>
<p>非阻塞体现在：等待下载完成“叮”一声通知过程中，去干别的任务了，只需要接收“叮”声通知即可；【软件处理下载任务，小明处理其他任务，不需关注进度，只需接收软件“叮”声通知，即可】</p>
</blockquote>
</li>
</ol>
<h3 id="进程里的Queue"><a href="#进程里的Queue" class="headerlink" title="进程里的Queue"></a><strong>进程里的Queue</strong></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Process,Queue</span><br><span class="line"><span class="keyword">import</span> os,time,random</span><br><span class="line"><span class="comment">#写数据进程执行的代码：</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">write</span>(<span class="params">q</span>):</span></span><br><span class="line">    <span class="keyword">for</span> value <span class="keyword">in</span> [<span class="string">&#x27;A&#x27;</span>,<span class="string">&#x27;B&#x27;</span>,<span class="string">&#x27;C&#x27;</span>]:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Put %s to queue...&quot;</span>,%value)</span><br><span class="line">        q.put(value)</span><br><span class="line">        time.sleep(random.random())</span><br><span class="line"><span class="comment">#读数据进程执行的代码</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">read</span>(<span class="params">q</span>):</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> q.empty():</span><br><span class="line">            value = q.get(<span class="literal">True</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Get %s from queue.&quot;</span>,%value)</span><br><span class="line">            time.sleep(random.random())</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="comment">#父进程创建Queue，并传给各个子进程</span></span><br><span class="line">    q = Queue()</span><br><span class="line">    pw = Process(target=write,args=(q,))</span><br><span class="line">    pr = Process(target=read,args=(q,))</span><br><span class="line">    <span class="comment">#启动子进程pw ，写入：</span></span><br><span class="line">    pw.start()</span><br><span class="line">    <span class="comment">#等待pw结束</span></span><br><span class="line">    pw.join()</span><br><span class="line">    <span class="comment">#启动子进程pr，读取：</span></span><br><span class="line">    pr.start()</span><br><span class="line">    pr.join()</span><br><span class="line">    <span class="comment">#pr 进程里是死循环，无法等待其结束，只能强行终止:</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;所有数据都写入并且读完&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p><strong>如果要使用Pool创建进程，就需要使用<code>multiprocessing.Manager()</code>中的Queue(),而不是multiprocessing.Queue(),否则会得到如下的错误信息：</strong></p>
<p><strong>RuntimeError： Queue objects should only be shared between processs through inheritance</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> multiprocessing <span class="keyword">import</span> Manager,Pool</span><br><span class="line"><span class="keyword">import</span> os,time,random</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">reader</span>(<span class="params">q</span>):</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;reader 启动(%s),父进程为（%s)&quot;</span>%(os.getpid(),os.getpid()))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(q.qsize()):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;reader 从Queue获取到消息:%s&quot;</span>%q.get(<span class="literal">True</span>))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">writer</span>(<span class="params">q</span>):</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;writer 启动（%s),父进程为(%s)&quot;</span>%(os.getpid(),os.getpid()))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="string">&quot;itcast&quot;</span>:</span><br><span class="line">        q.put(i)</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;(%s)start&quot;</span>%os.getpid())</span><br><span class="line">    q = Manager().Queue()<span class="comment">#使用Manager中的Queue</span></span><br><span class="line">    po = Pool()</span><br><span class="line">    po.apply_async(wrtier,(q,))</span><br><span class="line">    time.sleep(<span class="number">1</span>)</span><br><span class="line">    po.apply_async(reader,(q,))</span><br><span class="line">    po.close()</span><br><span class="line">    po.join()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;(%s)End&quot;</span>%os.getpid())</span><br></pre></td></tr></table></figure>



<h3 id="特性与描述符"><a href="#特性与描述符" class="headerlink" title="特性与描述符"></a><strong>特性与描述符</strong></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self,name</span>):</span></span><br><span class="line">        self._name = name</span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">name</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;--- get ---&#x27;</span>)</span><br><span class="line">        <span class="keyword">return</span> self._name</span><br><span class="line">    </span><br><span class="line"><span class="meta">    @name.setter</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">name</span>(<span class="params">self,value</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;--- set ---&#x27;</span>)</span><br><span class="line">        self._name = value</span><br><span class="line"></span><br><span class="line"><span class="meta">    @name.deleter</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">name</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;--- del ---&#x27;</span>)</span><br><span class="line">        <span class="keyword">del</span> self._name</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">bob = Person(<span class="string">&#x27;bob&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(bob.name)  <span class="comment"># --- get --- bob</span></span><br><span class="line">bob.name = <span class="string">&#x27;heyingliang&#x27;</span>  <span class="comment"># --- set ---</span></span><br><span class="line"><span class="built_in">print</span>(bob.name)  <span class="comment"># --- get --- heyingliang</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">del</span> bob.name   <span class="comment"># --- del ---</span></span><br><span class="line"></span><br><span class="line">sue = Person(<span class="string">&#x27;sue&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(sue.name)  <span class="comment"># sue</span></span><br><span class="line"><span class="built_in">print</span>(Person.name.__doc__)  <span class="comment"># None</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Descriptor</span>:</span></span><br><span class="line">    <span class="comment"># self     : 描述符实例</span></span><br><span class="line">    <span class="comment"># instance : 客户类的实例</span></span><br><span class="line">    <span class="comment"># owner    : 客户类</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__get__</span>(<span class="params">self,instance,owner</span>):</span></span><br><span class="line">        <span class="keyword">return</span> instance._name</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__set__</span>(<span class="params">self,instance,value</span>):</span></span><br><span class="line">        instance._name = value</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__delete__</span>(<span class="params">self,instance</span>):</span></span><br><span class="line">        <span class="keyword">del</span> instance._name</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self,name</span>):</span></span><br><span class="line">        self._name = name</span><br><span class="line"></span><br><span class="line">    name = Descriptor()</span><br><span class="line"></span><br><span class="line">a = A(<span class="string">&#x27;hyl&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(a.name)</span><br></pre></td></tr></table></figure>

<p><strong>描述符优于特性的地方 :</strong> </p>
<blockquote>
<p><strong>特性只能使用客户类的属性，描述符有自己的属性，并且可以调用自己的属性。</strong></p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Descriptor</span>:</span></span><br><span class="line">    <span class="comment"># self     : 描述符实例</span></span><br><span class="line">    <span class="comment"># instance : 客户类的实例</span></span><br><span class="line">    <span class="comment"># owner    : 客户类</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self,val</span>):</span></span><br><span class="line">    	self.val = val</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__get__</span>(<span class="params">self,instance,owner</span>):</span></span><br><span class="line">        <span class="keyword">return</span> instance._radius * self.val</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__set__</span>(<span class="params">self,instance,value</span>):</span></span><br><span class="line">        instance._radius = value</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__delete__</span>(<span class="params">self,instance</span>):</span></span><br><span class="line">        <span class="keyword">del</span> instance._radius</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Circle</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self,radius</span>):</span></span><br><span class="line">        self._radius = radius</span><br><span class="line"></span><br><span class="line">    radius = Descriptor(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">a = Circle(<span class="number">2</span>)</span><br><span class="line"><span class="built_in">print</span>(a.radius)  <span class="comment"># 6</span></span><br></pre></td></tr></table></figure>



<h3 id="僵尸进程与孤儿进程"><a href="#僵尸进程与孤儿进程" class="headerlink" title="僵尸进程与孤儿进程"></a>僵尸进程与孤儿进程</h3><ul>
<li><p>正常情况下，子进程是通过父进程创建的，子进程再创建新的进程。子进程的结束和父进程的运行是一个异步过程,即父进程永远无法预测子进程 到底什么时候结束。 当一个 进程完成它的工作终止之后，它的父进程需要调用wait()或者waitpid()系统调用取得子进程的终止状态。</p>
</li>
<li><p>孤儿进程： 父进程退出，子进程还在运行的这些子进程都是孤儿进程，孤儿进程将被init 进程（进程号为1）所收养，并由init 进程对他们完成状态收集工作。</p>
</li>
<li><p>僵尸进程： 进程使用 fork 创建子进程，如果子进程退出，而父进程并没有调用wait 获取waitpid 获取子进程的状态信息，那么子进程的进程描述符仍然保存在系统中的这些进程是僵尸进程。</p>
<blockquote>
<ul>
<li><p>启动一个程序，开始我们的任务，然后等任务结束了，我们就停止这个进程。 进程停止后， 该进程就会从进程表中移除。但是，有时候有些程序即使执行完了也依然留在进程表中。那么，这些完成了生命周期但却依然留在进程表中的进程，我们称之为 “僵尸进程”。</p>
</li>
<li><p>当你运行一个程序时，它会产生一个父进程以及很多子进程。 所有这些子进程都会消耗内核分配给它们的内存和 CPU 资源。</p>
</li>
</ul>
<p>这些子进程完成执行后会发送一个 Exit 信号然后死掉。这个 Exit 信号需要被父进程所读取。父进程需要随后调用 <code>wait</code> 命令来读取子进程的退出状态，并将子进程从进程表中移除。</p>
<p>若父进程正确第读取了子进程的 Exit 信号，则子进程会从进程表中删掉。</p>
<p>但若父进程未能读取到子进程的 Exit 信号，则这个子进程虽然完成执行处于死亡的状态，但也不会从进程表中删掉。</p>
</blockquote>
</li>
<li><p>针对于僵尸进程 : </p>
<ol>
<li>孤儿进程是没有父进程的进程，孤儿进程这个重任就落到了init进程身上，</li>
<li>init进程就好像是一个民政局，专门负责处理孤儿进程的善后工作。每当出现一个孤儿进程的时候，内核就把孤儿进程的父进程设置为init，而init进程会循环地wait()它的已经退出的子进程。</li>
<li>这样，当一个孤儿进程凄凉地结束了其生命周期的时候，init进程就会代表党和政府出面处理它的一切善后工作。</li>
<li>因此孤儿进程并不会有什么危害。</li>
</ol>
</li>
<li><p>针对于僵尸进程 :<br>unix提供了一种机制可以保证只要父进程想知道子进程结束时的状态信息， 就可以得到。</p>
<blockquote>
<p>这种机制就是: </p>
<ul>
<li>在每个进程退出的时候,内核释放该进程所有的资源,包括打开的文件,占用的内存等。 但是仍然为其保留一定的信息(包括进程号the process ID,退出状态the termination status of the process,运行时间the amount of CPU time taken by the process等)。直到父进程通过wait / waitpid来取时才释放。</li>
<li>但这样就导致了问题，如果进程不调用wait / waitpid的话，那么保留的那段信息就不会释放，其进程号就会一直被占用，但是系统所能使用的进程号是有限的，如果大量的产生僵死进程，将因为没有可用的进程号而导致系统不能产生新的进程. 此即为僵尸进程的危害，应当避免。</li>
</ul>
</blockquote>
</li>
<li><p>避免僵尸进程的方法：</p>
<ol>
<li>fork 两次用孙子进程去完成子进程的任务</li>
<li>用wait()函数使父进程阻塞</li>
<li>使用信号量，在signal handler 中调用waitpid,这样父进程不用阻塞</li>
</ol>
</li>
</ul>
<h3 id="Linux-五种IO模型"><a href="#Linux-五种IO模型" class="headerlink" title="Linux 五种IO模型"></a>Linux 五种IO模型</h3><h4 id="用户空间与内核空间"><a href="#用户空间与内核空间" class="headerlink" title="用户空间与内核空间"></a>用户空间与内核空间</h4><ul>
<li>操作系统的核心是内核，独立于普通的应用程序，可以访问受保护的内存空间，也有访问底层硬件设备的所有权限</li>
<li>为了保证用户进程不能直接操作内核（kernel），保证内核的安全，操作系统将虚拟空间划分为两部分，一部分为<code>内核空间</code>，一部分为<code>用户空间</code></li>
</ul>
<h4 id="进程切换"><a href="#进程切换" class="headerlink" title="进程切换"></a>进程切换</h4><p>为了控制进程的执行，<code>内核</code>必须有能力挂起正在CPU上运行的进程，并恢复以前挂起的某个进程的执行。这种行为被称为进程切换。</p>
<p>从一个进程的运行转到另一个进程上运行，这个过程中经过下面这些变化：</p>
<ol>
<li>保存处理机上下文，包括程序计数器和其他寄存器。</li>
<li>更新PCB信息。</li>
<li>把进程的PCB移入相应的队列，如就绪、在某事件阻塞等队列。</li>
<li>选择另一个进程执行，并更新其PCB。</li>
<li>更新内存管理的数据结构。</li>
<li>恢复处理机上下文。</li>
</ol>
<h4 id="进程的阻塞"><a href="#进程的阻塞" class="headerlink" title="进程的阻塞"></a>进程的阻塞</h4><ul>
<li>正在执行的进程，由于期待的某些事件未发生，如请求系统资源失败、等待某种操作的完成、新数据尚未到达或无新工作做等，则由系统自动执行阻塞原语(Block)，使自己由运行状态变为阻塞状态。</li>
<li>可见，进程的阻塞是进程自身的一种主动行为，也因此只有处于运行态的进程（获得CPU），才可能将其转为阻塞状态。</li>
<li><strong>当进程进入阻塞状态，是不占用CPU资源的</strong>。</li>
</ul>
<h4 id="文件描述符"><a href="#文件描述符" class="headerlink" title="文件描述符"></a>文件描述符</h4><ul>
<li><p>文件描述符（File descriptor）是一个用于表述指向<strong>文件的引用</strong>的抽象化概念。</p>
</li>
<li><p>文件描述符在形式上是一个非负整数。实际上，<strong>它是一个索引值，指向内核为每一个进程所维护的该进程打开文件的记录表</strong>。</p>
</li>
<li><p>当程序打开一个现有文件或者创建一个新文件时，内核向进程返回一个文件描述符。在程序设计中，一些涉及底层的程序编写往往会围绕着文件描述符展开。但是文件描述符这一概念往往只适用于UNIX、Linux这样的操作系统。</p>
</li>
</ul>
<h4 id="缓存-IO"><a href="#缓存-IO" class="headerlink" title="缓存 IO"></a>缓存 IO</h4><ul>
<li>缓存 IO 又被称作<code>标准 IO</code>，大多数文件系统的默认 IO 操作都是缓存 IO。</li>
<li>在 Linux 的缓存 IO 机制中，操作系统会将 IO 的数据缓存在文件系统的页缓存（ page cache ）中，也就是说，<strong>数据会先被拷贝到操作系统内核的缓冲区中，然后才会从操作系统内核的缓冲区拷贝到应用程序的地址空间</strong>。</li>
</ul>
<h4 id="Linux-IO模型"><a href="#Linux-IO模型" class="headerlink" title="Linux IO模型"></a>Linux IO模型</h4><ul>
<li><p>网络IO的本质是socket的读取，socket在linux系统被抽象为流，IO可以理解为对流的操作</p>
</li>
<li><p>对于一次IO访问（以read举例），数据会先被拷贝到操作系统内核的缓冲区中，然后才会从操作系统内核的缓冲区拷贝到应用程序的地址空间。所以说，当一个read操作发生时，它会经历两个阶段：</p>
<ol>
<li>第一阶段：等待数据准备 (Waiting for the data to be ready)。</li>
<li>第二阶段：将数据从内核拷贝到进程中 (Copying the data from the kernel to the process)。</li>
</ol>
<p>对于socket流而言，</p>
<ol>
<li>第一步：等待网络上的数据分组到达，然后被复制到内核的某个缓冲区。</li>
<li>第二步：把数据从内核缓冲区复制到应用进程缓冲区。</li>
</ol>
</li>
<li><p>网络应用需要处理的无非就是两大类问题，<code>网络IO</code>，<code>数据计算</code>。相对于后者，网络IO的延迟，给应用带来的性能瓶颈大于后者。网络IO的模型大致有如下几种：</p>
<ul>
<li>同步模型（synchronous IO）</li>
<li>阻塞IO（bloking IO）</li>
<li>非阻塞IO（non-blocking IO）</li>
<li>多路复用IO（multiplexing IO）</li>
<li>信号驱动式IO（signal-driven IO）</li>
<li>异步IO（asynchronous IO）</li>
</ul>
<p><img src="/images/e2534c5c-20144245_Wtld.png" alt="x"></p>
</li>
<li><p>每个 IO 模型都有自己的使用模式，它们对于特定的应用程序都有自己的优点。<br><img src="/images/012f84fa-20150405_VKYH.png" alt="img"><br><img src="/images/20150405_VKYH-1565785138879.png" alt="img"><br><img src="/images/3b82e8f2-20152818_DXcj.png" alt="img"><br><img src="/images/0c7efc27-20164149_LD8E.png" alt="img"><br><img src="/images/e1247433-21091434_DsZb.png" alt="img"><br><img src="/images/f847fb13-20175459_gtgw.png" alt="img"></p>
</li>
<li><p>地址: <a target="_blank" rel="noopener" href="https://www.jianshu.com/p/486b0965c296">https://www.jianshu.com/p/486b0965c296</a></p>
</li>
</ul>
<h3 id="I-O多路复用技术-multiplexing"><a href="#I-O多路复用技术-multiplexing" class="headerlink" title="I/O多路复用技术(multiplexing)"></a>I/O多路复用技术(multiplexing)</h3><ul>
<li><p>I/O多路复用技术(multiplexing):<br>就是很多网络连接(多路)，共(复)用少数几个(甚至是一个)<strong>线程</strong>。<br>通过一种机制，一个进程可以监视多个<strong>描述符</strong>，一旦某个描述符就绪（一般是读就绪或者写就绪），能够通知程序进行相应的读写操作。但select，pselect，poll，epoll本质上都是同步I/O</p>
<blockquote>
<ul>
<li>连接很多的时候，<strong>不能每个连接一个线程</strong>，会耗尽系统内存的。</li>
<li>线程也<strong>不能阻塞</strong>在任何一个连接上，等新的数据来，这样就不能及时响应其他连接发来的数据了；</li>
<li>也不能用非阻塞方式，<strong>不能轮询</strong>所有的连接，这会浪费掉大量CPU时间；</li>
<li>只能告诉系统，我对哪些连接感兴趣，有消息来的时候，通知我处理。</li>
<li>根据平台不同，可能会用到select/devpoll/epoll/kqueue/IOCP。</li>
</ul>
</blockquote>
</li>
<li><p>举例说明:</p>
<blockquote>
<p>模拟一个tcp服务器处理30个客户socket。假设你是一个超市老板，30个用户分别买不同的东西，但是有的商品有库存有的商品没有库存需要等待供应商送货，然后有下面几个选择：</p>
<ol>
<li>按顺序逐个检查，A用户先来买卫生纸，B用户买手电筒，C用户买泡面。。。。，逐个处理的结果是A用户买完走了，但是B用户的商品卖完了等待供应商送货30分钟后货送到了B购买成功，继续处理C用户。。。，这样处理就相当于最后的需要等待前面的用户全部购买成功才能继续购买。这种模式就好比，你用循环挨个处理socket，根本不具有并发能力。</li>
<li>你创建30个分身，每个分身去负责处理每个用户的购买请求。 这种类似于为每一个用户创建一个进程或者线程处理连接，但是Redis是单线程的</li>
<li>当A请求购买时 有货告知可以买 然后A购买，B请求购买 需要等待供应商送货 等待直到供应商送货过来 告知B来货了 B发起购买 购买成功；在B等待供应商的期间C用户的购买请求开始处理 有货直接购买成功 无需等待B用户购买。 这种就是IO复用模型</li>
</ol>
</blockquote>
</li>
<li><blockquote>
<p>阻塞I/O模型 : </p>
<p><img src="/images/v2-b5c4e9791f8c27fafc1ec05a8c720b73_hd.jpg" alt="img"></p>
<ol>
<li>客户端发起读（read）的命令</li>
<li>调用redis服务端</li>
<li>此时没有数据</li>
<li>数据报准备完成</li>
<li>复制数据报</li>
<li>复制完成</li>
<li>返回成功</li>
<li>客户端 处理数据报</li>
</ol>
</blockquote>
<blockquote>
<p>多路复用I/O模型:</p>
<ol>
<li>redis客户端先去select循环询问服务端是否可以发起read 这个过程是阻塞的 但是速度很快，当服务端准备好了数据报告诉客户端readable，客户端即可发起read请求，此时因为服务端已经准备好了数据报，直接返回即可。</li>
<li>整个过程只在调用select、poll、epoll这些调用的时候才会阻塞，收发客户消息是不会阻塞的。这种方式避免了线程的阻塞，又称为非阻塞I/O模型</li>
<li>这里<code>多路</code>指的是多个网络连接，<code>复用</code>指的是复用同一个<strong>线程</strong>。</li>
<li>采用多路 I/O 复用技术可以让单个线程高效的处理多个连接请求（尽量减少网络 IO 的时间消耗）</li>
</ol>
<p><img src="/images/v2-99c77dafd01970f9a60289bad5f3357b_hd.jpg" alt="img"></p>
<ol>
<li>客户端select机制 循环请求</li>
<li>去请求服务端 询问是否可以read</li>
<li>此时没有数据</li>
<li>数据报准备完成</li>
<li>服务端告诉客户端 可以read了<br>1~5 这个过程是阻塞的</li>
<li>客户端发起read</li>
<li>系统调用read</li>
<li>复制数据报</li>
<li>复制完成</li>
<li>返回成功</li>
<li>客户端 处理数据报</li>
</ol>
</blockquote>
</li>
<li><p>在最开始的时候，为了实现一个服务器可以支持多个客户端连接，人们想出了fork/thread等办法，当一个连接来到的时候，就fork/thread一个进程/线程去接收并且处理请求，然而，当时大家都穷，没啥钱买电脑，所以这个模型一直很好用，过去几十年都没有问题。</p>
</li>
<li><p>人们终于意识到了这种问题，所以发明了一种叫做<code>IO多路复用</code>的模型，这种模型的好处就是: 没必要开那么多条线程和进程了，一个线程一个进程就搞定了。</p>
</li>
<li><p>select函数发明:<br>一个连接来了，就必须<strong>遍历所有已经注册的文件描述符</strong>，来找到那个需要处理信息的文件描述符，如果已经注册了几万个文件描述符，那会因为遍历这些已经注册的文件描述符，导致cpu爆炸。</p>
</li>
<li><p>epoll方法</p>
<blockquote>
<p>每当一个学生入住新宿舍的时候，楼妈就记录下这个人的名字，学号，电话，以及宿舍房号。当小春找小丽的时候，楼妈掏出眼镜，查表，马上就能知道小丽在哪里了，小春几分钟就到达了小丽的宿舍….</p>
</blockquote>
</li>
<li><blockquote>
<p>在现代工业中我们会面临两个问题：</p>
<ol>
<li>单线程模型不能有阻塞，一旦发生任何阻塞（包括计算机计算延迟）都会使得这个模型不如多线程。另外，单线程模型不能很好的利用多核cpu</li>
<li>既然不能有阻塞，那我们只有用多线程去做异步io，那马上就会面临回调地狱。</li>
</ol>
<p>为了解决我上述说的两个问题人们做出了一些改进：</p>
<ol>
<li>利用多进程，每个进程单条线程去利用多核CPU。但是这又引入了新的问题：进程间状态共享和通信。但是对于提升的性能来说，可以忽略不计。</li>
<li>发明了协程。</li>
</ol>
</blockquote>
</li>
<li><p>IO无非就是几种</p>
<ol>
<li>读硬盘</li>
<li>写硬盘</li>
<li>网络请求（读和写）</li>
</ol>
<p>所有的读和写，网络请求接口都要设置成非阻塞式的，当系统内核把这些玩意儿执行完毕以后，再通过回调函数，通知用户处理。在用户空间上来看，我们就一直保持在<strong>一个线程，一个进程之中</strong>，因此，这种速率极高！</p>
</li>
</ul>
<h3 id="常用的设计模式"><a href="#常用的设计模式" class="headerlink" title="常用的设计模式"></a>常用的设计模式</h3><ul>
<li>简单工厂模式</li>
<li>工厂方法模式</li>
<li>抽象工厂模式</li>
<li>创建者模式</li>
<li>原型模式</li>
<li>单例模式</li>
</ul>
<p>设计模式七大原则</p>
<ol>
<li><p>开放封闭原则：一个软件实体如类，模块和函数应该对<strong>扩展是开放的</strong>，对<strong>修改是关闭的</strong>。即软件实体应尽量在不修改原有代码的情况下进行扩展(装饰器)</p>
</li>
<li><p>里氏替换原则：重写父类里面的方法，逻辑可能不一样，但是返回的结果参数啥的要一样（所有引用基类的地方必须能透明的使用其子类的对象）</p>
</li>
<li><p>依赖倒置原则：<strong>高层模块不应该依赖低层模块</strong>，二者都应该依赖其抽象，要针对接口编程，而不是针对实现编程。（接口类）</p>
</li>
<li><p>接口隔离原则：使用多个专门的接口，而不使用单一的总接口，即客户端不应该依赖那些它不需要实现的接口</p>
</li>
<li><p>迪米特法则：一个软件实体应当尽可能少的与其他实体发生相互作用</p>
</li>
<li><p>单一职责原则：一个类只负责一项职责（不要存在多于一个导致类变更的原因，即一个类只负责一项职责）</p>
</li>
<li><p>合同复用原则：多用组合少用继承.</p>
<blockquote>
<p>一个类重用另一个类的代码有两种方式</p>
<ul>
<li>继承</li>
<li>组合</li>
</ul>
</blockquote>
</li>
</ol>
<blockquote>
<p>接口隔离原则</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#假如说现在有这样的动物类</span></span><br><span class="line"><span class="keyword">from</span> abc <span class="keyword">import</span> abstractmethod,ABCMeta   <span class="comment">#借助abc模块来实现接口</span></span><br><span class="line"><span class="comment">#接口类就是为了提供标准，约束后面的子类</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animal</span>(<span class="params">metaclass=ABCMeta</span>):</span></span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">walk</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">fly</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">swim</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Frog</span>(<span class="params">Animal</span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;像是这样定义一个青蛙类，由于接口类的方法都要被实现,而青蛙只会走，没不要要实现其他的方法</span></span><br><span class="line"><span class="string">    动物不同会的功能也会不同，所以这时候我们就可以选择用接口隔离原则</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">walk</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;青蛙会走&#x27;</span>)</span><br><span class="line"></span><br><span class="line">obj = Frog()</span><br><span class="line">obj.walk()   <span class="comment">#会报错</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># =====================改进-=================</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AnimalOnLand</span>(<span class="params">metaclass=ABCMeta</span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;在陆地上的动物&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">walk</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AnimalInSky</span>(<span class="params">metaclass=ABCMeta</span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;飞行动物&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">fly</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AnimalInWater</span>(<span class="params">metaclass=ABCMeta</span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;在水里的动物&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">swim</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Tiger</span>(<span class="params">AnimalOnLand</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">walk</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;老虎在地上&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Frog</span>(<span class="params">AnimalOnLand,AnimalInWater</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">swim</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;青蛙会游&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">walk</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;会跳&#x27;</span>)</span><br><span class="line"></span><br><span class="line">obj = Tiger()</span><br><span class="line">obj.walk()</span><br><span class="line"></span><br><span class="line">obj = Frog()</span><br><span class="line">obj.walk()</span><br><span class="line">obj.swim()</span><br></pre></td></tr></table></figure>

<p>继承和组合</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 合同复用原则：多用组合少用继承</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;你好啊&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span>(<span class="params">A</span>):</span>  <span class="comment">#继承</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">123</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.a = A()   <span class="comment">#组合</span></span><br><span class="line">        self.a.test()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test</span>(<span class="params">self</span>):</span> </span><br><span class="line">        <span class="keyword">return</span> <span class="number">789</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(B().test())</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(C().a)</span><br><span class="line"><span class="built_in">print</span>(C().a.test())</span><br><span class="line"><span class="built_in">print</span>(C().test())</span><br></pre></td></tr></table></figure>
</blockquote>
<h4 id="简单工厂模式"><a href="#简单工厂模式" class="headerlink" title="简单工厂模式"></a><a target="_blank" rel="noopener" href="https://www.cnblogs.com/haiyan123/articles/8409526.html">简单工厂模式</a></h4><ol>
<li><p>内容 :<br>不直接向客户端暴露对象创建的实现细节，而是<strong>通过一个工厂类来负责创建产品类的实例</strong>。</p>
</li>
<li><p>角色 :</p>
<ul>
<li>工厂角色（Creator）</li>
<li>抽象产品角色（Product）</li>
<li>具体产品角色（Concrete Product）</li>
</ul>
</li>
<li><p>优点</p>
<ul>
<li>隐藏了对象创建的实现细节</li>
<li>客户端不需要修改代码</li>
</ul>
</li>
<li><p>缺点</p>
<ul>
<li>违反了单一职责原则，将创建逻辑集中到一个工厂类中</li>
<li>当添加新产品时，需要修改工厂类代码，违反了开放封闭原则</li>
</ul>
</li>
<li><p>代码示例</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 初始的</span></span><br><span class="line"><span class="keyword">from</span> abc <span class="keyword">import</span> abstractmethod,ABCMeta</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Payment</span>(<span class="params">metaclass=ABCMeta</span>):</span></span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">pay</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Alipay</span>(<span class="params">Payment</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self,money</span>):</span></span><br><span class="line">        self.money = money</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">pay</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;支付宝支付了%s元&#x27;</span>%self.money)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Whatpay</span>(<span class="params">Payment</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, money</span>):</span></span><br><span class="line">        self.money = money</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">pay</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;微信支付了%s元&#x27;</span> % self.money)</span><br><span class="line"></span><br><span class="line">obj = Alipay(<span class="number">100</span>)</span><br><span class="line">obj.pay()</span><br><span class="line"></span><br><span class="line">obj2 = Whatpay(<span class="number">200</span>)</span><br><span class="line">obj2.pay()</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 类工厂</span></span><br><span class="line"><span class="keyword">from</span> abc <span class="keyword">import</span> abstractmethod,ABCMeta</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Payment</span>(<span class="params">metaclass=ABCMeta</span>):</span></span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">pay</span>(<span class="params">self,money</span>):</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Alipay</span>(<span class="params">Payment</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">pay</span>(<span class="params">self, money</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;支付宝支付了%s元&#x27;</span>%money)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Applepay</span>(<span class="params">Payment</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">pay</span>(<span class="params">self, money</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;微信支付了%s元&#x27;</span> %money)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Yuebao</span>(<span class="params">Payment</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">pay</span>(<span class="params">self,money</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;余额宝支付了%s元&#x27;</span> %money)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PaymentFactory</span>:</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;工厂类：封装了对象创建的细节&#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">create_payment</span>(<span class="params">self,method</span>):</span></span><br><span class="line">        <span class="keyword">if</span> method ==<span class="string">&#x27;alipay&#x27;</span>:</span><br><span class="line">            <span class="keyword">return</span> Alipay()</span><br><span class="line">        <span class="keyword">elif</span> method ==<span class="string">&#x27;applepay&#x27;</span>:</span><br><span class="line">            <span class="keyword">return</span> Applepay()</span><br><span class="line">        <span class="keyword">elif</span> method ==<span class="string">&#x27;yuebao&#x27;</span>:</span><br><span class="line">            <span class="keyword">return</span> Yuebao()</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> NameError(method)</span><br><span class="line"></span><br><span class="line">factory = PaymentFactory()</span><br><span class="line">alipay=factory.create_payment(<span class="string">&#x27;yuebao&#x27;</span>)</span><br><span class="line">alipay.pay(<span class="number">100</span>)</span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="工厂方法模式"><a href="#工厂方法模式" class="headerlink" title="工厂方法模式"></a><a target="_blank" rel="noopener" href="https://www.cnblogs.com/haiyan123/articles/8409629.html">工厂方法模式</a></h4><ol>
<li><p>内容<br>定义一个用于创建对象的接口（工厂接口），让子类决定实例化哪一个产品类</p>
</li>
<li><p>角色</p>
<ul>
<li>抽象工厂角色（Creator）</li>
<li>具体工厂角色（Concrere Creator）</li>
<li>抽象产品角色（Product）</li>
<li>具体产品角色（Concrete Product）</li>
</ul>
<blockquote>
<p>工厂方法模式相比简单工厂模式将每个具体产品都对应一个具体工厂</p>
</blockquote>
</li>
<li><p>优点</p>
<ul>
<li>每个具体产品都对应一个具体工厂类，不需要修改工厂类代码</li>
<li>隐藏了对象创建的实现细节</li>
</ul>
</li>
<li><p>缺点</p>
<ul>
<li>每增加一个具体产品类，就必须增加一个相应的具体工厂类</li>
</ul>
</li>
<li><p>使用场景</p>
<ul>
<li>需要生产多种、大量复杂对象的时候</li>
<li>需要降低耦合度的时候</li>
<li>当系统的产品种类需要经常扩展的时候</li>
</ul>
</li>
<li><p>代码示例</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> abc <span class="keyword">import</span> ABCMeta,abstractmethod</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Payment</span>(<span class="params">metaclass=ABCMeta</span>):</span></span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">pay</span>(<span class="params">self,money</span>):</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Alipay</span>(<span class="params">Payment</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">pay</span>(<span class="params">self, money</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;支付宝支付了%s元&#x27;</span>%money)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Applepay</span>(<span class="params">Payment</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">pay</span>(<span class="params">self, money</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;微信支付了%s元&#x27;</span> %money)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PaymentFactory</span>(<span class="params">metaclass=ABCMeta</span>):</span></span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">create_payment</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AlipayFactory</span>(<span class="params">PaymentFactory</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">create_payment</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> Alipay()</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AppleFactory</span>(<span class="params">PaymentFactory</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">create_payment</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> Applepay()</span><br><span class="line"></span><br><span class="line">apple = AppleFactory()</span><br><span class="line">apple.create_payment().pay(<span class="number">100</span>)</span><br><span class="line"></span><br><span class="line">alipay = AlipayFactory()</span><br><span class="line">alipay.create_payment().pay(<span class="number">300</span>)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>原来的工厂类是:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PaymentFactory</span>:</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;工厂类：封装了对象创建的细节&#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">create_payment</span>(<span class="params">self,method</span>):</span></span><br><span class="line">        <span class="keyword">if</span> method ==<span class="string">&#x27;alipay&#x27;</span>:</span><br><span class="line">            <span class="keyword">return</span> Alipay()</span><br><span class="line">        <span class="keyword">elif</span> method ==<span class="string">&#x27;applepay&#x27;</span>:</span><br><span class="line">            <span class="keyword">return</span> Applepay()</span><br><span class="line">        <span class="keyword">elif</span> method ==<span class="string">&#x27;yuebao&#x27;</span>:</span><br><span class="line">            <span class="keyword">return</span> Yuebao()</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> NameError(method)</span><br></pre></td></tr></table></figure>

<p>改为:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PaymentFactory</span>(<span class="params">metaclass=ABCMeta</span>):</span></span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">create_payment</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AlipayFactory</span>(<span class="params">PaymentFactory</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">create_payment</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> Alipay()</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AppleFactory</span>(<span class="params">PaymentFactory</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">create_payment</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> Applepay()</span><br></pre></td></tr></table></figure>


<p>简单工厂模式的角色为:</p>
<ul>
<li>工厂角色（Creator）</li>
<li>抽象产品角色（Product）</li>
<li>具体产品角色（Concrete Product）</li>
</ul>
<p>工厂方法模式的角色为:</p>
<ul>
<li>抽象工厂角色（Creator）</li>
<li>具体工厂角色（Concrere Creator）</li>
<li>抽象产品角色（Product）</li>
<li>具体产品角色（Concrete Product）</li>
</ul>
<p>也就是说,把<code>工厂角色</code>拆分成了<code>抽象工厂角色</code>和<code>具体工厂角色</code></p>
</blockquote>
</li>
</ol>
<h4 id="抽象工厂模式"><a href="#抽象工厂模式" class="headerlink" title="抽象工厂模式"></a><a target="_blank" rel="noopener" href="https://www.cnblogs.com/haiyan123/articles/8409857.html">抽象工厂模式</a></h4><ol>
<li><p>内容:<br>定义一个工厂类接口，当工厂子类来创建<strong>一系列相关或相互依赖的对象</strong></p>
<blockquote>
<p>例：生产一部手机，需要手机壳、CPU、操作系统三类对象进行组装，其中每类对象都有不同的种类。对每个具体工厂，分别生产一部手机所需要的三个对象。</p>
</blockquote>
</li>
<li><p>角色</p>
<ul>
<li>抽象工厂角色（Creator）</li>
<li>具体工厂角色（Concrete Creator）</li>
<li>抽象产品角色（Product）</li>
<li>具体产品角色（Concrete Product）</li>
<li>客户端（Client）</li>
</ul>
<blockquote>
<p><strong>相比工厂方法模式，抽象工厂模式中的每个具体工厂都产生一套产品</strong></p>
</blockquote>
</li>
<li><p>优点</p>
<ul>
<li>将客户端与类的具体实现相分离</li>
<li>每个工厂创建了一个完整的产品系列，使得易于交换产品系列</li>
<li>有利于产品的一致性（即产品之间的约束关系）</li>
</ul>
</li>
<li><p>缺点</p>
<ul>
<li>难以支持新种类的（抽象）产品</li>
</ul>
</li>
<li><p>使用场景</p>
<ul>
<li>系统要独立于产品的创建与组合时</li>
<li>强调一系列相关的产品对象的设计以便进行联合使用时 </li>
<li>提供一个产品类库，想隐藏产品的具体实现时</li>
</ul>
</li>
<li><p>代码示例</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> abc <span class="keyword">import</span> abstractmethod,ABCMeta</span><br><span class="line"></span><br><span class="line"><span class="comment">#==============抽象产品============</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PhoneShell</span>(<span class="params">metaclass=ABCMeta</span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;手机壳&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">show_shell</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CPU</span>(<span class="params">metaclass=ABCMeta</span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;CPU&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">show_cpu</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">OS</span>(<span class="params">metaclass=ABCMeta</span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;操作系统&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">show_os</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ===============抽象工厂==============</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PhoneFactory</span>(<span class="params">metaclass=ABCMeta</span>):</span></span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">make_shell</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;制作手机壳&#x27;&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">make_cpu</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;制作cpu&#x27;&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">make_os</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;制作手机壳&#x27;&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># =================具体产品==============</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SmallShell</span>(<span class="params">PhoneShell</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">show_shell</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;普通手机小手机壳&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BigShell</span>(<span class="params">PhoneShell</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">show_shell</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;普通手机大手机壳&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AppleShell</span>(<span class="params">PhoneShell</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">show_shell</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;苹果手机壳&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">YingTeerCPU</span>(<span class="params">CPU</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">show_cpu</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;英特尔cpu&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MediaCPU</span>(<span class="params">CPU</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">show_cpu</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;联发科cpu&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AppleCPU</span>(<span class="params">CPU</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">show_cpu</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;苹果cpu&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Android</span>(<span class="params">OS</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">show_os</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Android系统&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">IOS</span>(<span class="params">OS</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">show_os</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;ios系统&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ==============具体工厂================</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MiFactory</span>(<span class="params">PhoneFactory</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">make_shell</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> SmallShell()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">make_cpu</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> AppleCPU()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">make_os</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> Android()</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HuaWeiactory</span>(<span class="params">PhoneFactory</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">make_shell</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> BigShell()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">make_cpu</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> YingTeerCPU()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">make_os</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> Android()</span><br><span class="line"></span><br><span class="line"><span class="comment"># ===============使用===============</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Phone</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self,cpu,os,shell</span>):</span></span><br><span class="line">        self.cpu = cpu</span><br><span class="line">        self.os = os</span><br><span class="line">        self.shell = shell</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">show_info</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;手机信息&#x27;</span>)</span><br><span class="line">        self.cpu.show_cpu()</span><br><span class="line">        self.os.show_os()</span><br><span class="line">        self.shell.show_shell()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">make_phone</span>(<span class="params">factory</span>):</span></span><br><span class="line">    cpu = factory.make_cpu()</span><br><span class="line">    os = factory.make_os()</span><br><span class="line">    shell = factory.make_shell()</span><br><span class="line">    <span class="keyword">return</span> Phone(cpu,os,shell)</span><br><span class="line"></span><br><span class="line">p1 = make_phone(HuaWeiactory())</span><br><span class="line">p1.show_info()</span><br><span class="line"></span><br><span class="line">p2 = make_phone(MiFactory())</span><br><span class="line">p2.show_info()</span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="建造者模式"><a href="#建造者模式" class="headerlink" title="建造者模式"></a><a target="_blank" rel="noopener" href="https://www.cnblogs.com/haiyan123/articles/8410196.html">建造者模式</a></h4><ol>
<li><p>内容<br>将一个<strong>复杂对象</strong>的构建与它表示分离，使得同样的构建过程可以创建不同的表示</p>
</li>
<li><p>角色</p>
<ul>
<li>抽象建造者</li>
<li>具体建造者</li>
<li>指挥者</li>
<li>产品</li>
</ul>
<blockquote>
<p>建造者模式与抽象工厂模式相似，也用来创建复杂对象。<br>主要区别是建造者模式着重<code>一步步构造一个复杂对象</code>，而抽象工厂模式着重于<code>多个系列的产品对象</code>。</p>
</blockquote>
</li>
<li><p>优点</p>
<ul>
<li>隐藏了一个产品的内部结构和装配过程</li>
<li>将构造代码与表示代码分开</li>
<li>可以将构建过程进行更精细的控制</li>
</ul>
</li>
<li><p>使用场景</p>
<ul>
<li>当创建复杂对象的算法（Director）应该独立于该对象的组成部分以及它们的装配方式（Builder）时</li>
<li>当构造过程允许被构造的对象有不同的表示时（不同Builder）</li>
</ul>
</li>
<li><p>代码示例</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> abc <span class="keyword">import</span> abstractmethod, ABCMeta</span><br><span class="line"></span><br><span class="line"><span class="comment">#------产品------</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Player</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, face=<span class="literal">None</span>, body=<span class="literal">None</span>, arm=<span class="literal">None</span>, leg=<span class="literal">None</span></span>):</span></span><br><span class="line">        self.face = face</span><br><span class="line">        self.arm = arm</span><br><span class="line">        self.leg = leg</span><br><span class="line">        self.body = body</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;%s, %s, %s, %s&quot;</span> % (self.face, self.arm, self.body, self.leg)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#------建造者------</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PlayerBuilder</span>(<span class="params">metaclass=ABCMeta</span>):</span></span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">build_face</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">build_arm</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">build_leg</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">build_body</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"><span class="meta">    @abstractmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_player</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BeautifulWomanBuilder</span>(<span class="params">PlayerBuilder</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.player = Player()</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">build_face</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.player.face = <span class="string">&quot;漂亮脸蛋&quot;</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">build_arm</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.player.arm=<span class="string">&quot;细胳膊&quot;</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">build_body</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.player.body=<span class="string">&quot;细腰&quot;</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">build_leg</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.player.leg=<span class="string">&quot;长腿&quot;</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_player</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.player</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RandomPlayerBuilder</span>(<span class="params">PlayerBuilder</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.player = Player()</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">build_face</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.player.face = random.choice([<span class="string">&quot;瓜子脸&quot;</span>,<span class="string">&quot;西瓜子脸&quot;</span>])</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">build_arm</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.player.arm=random.choice([<span class="string">&quot;长胳膊&quot;</span>,<span class="string">&quot;短胳膊&quot;</span>])</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">build_body</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.player.body=random.choice([<span class="string">&quot;苗条&quot;</span>,<span class="string">&quot;胖&quot;</span>])</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">build_leg</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.player.leg=random.choice([<span class="string">&quot;长腿&quot;</span>,<span class="string">&quot;短腿&quot;</span>])</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_player</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.player</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PlayerDirector</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, builder</span>):</span></span><br><span class="line">        self.builder = builder</span><br><span class="line">    <span class="comment"># 控制组装顺序</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">build_player</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.builder.build_body()</span><br><span class="line">        self.builder.build_face()</span><br><span class="line">        self.builder.build_arm()</span><br><span class="line">        self.builder.build_leg()</span><br><span class="line">        <span class="keyword">return</span> self.builder.get_player()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">pd = PlayerDirector(RandomPlayerBuilder())</span><br><span class="line">p = pd.build_player()</span><br><span class="line"><span class="built_in">print</span>(p)</span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="原型模式"><a href="#原型模式" class="headerlink" title="原型模式"></a>原型模式</h4><ol>
<li><p>内容:<br>假如你爱玩游戏，你能想到游戏里面有很多的角色，但是其实你有没有注意:脸型，身材，眼睛..这些其实都是略有不同的搭配， 这也就是原型的作用：<strong>不需要你每次都制造一个复杂的人物，只是根据一个原型的人物做些简单的修改即可</strong></p>
</li>
<li><p>代码示例:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 这里肯定要做深拷贝，要不然python的就是对象的引用</span></span><br><span class="line"><span class="keyword">from</span> copy <span class="keyword">import</span> deepcopy</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Prototype</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        self._objs = &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">registerObject</span>(<span class="params">self, name, obj</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;注册对象&quot;&quot;&quot;</span></span><br><span class="line">        self._objs[name] = obj</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">unregisterObject</span>(<span class="params">self, name</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;取消注册&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">del</span> self._objs[name]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">clone</span>(<span class="params">self, name, **attr</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;克隆对象&quot;&quot;&quot;</span></span><br><span class="line">        obj = deepcopy(self._objs[name])</span><br><span class="line">        <span class="comment"># 但是会根据attr增加或覆盖原对象的属性</span></span><br><span class="line">        obj.__dict__.update(attr)</span><br><span class="line">        <span class="keyword">return</span> obj</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">A</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    a=A()</span><br><span class="line">    prototype=Prototype()</span><br><span class="line">    prototype.registerObject(<span class="string">&quot;a&quot;</span>,a)</span><br><span class="line">    b=prototype.clone(<span class="string">&quot;a&quot;</span>,a=<span class="number">1</span>,b=<span class="number">2</span>,c=<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 这里会返回对象a</span></span><br><span class="line">    <span class="built_in">print</span>(a)</span><br><span class="line">    <span class="comment"># 这里的对象其实已经被修改成(1, 2, 3)</span></span><br><span class="line">    <span class="built_in">print</span>(b.a, b.b, b.c)</span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="单例模式-1"><a href="#单例模式-1" class="headerlink" title="单例模式"></a><a target="_blank" rel="noopener" href="https://www.cnblogs.com/haiyan123/p/8251032.html">单例模式</a></h4><ol>
<li><p>内容<br>保证一个类只有一个实例，并提供一个访问它的全局访问点</p>
</li>
<li><p>角色<br>单例</p>
</li>
<li><p>使用场景</p>
<ul>
<li>当类只有一个实例而且客户可以从一个众所周知的访问点访问它时</li>
<li>比如：数据库链接、Socket创建链接</li>
</ul>
</li>
<li><p>优点</p>
<ul>
<li>对唯一实例的受控访问</li>
<li>单利相当于全局变量，但防止了命名空间被污染</li>
</ul>
<blockquote>
<p>与单利模式功能相似的概念：<code>全局变量</code>、<code>静态变量</code>（方法）</p>
<p>为什么用单例模式，不用全局变量呢？</p>
<p>答、全局变量可能会有名称空间的干扰，如果有重名的可能会被覆盖</p>
</blockquote>
</li>
<li><p>单例模式的四种实现方式</p>
<ul>
<li><p>文件导入的形式（常用）</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">############ s1.py ############</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">test</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;123&quot;</span>)</span><br><span class="line"></span><br><span class="line">v = Foo()</span><br><span class="line"><span class="comment">#v是Foo的实例</span></span><br><span class="line"></span><br><span class="line"><span class="comment">############ s2.py ############</span></span><br><span class="line"><span class="keyword">from</span> s1 <span class="keyword">import</span> v <span class="keyword">as</span> v1</span><br><span class="line"><span class="built_in">print</span>(v1,<span class="built_in">id</span>(v1))  <span class="comment">#&lt;s1.Foo object at 0x0000000002221710&gt; 35788560</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> s1 <span class="keyword">import</span> v <span class="keyword">as</span> v2</span><br><span class="line"><span class="built_in">print</span>(v1,<span class="built_in">id</span>(v2))   <span class="comment">#&lt;s1.Foo object at 0x0000000002221710&gt; 35788560</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 两个的内存地址是一样的</span></span><br><span class="line"><span class="comment"># 文件加载的时候，第一次导入后，再次导入时不会再重新加载。</span></span><br></pre></td></tr></table></figure></li>
<li><p>基于类实现的单例模式</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ======================单例模式：无法支持多线程情况===============</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Singleton</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">import</span> time</span><br><span class="line">        time.sleep(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">instance</span>(<span class="params">cls, *args, **kwargs</span>):</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">hasattr</span>(Singleton, <span class="string">&quot;_instance&quot;</span>):</span><br><span class="line">            Singleton._instance = Singleton(*args, **kwargs)</span><br><span class="line">        <span class="keyword">return</span> Singleton._instance</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">task</span>(<span class="params">arg</span>):</span></span><br><span class="line">    obj = Singleton.instance()</span><br><span class="line">    <span class="built_in">print</span>(obj)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">    t = threading.Thread(target=task,args=[i,])</span><br><span class="line">    t.start()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ====================单例模式：支持多线程情况================、</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Singleton</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    _instance_lock = threading.Lock()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        time.sleep(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">instance</span>(<span class="params">cls, *args, **kwargs</span>):</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">hasattr</span>(Singleton, <span class="string">&quot;_instance&quot;</span>):</span><br><span class="line">            <span class="keyword">with</span> Singleton._instance_lock:   <span class="comment">#为了保证线程安全在内部加锁</span></span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">hasattr</span>(Singleton, <span class="string">&quot;_instance&quot;</span>):</span><br><span class="line">                    Singleton._instance = Singleton(*args, **kwargs)</span><br><span class="line">        <span class="keyword">return</span> Singleton._instance</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">task</span>(<span class="params">arg</span>):</span></span><br><span class="line">    obj = Singleton.instance()</span><br><span class="line">    <span class="built_in">print</span>(obj)</span><br><span class="line">    </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">    t = threading.Thread(target=task,args=[i,])</span><br><span class="line">    t.start()</span><br><span class="line">time.sleep(<span class="number">20</span>)</span><br><span class="line">obj = Singleton.instance()</span><br><span class="line"><span class="built_in">print</span>(obj)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用先说明，以后用单例模式，obj = Singleton.instance()</span></span><br><span class="line"><span class="comment"># 示例：</span></span><br><span class="line"><span class="comment"># obj1 = Singleton.instance()</span></span><br><span class="line"><span class="comment"># obj2 = Singleton.instance()</span></span><br><span class="line"><span class="comment"># print(obj1,obj2)</span></span><br><span class="line"><span class="comment"># 错误示例</span></span><br><span class="line"><span class="comment"># obj1 = Singleton()</span></span><br><span class="line"><span class="comment"># obj2 = Singleton()</span></span><br><span class="line"><span class="comment"># print(obj1,obj2)</span></span><br></pre></td></tr></table></figure></li>
<li><p>基于__new__实现的单例模式（最常用）</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># =============单线程下执行===============</span></span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Singleton</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line"></span><br><span class="line">    _instance_lock = threading.Lock()</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__new__</span>(<span class="params">cls, *args, **kwargs</span>):</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">hasattr</span>(Singleton, <span class="string">&quot;_instance&quot;</span>):</span><br><span class="line">            <span class="keyword">with</span> Singleton._instance_lock:</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">hasattr</span>(Singleton, <span class="string">&quot;_instance&quot;</span>):</span><br><span class="line">                    <span class="comment"># 类加括号就回去执行__new__方法，__new__方法会创建一个类实例：Singleton()</span></span><br><span class="line">                    Singleton._instance = <span class="built_in">object</span>.__new__(cls)  <span class="comment"># 继承object类的__new__方法，类去调用方法，说明是函数，要手动传cls</span></span><br><span class="line">        <span class="keyword">return</span> Singleton._instance  <span class="comment">#obj1</span></span><br><span class="line">        <span class="comment">#类加括号就会先去执行__new__方法，在执行__init__方法</span></span><br><span class="line">        </span><br><span class="line"><span class="comment"># obj1 = Singleton()</span></span><br><span class="line"><span class="comment"># obj2 = Singleton()</span></span><br><span class="line"><span class="comment"># print(obj1,obj2)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ===========多线程执行单利============</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">task</span>(<span class="params">arg</span>):</span></span><br><span class="line">    obj = Singleton()</span><br><span class="line">    <span class="built_in">print</span>(obj)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">    t = threading.Thread(target=task,args=[i,])</span><br><span class="line">    t.start()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用先说明，以后用单例模式，obj = Singleton()</span></span><br><span class="line"><span class="comment"># 示例</span></span><br><span class="line"><span class="comment"># obj1 = Singleton()</span></span><br><span class="line"><span class="comment"># obj2 = Singleton()</span></span><br><span class="line"><span class="comment"># print(obj1,obj2)</span></span><br></pre></td></tr></table></figure></li>
<li><p>基于metaclass(元类)实现的单例模式</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">1.对象是类创建，创建对象时候类的__init__方法自动执行，对象()执行类的 __call__ 方法</span></span><br><span class="line"><span class="string">2.类是type创建，创建类时候type的__init__方法自动执行，类() 执行type的 __call__方法(类的__new__方法,类的__init__方法)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 第0步: 执行type的 __init__ 方法【类是type的对象】</span></span><br><span class="line"><span class="string">class Foo:</span></span><br><span class="line"><span class="string">    def __init__(self):</span></span><br><span class="line"><span class="string">        pass</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    def __call__(self, *args, **kwargs):</span></span><br><span class="line"><span class="string">        pass</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 第1步: 执行type的 __call__ 方法</span></span><br><span class="line"><span class="string">#        1.1  调用 Foo类（是type的对象）的 __new__方法，用于创建对象。</span></span><br><span class="line"><span class="string">#        1.2  调用 Foo类（是type的对象）的 __init__方法，用于对对象初始化。</span></span><br><span class="line"><span class="string">obj = Foo()</span></span><br><span class="line"><span class="string"># 第2步：执行Foo的 __call__ 方法</span></span><br><span class="line"><span class="string">obj()</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ===========类的执行流程================</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SingletonType</span>(<span class="params"><span class="built_in">type</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self,*args,**kwargs</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(self)  <span class="comment">#会不会打印？  #&lt;class &#x27;__main__.Foo&#x27;&gt;</span></span><br><span class="line">        <span class="built_in">super</span>(SingletonType,self).__init__(*args,**kwargs)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__call__</span>(<span class="params">cls, *args, **kwargs</span>):</span>  <span class="comment">#cls = Foo</span></span><br><span class="line">        obj = cls.__new__(cls, *args, **kwargs)</span><br><span class="line">        obj.__init__(*args, **kwargs)</span><br><span class="line">        <span class="keyword">return</span> obj</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span>(<span class="params">metaclass=SingletonType</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self,name</span>):</span></span><br><span class="line">        self.name = name</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__new__</span>(<span class="params">cls, *args, **kwargs</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">object</span>.__new__(cls, *args, **kwargs)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    1、对象是类创建的，创建对象时类的__init__方法会自动执行，对象（）执行类的__call__方法</span></span><br><span class="line"><span class="string">    2、类是type创建的，创建类时候type类的__init__方法会自动执行，类（）会先执行type的__call__方法（调用类的__new__，__init__方法）</span></span><br><span class="line"><span class="string">    Foo 这个类是由SingletonType这个类创建的</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">obj = Foo(<span class="string">&quot;hiayan&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ============第三种方式实现单例模式=================</span></span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SingletonType</span>(<span class="params"><span class="built_in">type</span></span>):</span></span><br><span class="line">    _instance_lock = threading.Lock()</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__call__</span>(<span class="params">cls, *args, **kwargs</span>):</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">hasattr</span>(cls, <span class="string">&quot;_instance&quot;</span>):</span><br><span class="line">            <span class="keyword">with</span> SingletonType._instance_lock:</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">hasattr</span>(cls, <span class="string">&quot;_instance&quot;</span>):</span><br><span class="line">                    cls._instance = <span class="built_in">super</span>(SingletonType,cls).__call__(*args, **kwargs)</span><br><span class="line">        <span class="keyword">return</span> cls._instance</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span>(<span class="params">metaclass=SingletonType</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self,name</span>):</span></span><br><span class="line">        self.name = name</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">obj1 = Foo(<span class="string">&#x27;name&#x27;</span>)</span><br><span class="line">obj2 = Foo(<span class="string">&#x27;name&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(obj1,obj2)</span><br></pre></td></tr></table></figure></li>
<li><p>使用装饰器实现:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">wrapper</span>(<span class="params">cls</span>):</span></span><br><span class="line">    instance = &#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">inner</span>(<span class="params">*args,**kwargs</span>):</span></span><br><span class="line">        <span class="keyword">if</span> cls <span class="keyword">not</span> <span class="keyword">in</span>  instance:</span><br><span class="line">            instance[cls] = cls(*args,**kwargs)</span><br><span class="line">        <span class="keyword">return</span> instance[cls]</span><br><span class="line">    <span class="keyword">return</span> inner</span><br><span class="line"></span><br><span class="line"><span class="meta">@wrapper</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Singleton</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self,name,age</span>):</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.age = age</span><br><span class="line"></span><br><span class="line">obj1 = Singleton(<span class="string">&#x27;haiyan&#x27;</span>,<span class="number">22</span>)</span><br><span class="line">obj2 = Singleton(<span class="string">&#x27;xx&#x27;</span>,<span class="number">22</span>)</span><br><span class="line"><span class="built_in">print</span>(obj1)</span><br><span class="line"><span class="built_in">print</span>(obj2)</span><br></pre></td></tr></table></figure></li>
</ul>
<p>或者：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Scheduler</span>:</span></span><br><span class="line">    __instance = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__new__</span>(<span class="params">cls</span>):</span></span><br><span class="line">        <span class="keyword">if</span> cls.__instance <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            cls.__instance = <span class="built_in">object</span>.__new__(cls)</span><br><span class="line">        <span class="keyword">return</span> cls.__instance</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.q = asyncio.Queue()</span><br></pre></td></tr></table></figure></li>
</ol>
<h5 id="单例模式的应用"><a href="#单例模式的应用" class="headerlink" title="单例模式的应用"></a>单例模式的应用</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># pool.py</span></span><br><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">from</span> DBUtils.PooledDB <span class="keyword">import</span> PooledDB</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SingletonDBPool</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    _instance_lock = threading.Lock()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.pool = PooledDB(</span><br><span class="line">            creator=pymysql,  <span class="comment"># 使用链接数据库的模块</span></span><br><span class="line">            maxconnections=<span class="number">6</span>,  <span class="comment"># 连接池允许的最大连接数，0和None表示不限制连接数</span></span><br><span class="line">            mincached=<span class="number">2</span>,  <span class="comment"># 初始化时，链接池中至少创建的空闲的链接，0表示不创建</span></span><br><span class="line"></span><br><span class="line">            maxcached=<span class="number">5</span>,  <span class="comment"># 链接池中最多闲置的链接，0和None不限制</span></span><br><span class="line">            maxshared=<span class="number">3</span>,</span><br><span class="line">            <span class="comment"># 链接池中最多共享的链接数量，0和None表示全部共享。PS: 无用，因为pymysql和MySQLdb等模块的 threadsafety都为1，所有值无论设置为多少，_maxcached永远为0，所以永远是所有链接都共享。</span></span><br><span class="line">            blocking=<span class="literal">True</span>,  <span class="comment"># 连接池中如果没有可用连接后，是否阻塞等待。True，等待；False，不等待然后报错</span></span><br><span class="line">            maxusage=<span class="literal">None</span>,  <span class="comment"># 一个链接最多被重复使用的次数，None表示无限制</span></span><br><span class="line">            setsession=[],  <span class="comment"># 开始会话前执行的命令列表。如：[&quot;set datestyle to ...&quot;, &quot;set time zone ...&quot;]</span></span><br><span class="line">            ping=<span class="number">0</span>,</span><br><span class="line">            <span class="comment"># ping MySQL服务端，检查是否服务可用。# 如：0 = None = never, 1 = default = whenever it is requested, 2 = when a cursor is created, 4 = when a query is executed, 7 = always</span></span><br><span class="line">            host=<span class="string">&#x27;127.0.0.1&#x27;</span>,</span><br><span class="line">            port=<span class="number">3306</span>,</span><br><span class="line">            user=<span class="string">&#x27;root&#x27;</span>,</span><br><span class="line">            password=<span class="string">&#x27;123&#x27;</span>,</span><br><span class="line">            database=<span class="string">&#x27;pooldb&#x27;</span>,</span><br><span class="line">            charset=<span class="string">&#x27;utf8&#x27;</span></span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__new__</span>(<span class="params">cls, *args, **kwargs</span>):</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">hasattr</span>(SingletonDBPool, <span class="string">&quot;_instance&quot;</span>):</span><br><span class="line">            <span class="keyword">with</span> SingletonDBPool._instance_lock:</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">hasattr</span>(SingletonDBPool, <span class="string">&quot;_instance&quot;</span>):</span><br><span class="line">                    SingletonDBPool._instance = <span class="built_in">object</span>.__new__(cls, *args, **kwargs)</span><br><span class="line">        <span class="keyword">return</span> SingletonDBPool._instance</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">connect</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.pool.connection()</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># app.py</span></span><br><span class="line"><span class="keyword">from</span> pool <span class="keyword">import</span> SingletonDBPool</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run</span>():</span></span><br><span class="line">    pool = SingletonDBPool()</span><br><span class="line">    conn = pool.connect()</span><br><span class="line">    <span class="comment"># xxxxxx</span></span><br><span class="line">    cursor = conn.cursor()</span><br><span class="line">    cursor.execute(<span class="string">&quot;select * from td where id=%s&quot;</span>, [<span class="number">5</span>, ])</span><br><span class="line">    result = cursor.fetchall()  <span class="comment"># 获取数据</span></span><br><span class="line">    cursor.close()</span><br><span class="line">    conn.close()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    run()</span><br></pre></td></tr></table></figure>







</div></div></article><link rel="stylesheet" type="text/css" href="/css/font.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.css"><script src="//cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script><script src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script>$(document).ready(function() {
  $(".fancybox").fancybox();
});
</script></body></html>
<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="INI 就是英文 “initialization”的头三个字母的缩写；当然INI file的后缀名也不一定是&lt;code&gt;.ini&lt;/code&gt;也可以是&lt;code&gt;.cfg&lt;/code&gt;，&lt;code&gt;.conf &lt;/code&gt;或者是&lt;code&gt;.txt&lt;/code&gt;。"><link rel="stylesheet" type="text/css" href="/css/normalize.css"><link rel="stylesheet" type="text/css" href="/css/highlight.css"><link rel="stylesheet" type="text/css" href="/css/noise.css"><title>configparser | 凉薄的自动书记人偶</title><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><meta name="generator" content="Hexo 5.4.0"></head><body><article class="wrapper"><div class="post-main"><div class="nav"><nav class="container"><a class="sidebar-nav-item active" href="/">Home</a></nav><div class="container post-meta"><div class="post-tags"><a class="post-tag-none-link" href="/tags/Python/" rel="tag">Python</a></div><div class="post-time">2019-08-10</div></div></div><div class="container post-header"><h1>configparser</h1></div><div class="container post-toc"><details class="toc"><summary class="toc-accordion">Table of Contents</summary><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8"><span class="toc-number">1.</span> <span class="toc-text">简单使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A2%9E%E5%88%A0%E6%94%B9%E6%9F%A5-%E5%B9%B6%E4%B8%8D%E8%83%BD%E4%BF%AE%E6%94%B9%E6%BA%90%E6%96%87%E4%BB%B6"><span class="toc-number">2.</span> <span class="toc-text">增删改查(并不能修改源文件)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E6%BA%90%E6%96%87%E4%BB%B6"><span class="toc-number">3.</span> <span class="toc-text">修改源文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%93%8D%E4%BD%9Cconfigparser%E7%B1%BB%E6%9D%A5%E7%94%9F%E6%88%90%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">4.</span> <span class="toc-text">操作configparser类来生成配置文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%B4%E6%8E%A5%E8%8E%B7%E5%8F%96%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B"><span class="toc-number">5.</span> <span class="toc-text">直接获取数据类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DEFAULT"><span class="toc-number">6.</span> <span class="toc-text">[DEFAULT]</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Interpolation"><span class="toc-number">7.</span> <span class="toc-text">Interpolation</span></a></li></ol></details></div><div class="container post-content"><p>INI 就是英文 “initialization”的头三个字母的缩写；当然INI file的后缀名也不一定是<code>.ini</code>也可以是<code>.cfg</code>，<code>.conf </code>或者是<code>.txt</code>。</p>
<ul>
<li><strong>文件中由多个section构成，每个section下又有多个配置项</strong></li>
<li>section不能重复，里面数据通过section去查找，每个seletion下可以有多个key和vlaue的键值对，注释用英文分号(;)</li>
</ul>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">;这里是注释</span></span><br><span class="line"><span class="section">[section0]</span></span><br><span class="line"><span class="attr">key0</span> = value0</span><br><span class="line"><span class="attr">key1</span> = value1</span><br><span class="line"></span><br><span class="line"><span class="section">[section1]</span></span><br><span class="line"><span class="attr">key2</span> = value2</span><br><span class="line"><span class="attr">key3</span> = value3</span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li>在section声明后的所有parameters都是属于该section。</li>
<li>对于一个section没有明显的结束标志符，一个section的开始就是上一个section的结束，或者是end of the file。</li>
<li>Sections一般情况下不能被nested，当然特殊情况下也可以实现sections的嵌套。</li>
</ul>
</blockquote>
<h3 id="简单使用"><a href="#简单使用" class="headerlink" title="简单使用"></a>简单使用</h3><ul>
<li><code>read(filename)</code>: 直接读取文件内容</li>
<li><code>get(section, option)</code>: 获取<code>section</code> 下具体某一配置项的值(返回的是字符串)</li>
<li><code>sections()</code> : 得到所有的section，并以列表的形式返回</li>
<li><code>options(section) </code> : 得到该section的所有option</li>
<li><code>items(section)</code> : 键值对的形式 得到该section的所有option</li>
<li><code>getint(section,option)</code>、<code>cnf.getboolean(section,option)</code>、<code>getfloat(section,option) </code>:  获取整型、布尔型和浮点型的<code>option</code>的值</li>
</ul>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[mysql]</span></span><br><span class="line"><span class="attr">db_ip</span> = <span class="number">127.0</span>.<span class="number">0.1</span></span><br><span class="line"><span class="attr">db_port</span> = <span class="number">3306</span></span><br><span class="line"><span class="attr">db_user</span> = mysql</span><br><span class="line"><span class="attr">db_pass</span> = mysql</span><br><span class="line"></span><br><span class="line"><span class="section">[redis]</span></span><br><span class="line"><span class="attr">redis_ip</span> = <span class="number">127.0</span>.<span class="number">0.1</span></span><br><span class="line"><span class="attr">redis_port</span> = <span class="number">3978</span></span><br><span class="line"><span class="attr">redis_user</span> = redis</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> configparser</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建管理对象</span></span><br><span class="line">conf = configparser.ConfigParser()</span><br><span class="line"><span class="comment"># 读ini文件</span></span><br><span class="line"><span class="built_in">print</span>(conf.read(<span class="string">&#x27;config.ini&#x27;</span>))  <span class="comment"># [&#x27;config.ini&#x27;]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取所有sections</span></span><br><span class="line">sections = conf.sections()</span><br><span class="line"><span class="built_in">print</span>(sections)  <span class="comment"># [&#x27;mysql&#x27;, &#x27;redis&#x27;]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取单个sections里所有key</span></span><br><span class="line">items = conf.items(<span class="string">&#x27;mysql&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(items)</span><br><span class="line"><span class="comment"># [(&#x27;db_ip&#x27;, &#x27;127.0.0.1&#x27;), (&#x27;db_port&#x27;, &#x27;3306&#x27;), (&#x27;db_user&#x27;, &#x27;mysql&#x27;), (&#x27;db_pass&#x27;, &#x27;mysql&#x27;)]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 或者使用get</span></span><br><span class="line">conf.get(<span class="string">&#x27;mysql&#x27;</span>, <span class="string">&#x27;db_port&#x27;</span>)</span><br></pre></td></tr></table></figure>



<h3 id="增删改查-并不能修改源文件"><a href="#增删改查-并不能修改源文件" class="headerlink" title="增删改查(并不能修改源文件)"></a>增删改查(并不能修改源文件)</h3><p>一样可以增删改查:</p>
<ul>
<li><code>add_section(section)</code>   添加一个新的section</li>
<li> <code>set(section, option, value)</code> 对section中添加 option 和 value</li>
<li><code>remove_section(section)</code> 删除某个 section</li>
<li> <code>remove_option(section, option)</code>  删除某个 section 下的 option</li>
<li><code>write()</code> <strong>将设置的新的 section 和 option 写到文件中</strong></li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 删除mysql这个sections里db_ip(并不会真的删除ini文件的数据)</span></span><br><span class="line">conf.remove_option(<span class="string">&#x27;mysql&#x27;</span>, <span class="string">&quot;db_ip&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(conf.items(<span class="string">&#x27;mysql&#x27;</span>))</span><br><span class="line"><span class="comment"># [(&#x27;db_port&#x27;, &#x27;3306&#x27;), (&#x27;db_user&#x27;, &#x27;mysql&#x27;), (&#x27;db_pass&#x27;, &#x27;mysql&#x27;)]</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除整个section</span></span><br><span class="line">conf.remove_section(<span class="string">&#x27;mysql&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(conf.sections())  <span class="comment"># [&#x27;redis&#x27;]</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加一个select</span></span><br><span class="line">conf.add_section(<span class="string">&quot;mongo&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(conf.sections())  <span class="comment"># [&#x27;redis&#x27;, &#x27;mongo&#x27;]</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># section里面新增key和value</span></span><br><span class="line">conf.<span class="built_in">set</span>(<span class="string">&quot;mongo&quot;</span>, <span class="string">&quot;db_ip&quot;</span>, <span class="string">&quot;127.0.0.1&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(conf.items(<span class="string">&#x27;mongo&#x27;</span>))  <span class="comment"># [(&#x27;db_ip&#x27;, &#x27;127.0.0.1&#x27;)]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置值</span></span><br><span class="line">conf.<span class="built_in">set</span>(<span class="string">&quot;mongo&quot;</span>, <span class="string">&quot;db_ip&quot;</span>, <span class="string">&quot;127.0.0.5&quot;</span>)  <span class="comment"># 写入中文</span></span><br></pre></td></tr></table></figure>



<h3 id="修改源文件"><a href="#修改源文件" class="headerlink" title="修改源文件"></a>修改源文件</h3><ul>
<li>前面讲的remove和set方法并没有真正的修改ini文件内容，</li>
<li><strong>只有当执行conf.write()方法的时候，才会修改ini文件内容</strong></li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">conf.write(<span class="built_in">open</span>(<span class="string">&#x27;conf.ini&#x27;</span>, <span class="string">&quot;w&quot;</span>)) <span class="comment"># 删除原文件重新写入</span></span><br><span class="line">conf.write(<span class="built_in">open</span>(<span class="string">&#x27;conf.ini&#x27;</span>, <span class="string">&quot;a&quot;</span>)) <span class="comment"># 追加模式写入</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建管理对象</span></span><br><span class="line">conf = configparser.ConfigParser()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加一个select</span></span><br><span class="line">conf.add_section(<span class="string">&quot;emali_tel&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 往select添加key和value</span></span><br><span class="line">conf.<span class="built_in">set</span>(<span class="string">&quot;emali_tel&quot;</span>, <span class="string">&quot;sender&quot;</span>, <span class="string">&quot;yoyo1@tel.com&quot;</span>)</span><br><span class="line">conf.<span class="built_in">set</span>(<span class="string">&quot;emali_tel&quot;</span>, <span class="string">&quot;port&quot;</span>, <span class="string">&quot;265&quot;</span>)</span><br><span class="line">items = conf.items(<span class="string">&#x27;emali_tel&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(items)  <span class="comment"># list里面对象是元祖</span></span><br><span class="line"></span><br><span class="line">conf.write(<span class="built_in">open</span>(cfgpath, <span class="string">&quot;a&quot;</span>))  <span class="comment"># 追加模式写入</span></span><br></pre></td></tr></table></figure>



<h3 id="操作configparser类来生成配置文件"><a href="#操作configparser类来生成配置文件" class="headerlink" title="操作configparser类来生成配置文件"></a>操作configparser类来生成配置文件</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> configparser</span><br><span class="line"></span><br><span class="line">config = configparser.ConfigParser()</span><br><span class="line">config[<span class="string">&#x27;DEFAULT&#x27;</span>] = &#123;<span class="string">&#x27;serveraliveinterval&#x27;</span> : <span class="string">&#x27;4&#x27;</span>,</span><br><span class="line">                     <span class="string">&#x27;compression&#x27;</span> : <span class="string">&#x27;yes&#x27;</span>,</span><br><span class="line">                     <span class="string">&#x27;compressionlevel&#x27;</span> : <span class="string">&#x27;9&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line">config[<span class="string">&#x27;bitbucket&#x27;</span>] = &#123;&#125;</span><br><span class="line">config[<span class="string">&#x27;bitbucket&#x27;</span>][<span class="string">&#x27;user&#x27;</span>] = <span class="string">&#x27;kk&#x27;</span></span><br><span class="line"></span><br><span class="line">config[<span class="string">&#x27;topsecrect&#x27;</span>] = &#123;&#125;</span><br><span class="line">topsecrect = config[<span class="string">&#x27;topsecrect&#x27;</span>]</span><br><span class="line"></span><br><span class="line">topsecrect[<span class="string">&#x27;port&#x27;</span>] = <span class="string">&#x27;22&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;example.ini&#x27;</span>, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> configfile:</span><br><span class="line">    config.write(configfile)</span><br></pre></td></tr></table></figure>



<h3 id="直接获取数据类型"><a href="#直接获取数据类型" class="headerlink" title="直接获取数据类型"></a>直接获取数据类型</h3><p>一般情况下，<strong>configpaser类是无法识别配置文件中的value的数据类型的</strong>，它总是以字符串的形式来存储这些类型，所以当涉及到int float等类型的时候就需要我们自己对它进行转换</p>
<blockquote>
<p>configparser 为我们提供了<code>getboolean()</code>,<code>getint()</code>, <code>getfloat()</code>方法用来对读对应类型的配置</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> configparser</span><br><span class="line"></span><br><span class="line">config = configparser.ConfigParser()</span><br><span class="line">config.read(<span class="string">&#x27;example.ini&#x27;</span>)</span><br><span class="line"></span><br><span class="line">port = config[<span class="string">&#x27;topsecrect&#x27;</span>].getint(<span class="string">&#x27;port&#x27;</span>)</span><br><span class="line">compression = config.getboolean(<span class="string">&#x27;DEFAULT&#x27;</span>, <span class="string">&#x27;compression&#x27;</span>)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>getboolean方法可以识别 <code>yes/no</code>, <code>on/off</code>, <code>true/false</code> , <code>1/0</code>等数据并转换为布尔值, 其他值都会导致抛出ValueError 异常</p>
</blockquote>
<h3 id="DEFAULT"><a href="#DEFAULT" class="headerlink" title="[DEFAULT]"></a>[DEFAULT]</h3><p>configparser有default_section的概念,默认为[DEFAULT]节,也就是<strong>之后的所有的section都有该默认section中的键值对</strong></p>
<blockquote>
<p>也就是说， 当读取的配置项在不在指定的节里时，ConﬁgParser 将会到 [DEFAULT] 节中查找</p>
</blockquote>
<h3 id="Interpolation"><a href="#Interpolation" class="headerlink" title="Interpolation"></a>Interpolation</h3><ul>
<li><p>创建ConfigParser()类的时候可以指定interpolation参数，</p>
</li>
<li><p>如果将interpolation设置为<code>BasicInterpolation()</code>，则配置文件中的<code>%(key)s</code>结构会被解析</p>
</li>
<li><p>如，比如<code>example.ini</code>文件内容如下：</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[Paths]</span></span><br><span class="line">home_dir: /Users</span><br><span class="line"><span class="comment">; 使用上面的home_dir</span></span><br><span class="line">my_dir: %(home_dir)s/lumberjack</span><br><span class="line">my_pictures: %(my_dir)s/Pictures</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> configparser</span><br><span class="line">config = configparser.ConfigParser(interpolation=configparser.BasicInterpolation())</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(config.read(<span class="string">r&#x27;F:\coding\python\example.ini&#x27;</span>))</span><br><span class="line"><span class="comment"># [&#x27;F:\\coding\\python\\example.ini&#x27;]</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(config[<span class="string">&#x27;Paths&#x27;</span>][<span class="string">&#x27;my_dir&#x27;</span>])</span><br><span class="line"><span class="comment"># &#x27;/Users/lumberjack&#x27;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>%(home_dir)s</code>被解析成了<code>/Users</code>，说白了，相当于配置文件中的变量</p>
</blockquote>
</li>
<li><p>也可以使用<code>SafeConfigParser()</code>:<br>更加智能化，在section中是否存在%()s会自动判断</p>
</li>
</ul>
</div></div><div class="post-main post-comment"></div></article><link rel="stylesheet" type="text/css" href="/css/font.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.css"><script src="//cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script><script src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script>$(document).ready(function() {
  $(".fancybox").fancybox();
});
</script></body></html>
<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content=" id=&quot;第7章-数据清洗和准备&quot;&gt;&lt;a href=&quot;#第7章-数据清洗和准备&quot; class=&quot;headerlink&quot; title=&quot;第7章 数据清洗和准备&quot;&gt;&lt;/a&gt;第7章 数据清洗和准备&lt;/h1&gt;&lt;p&gt;本章讨论处理缺失数据、重复数据、字符串操作和其它分析数据转换的⼯具。下⼀章，我会关注于⽤多种⽅法合并、重塑数据集。"><link rel="stylesheet" type="text/css" href="/css/normalize.css"><link rel="stylesheet" type="text/css" href="/css/highlight.css"><link rel="stylesheet" type="text/css" href="/css/noise.css"><title>利用Python进行数据分析4_第7章_数据清洗和准备 | 凉薄的自动书记人偶</title><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><meta name="generator" content="Hexo 5.4.0"></head><body><article class="wrapper"><div class="post-main"><div class="nav"><nav class="container"><a class="sidebar-nav-item active" href="/">Home</a></nav><div class="container post-meta"><div class="post-tags"><a class="post-tag-none-link" href="/tags/Python/" rel="tag">Python</a></div><div class="post-time">2019-06-08</div></div></div><div class="container post-header"><h1>利用Python进行数据分析4_第7章_数据清洗和准备</h1></div><div class="container post-toc"><details class="toc"><summary class="toc-accordion">Table of Contents</summary><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC7%E7%AB%A0-%E6%95%B0%E6%8D%AE%E6%B8%85%E6%B4%97%E5%92%8C%E5%87%86%E5%A4%87"><span class="toc-number">1.</span> <span class="toc-text">第7章 数据清洗和准备</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#7-1-%E5%A4%84%E7%90%86%E7%BC%BA%E5%A4%B1%E6%95%B0%E6%8D%AE"><span class="toc-number">1.1.</span> <span class="toc-text">7.1 处理缺失数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-2-%E6%95%B0%E6%8D%AE%E8%BD%AC%E6%8D%A2"><span class="toc-number">1.2.</span> <span class="toc-text">7.2 数据转换</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-3-%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%93%8D%E4%BD%9C"><span class="toc-number">1.3.</span> <span class="toc-text">7.3 字符串操作</span></a></li></ol></li></ol></details></div><div class="container post-content"><h1 id="第7章-数据清洗和准备"><a href="#第7章-数据清洗和准备" class="headerlink" title="第7章 数据清洗和准备"></a>第7章 数据清洗和准备</h1><p>本章讨论处理缺失数据、重复数据、字符串操作和其它分析数据转换的⼯具。下⼀章，我会关注于⽤多种⽅法合并、重塑数据集。</p>
<h2 id="7-1-处理缺失数据"><a href="#7-1-处理缺失数据" class="headerlink" title="7.1 处理缺失数据"></a>7.1 处理缺失数据</h2><p>pandas对象的所有描述性统计默认都不包括缺失数据。</p>
<p>pandas使⽤浮点值NaN（Not a Number）表示缺失数据。我们称其为<code>哨兵值</code>，它表示不可⽤not available。</p>
<p>检测哨兵值很简单:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">string_data = pd.Series([<span class="string">&#x27;aardvark&#x27;</span>, <span class="string">&#x27;artichoke&#x27;</span>, np.nan, <span class="string">&#x27;avocado&#x27;</span>,<span class="literal">None</span>])</span><br><span class="line"><span class="built_in">print</span>(string_data)</span><br><span class="line"><span class="comment"># 0     aardvark</span></span><br><span class="line"><span class="comment"># 1    artichoke</span></span><br><span class="line"><span class="comment"># 2          NaN</span></span><br><span class="line"><span class="comment"># 3      avocado</span></span><br><span class="line"><span class="comment"># 4         None</span></span><br><span class="line"><span class="comment"># dtype: object</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(string_data.isnull())</span><br><span class="line"><span class="comment"># 0    False</span></span><br><span class="line"><span class="comment"># 1    False</span></span><br><span class="line"><span class="comment"># 2     True</span></span><br><span class="line"><span class="comment"># 3    False</span></span><br><span class="line"><span class="comment"># 4     True</span></span><br><span class="line"><span class="comment"># dtype: bool</span></span><br></pre></td></tr></table></figure>

<p>NaN的处理方法</p>
<p><img src="/images/687479702537.png" alt="687479702537"></p>
<p>滤除缺失数据</p>
<p>对于⼀个Series，dropna返回⼀个仅含⾮空数据和索引值的Series：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> numpy <span class="keyword">import</span> nan <span class="keyword">as</span> NA</span><br><span class="line"></span><br><span class="line">data = pd.Series([<span class="number">1</span>, NA, <span class="number">3.5</span>, NA, <span class="number">7</span>])</span><br><span class="line"><span class="built_in">print</span>(data)</span><br><span class="line"><span class="comment"># 0    1.0</span></span><br><span class="line"><span class="comment"># 1    NaN</span></span><br><span class="line"><span class="comment"># 2    3.5</span></span><br><span class="line"><span class="comment"># 3    NaN</span></span><br><span class="line"><span class="comment"># 4    7.0</span></span><br><span class="line"><span class="comment"># dtype: float64</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(data.dropna())</span><br><span class="line"><span class="comment"># 0    1.0</span></span><br><span class="line"><span class="comment"># 2    3.5</span></span><br><span class="line"><span class="comment"># 4    7.0</span></span><br><span class="line"><span class="comment"># dtype: float64</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 等价于</span></span><br><span class="line"><span class="built_in">print</span>(data[data.notnull()])</span><br><span class="line"><span class="comment"># 0    1.0</span></span><br><span class="line"><span class="comment"># 2    3.5</span></span><br><span class="line"><span class="comment"># 4    7.0</span></span><br><span class="line"><span class="comment"># dtype: float64</span></span><br></pre></td></tr></table></figure>

<p>对于DataFrame对象,dropna默认丢弃含有缺失值的<strong>行</strong>(默认axis=0)：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> numpy <span class="keyword">import</span> nan <span class="keyword">as</span> NA</span><br><span class="line"></span><br><span class="line">data = pd.DataFrame([[<span class="number">1.</span>, <span class="number">6.5</span>, <span class="number">3.</span>], [<span class="number">1.</span>, NA, NA],</span><br><span class="line">                     [NA, NA, NA], [NA, <span class="number">6.5</span>, <span class="number">3.</span>]])</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(data)</span><br><span class="line"><span class="comment">#      0    1    2</span></span><br><span class="line"><span class="comment"># 0  1.0  6.5  3.0</span></span><br><span class="line"><span class="comment"># 1  1.0  NaN  NaN</span></span><br><span class="line"><span class="comment"># 2  NaN  NaN  NaN</span></span><br><span class="line"><span class="comment"># 3  NaN  6.5  3.0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 默认axis=0</span></span><br><span class="line"><span class="built_in">print</span>(data.dropna())</span><br><span class="line"><span class="comment">#      0    1    2</span></span><br><span class="line"><span class="comment"># 0  1.0  6.5  3.0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 传⼊how=&#x27;all&#x27;将只丢弃全为NA的那些⾏：</span></span><br><span class="line"><span class="built_in">print</span>(data.dropna(how=<span class="string">&#x27;all&#x27;</span>))</span><br><span class="line"><span class="comment">#      0    1    2</span></span><br><span class="line"><span class="comment"># 0  1.0  6.5  3.0</span></span><br><span class="line"><span class="comment"># 1  1.0  NaN  NaN</span></span><br><span class="line"><span class="comment"># 3  NaN  6.5  3.0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用axis参数删除列中的NA</span></span><br><span class="line"><span class="built_in">print</span>(data.dropna(axis=<span class="number">1</span>))</span><br><span class="line"><span class="comment"># Empty DataFrame</span></span><br><span class="line"><span class="comment"># Columns: []</span></span><br><span class="line"><span class="comment"># Index: [0, 1, 2, 3]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用axis参数删除列中的NA</span></span><br><span class="line"><span class="built_in">print</span>(data.dropna(axis=<span class="number">0</span>))</span><br><span class="line"><span class="comment">#      0    1    2</span></span><br><span class="line"><span class="comment"># 0  1.0  6.5  3.0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">df = pd.DataFrame(np.random.randn(<span class="number">7</span>, <span class="number">3</span>))</span><br><span class="line">df.iloc[:<span class="number">4</span>, <span class="number">1</span>] = NA</span><br><span class="line">df.iloc[:<span class="number">2</span>, <span class="number">2</span>] = NA</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(df)</span><br><span class="line"><span class="comment">#           0         1         2</span></span><br><span class="line"><span class="comment"># 0 -1.601317       NaN       NaN</span></span><br><span class="line"><span class="comment"># 1 -1.626248       NaN       NaN</span></span><br><span class="line"><span class="comment"># 2 -1.142053       NaN  0.679764</span></span><br><span class="line"><span class="comment"># 3  0.246375       NaN  0.441402</span></span><br><span class="line"><span class="comment"># 4 -0.004399  1.075954 -1.366072</span></span><br><span class="line"><span class="comment"># 5  0.038879  0.077374 -0.557103</span></span><br><span class="line"><span class="comment"># 6  1.207704  0.092570  0.587832</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(df.dropna())</span><br><span class="line"><span class="comment">#           0         1         2</span></span><br><span class="line"><span class="comment"># 4 -0.004399  1.075954 -1.366072</span></span><br><span class="line"><span class="comment"># 5  0.038879  0.077374 -0.557103</span></span><br><span class="line"><span class="comment"># 6  1.207704  0.092570  0.587832</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># thresh:非NA数量大于等于2的话就保留该Series</span></span><br><span class="line"><span class="comment"># 人话:非NA列的数量大于等于2的话就保留,否则删除</span></span><br><span class="line"><span class="built_in">print</span>(df.dropna(thresh=<span class="number">2</span>))</span><br><span class="line"><span class="comment">#           0         1         2</span></span><br><span class="line"><span class="comment"># 2 -1.142053       NaN  0.679764</span></span><br><span class="line"><span class="comment"># 3  0.246375       NaN  0.441402</span></span><br><span class="line"><span class="comment"># 4 -0.004399  1.075954 -1.366072</span></span><br><span class="line"><span class="comment"># 5  0.038879  0.077374 -0.557103</span></span><br><span class="line"><span class="comment"># 6  1.207704  0.092570  0.587832</span></span><br></pre></td></tr></table></figure>



<p>填充缺失数据</p>
<p>fillna⽅法:</p>
<ul>
<li>通过⼀个常数调⽤fillna，就会将缺失值替换为那个常数值</li>
<li>通过⼀个字典调⽤fillna，就会对不同的<strong>列</strong>填充不同的值<br>(就是说,如果传入一个字典,会导致axis=1失效,这是函数的设计问题)<br>(此时就需要使用双转置)</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> numpy <span class="keyword">import</span> nan <span class="keyword">as</span> NA</span><br><span class="line"></span><br><span class="line">adict = &#123;<span class="string">&#x27;col1&#x27;</span>:[<span class="number">1.</span>,  <span class="number">1.</span>, NA,NA],</span><br><span class="line">         <span class="string">&#x27;col2&#x27;</span>:[<span class="number">6.5</span>, NA, NA,<span class="number">6.5</span>],</span><br><span class="line">         <span class="string">&#x27;col3&#x27;</span>:[<span class="number">3.0</span>, NA, NA,<span class="number">3.0</span>],&#125;</span><br><span class="line"></span><br><span class="line">df = pd.DataFrame(adict,index=[<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;c&#x27;</span>,<span class="string">&#x27;d&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(df)</span><br><span class="line"><span class="comment">#    col1  col2  col3</span></span><br><span class="line"><span class="comment"># a   1.0   6.5   3.0</span></span><br><span class="line"><span class="comment"># b   1.0   NaN   NaN</span></span><br><span class="line"><span class="comment"># c   NaN   NaN   NaN</span></span><br><span class="line"><span class="comment"># d   NaN   6.5   3.0</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(df.fillna(<span class="number">0</span>))</span><br><span class="line"><span class="comment">#    col1  col2  col3</span></span><br><span class="line"><span class="comment"># a   1.0   6.5   3.0</span></span><br><span class="line"><span class="comment"># b   1.0   0.0   0.0</span></span><br><span class="line"><span class="comment"># c   0.0   0.0   0.0</span></span><br><span class="line"><span class="comment"># d   0.0   6.5   3.0</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(df.fillna(<span class="string">&#x27;hyl&#x27;</span>,axis=<span class="number">1</span>))</span><br><span class="line"><span class="comment">#   col1 col2 col3</span></span><br><span class="line"><span class="comment"># a    1  6.5    3</span></span><br><span class="line"><span class="comment"># b    1  hyl  hyl</span></span><br><span class="line"><span class="comment"># c  hyl  hyl  hyl</span></span><br><span class="line"><span class="comment"># d  hyl  6.5    3</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(df.fillna(&#123;<span class="string">&#x27;col1&#x27;</span>: <span class="number">0.5</span>, <span class="string">&#x27;col3&#x27;</span>: <span class="number">0</span>&#125;))</span><br><span class="line"><span class="comment">#    col1  col2  col3</span></span><br><span class="line"><span class="comment"># a   1.0   6.5   3.0</span></span><br><span class="line"><span class="comment"># b   1.0   NaN   0.0</span></span><br><span class="line"><span class="comment"># c   0.5   NaN   0.0</span></span><br><span class="line"><span class="comment"># d   0.5   6.5   3.0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 无法指定行填充元素</span></span><br><span class="line"><span class="comment"># print(df.fillna(&#123;&#x27;b&#x27;:&#x27;uu&#x27;&#125;,axis=1))</span></span><br><span class="line"><span class="comment"># NotImplementedError: Currently only can fill with dict/Series column by column</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 想要指定行填充元素,这时就必须使用双转置</span></span><br><span class="line"><span class="built_in">print</span>(df.T.fillna(&#123;<span class="string">&#x27;b&#x27;</span>:<span class="string">&#x27;uu&#x27;</span>&#125;).T)</span><br><span class="line"><span class="comment">#   col1 col2 col3</span></span><br><span class="line"><span class="comment"># a    1  6.5    3</span></span><br><span class="line"><span class="comment"># b    1   uu   uu</span></span><br><span class="line"><span class="comment"># c  NaN  NaN  NaN</span></span><br><span class="line"><span class="comment"># d  NaN  6.5    3</span></span><br></pre></td></tr></table></figure>

<p>fillna的其他参数:</p>
<ul>
<li>inplace:<br>fillna默认会返回新对象，但也可以对现有对象进⾏就地修改</li>
<li>method:<br>填充的方法</li>
<li>limit:<br>连续的NaN值的前向/后向填充的最大数量</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> numpy <span class="keyword">import</span> nan <span class="keyword">as</span> NA</span><br><span class="line"></span><br><span class="line">adict = &#123;<span class="string">&#x27;col1&#x27;</span>:[<span class="number">1.</span>,  <span class="number">1.</span>, NA,NA],</span><br><span class="line">         <span class="string">&#x27;col2&#x27;</span>:[<span class="number">6.5</span>, NA, NA,<span class="number">6.5</span>],</span><br><span class="line">         <span class="string">&#x27;col3&#x27;</span>:[<span class="number">3.0</span>, NA, NA,<span class="number">3.0</span>],&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">df = pd.DataFrame(adict,index=[<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;c&#x27;</span>,<span class="string">&#x27;d&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(df)</span><br><span class="line"><span class="comment">#    col1  col2  col3</span></span><br><span class="line"><span class="comment"># a   1.0   6.5   3.0</span></span><br><span class="line"><span class="comment"># b   1.0   NaN   NaN</span></span><br><span class="line"><span class="comment"># c   NaN   NaN   NaN</span></span><br><span class="line"><span class="comment"># d   NaN   6.5   3.0</span></span><br><span class="line"></span><br><span class="line">a = df.fillna(<span class="number">0</span>, inplace=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(a)</span><br><span class="line"><span class="comment"># None</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(df)</span><br><span class="line"><span class="comment">#    col1  col2  col3</span></span><br><span class="line"><span class="comment"># a   1.0   6.5   3.0</span></span><br><span class="line"><span class="comment"># b   1.0   0.0   0.0</span></span><br><span class="line"><span class="comment"># c   0.0   0.0   0.0</span></span><br><span class="line"><span class="comment"># d   0.0   6.5   3.0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">df = pd.DataFrame(np.random.randn(<span class="number">6</span>, <span class="number">3</span>))</span><br><span class="line">df.iloc[<span class="number">2</span>:, <span class="number">1</span>] = NA</span><br><span class="line">df.iloc[<span class="number">4</span>:, <span class="number">2</span>] = NA</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(df)</span><br><span class="line"><span class="comment">#           0         1         2</span></span><br><span class="line"><span class="comment"># 0 -0.221341 -0.456265 -0.349181</span></span><br><span class="line"><span class="comment"># 1  0.004801 -1.274752  0.509877</span></span><br><span class="line"><span class="comment"># 2 -1.511773       NaN  2.708623</span></span><br><span class="line"><span class="comment"># 3 -0.499189       NaN  1.929494</span></span><br><span class="line"><span class="comment"># 4  1.425541       NaN       NaN</span></span><br><span class="line"><span class="comment"># 5  0.235956       NaN       NaN</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(df.fillna(method=<span class="string">&#x27;ffill&#x27;</span>))</span><br><span class="line"><span class="comment">#           0         1         2</span></span><br><span class="line"><span class="comment"># 0 -0.221341 -0.456265 -0.349181</span></span><br><span class="line"><span class="comment"># 1  0.004801 -1.274752  0.509877</span></span><br><span class="line"><span class="comment"># 2 -1.511773 -1.274752  2.708623</span></span><br><span class="line"><span class="comment"># 3 -0.499189 -1.274752  1.929494</span></span><br><span class="line"><span class="comment"># 4  1.425541 -1.274752  1.929494</span></span><br><span class="line"><span class="comment"># 5  0.235956 -1.274752  1.929494</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 连续的NaN值的前向/后向填充的最大数量</span></span><br><span class="line"><span class="comment"># 人话:最多只会填充连续的两个NaN</span></span><br><span class="line"><span class="built_in">print</span>(df.fillna(method=<span class="string">&#x27;ffill&#x27;</span>, limit=<span class="number">2</span>))</span><br><span class="line"><span class="comment">#           0         1         2</span></span><br><span class="line"><span class="comment"># 0 -0.221341 -0.456265 -0.349181</span></span><br><span class="line"><span class="comment"># 1  0.004801 -1.274752  0.509877</span></span><br><span class="line"><span class="comment"># 2 -1.511773 -1.274752  2.708623</span></span><br><span class="line"><span class="comment"># 3 -0.499189 -1.274752  1.929494</span></span><br><span class="line"><span class="comment"># 4  1.425541       NaN  1.929494</span></span><br><span class="line"><span class="comment"># 5  0.235956       NaN  1.929494</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(df.fillna(<span class="string">&#x27;hyl&#x27;</span>,limit=<span class="number">2</span>))</span><br><span class="line"><span class="comment">#           0         1         2</span></span><br><span class="line"><span class="comment"># 0 -0.221341 -0.456265 -0.349181</span></span><br><span class="line"><span class="comment"># 1  0.004801 -1.274752  0.509877</span></span><br><span class="line"><span class="comment"># 2 -1.511773       hyl  2.708623</span></span><br><span class="line"><span class="comment"># 3 -0.499189       hyl  1.929494</span></span><br><span class="line"><span class="comment"># 4  1.425541       NaN       hyl</span></span><br><span class="line"><span class="comment"># 5  0.235956       NaN       hyl</span></span><br></pre></td></tr></table></figure>

<p>注意:value参数不一定要是参数,大可以传入其他值</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 传入Series的平均值或中位数</span></span><br><span class="line">data = pd.Series([<span class="number">1.</span>, NA, <span class="number">3.5</span>, NA, <span class="number">7</span>])</span><br><span class="line"><span class="built_in">print</span>(data.fillna(data.mean()))</span><br><span class="line"><span class="comment"># 0    1.000000</span></span><br><span class="line"><span class="comment"># 1    3.833333</span></span><br><span class="line"><span class="comment"># 2    3.500000</span></span><br><span class="line"><span class="comment"># 3    3.833333</span></span><br><span class="line"><span class="comment"># 4    7.000000</span></span><br><span class="line"><span class="comment"># dtype: float64</span></span><br></pre></td></tr></table></figure>



<hr>
<h2 id="7-2-数据转换"><a href="#7-2-数据转换" class="headerlink" title="7.2 数据转换"></a>7.2 数据转换</h2><p>本节讲过滤、清理以及其他的转换⼯作。</p>
<p>移除重复数据:</p>
<ul>
<li>duplicated:<br>各⾏是否是重复⾏（前⾯出现过的⾏）</li>
<li>drop_duplicates:<br>丢掉重复行</li>
<li>df.drop_duplicates([‘k1’]):<br>只根据k1列过滤重复项</li>
<li>keep:<br>默认是保留第一个出现的行,keep=’last’保留最后一个</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">data = pd.DataFrame(&#123;<span class="string">&#x27;k1&#x27;</span>: [<span class="string">&#x27;one&#x27;</span>, <span class="string">&#x27;two&#x27;</span>] * <span class="number">3</span> + [<span class="string">&#x27;two&#x27;</span>],</span><br><span class="line">                     <span class="string">&#x27;k2&#x27;</span>: [<span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">4</span>]&#125;)</span><br><span class="line"><span class="built_in">print</span>(data)</span><br><span class="line"><span class="comment">#     k1  k2</span></span><br><span class="line"><span class="comment"># 0  one   1</span></span><br><span class="line"><span class="comment"># 1  two   1</span></span><br><span class="line"><span class="comment"># 2  one   2</span></span><br><span class="line"><span class="comment"># 3  two   3</span></span><br><span class="line"><span class="comment"># 4  one   3</span></span><br><span class="line"><span class="comment"># 5  two   4</span></span><br><span class="line"><span class="comment"># 6  two   4</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># duplicated:各⾏是否是重复⾏（前⾯出现过的⾏）</span></span><br><span class="line"><span class="built_in">print</span>(data.duplicated())</span><br><span class="line"><span class="comment"># 0    False</span></span><br><span class="line"><span class="comment"># 1    False</span></span><br><span class="line"><span class="comment"># 2    False</span></span><br><span class="line"><span class="comment"># 3    False</span></span><br><span class="line"><span class="comment"># 4    False</span></span><br><span class="line"><span class="comment"># 5    False</span></span><br><span class="line"><span class="comment"># 6     True</span></span><br><span class="line"><span class="comment"># dtype: bool</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># drop_duplicates:丢掉重复行</span></span><br><span class="line"><span class="built_in">print</span>(data.drop_duplicates())</span><br><span class="line"><span class="comment">#     k1  k2</span></span><br><span class="line"><span class="comment"># 0  one   1</span></span><br><span class="line"><span class="comment"># 1  two   1</span></span><br><span class="line"><span class="comment"># 2  one   2</span></span><br><span class="line"><span class="comment"># 3  two   3</span></span><br><span class="line"><span class="comment"># 4  one   3</span></span><br><span class="line"><span class="comment"># 5  two   4</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">data[<span class="string">&#x27;v1&#x27;</span>] = <span class="built_in">range</span>(<span class="number">7</span>)</span><br><span class="line"><span class="built_in">print</span>(data)</span><br><span class="line"><span class="comment">#     k1  k2  v1</span></span><br><span class="line"><span class="comment"># 0  one   1   0</span></span><br><span class="line"><span class="comment"># 1  two   1   1</span></span><br><span class="line"><span class="comment"># 2  one   2   2</span></span><br><span class="line"><span class="comment"># 3  two   3   3</span></span><br><span class="line"><span class="comment"># 4  one   3   4</span></span><br><span class="line"><span class="comment"># 5  two   4   5</span></span><br><span class="line"><span class="comment"># 6  two   4   6</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 只根据k1列过滤重复项(只要k1重复了,就丢掉该行)</span></span><br><span class="line"><span class="built_in">print</span>(data.drop_duplicates([<span class="string">&#x27;k1&#x27;</span>]))</span><br><span class="line"><span class="comment">#     k1  k2  v1</span></span><br><span class="line"><span class="comment"># 0  one   1   0</span></span><br><span class="line"><span class="comment"># 1  two   1   1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># keep:默认是保留第一个出现的行,keep=&#x27;last&#x27;保留最后一个</span></span><br><span class="line"><span class="built_in">print</span>(data.drop_duplicates([<span class="string">&#x27;k1&#x27;</span>, <span class="string">&#x27;k2&#x27;</span>], keep=<span class="string">&#x27;last&#x27;</span>))</span><br><span class="line"><span class="comment">#     k1  k2  v1</span></span><br><span class="line"><span class="comment"># 0  one   1   0</span></span><br><span class="line"><span class="comment"># 1  two   1   1</span></span><br><span class="line"><span class="comment"># 2  one   2   2</span></span><br><span class="line"><span class="comment"># 3  two   3   3</span></span><br><span class="line"><span class="comment"># 4  one   3   4</span></span><br><span class="line"><span class="comment"># 6  two   4   6</span></span><br></pre></td></tr></table></figure>



<p>利⽤函数或映射进⾏数据转换</p>
<p>map:实现<strong>元素级</strong>转换以及其他数据清理⼯作的便捷⽅式。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">data = pd.DataFrame(&#123;<span class="string">&#x27;food&#x27;</span>: [<span class="string">&#x27;bacon&#x27;</span>, <span class="string">&#x27;pulled pork&#x27;</span>, <span class="string">&#x27;bacon&#x27;</span>,</span><br><span class="line">                              <span class="string">&#x27;Pastrami&#x27;</span>, <span class="string">&#x27;corned beef&#x27;</span>, <span class="string">&#x27;Bacon&#x27;</span>,</span><br><span class="line">                              <span class="string">&#x27;pastrami&#x27;</span>, <span class="string">&#x27;honey ham&#x27;</span>, <span class="string">&#x27;nova lox&#x27;</span>],</span><br><span class="line">                     <span class="string">&#x27;ounces&#x27;</span>: [<span class="number">4</span>, <span class="number">3</span>, <span class="number">12</span>, <span class="number">6</span>, <span class="number">7.5</span>, <span class="number">8</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">6</span>]&#125;)</span><br><span class="line"><span class="built_in">print</span>(data)</span><br><span class="line"><span class="comment">#           food  ounces</span></span><br><span class="line"><span class="comment"># 0        bacon     4.0</span></span><br><span class="line"><span class="comment"># 1  pulled pork     3.0</span></span><br><span class="line"><span class="comment"># 2        bacon    12.0</span></span><br><span class="line"><span class="comment"># 3     Pastrami     6.0</span></span><br><span class="line"><span class="comment"># 4  corned beef     7.5</span></span><br><span class="line"><span class="comment"># 5        Bacon     8.0</span></span><br><span class="line"><span class="comment"># 6     pastrami     3.0</span></span><br><span class="line"><span class="comment"># 7    honey ham     5.0</span></span><br><span class="line"><span class="comment"># 8     nova lox     6.0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">meat_to_animal = &#123;</span><br><span class="line">  <span class="string">&#x27;bacon&#x27;</span>      : <span class="string">&#x27;pig&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;pulled pork&#x27;</span>: <span class="string">&#x27;pig&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;pastrami&#x27;</span>   : <span class="string">&#x27;cow&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;corned beef&#x27;</span>: <span class="string">&#x27;cow&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;honey ham&#x27;</span>  : <span class="string">&#x27;pig&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;nova lox&#x27;</span>   : <span class="string">&#x27;salmon&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">lowercased = data[<span class="string">&#x27;food&#x27;</span>].<span class="built_in">str</span>.lower()</span><br><span class="line"><span class="built_in">print</span>(lowercased)</span><br><span class="line"><span class="comment"># 0          bacon</span></span><br><span class="line"><span class="comment"># 1    pulled pork</span></span><br><span class="line"><span class="comment"># 2          bacon</span></span><br><span class="line"><span class="comment"># 3       pastrami</span></span><br><span class="line"><span class="comment"># 4    corned beef</span></span><br><span class="line"><span class="comment"># 5          bacon</span></span><br><span class="line"><span class="comment"># 6       pastrami</span></span><br><span class="line"><span class="comment"># 7      honey ham</span></span><br><span class="line"><span class="comment"># 8       nova lox</span></span><br><span class="line"><span class="comment"># Name: food, dtype: object</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># map⽅法:接受⼀个函数或含有映射关系的字典型对象</span></span><br><span class="line"><span class="comment"># 使用字典映射</span></span><br><span class="line">data[<span class="string">&#x27;animal&#x27;</span>] = lowercased.<span class="built_in">map</span>(meat_to_animal)</span><br><span class="line"><span class="built_in">print</span>(data)</span><br><span class="line"><span class="comment">#           food  ounces  animal</span></span><br><span class="line"><span class="comment"># 0        bacon     4.0     pig</span></span><br><span class="line"><span class="comment"># 1  pulled pork     3.0     pig</span></span><br><span class="line"><span class="comment"># 2        bacon    12.0     pig</span></span><br><span class="line"><span class="comment"># 3     Pastrami     6.0     cow</span></span><br><span class="line"><span class="comment"># 4  corned beef     7.5     cow</span></span><br><span class="line"><span class="comment"># 5        Bacon     8.0     pig</span></span><br><span class="line"><span class="comment"># 6     pastrami     3.0     cow</span></span><br><span class="line"><span class="comment"># 7    honey ham     5.0     pig</span></span><br><span class="line"><span class="comment"># 8     nova lox     6.0  salmon</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 或者使用匿名函数</span></span><br><span class="line">result = data[<span class="string">&#x27;food&#x27;</span>].<span class="built_in">map</span>(<span class="keyword">lambda</span> x: meat_to_animal[x.lower()])</span><br><span class="line"><span class="built_in">print</span>(result)</span><br><span class="line"><span class="comment"># 0       pig</span></span><br><span class="line"><span class="comment"># 1       pig</span></span><br><span class="line"><span class="comment"># 2       pig</span></span><br><span class="line"><span class="comment"># 3       cow</span></span><br><span class="line"><span class="comment"># 4       cow</span></span><br><span class="line"><span class="comment"># 5       pig</span></span><br><span class="line"><span class="comment"># 6       cow</span></span><br><span class="line"><span class="comment"># 7       pig</span></span><br><span class="line"><span class="comment"># 8    salmon</span></span><br><span class="line"><span class="comment"># Name: food, dtype: object</span></span><br></pre></td></tr></table></figure>



<p>map, applymap apply的区别:</p>
<ul>
<li>map:<br>Series元素级函数映射</li>
<li>applymap:<br>DataFrame元素级函数映射</li>
<li>apply:<br>DataFrame轴级函数映射</li>
</ul>
<hr>
<p>替换值</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">data = pd.Series([<span class="number">1.</span>, -<span class="number">999.</span>, <span class="number">2.</span>, -<span class="number">999.</span>, -<span class="number">1000.</span>, <span class="number">3.</span>])</span><br><span class="line"><span class="built_in">print</span>(data)</span><br><span class="line"><span class="comment"># 0       1.0</span></span><br><span class="line"><span class="comment"># 1    -999.0</span></span><br><span class="line"><span class="comment"># 2       2.0</span></span><br><span class="line"><span class="comment"># 3    -999.0</span></span><br><span class="line"><span class="comment"># 4   -1000.0</span></span><br><span class="line"><span class="comment"># 5       3.0</span></span><br><span class="line"><span class="comment"># dtype: float64</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># replace: 替换掉目标元素</span></span><br><span class="line"><span class="built_in">print</span>(data.replace(-<span class="number">999</span>, np.nan))</span><br><span class="line"><span class="comment"># 0       1.0</span></span><br><span class="line"><span class="comment"># 1       NaN</span></span><br><span class="line"><span class="comment"># 2       2.0</span></span><br><span class="line"><span class="comment"># 3       NaN</span></span><br><span class="line"><span class="comment"># 4   -1000.0</span></span><br><span class="line"><span class="comment"># 5       3.0</span></span><br><span class="line"><span class="comment"># dtype: float64</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 替换掉一系列目标元素</span></span><br><span class="line"><span class="built_in">print</span>(data.replace([-<span class="number">999</span>, -<span class="number">1000</span>], np.nan))</span><br><span class="line"><span class="comment"># 0    1.0</span></span><br><span class="line"><span class="comment"># 1    NaN</span></span><br><span class="line"><span class="comment"># 2    2.0</span></span><br><span class="line"><span class="comment"># 3    NaN</span></span><br><span class="line"><span class="comment"># 4    NaN</span></span><br><span class="line"><span class="comment"># 5    3.0</span></span><br><span class="line"><span class="comment"># dtype: float64</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 列表形式:用不同的值替换掉不同的元素</span></span><br><span class="line"><span class="built_in">print</span>(data.replace([-<span class="number">999</span>, -<span class="number">1000</span>], [np.nan, <span class="number">0</span>]))</span><br><span class="line"><span class="comment"># 0    1.0</span></span><br><span class="line"><span class="comment"># 1    NaN</span></span><br><span class="line"><span class="comment"># 2    2.0</span></span><br><span class="line"><span class="comment"># 3    NaN</span></span><br><span class="line"><span class="comment"># 4    0.0</span></span><br><span class="line"><span class="comment"># 5    3.0</span></span><br><span class="line"><span class="comment"># dtype: float64</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 字典形式:用不同的值替换掉不同的元素</span></span><br><span class="line"><span class="built_in">print</span>(data.replace(&#123;-<span class="number">999</span>: np.nan, -<span class="number">1000</span>: <span class="number">0</span>&#125;))</span><br><span class="line"><span class="comment"># 0    1.0</span></span><br><span class="line"><span class="comment"># 1    NaN</span></span><br><span class="line"><span class="comment"># 2    2.0</span></span><br><span class="line"><span class="comment"># 3    NaN</span></span><br><span class="line"><span class="comment"># 4    0.0</span></span><br><span class="line"><span class="comment"># 5    3.0</span></span><br><span class="line"><span class="comment"># dtype: float64</span></span><br></pre></td></tr></table></figure>



<p>重命名轴索引</p>
<ul>
<li>使用map</li>
<li>使用rename<ol>
<li>可以传入函数映射</li>
<li>可以传入字典实现部分标签的更新</li>
</ol>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">data = pd.DataFrame(np.arange(<span class="number">12</span>).reshape((<span class="number">3</span>, <span class="number">4</span>)),</span><br><span class="line">                    index=[<span class="string">&#x27;Ohio&#x27;</span>, <span class="string">&#x27;Colorado&#x27;</span>, <span class="string">&#x27;New York&#x27;</span>],</span><br><span class="line">                    columns=[<span class="string">&#x27;one&#x27;</span>, <span class="string">&#x27;two&#x27;</span>, <span class="string">&#x27;three&#x27;</span>, <span class="string">&#x27;four&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(data)</span><br><span class="line"><span class="comment">#           one  two  three  four</span></span><br><span class="line"><span class="comment"># Ohio        0    1      2     3</span></span><br><span class="line"><span class="comment"># Colorado    4    5      6     7</span></span><br><span class="line"><span class="comment"># New York    8    9     10    11</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">transform = <span class="keyword">lambda</span> x: x[:<span class="number">4</span>].upper()</span><br><span class="line"><span class="comment"># map:series元素级函数映射</span></span><br><span class="line"><span class="built_in">print</span>(data.index.<span class="built_in">map</span>(transform))</span><br><span class="line"><span class="comment"># Index([&#x27;OHIO&#x27;, &#x27;COLO&#x27;, &#x27;NEW &#x27;], dtype=&#x27;object&#x27;)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 将修改后的Index赋给DataFrame</span></span><br><span class="line">data.index = data.index.<span class="built_in">map</span>(transform)</span><br><span class="line"><span class="built_in">print</span>(data)</span><br><span class="line"><span class="comment">#       one  two  three  four</span></span><br><span class="line"><span class="comment"># OHIO    0    1      2     3</span></span><br><span class="line"><span class="comment"># COLO    4    5      6     7</span></span><br><span class="line"><span class="comment"># NEW     8    9     10    11</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># rename:如果单单想改变DataFrame的行列标签,可以直接使用rename函数</span></span><br><span class="line"><span class="built_in">print</span>(data.rename(index=<span class="built_in">str</span>.title, columns=<span class="built_in">str</span>.upper))</span><br><span class="line"><span class="comment">#       ONE  TWO  THREE  FOUR</span></span><br><span class="line"><span class="comment"># Ohio    0    1      2     3</span></span><br><span class="line"><span class="comment"># Colo    4    5      6     7</span></span><br><span class="line"><span class="comment"># New     8    9     10    11</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># rename:也可以传入字典,实现部分标签的更新</span></span><br><span class="line">result = data.rename(index=&#123;<span class="string">&#x27;OHIO&#x27;</span>: <span class="string">&#x27;INDIANA&#x27;</span>&#125;,</span><br><span class="line">                     columns=&#123;<span class="string">&#x27;three&#x27;</span>: <span class="string">&#x27;peekaboo&#x27;</span>&#125;)</span><br><span class="line"><span class="built_in">print</span>(result)</span><br><span class="line"><span class="comment">#          one  two  peekaboo  four</span></span><br><span class="line"><span class="comment"># INDIANA    0    1         2     3</span></span><br><span class="line"><span class="comment"># COLO       4    5         6     7</span></span><br><span class="line"><span class="comment"># NEW        8    9        10    11</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># rename也有inplace属性</span></span><br><span class="line">x = data.rename(index=&#123;<span class="string">&#x27;OHIO&#x27;</span>: <span class="string">&#x27;INDIANA&#x27;</span>&#125;, inplace=<span class="literal">True</span>)</span><br><span class="line"><span class="built_in">print</span>(x)</span><br><span class="line"><span class="comment"># None</span></span><br></pre></td></tr></table></figure>



<p>离散化和⾯元划分</p>
<p>为了便于分析，连续数据常常被离散化或拆分为<code>面元</code>（bin）。<br>比如:现在有一组人员的年龄数据,将这些年龄划分为为“18到25”、“26到35”、“35到60”以及“60以上”⼏个<code>⾯元</code>。</p>
<p>使用pandas.cut函数:<code>cats = pd.cut(ages, bins)</code></p>
<ul>
<li><p>cats:<br>Categories对象</p>
</li>
<li><p>cats.codes:</p>
<p>这个分类的分类代码</p>
</li>
<li><p>cats.categories:<br>这个分类的类别</p>
</li>
<li><p>right:<br>控制右边是否为开</p>
</li>
<li><p>lables:<br>设置面元的名称</p>
</li>
<li><p>pd.value_counts(cats):<br>对面元大小计数</p>
</li>
<li><p>precision:<br>限定小数位数最多为n</p>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">ages = [<span class="number">20</span>, <span class="number">22</span>, <span class="number">25</span>, <span class="number">27</span>, <span class="number">21</span>, <span class="number">23</span>, <span class="number">37</span>, <span class="number">31</span>, <span class="number">61</span>, <span class="number">45</span>, <span class="number">41</span>, <span class="number">32</span>]</span><br><span class="line">bins = [<span class="number">18</span>, <span class="number">25</span>, <span class="number">35</span>, <span class="number">60</span>, <span class="number">100</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">cats = pd.cut(ages, bins)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 返回Categories对象</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(cats))</span><br><span class="line"><span class="comment"># &lt;class &#x27;pandas.core.arrays.categorical.Categorical&#x27;&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(cats)</span><br><span class="line"><span class="comment"># [(18, 25], (18, 25], (18, 25], (25, 35], (18, 25], ..., (25, 35], (60, 100], (35, 60], (35, 60], (25, 35]]</span></span><br><span class="line"><span class="comment"># Length: 12</span></span><br><span class="line"><span class="comment"># Categories (4, interval[int64]): [(18, 25] &lt; (25, 35] &lt; (35, 60] &lt; (60, 100]]</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 这个分类的分类代码。</span></span><br><span class="line"><span class="built_in">print</span>(cats.codes)</span><br><span class="line"><span class="comment"># [0 0 0 1 0 0 2 1 3 2 2 1]</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 这个分类的类别。(注意:默认是左开右闭)</span></span><br><span class="line"><span class="built_in">print</span>(cats.categories)</span><br><span class="line"><span class="comment"># IntervalIndex([(18, 25], (25, 35], (35, 60], (60, 100]]</span></span><br><span class="line"><span class="comment">#               closed=&#x27;right&#x27;,</span></span><br><span class="line"><span class="comment">#               dtype=&#x27;interval[int64]&#x27;)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 对pandas.cut结果的⾯元进行计数</span></span><br><span class="line"><span class="built_in">print</span>(pd.value_counts(cats))</span><br><span class="line"><span class="comment"># (18, 25]     5</span></span><br><span class="line"><span class="comment"># (35, 60]     3</span></span><br><span class="line"><span class="comment"># (25, 35]     3</span></span><br><span class="line"><span class="comment"># (60, 100]    1</span></span><br><span class="line"><span class="comment"># dtype: int64</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># right:控制右边是否为开</span></span><br><span class="line">cats = pd.cut(ages, [<span class="number">18</span>, <span class="number">26</span>, <span class="number">36</span>, <span class="number">61</span>, <span class="number">100</span>], right=<span class="literal">False</span>)</span><br><span class="line"><span class="built_in">print</span>(cats)</span><br><span class="line"><span class="comment"># [[18, 26), [18, 26), [18, 26), [26, 36), [18, 26), ..., [26, 36), [61, 100), [36, 61), [36, 61), [26, 36)]</span></span><br><span class="line"><span class="comment"># Length: 12</span></span><br><span class="line"><span class="comment"># Categories (4, interval[int64]): [[18, 26) &lt; [26, 36) &lt; [36, 61) &lt; [61, 100)]</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ages = [<span class="number">20</span>, <span class="number">22</span>, <span class="number">25</span>, <span class="number">27</span>, <span class="number">21</span>, <span class="number">23</span>, <span class="number">37</span>, <span class="number">31</span>, <span class="number">61</span>, <span class="number">45</span>, <span class="number">41</span>, <span class="number">32</span>]</span><br><span class="line">bins = [<span class="number">18</span>, <span class="number">25</span>, <span class="number">35</span>, <span class="number">60</span>, <span class="number">100</span>]</span><br><span class="line">group_names = [<span class="string">&#x27;Youth&#x27;</span>, <span class="string">&#x27;YoungAdult&#x27;</span>, <span class="string">&#x27;MiddleAged&#x27;</span>, <span class="string">&#x27;Senior&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># lables:设置面元的名称</span></span><br><span class="line">cats = pd.cut(ages, bins, labels=group_names)</span><br><span class="line"><span class="built_in">print</span>(cats)</span><br><span class="line"><span class="comment"># [Youth, Youth, Youth, YoungAdult, Youth, ..., YoungAdult, Senior, MiddleAged, MiddleAged, YoungAdult]</span></span><br><span class="line"><span class="comment"># Length: 12</span></span><br><span class="line"><span class="comment"># Categories (4, object): [Youth &lt; YoungAdult &lt; MiddleAged &lt; Senior]</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">data = np.random.rand(<span class="number">20</span>)</span><br><span class="line"><span class="built_in">print</span>(data)</span><br><span class="line"><span class="comment"># [0.61227823 0.26643464 0.98705774 0.21116076 0.01736529 0.5511922</span></span><br><span class="line"><span class="comment">#  0.15892424 0.50131    0.23453    0.57254727 0.84205302 0.80831397</span></span><br><span class="line"><span class="comment">#  0.81056495 0.8453584  0.42360283 0.50968521 0.97950919 0.22434297</span></span><br><span class="line"><span class="comment">#  0.07420821 0.66474358]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 传⼊的是⾯元的数量⽽不是确切的⾯元边界，则它会根据数据的最⼩值和最⼤值计算等⻓⾯元。</span></span><br><span class="line"><span class="comment"># 这个例⼦中，会将⼀些均匀分布的数据分成四组</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># precision:限定小数位数最多为2</span></span><br><span class="line"><span class="built_in">print</span>(pd.cut(data, <span class="number">4</span>, precision=<span class="number">2</span>))</span><br><span class="line"><span class="comment"># [(0.5, 0.74], (0.26, 0.5], (0.74, 0.99], (0.016, 0.26], (0.016, 0.26], ..., (0.5, 0.74], (0.74, 0.99], (0.016, 0.26], (0.016, 0.26], (0.5, 0.74]]</span></span><br><span class="line"><span class="comment"># Length: 20</span></span><br><span class="line"><span class="comment"># Categories (4, interval[float64]): [(0.016, 0.26] &lt; (0.26, 0.5] &lt; (0.5, 0.74] &lt; (0.74, 0.99]]</span></span><br></pre></td></tr></table></figure>

<p>qcut是⼀个⾮常类似于cut的函数，它可以根据样本分位数对数据进⾏⾯元划分.因此可以得到<strong>大小基本相等的面元</strong>：(每个面元的元素数量基本相等)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">data = np.random.randn(<span class="number">1000</span>) </span><br><span class="line"></span><br><span class="line"><span class="comment"># 根据样本分位数对数据进⾏⾯元划分,因此可以得到⼤⼩基本相等的⾯元：</span></span><br><span class="line">cats = pd.qcut(data, <span class="number">4</span>)  </span><br><span class="line"><span class="built_in">print</span>(cats)</span><br><span class="line"><span class="comment"># [(-0.66, 0.013], (-0.66, 0.013], (-2.8979999999999997, -0.66], (0.674, 2.814], (-0.66, 0.013], ..., (0.013, 0.674], (0.013, 0.674], (-0.66, 0.013], (-2.8979999999999997, -0.66], (0.674, 2.814]]</span></span><br><span class="line"><span class="comment"># Length: 1000</span></span><br><span class="line"><span class="comment"># Categories (4, interval[float64]): [(-2.8979999999999997, -0.66] &lt; (-0.66, 0.013] &lt; (0.013, 0.674] &lt; (0.674, 2.814]]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 面元大小基本相等</span></span><br><span class="line"><span class="built_in">print</span>(pd.value_counts(cats))</span><br><span class="line"><span class="comment"># (0.674, 2.814]                  250</span></span><br><span class="line"><span class="comment"># (0.013, 0.674]                  250</span></span><br><span class="line"><span class="comment"># (-0.66, 0.013]                  250</span></span><br><span class="line"><span class="comment"># (-2.8979999999999997, -0.66]    250</span></span><br><span class="line"><span class="comment"># dtype: int64</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 传递⾃定义的分位数（0到1之间的数值，包含端点）：</span></span><br><span class="line">ca = pd.qcut(data, [<span class="number">0</span>, <span class="number">0.1</span>, <span class="number">0.5</span>, <span class="number">0.9</span>, <span class="number">1.</span>])</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(ca)</span><br><span class="line"><span class="comment"># [(-1.295, 0.013], (-1.295, 0.013], (-1.295, 0.013], (1.253, 2.814], (-1.295, 0.013], ..., (0.013, 1.253], (0.013, 1.253], (-1.295, 0.013], (-1.295, 0.013], (0.013, 1.253]]</span></span><br><span class="line"><span class="comment"># Length: 1000</span></span><br><span class="line"><span class="comment"># Categories (4, interval[float64]): [(-2.8979999999999997, -1.295] &lt; (-1.295, 0.013] &lt; (0.013, 1.253] &lt;</span></span><br><span class="line"><span class="comment">#                                     (1.253, 2.814]]</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(pd.value_counts(ca))</span><br><span class="line"><span class="comment"># (0.013, 1.253]                   400</span></span><br><span class="line"><span class="comment"># (-1.295, 0.013]                  400</span></span><br><span class="line"><span class="comment"># (1.253, 2.814]                   100</span></span><br><span class="line"><span class="comment"># (-2.8979999999999997, -1.295]    100</span></span><br><span class="line"><span class="comment"># dtype: int64</span></span><br></pre></td></tr></table></figure>



<p>检测和过滤异常值:</p>
<p>np.sign(df):根据数据的值是正还是负,返回1或-1</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="comment"># 正态分布的DataFrame</span></span><br><span class="line">data = pd.DataFrame(np.random.randn(<span class="number">1000</span>, <span class="number">4</span>))</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(data.describe())</span><br><span class="line"><span class="comment">#                  0            1            2            3</span></span><br><span class="line"><span class="comment"># count  1000.000000  1000.000000  1000.000000  1000.000000</span></span><br><span class="line"><span class="comment"># mean      0.001186    -0.011577    -0.022340    -0.037435</span></span><br><span class="line"><span class="comment"># std       1.030316     1.013564     0.995029     1.076454</span></span><br><span class="line"><span class="comment"># min      -3.041240    -2.801578    -3.434478    -3.507477</span></span><br><span class="line"><span class="comment"># 25%      -0.682765    -0.642027    -0.659873    -0.779336</span></span><br><span class="line"><span class="comment"># 50%       0.038580    -0.007997    -0.042658    -0.060064</span></span><br><span class="line"><span class="comment"># 75%       0.643663     0.680967     0.662104     0.673498</span></span><br><span class="line"><span class="comment"># max       4.063368     3.352299     3.377122     3.341305</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 某列中绝对值⼤⼩超过3的值：</span></span><br><span class="line">col = data[<span class="number">2</span>]</span><br><span class="line"><span class="built_in">print</span>(col[np.<span class="built_in">abs</span>(col) &gt; <span class="number">3</span>])</span><br><span class="line"><span class="comment"># 10    -3.074688</span></span><br><span class="line"><span class="comment"># 41    -3.434478</span></span><br><span class="line"><span class="comment"># 201   -3.066475</span></span><br><span class="line"><span class="comment"># 796    3.010803</span></span><br><span class="line"><span class="comment"># 896    3.377122</span></span><br><span class="line"><span class="comment"># Name: 2, dtype: float64</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 选出全部含有“超过3或－3的值”的⾏</span></span><br><span class="line"><span class="built_in">print</span>(data[(np.<span class="built_in">abs</span>(data) &gt; <span class="number">3</span>).<span class="built_in">any</span>(axis=<span class="number">1</span>)])</span><br><span class="line"><span class="comment">#             0         1         2         3</span></span><br><span class="line"><span class="comment"># 10   0.399631 -1.872873 -3.074688 -0.830713</span></span><br><span class="line"><span class="comment"># 41   1.252504  2.392584 -3.434478  2.768397</span></span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line"><span class="comment"># 862  3.015624 -0.078902 -0.388504  0.220393</span></span><br><span class="line"><span class="comment"># 896 -1.152745  0.992461  3.377122 -0.394303</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># sign():根据数据的值是正还是负，⽣成1和-1</span></span><br><span class="line"><span class="comment"># 将元素的值限定在[-3,3],超出的值将被强制设置为-3/3</span></span><br><span class="line">data[np.<span class="built_in">abs</span>(data) &gt; <span class="number">3</span>] = np.sign(data) * <span class="number">3</span></span><br><span class="line"><span class="built_in">print</span>(data.describe())</span><br><span class="line"><span class="comment">#                  0            1            2            3</span></span><br><span class="line"><span class="comment"># count  1000.000000  1000.000000  1000.000000  1000.000000</span></span><br><span class="line"><span class="comment"># mean     -0.000274    -0.011929    -0.022152    -0.037598</span></span><br><span class="line"><span class="comment"># std       1.025224     1.012455     0.991949     1.072968</span></span><br><span class="line"><span class="comment"># min      -3.000000    -2.801578    -3.000000    -3.000000</span></span><br><span class="line"><span class="comment"># 25%      -0.682765    -0.642027    -0.659873    -0.779336</span></span><br><span class="line"><span class="comment"># 50%       0.038580    -0.007997    -0.042658    -0.060064</span></span><br><span class="line"><span class="comment"># 75%       0.643663     0.680967     0.662104     0.673498</span></span><br><span class="line"><span class="comment"># max       3.000000     3.000000     3.000000     3.000000</span></span><br></pre></td></tr></table></figure>



<p>排列和随机采样:</p>
<ul>
<li>numpy.random.permutation():<br>产生随机顺序的整数数组</li>
<li>df.take():<br>获取行/列</li>
<li>df.sample(n=3)<br>随机抽取列</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">df = pd.DataFrame(np.arange(<span class="number">5</span> * <span class="number">4</span>).reshape((<span class="number">5</span>, <span class="number">4</span>)))</span><br><span class="line"><span class="built_in">print</span>(df)</span><br><span class="line"><span class="comment">#     0   1   2   3</span></span><br><span class="line"><span class="comment"># 0   0   1   2   3</span></span><br><span class="line"><span class="comment"># 1   4   5   6   7</span></span><br><span class="line"><span class="comment"># 2   8   9  10  11</span></span><br><span class="line"><span class="comment"># 3  12  13  14  15</span></span><br><span class="line"><span class="comment"># 4  16  17  18  19</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># permutation():产生随机顺序的整数数组</span></span><br><span class="line">sampler = np.random.permutation(<span class="number">5</span>)</span><br><span class="line"><span class="built_in">print</span>(sampler)</span><br><span class="line"><span class="comment"># [3 2 1 0 4]</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(df.take([<span class="number">1</span>],axis=<span class="number">1</span>))</span><br><span class="line"><span class="comment">#     1</span></span><br><span class="line"><span class="comment"># 0   1</span></span><br><span class="line"><span class="comment"># 1   5</span></span><br><span class="line"><span class="comment"># 2   9</span></span><br><span class="line"><span class="comment"># 3  13</span></span><br><span class="line"><span class="comment"># 4  17</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 根据permutation的值获取行数据</span></span><br><span class="line"><span class="built_in">print</span>(df.take(sampler))</span><br><span class="line"><span class="comment">#     0   1   2   3</span></span><br><span class="line"><span class="comment"># 3  12  13  14  15</span></span><br><span class="line"><span class="comment"># 2   8   9  10  11</span></span><br><span class="line"><span class="comment"># 1   4   5   6   7</span></span><br><span class="line"><span class="comment"># 0   0   1   2   3</span></span><br><span class="line"><span class="comment"># 4  16  17  18  19</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 随机抽取3行/列(使用axis参数)</span></span><br><span class="line"><span class="built_in">print</span>(df.sample(n=<span class="number">3</span>))</span><br><span class="line"><span class="comment">#     0   1   2   3</span></span><br><span class="line"><span class="comment"># 4  16  17  18  19</span></span><br><span class="line"><span class="comment"># 2   8   9  10  11</span></span><br><span class="line"><span class="comment"># 3  12  13  14  15</span></span><br></pre></td></tr></table></figure>



<hr>
<p>计算指标/哑变量</p>
<p>前期知识预备:</p>
<ol>
<li><p>在构建回归模型时，如果自变量X为连续性变量，回归系数β可以解释为：在其他自变量不变的条件下，X每改变一个单位，所引起的因变量Y的平均变化量；如果自变量X为二分类变量，例如是否饮酒（1=是，0=否），则回归系数β可以解释为：其他自变量不变的条件下，X=1（饮酒者）与X=0（不饮酒者）相比，所引起的因变量Y的平均变化量。</p>
<p>但是，当自变量X为<strong>多分类变量</strong>时，例如职业、学历、血型、疾病严重程度等等，此时仅用一个回归系数来解释多分类变量之间的变化关系，及其对因变量的影响，就显得太不理想。</p>
<p>此时，我们通常会将原始的多分类变量转化为哑变量，每个哑变量只代表某两个级别或若干个级别间的差异，通过构建回归模型，每一个哑变量都能得出一个估计的回归系数，从而使得回归的结果更易于解释，更具有实际意义。</p>
</li>
<li><p>哑变量:也叫<code>虚拟变量</code>( Dummy Variables)</p>
</li>
<li><p>分类型变量:<br>如性别,班级,科目等等.<br>对于性别这样的分类型变量,我们就需要用一个数值来表示它们，常用0和1来表示，如男性为1，女性为0。<br>这样将性别“量化”的方法是为了在统计分析模型中纳入性别的影响，提高模型的精度。广义上说这就是对哑变量（Dummy variable）的应用。</p>
</li>
<li><p>哑变量:<br>就是用一些数值上虚拟的值（0或1）去代替那些无法直接纳入统计分析的变量。对于性别这种两分类的情况，我们只需要设置0和1即可，那么对于胃癌的病理类型（有4个分类）呢，我们就需要用一系列数值来表示了，它应该设置成如下结构：</p>
<table>
<thead>
<tr>
<th></th>
<th>D1</th>
<th>D2</th>
<th>D3</th>
</tr>
</thead>
<tbody><tr>
<td>腺癌</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td>粘液腺癌</td>
<td>1</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td>印戒细胞癌</td>
<td>0</td>
<td>1</td>
<td>0</td>
</tr>
<tr>
<td>特殊类型癌</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
</tbody></table>
<p>也就是说我们引进了3个变量来表达上述4种病理类型，3个变量分别是D1、D2和D3。</p>
<p>为什么不引入4个变量呢？伍德里奇在《计量经济学导论》中说“如果某个定性变量有m种互相排斥的类型，则模型中只能引入m-1个虚拟变量，否则会陷入虚拟变量陷阱，产生完全共线性。”感兴趣的可以了解一下。不感兴趣的，知道<strong>某一个变量如果有m个互斥的分类设成m-1个哑变量</strong>就ok了。</p>
</li>
<li><p>==设置哑变量就是为了将分类变量数量化==，然后纳入分析模型进行分析。哑变量的引入，扩大了回归分析中自变量的纳入范围，也就是说分类变量也可以纳入回归分析啦。</p>
</li>
<li><p>参考资料:<br><a target="_blank" rel="noopener" href="http://www.sohu.com/a/199698358_489312">回归模型中的哑变量是个啥？何时需要设置哑变量？</a></p>
</li>
</ol>
<p>将分类变量（categorical variable）转换为<code>哑变量</code>或<code>指标矩阵</code>。</p>
<ul>
<li>get_dummies函数:<br>==如果DataFrame的某⼀列中含有k个不同的值，则可以派⽣出⼀个k列矩阵或DataFrame（其值全为1和0）==。</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># get_dummies():创建哑变量</span></span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">se = pd.Series(&#123;<span class="string">&#x27;key&#x27;</span>: [<span class="string">&#x27;hyl&#x27;</span>,<span class="string">&#x27;dsz&#x27;</span>,<span class="string">&#x27;czj&#x27;</span>,<span class="string">&#x27;gzr&#x27;</span>,<span class="string">&#x27;hyl&#x27;</span>,<span class="string">&#x27;gzr&#x27;</span>]&#125;)</span><br><span class="line"><span class="built_in">print</span>(se)</span><br><span class="line"><span class="comment"># key    [hyl, dsz, czj, gzr, hyl, gzr]</span></span><br><span class="line"><span class="comment"># dtype: object</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(pd.get_dummies(se[<span class="string">&#x27;key&#x27;</span>]))</span><br><span class="line"><span class="comment">#    czj  dsz  gzr  hyl</span></span><br><span class="line"><span class="comment"># 0    0    0    0    1</span></span><br><span class="line"><span class="comment"># 1    0    1    0    0</span></span><br><span class="line"><span class="comment"># 2    1    0    0    0</span></span><br><span class="line"><span class="comment"># 3    0    0    1    0</span></span><br><span class="line"><span class="comment"># 4    0    0    0    1</span></span><br><span class="line"><span class="comment"># 5    0    0    1    0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">df = pd.DataFrame(&#123;<span class="string">&#x27;key&#x27;</span>: [<span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>]&#125;)</span><br><span class="line"><span class="built_in">print</span>(df)</span><br><span class="line"><span class="comment">#   key</span></span><br><span class="line"><span class="comment"># 0   b</span></span><br><span class="line"><span class="comment"># 1   b</span></span><br><span class="line"><span class="comment"># 2   a</span></span><br><span class="line"><span class="comment"># 3   c</span></span><br><span class="line"><span class="comment"># 4   a</span></span><br><span class="line"><span class="comment"># 5   b</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(pd.get_dummies(df[<span class="string">&#x27;key&#x27;</span>]))</span><br><span class="line"><span class="comment">#    a  b  c</span></span><br><span class="line"><span class="comment"># 0  0  1  0</span></span><br><span class="line"><span class="comment"># 1  0  1  0</span></span><br><span class="line"><span class="comment"># 2  1  0  0</span></span><br><span class="line"><span class="comment"># 3  0  0  1</span></span><br><span class="line"><span class="comment"># 4  1  0  0</span></span><br><span class="line"><span class="comment"># 5  0  1  0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">df = pd.DataFrame(&#123;<span class="string">&#x27;key&#x27;</span>: [<span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>],</span><br><span class="line">                   <span class="string">&#x27;data1&#x27;</span>: <span class="built_in">range</span>(<span class="number">6</span>)&#125;)</span><br><span class="line"><span class="built_in">print</span>(df)</span><br><span class="line"><span class="comment">#   key  data1</span></span><br><span class="line"><span class="comment"># 0   b      0</span></span><br><span class="line"><span class="comment"># 1   b      1</span></span><br><span class="line"><span class="comment"># 2   a      2</span></span><br><span class="line"><span class="comment"># 3   c      3</span></span><br><span class="line"><span class="comment"># 4   a      4</span></span><br><span class="line"><span class="comment"># 5   b      5</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(pd.get_dummies(df[<span class="string">&#x27;key&#x27;</span>]))</span><br><span class="line"><span class="comment">#    a  b  c</span></span><br><span class="line"><span class="comment"># 0  0  1  0</span></span><br><span class="line"><span class="comment"># 1  0  1  0</span></span><br><span class="line"><span class="comment"># 2  1  0  0</span></span><br><span class="line"><span class="comment"># 3  0  0  1</span></span><br><span class="line"><span class="comment"># 4  1  0  0</span></span><br><span class="line"><span class="comment"># 5  0  1  0</span></span><br></pre></td></tr></table></figure>

<p>注意:</p>
<ul>
<li><code>df[[&#39;data1&#39;]]</code>:DataFrame类型</li>
<li><code>df[&#39;data1&#39;]</code>:Series类型</li>
</ul>
<ul>
<li>index对象具有字典的映射功能:<ol>
<li>get_loc(value):获得一个标签的索引值</li>
<li>get_indexer(values):获得一组标签的索引值，当值不存在则返回-1</li>
</ol>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">df = pd.DataFrame(&#123;<span class="string">&#x27;key&#x27;</span>: [<span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>],</span><br><span class="line">                   <span class="string">&#x27;data1&#x27;</span>: <span class="built_in">range</span>(<span class="number">6</span>)&#125;)</span><br><span class="line"><span class="built_in">print</span>(df)</span><br><span class="line"><span class="comment">#   key  data1</span></span><br><span class="line"><span class="comment"># 0   b      0</span></span><br><span class="line"><span class="comment"># 1   b      1</span></span><br><span class="line"><span class="comment"># 2   a      2</span></span><br><span class="line"><span class="comment"># 3   c      3</span></span><br><span class="line"><span class="comment"># 4   a      4</span></span><br><span class="line"><span class="comment"># 5   b      5</span></span><br><span class="line"></span><br><span class="line">x = pd.get_dummies(df[<span class="string">&#x27;key&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用get_dummies添加哑变量,类型还是DF</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(x))</span><br><span class="line"><span class="comment"># &lt;class &#x27;pandas.core.frame.DataFrame&#x27;&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(x)</span><br><span class="line"><span class="comment">#    a  b  c</span></span><br><span class="line"><span class="comment"># 0  0  1  0</span></span><br><span class="line"><span class="comment"># 1  0  1  0</span></span><br><span class="line"><span class="comment"># 2  1  0  0</span></span><br><span class="line"><span class="comment"># 3  0  0  1</span></span><br><span class="line"><span class="comment"># 4  1  0  0</span></span><br><span class="line"><span class="comment"># 5  0  1  0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># prefix:给列名添加前缀</span></span><br><span class="line">dummies = pd.get_dummies(df[<span class="string">&#x27;key&#x27;</span>], prefix=<span class="string">&#x27;hyl&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(dummies)</span><br><span class="line"><span class="comment">#    hyl_a  hyl_b  hyl_c</span></span><br><span class="line"><span class="comment"># 0      0      1      0</span></span><br><span class="line"><span class="comment"># 1      0      1      0</span></span><br><span class="line"><span class="comment"># 2      1      0      0</span></span><br><span class="line"><span class="comment"># 3      0      0      1</span></span><br><span class="line"><span class="comment"># 4      1      0      0</span></span><br><span class="line"><span class="comment"># 5      0      1      0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># df[[&#x27;data1&#x27;]]:这是DaTaFrame类型</span></span><br><span class="line">df_with_dummy = df[[<span class="string">&#x27;data1&#x27;</span>]].join(dummies)</span><br><span class="line"><span class="built_in">print</span>(df_with_dummy)</span><br><span class="line"><span class="comment">#    data1  hyl_a  hyl_b  hyl_c</span></span><br><span class="line"><span class="comment"># 0      0      0      1      0</span></span><br><span class="line"><span class="comment"># 1      1      0      1      0</span></span><br><span class="line"><span class="comment"># 2      2      1      0      0</span></span><br><span class="line"><span class="comment"># 3      3      0      0      1</span></span><br><span class="line"><span class="comment"># 4      4      1      0      0</span></span><br><span class="line"><span class="comment"># 5      5      0      1      0</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(df[[<span class="string">&#x27;data1&#x27;</span>]]))</span><br><span class="line"><span class="comment"># &lt;class &#x27;pandas.core.frame.DataFrame&#x27;&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(df[<span class="string">&#x27;data1&#x27;</span>]))</span><br><span class="line"><span class="comment"># &lt;class &#x27;pandas.core.series.Series&#x27;&gt;</span></span><br></pre></td></tr></table></figure>

<p>如果DataFrame中的某⾏同属于多个分类，则事情就会有点复杂。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">movies.dat的内容为:</span><br><span class="line"></span><br><span class="line">1::Toy Story (1995)::Animation|Children&#x27;s|Comedy</span><br><span class="line">2::Jumanji (1995)::Adventure|Children&#x27;s|Fantasy</span><br><span class="line">3::Grumpier Old Men (1995)::Comedy|Romance</span><br><span class="line">4::Waiting to Exhale (1995)::Comedy|Drama</span><br></pre></td></tr></table></figure>

<p>有三列,<code>电影id</code>,<code>标题</code>,<code>分类</code>.可以发现,一部电影有很多的分类</p>
<p>现在要找出所有的分类,并且构建指标(找出每部电影含有和不含有的分类):</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mnames = [<span class="string">&#x27;movie_id&#x27;</span>, <span class="string">&#x27;title&#x27;</span>, <span class="string">&#x27;genres&#x27;</span>]</span><br><span class="line">movies = pd.read_table(<span class="string">&#x27;datasets/movielens/movies.dat&#x27;</span>, sep=<span class="string">&#x27;::&#x27;</span>,</span><br><span class="line">                       header=<span class="literal">None</span>, names=mnames)</span><br><span class="line"><span class="built_in">print</span>(movies.head())</span><br><span class="line"><span class="comment">#    movie_id              ...                                     genres</span></span><br><span class="line"><span class="comment"># 0         1              ...                Animation|Children&#x27;s|Comedy</span></span><br><span class="line"><span class="comment"># 1         2              ...               Adventure|Children&#x27;s|Fantasy</span></span><br><span class="line"><span class="comment"># 2         3              ...                             Comedy|Romance</span></span><br><span class="line"><span class="comment"># 3         4              ...                               Comedy|Drama</span></span><br><span class="line"><span class="comment"># 4         5              ...                                     Comedy</span></span><br><span class="line"><span class="comment"># [5 rows x 3 columns]</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">all_genres = []</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> movies.genres:</span><br><span class="line">    all_genres.extend(x.split(<span class="string">&#x27;|&#x27;</span>))</span><br><span class="line">genres = pd.unique(all_genres)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(genres))</span><br><span class="line"><span class="comment"># &lt;class &#x27;numpy.ndarray&#x27;&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 找出所有的分类</span></span><br><span class="line"><span class="built_in">print</span>(genres)</span><br><span class="line"><span class="comment"># [&#x27;Animation&#x27; &quot;Children&#x27;s&quot; &#x27;Comedy&#x27; &#x27;Adventure&#x27; &#x27;Fantasy&#x27; &#x27;Romance&#x27; &#x27;Drama&#x27;</span></span><br><span class="line"><span class="comment">#  &#x27;Action&#x27; &#x27;Crime&#x27; &#x27;Thriller&#x27; &#x27;Horror&#x27; &#x27;Sci-Fi&#x27; &#x27;Documentary&#x27; &#x27;War&#x27;</span></span><br><span class="line"><span class="comment">#  &#x27;Musical&#x27; &#x27;Mystery&#x27; &#x27;Film-Noir&#x27; &#x27;Western&#x27;]</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;-------------------&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 构建一个全零DataFrame,列标签为所有的分类</span></span><br><span class="line">zero_matrix = np.zeros((<span class="built_in">len</span>(movies), <span class="built_in">len</span>(genres)))</span><br><span class="line">dummies = pd.DataFrame(zero_matrix, columns=genres)</span><br><span class="line"></span><br><span class="line"><span class="comment"># # 获取第一行数据的分类</span></span><br><span class="line"><span class="comment"># gen = movies.genres[0]</span></span><br><span class="line"><span class="comment"># print(gen)  # Animation|Children&#x27;s|Comedy</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># # 尝试使用get_indexer,获取一组标签的索引值</span></span><br><span class="line"><span class="comment"># idx = dummies.columns.get_indexer(gen.split(&#x27;|&#x27;))</span></span><br><span class="line"><span class="comment"># print(idx)  # [0 1 2]</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取全部行的分类</span></span><br><span class="line"><span class="keyword">for</span> i, gen <span class="keyword">in</span> <span class="built_in">enumerate</span>(movies.genres):</span><br><span class="line">	<span class="comment"># 找出当前这部电影的分类 在dummies的分类列 中的索引值</span></span><br><span class="line">    indices = dummies.columns.get_indexer(gen.split(<span class="string">&#x27;|&#x27;</span>))</span><br><span class="line">    <span class="comment"># 将该元素设置为1</span></span><br><span class="line">    dummies.iloc[i, indices] = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 给dummies的列添加前缀</span></span><br><span class="line">movies_windic = movies.join(dummies.add_prefix(<span class="string">&#x27;Genre_&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 得出第一部电影含有和不含有的分类</span></span><br><span class="line"><span class="built_in">print</span>(movies_windic.iloc[<span class="number">0</span>])</span><br><span class="line"><span class="comment"># movie_id                                       1</span></span><br><span class="line"><span class="comment"># title                           Toy Story (1995)</span></span><br><span class="line"><span class="comment"># genres               Animation|Children&#x27;s|Comedy</span></span><br><span class="line"><span class="comment"># Genre_Animation                                1</span></span><br><span class="line"><span class="comment"># Genre_Children&#x27;s                               1</span></span><br><span class="line"><span class="comment"># Genre_Comedy                                   1</span></span><br><span class="line"><span class="comment"># Genre_Adventure                                0</span></span><br><span class="line"><span class="comment"># Genre_Fantasy                                  0</span></span><br><span class="line"><span class="comment"># Genre_Romance                                  0</span></span><br><span class="line"><span class="comment"># Genre_Drama                                    0</span></span><br><span class="line"><span class="comment"># Genre_Action                                   0</span></span><br><span class="line"><span class="comment"># Genre_Crime                                    0</span></span><br><span class="line"><span class="comment"># Genre_Thriller                                 0</span></span><br><span class="line"><span class="comment"># Genre_Horror                                   0</span></span><br><span class="line"><span class="comment"># Genre_Sci-Fi                                   0</span></span><br><span class="line"><span class="comment"># Genre_Documentary                              0</span></span><br><span class="line"><span class="comment"># Genre_War                                      0</span></span><br><span class="line"><span class="comment"># Genre_Musical                                  0</span></span><br><span class="line"><span class="comment"># Genre_Mystery                                  0</span></span><br><span class="line"><span class="comment"># Genre_Film-Noir                                0</span></span><br><span class="line"><span class="comment"># Genre_Western                                  0</span></span><br><span class="line"><span class="comment"># Name: 0, dtype: object</span></span><br></pre></td></tr></table></figure>

<p>⼀个对统计应⽤有⽤的秘诀是：<br><strong>结合get_dummies和诸如cut之类的离散化函数</strong>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">np.random.seed(<span class="number">12345</span>)</span><br><span class="line">values = np.random.rand(<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(values)</span><br><span class="line"><span class="comment"># [0.92961609 0.31637555 0.18391881 0.20456028 0.56772503 0.5955447</span></span><br><span class="line"><span class="comment">#  0.96451452 0.6531771  0.74890664 0.65356987]</span></span><br><span class="line"></span><br><span class="line">bins = [<span class="number">0</span>, <span class="number">0.2</span>, <span class="number">0.4</span>, <span class="number">0.6</span>, <span class="number">0.8</span>, <span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 切割,取得分类</span></span><br><span class="line">categories = pd.cut(values, bins)</span><br><span class="line"><span class="built_in">print</span>(categories)</span><br><span class="line"><span class="comment"># [(0.8, 1.0], (0.2, 0.4], (0.0, 0.2], (0.2, 0.4], (0.4, 0.6], (0.4, 0.6], (0.8, 1.0], (0.6, 0.8], (0.6, 0.8], (0.6, 0.8]]</span></span><br><span class="line"><span class="comment"># Categories (5, interval[float64]): [(0.0, 0.2] &lt; (0.2, 0.4] &lt; (0.4, 0.6] &lt; (0.6, 0.8] &lt; (0.8, 1.0]]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 将分类传给get_dummies,制作成哑变量</span></span><br><span class="line"><span class="built_in">print</span>(pd.get_dummies(categories))</span><br><span class="line"><span class="comment">#    (0.0, 0.2]  (0.2, 0.4]  (0.4, 0.6]  (0.6, 0.8]  (0.8, 1.0]</span></span><br><span class="line"><span class="comment"># 0           0           0           0           0           1</span></span><br><span class="line"><span class="comment"># 1           0           1           0           0           0</span></span><br><span class="line"><span class="comment"># 2           1           0           0           0           0</span></span><br><span class="line"><span class="comment"># 3           0           1           0           0           0</span></span><br><span class="line"><span class="comment"># 4           0           0           1           0           0</span></span><br><span class="line"><span class="comment"># 5           0           0           1           0           0</span></span><br><span class="line"><span class="comment"># 6           0           0           0           0           1</span></span><br><span class="line"><span class="comment"># 7           0           0           0           1           0</span></span><br><span class="line"><span class="comment"># 8           0           0           0           1           0</span></span><br><span class="line"><span class="comment"># 9           0           0           0           1           0</span></span><br></pre></td></tr></table></figure>



<hr>
<h2 id="7-3-字符串操作"><a href="#7-3-字符串操作" class="headerlink" title="7.3 字符串操作"></a>7.3 字符串操作</h2><p>字符串对象⽅法<br>老生常谈的东西.不多讲</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">val = <span class="string">&#x27;a,b,  guido&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(val.split(<span class="string">&#x27;,&#x27;</span>))</span><br><span class="line"><span class="comment"># [&#x27;a&#x27;, &#x27;b&#x27;, &#x27;  guido&#x27;]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># split常常与strip⼀起使⽤，以去除空⽩符</span></span><br><span class="line">pieces = [x.strip() <span class="keyword">for</span> x <span class="keyword">in</span> val.split(<span class="string">&#x27;,&#x27;</span>)]</span><br><span class="line"><span class="built_in">print</span>(pieces)</span><br><span class="line"><span class="comment"># [&#x27;a&#x27;, &#x27;b&#x27;, &#x27;guido&#x27;]</span></span><br><span class="line"></span><br><span class="line">val = <span class="string">&#x27;::&#x27;</span>.join(pieces)</span><br><span class="line"><span class="built_in">print</span>(val)</span><br><span class="line"><span class="comment"># a::b::guido</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(val.find(<span class="string">&#x27;guido&#x27;</span>))</span><br><span class="line"><span class="comment"># 6</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(val.count(<span class="string">&#x27;:&#x27;</span>))</span><br><span class="line"><span class="comment"># 4</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(val.replace(<span class="string">&#x27;:&#x27;</span>,<span class="string">&#x27;&#x27;</span>))</span><br><span class="line"><span class="comment"># abguido</span></span><br></pre></td></tr></table></figure>

<p>正则:<br>注意<code>re.split</code>方法</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">text = <span class="string">&#x27;hyl is \t sb&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(re.split(<span class="string">&#x27;\s&#x27;</span>,text))</span><br><span class="line"><span class="comment"># [&#x27;hyl&#x27;, &#x27;is&#x27;, &#x27;&#x27;, &#x27;&#x27;, &#x27;sb&#x27;]</span></span><br></pre></td></tr></table></figure>



<p>pandas的⽮量化字符串函数</p>
<p>就像前面说的,series.map能将函数映射到数据上,但是如果存在NA（null）就会报错。</p>
<ul>
<li>pandas调用python的原生字符串方法要加一个str,有点类似于Scrapy</li>
<li>==pandas调用正则也是在前面添加str==</li>
</ul>
<p>也就是说,<strong>pandas的字符串方法和正则表达式共用一个str属性</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">data = &#123;<span class="string">&#x27;Dave&#x27;</span>: <span class="string">&#x27;asdasd dave@google.com&#x27;</span>, <span class="string">&#x27;Steve&#x27;</span>: <span class="string">&#x27;asdasd steve@gmail.com&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;Rob&#x27;</span>: <span class="string">&#x27;asdasd rob@gmail.com&#x27;</span>, <span class="string">&#x27;Wes&#x27;</span>: np.nan&#125;</span><br><span class="line">data = pd.Series(data)</span><br><span class="line"><span class="built_in">print</span>(data)</span><br><span class="line"><span class="comment"># Dave     asdasd dave@google.com</span></span><br><span class="line"><span class="comment"># Steve    asdasd steve@gmail.com</span></span><br><span class="line"><span class="comment"># Rob        asdasd rob@gmail.com</span></span><br><span class="line"><span class="comment"># Wes                         NaN</span></span><br><span class="line"><span class="comment"># dtype: object</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 调用py的原生方法要加一个str,有点类似于Scrapy</span></span><br><span class="line"><span class="built_in">print</span>(data.<span class="built_in">str</span>.contains(<span class="string">&#x27;gmail&#x27;</span>))</span><br><span class="line"><span class="comment"># Dave     False</span></span><br><span class="line"><span class="comment"># Steve     True</span></span><br><span class="line"><span class="comment"># Rob       True</span></span><br><span class="line"><span class="comment"># Wes        NaN</span></span><br><span class="line"><span class="comment"># dtype: object</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">pattern = <span class="string">r&#x27;[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]&#123;2,4&#125;&#x27;</span></span><br><span class="line">result = data.<span class="built_in">str</span>.findall(pattern, flags=re.IGNORECASE)</span><br><span class="line"><span class="built_in">print</span>(result)</span><br><span class="line"><span class="comment"># Dave     [dave@google.com]</span></span><br><span class="line"><span class="comment"># Steve    [steve@gmail.com]</span></span><br><span class="line"><span class="comment"># Rob        [rob@gmail.com]</span></span><br><span class="line"><span class="comment"># Wes                    NaN</span></span><br><span class="line"><span class="comment"># dtype: object</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">matches = data.<span class="built_in">str</span>.match(pattern, flags=re.IGNORECASE)</span><br><span class="line"><span class="built_in">print</span>(matches)</span><br><span class="line"><span class="comment"># Dave     False</span></span><br><span class="line"><span class="comment"># Steve    False</span></span><br><span class="line"><span class="comment"># Rob      False</span></span><br><span class="line"><span class="comment"># Wes        NaN</span></span><br><span class="line"><span class="comment"># dtype: object</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(matches.<span class="built_in">str</span>.get(<span class="number">1</span>))</span><br><span class="line"><span class="comment"># Dave    NaN</span></span><br><span class="line"><span class="comment"># Steve   NaN</span></span><br><span class="line"><span class="comment"># Rob     NaN</span></span><br><span class="line"><span class="comment"># Wes     NaN</span></span><br><span class="line"><span class="comment"># dtype: float64</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(matches.<span class="built_in">str</span>[<span class="number">0</span>])</span><br><span class="line"><span class="comment"># Dave    NaN</span></span><br><span class="line"><span class="comment"># Steve   NaN</span></span><br><span class="line"><span class="comment"># Rob     NaN</span></span><br><span class="line"><span class="comment"># Wes     NaN</span></span><br><span class="line"><span class="comment"># dtype: float64</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(data.<span class="built_in">str</span>[:<span class="number">5</span>])</span><br><span class="line"><span class="comment"># Dave     asdas</span></span><br><span class="line"><span class="comment"># Steve    asdas</span></span><br><span class="line"><span class="comment"># Rob      asdas</span></span><br><span class="line"><span class="comment"># Wes        NaN</span></span><br><span class="line"><span class="comment"># dtype: object</span></span><br></pre></td></tr></table></figure>

<p>部分⽮量化字符串⽅法</p>
<p><img src="/images/702537.png" alt="702537"></p>
</div></div><div class="post-main post-comment"></div></article><link rel="stylesheet" type="text/css" href="/css/font.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.css"><script src="//cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script><script src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script>$(document).ready(function() {
  $(".fancybox").fancybox();
});
</script></body></html>
<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content=" id=&quot;第6章-数据加载、存储与⽂件格式&quot;&gt;&lt;a href=&quot;#第6章-数据加载、存储与⽂件格式&quot; class=&quot;headerlink&quot; title=&quot;第6章 数据加载、存储与⽂件格式&quot;&gt;&lt;/a&gt;第6章 数据加载、存储与⽂件格式&lt;/h1&gt;&lt;p&gt;输⼊输出通常可以划分为⼏个⼤类："><link rel="stylesheet" type="text/css" href="/css/normalize.css"><link rel="stylesheet" type="text/css" href="/css/highlight.css"><link rel="stylesheet" type="text/css" href="/css/noise.css"><title>利用Python进行数据分析3_第6章_数据加载、存储与文件格式 | 凉薄的自动书记人偶</title><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><meta name="generator" content="Hexo 5.4.0"></head><body><article class="wrapper"><div class="post-main"><div class="nav"><nav class="container"><a class="sidebar-nav-item active" href="/">Home</a></nav><div class="container post-meta"><div class="post-tags"><a class="post-tag-none-link" href="/tags/Python/" rel="tag">Python</a></div><div class="post-time">2019-06-06</div></div></div><div class="container post-header"><h1>利用Python进行数据分析3_第6章_数据加载、存储与文件格式</h1></div><div class="container post-toc"><details class="toc"><summary class="toc-accordion">Table of Contents</summary><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC6%E7%AB%A0-%E6%95%B0%E6%8D%AE%E5%8A%A0%E8%BD%BD%E3%80%81%E5%AD%98%E5%82%A8%E4%B8%8E%E2%BD%82%E4%BB%B6%E6%A0%BC%E5%BC%8F"><span class="toc-number">1.</span> <span class="toc-text">第6章 数据加载、存储与⽂件格式</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#6-1-%E8%AF%BB%E5%86%99%E2%BD%82%E6%9C%AC%E6%A0%BC%E5%BC%8F%E7%9A%84%E6%95%B0%E6%8D%AE"><span class="toc-number">1.1.</span> <span class="toc-text">6.1 读写⽂本格式的数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-2-%E2%BC%86%E8%BF%9B%E5%88%B6%E6%95%B0%E6%8D%AE%E6%A0%BC%E5%BC%8F"><span class="toc-number">1.2.</span> <span class="toc-text">6.2 ⼆进制数据格式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-3-Web-APIs%E4%BA%A4%E4%BA%92"><span class="toc-number">1.3.</span> <span class="toc-text">6.3 Web APIs交互</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-4-%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BA%A4%E4%BA%92"><span class="toc-number">1.4.</span> <span class="toc-text">6.4 数据库交互</span></a></li></ol></li></ol></details></div><div class="container post-content"><h1 id="第6章-数据加载、存储与⽂件格式"><a href="#第6章-数据加载、存储与⽂件格式" class="headerlink" title="第6章 数据加载、存储与⽂件格式"></a>第6章 数据加载、存储与⽂件格式</h1><p>输⼊输出通常可以划分为⼏个⼤类：</p>
<ul>
<li>读取⽂本⽂件和其他更⾼效的磁盘存储格式</li>
<li>加载数据库中的数据</li>
<li>利⽤Web API操作⽹络资源。</li>
</ul>
<h2 id="6-1-读写⽂本格式的数据"><a href="#6-1-读写⽂本格式的数据" class="headerlink" title="6.1 读写⽂本格式的数据"></a>6.1 读写⽂本格式的数据</h2><p>pandas提供了⼀些⽤于将表格型数据读取为<strong>DataFrame对象</strong>的函数。<br>read_csv和read_table可能会是你今后⽤得最多的。</p>
<p><img src="/images/687702537.png" alt="687702537"></p>
<p>这些函数的选项可以划分为以下⼏个⼤类：</p>
<ul>
<li>索引：<br>将⼀个或多个列当做返回的DataFrame处理，以及是否从⽂件、⽤户获取列名。</li>
<li>类型推断和数据转换：<br>包括⽤户定义值的转换、和⾃定义的缺失值标记列表等。</li>
<li>⽇期解析：<br>包括组合功能，⽐如将分散在多个列中的⽇期时间信息组合成结果中的单个列。</li>
<li>迭代：<br>⽀持对⼤⽂件进⾏逐块迭代。</li>
<li>不规整数据问题：<br>跳过⼀些⾏、⻚脚、注释或其他⼀些不重要的东⻄（⽐如由成千上万个逗号隔开的数值数据）。</li>
</ul>
<p>使用read_csv时需要注意:<br>列数据的类型不属于数据类型。</p>
<p>ex1.csv内容如下:(带表头)</p>
<table>
<thead>
<tr>
<th>col1</th>
<th>col2</th>
<th>col3</th>
<th>col4</th>
<th>col5</th>
</tr>
</thead>
<tbody><tr>
<td>a</td>
<td>b</td>
<td>c</td>
<td>d</td>
<td>hello</td>
</tr>
<tr>
<td>e</td>
<td>f</td>
<td>g</td>
<td>h</td>
<td>world</td>
</tr>
<tr>
<td>i</td>
<td>j</td>
<td>k</td>
<td>l</td>
<td>foo</td>
</tr>
</tbody></table>
<p>ex2.csv内容如下:(不带表头)</p>
<table>
<thead>
<tr>
<th>a</th>
<th>b</th>
<th>c</th>
<th>d</th>
<th>hello</th>
</tr>
</thead>
<tbody><tr>
<td>e</td>
<td>f</td>
<td>g</td>
<td>h</td>
<td>world</td>
</tr>
<tr>
<td>i</td>
<td>j</td>
<td>k</td>
<td>l</td>
<td>foo</td>
</tr>
</tbody></table>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用read_csv读取csv</span></span><br><span class="line">df = pd.read_csv(<span class="string">&#x27;ex1.csv&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(df)</span><br><span class="line"><span class="comment">#   col1 col2 col3 col4   col5</span></span><br><span class="line"><span class="comment"># 0    a    b    c    d  hello</span></span><br><span class="line"><span class="comment"># 1    e    f    g    h  world</span></span><br><span class="line"><span class="comment"># 2    i    j    k    l    foo</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用read_table读取csv</span></span><br><span class="line"><span class="comment"># 必须使用sep=&#x27;,&#x27;</span></span><br><span class="line">df2 = pd.read_table(<span class="string">&#x27;ex1.csv&#x27;</span>,sep=<span class="string">&#x27;,&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(df2)</span><br><span class="line"><span class="comment">#   col1 col2 col3 col4   col5</span></span><br><span class="line"><span class="comment"># 0    a    b    c    d  hello</span></span><br><span class="line"><span class="comment"># 1    e    f    g    h  world</span></span><br><span class="line"><span class="comment"># 2    i    j    k    l    foo</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用read_table读取csv</span></span><br><span class="line">df3 = pd.read_table(<span class="string">&#x27;ex1.csv&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(df3)</span><br><span class="line"><span class="comment">#   col1,col2,col3,col4,col5</span></span><br><span class="line"><span class="comment"># 0            a,b,c,d,hello</span></span><br><span class="line"><span class="comment"># 1            e,f,g,h,world</span></span><br><span class="line"><span class="comment"># 2              i,j,k,l,foo</span></span><br></pre></td></tr></table></figure>

<p>虽然csv默认是使用逗号的,但是也有人使用空格什么的.<br>这时为了获取这种csv文件,可以使用read_table,但是必须要用sep参数.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># se2.csv没有标题行</span></span><br><span class="line"><span class="built_in">print</span>(pd.read_csv(<span class="string">&#x27;ex2.csv&#x27;</span>))</span><br><span class="line"><span class="comment">#    a  b  c  d  hello</span></span><br><span class="line"><span class="comment"># 0  e  f  g  h  world</span></span><br><span class="line"><span class="comment"># 1  i  j  k  l    foo</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 为其自动添加默认的列名</span></span><br><span class="line"><span class="built_in">print</span>(pd.read_csv(<span class="string">&#x27;ex2.csv&#x27;</span>,header=<span class="literal">None</span>))</span><br><span class="line"><span class="comment">#    0  1  2  3      4</span></span><br><span class="line"><span class="comment"># 0  a  b  c  d  hello</span></span><br><span class="line"><span class="comment"># 1  e  f  g  h  world</span></span><br><span class="line"><span class="comment"># 2  i  j  k  l    foo</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加自定义列名</span></span><br><span class="line">names = (<span class="string">&#x27;c1 c2 c3 c4 c5&#x27;</span>).split()</span><br><span class="line"><span class="built_in">print</span>(pd.read_csv(<span class="string">&#x27;ex2.csv&#x27;</span>,names=names))</span><br><span class="line"><span class="comment">#   c1 c2 c3 c4     c5</span></span><br><span class="line"><span class="comment"># 0  a  b  c  d  hello</span></span><br><span class="line"><span class="comment"># 1  e  f  g  h  world</span></span><br><span class="line"><span class="comment"># 2  i  j  k  l    foo</span></span><br></pre></td></tr></table></figure>

<p>如果自定义列名的列数量不够的话,</p>
<ul>
<li>==最左边的列将不能分配列名,他们将自动变成行索引==</li>
<li>如果缺少的列数量大于等于2,那么这些列就会形成MultiIndex(多级索引)</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 具有0,1,2的行索引</span></span><br><span class="line">names = (<span class="string">&#x27;c1 c2 c3 c4 c5&#x27;</span>).split()</span><br><span class="line">df1 = pd.read_csv(<span class="string">&#x27;ex2.csv&#x27;</span>,names=names)</span><br><span class="line"><span class="built_in">print</span>(df1)</span><br><span class="line"><span class="comment">#   c1 c2 c3 c4     c5</span></span><br><span class="line"><span class="comment"># 0  a  b  c  d  hello</span></span><br><span class="line"><span class="comment"># 1  e  f  g  h  world</span></span><br><span class="line"><span class="comment"># 2  i  j  k  l    foo</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(df1.index)</span><br><span class="line"><span class="comment"># RangeIndex(start=0, stop=3, step=1)</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(df1.columns)</span><br><span class="line"><span class="comment"># Index([&#x27;c1&#x27;, &#x27;c2&#x27;, &#x27;c3&#x27;, &#x27;c4&#x27;, &#x27;c5&#x27;], dtype=&#x27;object&#x27;)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取行标签为2的数据</span></span><br><span class="line"><span class="built_in">print</span>(df1.loc[<span class="number">2</span>])</span><br><span class="line"><span class="comment"># c1      i</span></span><br><span class="line"><span class="comment"># c2      j</span></span><br><span class="line"><span class="comment"># c3      k</span></span><br><span class="line"><span class="comment"># c4      l</span></span><br><span class="line"><span class="comment"># c5    foo</span></span><br><span class="line"><span class="comment"># Name: 2, dtype: object</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;------------------------&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 列数量缺一</span></span><br><span class="line"><span class="comment"># 第一列变成了行索引</span></span><br><span class="line">names = (<span class="string">&#x27;c1 c2 c3 c4&#x27;</span>).split()</span><br><span class="line">df2 = pd.read_csv(<span class="string">&#x27;ex2.csv&#x27;</span>,names=names)</span><br><span class="line"><span class="built_in">print</span>(df2)</span><br><span class="line"><span class="comment">#   c1 c2 c3     c4</span></span><br><span class="line"><span class="comment"># a  b  c  d  hello</span></span><br><span class="line"><span class="comment"># e  f  g  h  world</span></span><br><span class="line"><span class="comment"># i  j  k  l    foo</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(df2.index)</span><br><span class="line"><span class="comment"># Index([&#x27;a&#x27;, &#x27;e&#x27;, &#x27;i&#x27;], dtype=&#x27;object&#x27;)</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(df2.columns)</span><br><span class="line"><span class="comment"># Index([&#x27;c1&#x27;, &#x27;c2&#x27;, &#x27;c3&#x27;, &#x27;c4&#x27;], dtype=&#x27;object&#x27;)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取行标签为a的数据</span></span><br><span class="line"><span class="built_in">print</span>(df2.loc[<span class="string">&#x27;a&#x27;</span>])</span><br><span class="line"><span class="comment"># c1        b</span></span><br><span class="line"><span class="comment"># c2        c</span></span><br><span class="line"><span class="comment"># c3        d</span></span><br><span class="line"><span class="comment"># c4    hello</span></span><br><span class="line"><span class="comment"># Name: a, dtype: object</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;-----------------------------&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 形成多级索引</span></span><br><span class="line">names = (<span class="string">&#x27;c1 c2 c3&#x27;</span>).split()</span><br><span class="line">df3 = pd.read_csv(<span class="string">&#x27;ex2.csv&#x27;</span>,names=names)</span><br><span class="line"><span class="built_in">print</span>(df3)</span><br><span class="line"><span class="comment">#     c1 c2     c3</span></span><br><span class="line"><span class="comment"># a b  c  d  hello</span></span><br><span class="line"><span class="comment"># e f  g  h  world</span></span><br><span class="line"><span class="comment"># i j  k  l    foo</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(df3.index)</span><br><span class="line"><span class="comment"># MultiIndex(levels=[[&#x27;a&#x27;, &#x27;e&#x27;, &#x27;i&#x27;], [&#x27;b&#x27;, &#x27;f&#x27;, &#x27;j&#x27;]],</span></span><br><span class="line"><span class="comment">#            labels=[[0, 1, 2], [0, 1, 2]])</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(df3.columns)</span><br><span class="line"><span class="comment"># Index([&#x27;c1&#x27;, &#x27;c2&#x27;, &#x27;c3&#x27;], dtype=&#x27;object&#x27;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取多级索引为(a,b)的数据</span></span><br><span class="line"><span class="built_in">print</span>(df3.loc[(<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>)])</span><br><span class="line"><span class="comment"># c1        c</span></span><br><span class="line"><span class="comment"># c2        d</span></span><br><span class="line"><span class="comment"># c3    hello</span></span><br><span class="line"><span class="comment"># Name: (a, b), dtype: object</span></span><br></pre></td></tr></table></figure>

<p>什么是多级索引?</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">m_index1=pd.Index([(<span class="string">&quot;A&quot;</span>,<span class="string">&quot;x1&quot;</span>),(<span class="string">&quot;A&quot;</span>,<span class="string">&quot;x2&quot;</span>),(<span class="string">&quot;B&quot;</span>,<span class="string">&quot;y1&quot;</span>),(<span class="string">&quot;B&quot;</span>,<span class="string">&quot;y2&quot;</span>),(<span class="string">&quot;B&quot;</span>,<span class="string">&quot;y3&quot;</span>)],name=[<span class="string">&quot;class1&quot;</span>,<span class="string">&quot;class2&quot;</span>])</span><br><span class="line"><span class="built_in">print</span>(m_index1)</span><br><span class="line"><span class="comment"># MultiIndex(levels=[[&#x27;A&#x27;, &#x27;B&#x27;], [&#x27;x1&#x27;, &#x27;x2&#x27;, &#x27;y1&#x27;, &#x27;y2&#x27;, &#x27;y3&#x27;]],</span></span><br><span class="line"><span class="comment">#            labels=[[0, 0, 1, 1, 1], [0, 1, 2, 3, 4]],</span></span><br><span class="line"><span class="comment">#            names=[&#x27;class1&#x27;, &#x27;class2&#x27;])</span></span><br><span class="line"></span><br><span class="line">df1 = pd.DataFrame(np.random.randint(<span class="number">1</span>,<span class="number">10</span>,(<span class="number">5</span>,<span class="number">3</span>)),index=m_index1)</span><br><span class="line"><span class="built_in">print</span>(df1)</span><br><span class="line"><span class="comment"># class1 class2         </span></span><br><span class="line"><span class="comment"># A      x1      3  1  2</span></span><br><span class="line"><span class="comment">#        x2      4  6  8</span></span><br><span class="line"><span class="comment"># B      y1      6  4  9</span></span><br><span class="line"><span class="comment">#        y2      3  7  3</span></span><br><span class="line"><span class="comment">#        y3      3  6  7</span></span><br></pre></td></tr></table></figure>

<p>上面代码形成的表格就是:<br><img src="/images/20190508123218.png" alt="20190508123218"></p>
<p>我们还可以使用from_arrays()来创建多级索引:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">class1=[<span class="string">&quot;A&quot;</span>,<span class="string">&quot;A&quot;</span>,<span class="string">&quot;B&quot;</span>,<span class="string">&quot;B&quot;</span>]</span><br><span class="line">class2=[<span class="string">&quot;x1&quot;</span>,<span class="string">&quot;x2&quot;</span>,<span class="string">&quot;y1&quot;</span>,<span class="string">&quot;y2&quot;</span>]</span><br><span class="line">m_index2=pd.MultiIndex.from_arrays([class1,class2],names=[<span class="string">&quot;class1&quot;</span>,<span class="string">&quot;class2&quot;</span>])</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(m_index2)</span><br><span class="line"><span class="comment"># MultiIndex(levels=[[&#x27;A&#x27;, &#x27;B&#x27;], [&#x27;x1&#x27;, &#x27;x2&#x27;, &#x27;y1&#x27;, &#x27;y2&#x27;]],</span></span><br><span class="line"><span class="comment">#            labels=[[0, 0, 1, 1], [0, 1, 2, 3]],</span></span><br><span class="line"><span class="comment">#            names=[&#x27;class1&#x27;, &#x27;class2&#x27;])</span></span><br><span class="line"></span><br><span class="line">df2 = pd.DataFrame(np.random.randint(<span class="number">1</span>,<span class="number">10</span>,(<span class="number">4</span>,<span class="number">3</span>)),index=m_index2)</span><br><span class="line"><span class="built_in">print</span>(df2)</span><br><span class="line"><span class="comment"># class1 class2         </span></span><br><span class="line"><span class="comment"># A      x1      7  4  1</span></span><br><span class="line"><span class="comment">#        x2      1  1  5</span></span><br><span class="line"><span class="comment"># B      y1      3  6  7</span></span><br><span class="line"><span class="comment">#        y2      3  9  6</span></span><br></pre></td></tr></table></figure>

<p><img src="/images/1557290260556.png" alt="1557290260556"></p>
<p>多级索引的常用属性:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">m_index1=pd.Index([(<span class="string">&quot;A&quot;</span>,<span class="string">&quot;x1&quot;</span>),(<span class="string">&quot;A&quot;</span>,<span class="string">&quot;x2&quot;</span>),(<span class="string">&quot;B&quot;</span>,<span class="string">&quot;y1&quot;</span>),(<span class="string">&quot;B&quot;</span>,<span class="string">&quot;y2&quot;</span>),(<span class="string">&quot;B&quot;</span>,<span class="string">&quot;y3&quot;</span>)],name=[<span class="string">&quot;class1&quot;</span>,<span class="string">&quot;class2&quot;</span>])</span><br><span class="line"><span class="built_in">print</span>(m_index1)</span><br><span class="line"><span class="comment"># MultiIndex(levels=[[&#x27;A&#x27;, &#x27;B&#x27;], [&#x27;x1&#x27;, &#x27;x2&#x27;, &#x27;y1&#x27;, &#x27;y2&#x27;, &#x27;y3&#x27;]],</span></span><br><span class="line"><span class="comment">#            labels=[[0, 0, 1, 1, 1], [0, 1, 2, 3, 4]],</span></span><br><span class="line"><span class="comment">#            names=[&#x27;class1&#x27;, &#x27;class2&#x27;])</span></span><br><span class="line"></span><br><span class="line">df1 = pd.DataFrame(np.random.randint(<span class="number">1</span>,<span class="number">10</span>,(<span class="number">5</span>,<span class="number">3</span>)),index=m_index1)</span><br><span class="line"><span class="built_in">print</span>(df1)</span><br><span class="line"><span class="comment"># class1 class2         </span></span><br><span class="line"><span class="comment"># A      x1      3  1  2</span></span><br><span class="line"><span class="comment">#        x2      4  6  8</span></span><br><span class="line"><span class="comment"># B      y1      6  4  9</span></span><br><span class="line"><span class="comment">#        y2      3  7  3</span></span><br><span class="line"><span class="comment">#        y3      3  6  7</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(df1.index[<span class="number">0</span>])</span><br><span class="line"><span class="comment"># (&#x27;A&#x27;, &#x27;x1&#x27;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 调用.get_loc()和.get_indexer()获取标签的下标：</span></span><br><span class="line"><span class="built_in">print</span>(df1.index.get_loc((<span class="string">&quot;A&quot;</span>,<span class="string">&quot;x2&quot;</span>)))</span><br><span class="line"><span class="comment"># 1</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(df1.index.get_indexer([(<span class="string">&quot;A&quot;</span>,<span class="string">&quot;x2&quot;</span>),(<span class="string">&quot;B&quot;</span>,<span class="string">&quot;y1&quot;</span>),<span class="string">&quot;nothing&quot;</span>]))</span><br><span class="line"><span class="comment"># [ 1  2 -1]</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(df1.index.levels[<span class="number">0</span>])</span><br><span class="line"><span class="comment"># Index([&#x27;A&#x27;, &#x27;B&#x27;], dtype=&#x27;object&#x27;, name=&#x27;class1&#x27;)</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(df1.index.levels[<span class="number">1</span>])</span><br><span class="line"><span class="comment"># Index([&#x27;x1&#x27;, &#x27;x2&#x27;, &#x27;y1&#x27;, &#x27;y2&#x27;, &#x27;y3&#x27;], dtype=&#x27;object&#x27;, name=&#x27;class2&#x27;)</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(df1.index.levels[<span class="number">1</span>][<span class="number">1</span>])</span><br><span class="line"><span class="comment"># x2</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># MultiIndex对象还有属性labels保存标签的下标：</span></span><br><span class="line"><span class="built_in">print</span>(df1.index.labels[<span class="number">0</span>])</span><br><span class="line"><span class="comment"># FrozenNDArray([0, 0, 1, 1, 1], dtype=&#x27;int8&#x27;)</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(df1.index.labels[<span class="number">1</span>])</span><br><span class="line"><span class="comment"># FrozenNDArray([0, 1, 2, 3, 4], dtype=&#x27;int8&#x27;)</span></span><br></pre></td></tr></table></figure>

<p>上面csv代码设置行标签都是隐式,不明确.<br>如果想明确的将列表前行标签的话,需要使用index_col参数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">names = (<span class="string">&#x27;c1 c2 c3 c4 c5&#x27;</span>).split()</span><br><span class="line">df = pd.read_csv(<span class="string">&#x27;ex2.csv&#x27;</span>, names=names)</span><br><span class="line"><span class="built_in">print</span>(df)</span><br><span class="line"><span class="comment">#   c1 c2 c3 c4     c5</span></span><br><span class="line"><span class="comment"># 0  a  b  c  d  hello</span></span><br><span class="line"><span class="comment"># 1  e  f  g  h  world</span></span><br><span class="line"><span class="comment"># 2  i  j  k  l    foo</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用index_col将c5列的数据作为行标签</span></span><br><span class="line">df = pd.read_csv(<span class="string">&#x27;ex2.csv&#x27;</span>, names=names, index_col=<span class="string">&#x27;c5&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(df)</span><br><span class="line"><span class="comment">#       c1 c2 c3 c4</span></span><br><span class="line"><span class="comment"># c5               </span></span><br><span class="line"><span class="comment"># hello  a  b  c  d</span></span><br><span class="line"><span class="comment"># world  e  f  g  h</span></span><br><span class="line"><span class="comment"># foo    i  j  k  l</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(df.index)</span><br><span class="line"><span class="comment"># Index([&#x27;hello&#x27;, &#x27;world&#x27;, &#x27;foo&#x27;], dtype=&#x27;object&#x27;, name=&#x27;c5&#x27;)</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(df.loc[<span class="string">&#x27;hello&#x27;</span>])</span><br><span class="line"><span class="comment"># c1    a</span></span><br><span class="line"><span class="comment"># c2    b</span></span><br><span class="line"><span class="comment"># c3    c</span></span><br><span class="line"><span class="comment"># c4    d</span></span><br><span class="line"><span class="comment"># Name: hello, dtype: object</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 传入列表则形成多级索引</span></span><br><span class="line">fd2 = pd.read_csv(<span class="string">&#x27;ex2.csv&#x27;</span>,names=names, index_col=[<span class="string">&#x27;c4&#x27;</span>, <span class="string">&#x27;c5&#x27;</span>])</span><br><span class="line"><span class="built_in">print</span>(fd2)</span><br><span class="line"><span class="comment">#          c1 c2 c3</span></span><br><span class="line"><span class="comment"># c4 c5            </span></span><br><span class="line"><span class="comment"># d  hello  a  b  c</span></span><br><span class="line"><span class="comment"># h  world  e  f  g</span></span><br><span class="line"><span class="comment"># l  foo    i  j  k</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(fd2.index)</span><br><span class="line"><span class="comment"># MultiIndex(levels=[[&#x27;d&#x27;, &#x27;h&#x27;, &#x27;l&#x27;], [&#x27;foo&#x27;, &#x27;hello&#x27;, &#x27;world&#x27;]],</span></span><br><span class="line"><span class="comment">#            labels=[[0, 1, 2], [1, 2, 0]],</span></span><br><span class="line"><span class="comment">#            names=[&#x27;c4&#x27;, &#x27;c5&#x27;])</span></span><br></pre></td></tr></table></figure>

<p>read_table:<br>前面讲了read_table使用<code>sep=&#39;,&#39;</code>实现读取csv,实际上read_table可以读取很多种类的文件,sep参数支持很多的写法,甚至可以使用正则:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">list</span>(<span class="built_in">open</span>(<span class="string">&#x27;ex3.txt&#x27;</span>)))</span><br><span class="line"><span class="comment"># [&#x27;            A         B         C\n&#x27;,</span></span><br><span class="line"><span class="comment">#  &#x27;aaa -0.264438 -1.026059 -0.619500\n&#x27;,</span></span><br><span class="line"><span class="comment">#  &#x27;bbb  0.927272  0.302904 -0.032399\n&#x27;,</span></span><br><span class="line"><span class="comment">#  &#x27;ccc -0.264273 -0.386314 -0.217601\n&#x27;,</span></span><br><span class="line"><span class="comment">#  &#x27;ddd -0.871858 -0.348382  1.100491\n&#x27;]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用空白字符作分隔符</span></span><br><span class="line">result = pd.read_table(<span class="string">&#x27;ex3.txt&#x27;</span>, sep=<span class="string">r&#x27;\s+&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(result)</span><br><span class="line"><span class="comment">#             A         B         C</span></span><br><span class="line"><span class="comment"># aaa -0.264438 -1.026059 -0.619500</span></span><br><span class="line"><span class="comment"># bbb  0.927272  0.302904 -0.032399</span></span><br><span class="line"><span class="comment"># ccc -0.264273 -0.386314 -0.217601</span></span><br><span class="line"><span class="comment"># ddd -0.871858 -0.348382  1.100491</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 因为列名比数据行的数量少,自动推测第一列是行标签</span></span><br><span class="line"><span class="built_in">print</span>(result.index)</span><br><span class="line"><span class="comment"># Index([&#x27;aaa&#x27;, &#x27;bbb&#x27;, &#x27;ccc&#x27;, &#x27;ddd&#x27;], dtype=&#x27;object&#x27;)</span></span><br></pre></td></tr></table></figure>

<p>事实上,pandas默认会将<code>-1.#IND</code>, <code>1.#QNAN</code>, <code>1.#IND</code>, <code>-1.#QNAN</code>, <code>#N/A N/A</code>,<code>#N/A</code>, <code>N/A</code>, <code>NA</code>, <code>#NA</code>, <code>NULL</code>, <code>NaN</code>, <code>-NaN</code>, <code>nan</code>, <code>-nan</code>, 转换为NaN，<code>na_values</code>参数还支持定义另外的应处理为缺失值的值。<br>值得注意的是<code>keep_default_na</code>参数，这个参数的作用是<strong>决定要不要保留默认应该转换的缺失值列表</strong>，将这个参数设为False之后同时不定义na_values参数，就可以在读取文件时不将任何值转换为缺失值NaN。</p>
<p>read_csv常用操作:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(pd.read_csv(<span class="string">&#x27;ex2.csv&#x27;</span>))</span><br><span class="line"><span class="comment">#    a  b  c  d  hello</span></span><br><span class="line"><span class="comment"># 0  e  f  g  h  world</span></span><br><span class="line"><span class="comment"># 1  i  j  k  l    foo</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 跳过第0,2行</span></span><br><span class="line"><span class="built_in">print</span>(pd.read_csv(<span class="string">&#x27;ex2.csv&#x27;</span>, skiprows=[<span class="number">0</span>, <span class="number">2</span>]))</span><br><span class="line"><span class="comment"># Columns: [e, f, g, h, world]</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;-------------------------------------&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># examples/ex5.csv文件内容为:</span></span><br><span class="line">	<span class="comment"># something,a,b,c,d,message</span></span><br><span class="line">	<span class="comment"># one,1,2,3,4,NA</span></span><br><span class="line">	<span class="comment"># two,5,6,,8,world</span></span><br><span class="line">	<span class="comment"># three,9,10,11,12,foo</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 自动将NA和空字符串识别为pd的NaN对象</span></span><br><span class="line">result = pd.read_csv(<span class="string">&#x27;examples/ex5.csv&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(result)</span><br><span class="line"><span class="comment">#   something  a   b     c   d message</span></span><br><span class="line"><span class="comment"># 0       one  1   2   3.0   4     NaN</span></span><br><span class="line"><span class="comment"># 1       two  5   6   NaN   8   world</span></span><br><span class="line"><span class="comment"># 2     three  9  10  11.0  12     foo</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(pd.isnull(result))</span><br><span class="line"><span class="comment">#    something      a      b      c      d  message</span></span><br><span class="line"><span class="comment"># 0      False  False  False  False  False     True</span></span><br><span class="line"><span class="comment"># 1      False  False  False   True  False    False</span></span><br><span class="line"><span class="comment"># 2      False  False  False  False  False    False</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># na_values可以⽤⼀个列表或集合的字符串表示缺失值：</span></span><br><span class="line">result = pd.read_csv(<span class="string">&#x27;examples/ex5.csv&#x27;</span>,na_values=[<span class="string">&#x27;NULL&#x27;</span>])</span><br><span class="line"><span class="built_in">print</span>(result)</span><br><span class="line"><span class="comment">#   something  a   b     c   d message</span></span><br><span class="line"><span class="comment"># 0       one  1   2   3.0   4     NaN</span></span><br><span class="line"><span class="comment"># 1       two  5   6   NaN   8   world</span></span><br><span class="line"><span class="comment"># 2     three  9  10  11.0  12     foo</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># na_values：在这个list里面的的元素都会被认为是NaN</span></span><br><span class="line"><span class="comment"># 这里one被视为NaN</span></span><br><span class="line">result = pd.read_csv(<span class="string">&#x27;examples/ex5.csv&#x27;</span>,na_values=[<span class="string">&#x27;one&#x27;</span>])</span><br><span class="line"><span class="built_in">print</span>(result)</span><br><span class="line"><span class="comment">#   something  a   b     c   d message</span></span><br><span class="line"><span class="comment"># 0       NaN  1   2   3.0   4     NaN</span></span><br><span class="line"><span class="comment"># 1       two  5   6   NaN   8   world</span></span><br><span class="line"><span class="comment"># 2     three  9  10  11.0  12     foo</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 为不同的列分配不同的na_values</span></span><br><span class="line">sentinels = &#123;<span class="string">&#x27;message&#x27;</span>: [<span class="string">&#x27;foo&#x27;</span>, <span class="string">&#x27;NA&#x27;</span>], <span class="string">&#x27;something&#x27;</span>: [<span class="string">&#x27;two&#x27;</span>]&#125;</span><br><span class="line"><span class="built_in">print</span>(pd.read_csv(<span class="string">&#x27;examples/ex5.csv&#x27;</span>, na_values=sentinels))</span><br><span class="line"><span class="comment">#   something  a   b     c   d message</span></span><br><span class="line"><span class="comment"># 0       one  1   2   3.0   4     NaN</span></span><br><span class="line"><span class="comment"># 1       NaN  5   6   NaN   8   world</span></span><br><span class="line"><span class="comment"># 2     three  9  10  11.0  12     NaN</span></span><br></pre></td></tr></table></figure>

<p>pandas.read_csv和pandas.read_table常用的选项。</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>path</td>
<td>表示文件系统位置、URL、文件型对象的字符串</td>
</tr>
<tr>
<td>sep或delimiter</td>
<td>用于对行中各字段进行拆分的字符序列或正则表达式</td>
</tr>
<tr>
<td>header</td>
<td>用作列名的行号。默认为0（第一行），如果没有header行就应该设置为None</td>
</tr>
<tr>
<td>index_col</td>
<td>用作行索引的列编号或列名。可以是单个名称/数字或由多个名称/数字组成的列表（层次化索引）</td>
</tr>
<tr>
<td>names</td>
<td>用于结果的列名列表，结合header=None</td>
</tr>
<tr>
<td>skiprows</td>
<td>需要忽略的行数（从文件开始处算起），或需要跳过的行号列表（从0开始)</td>
</tr>
<tr>
<td>na_values</td>
<td>一组用于替换NA的值</td>
</tr>
<tr>
<td>comment</td>
<td>用于将注释信息从行尾拆分出去的字符(一个或多个)</td>
</tr>
<tr>
<td>parse_dates</td>
<td>尝试将数据解析为日期，默认为False。如果为True，则尝试解析所有列。此外，还可以指定需要解析的一组列号或列名。如果列表的元素为列表或元组，就会将多个列组合到一起再进行日期解析工作（例如，日期/时间分别位于两个列中）</td>
</tr>
<tr>
<td>keep_data_col</td>
<td>如果连接多列解析日期，则保持参与连接的列。默认为 False。</td>
</tr>
<tr>
<td>converters</td>
<td>由列号/列名跟函数之间的映射关系组成的字典。例如，{‘foo’：f}会对foo列的所有值应用函数f</td>
</tr>
<tr>
<td>dayfirst</td>
<td>当解析有歧义的日期时，将其看做国际格式（例如，7/6/2012→June 7，2012）。默认为Fase</td>
</tr>
<tr>
<td>date_parser</td>
<td>用于解析日期的函数</td>
</tr>
<tr>
<td>nrows</td>
<td>需要读取的行数（从文件开始处算起）</td>
</tr>
<tr>
<td>iterator</td>
<td>返回一个TextParser以便逐块读取文件</td>
</tr>
<tr>
<td>chunksize</td>
<td>文件块的大小（用于迭代）</td>
</tr>
<tr>
<td>skip_footer</td>
<td>需要忽略的行数（从文件末尾处算起）</td>
</tr>
<tr>
<td>verbose</td>
<td>打印各种解析器输出信息，比如“非数值列中缺失值的数量”等</td>
</tr>
<tr>
<td>encoding</td>
<td>用于unicode的文本编码格式。例如，“utf-8”表示用UTF-8编码的文本</td>
</tr>
<tr>
<td>squeeze</td>
<td>如果数据经解析后仅含一列，则返回 Series</td>
</tr>
<tr>
<td>thousands</td>
<td>千分位分隔符，如“ , ”或“ . ”</td>
</tr>
</tbody></table>
<p>逐块读取⽂本⽂件</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="comment"># 要展示几行</span></span><br><span class="line">pd.options.display.max_rows	= <span class="number">8</span></span><br><span class="line">result = pd.read_csv(<span class="string">&#x27;examples/ex6.csv&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(result)</span><br><span class="line"><span class="comment">#            one       two     three      four key</span></span><br><span class="line"><span class="comment"># 0     0.467976 -0.038649 -0.295344 -1.824726   L</span></span><br><span class="line"><span class="comment"># 1    -0.358893  1.404453  0.704965 -0.200638   B</span></span><br><span class="line"><span class="comment"># 2    -0.501840  0.659254 -0.421691 -0.057688   G</span></span><br><span class="line"><span class="comment"># 3     0.204886  1.074134  1.388361 -0.982404   R</span></span><br><span class="line"><span class="comment"># ...        ...       ...       ...       ...  ..</span></span><br><span class="line"><span class="comment"># 9996 -0.479893 -0.650419  0.745152 -0.646038   E</span></span><br><span class="line"><span class="comment"># 9997  0.523331  0.787112  0.486066  1.093156   K</span></span><br><span class="line"><span class="comment"># 9998 -0.362559  0.598894 -1.843201  0.887292   G</span></span><br><span class="line"><span class="comment"># 9999 -0.096376 -1.012999 -0.657431 -0.573315   0</span></span><br><span class="line"><span class="comment"># [10000 rows x 5 columns]</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 只读3行</span></span><br><span class="line"><span class="built_in">print</span>(pd.read_csv(<span class="string">&#x27;examples/ex6.csv&#x27;</span>, nrows=<span class="number">3</span>))</span><br><span class="line"><span class="comment">#         one       two     three      four key</span></span><br><span class="line"><span class="comment"># 0  0.467976 -0.038649 -0.295344 -1.824726   L</span></span><br><span class="line"><span class="comment"># 1 -0.358893  1.404453  0.704965 -0.200638   B</span></span><br><span class="line"><span class="comment"># 2 -0.501840  0.659254 -0.421691 -0.057688   G</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 逐块读取⽂件,每块读几行,返回TextParser对象</span></span><br><span class="line">chunker = pd.read_csv(<span class="string">&#x27;examples/ex6.csv&#x27;</span>, chunksize=<span class="number">1000</span>)</span><br><span class="line"><span class="built_in">print</span>(chunker)</span><br><span class="line"><span class="comment"># &lt;pandas.io.parsers.TextFileReader object at 0x00000219B4ACAF60&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># TextParser对象使你可以根据chunksize对⽂件进⾏逐块迭代</span></span><br><span class="line">chunker = pd.read_csv(<span class="string">&#x27;examples/ex6.csv&#x27;</span>, chunksize=<span class="number">1000</span>)</span><br><span class="line">tot = pd.Series([])</span><br><span class="line"><span class="keyword">for</span> piece <span class="keyword">in</span> chunker:</span><br><span class="line">	<span class="comment"># 给key列的计数</span></span><br><span class="line">    tot = tot.add(piece[<span class="string">&#x27;key&#x27;</span>].value_counts(), fill_value=<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">tot = tot.sort_values(ascending=<span class="literal">False</span>)</span><br><span class="line"><span class="built_in">print</span>(tot[:<span class="number">6</span>])</span><br><span class="line"><span class="comment"># E    368.0</span></span><br><span class="line"><span class="comment"># X    364.0</span></span><br><span class="line"><span class="comment"># L    346.0</span></span><br><span class="line"><span class="comment"># O    343.0</span></span><br><span class="line"><span class="comment"># Q    340.0</span></span><br><span class="line"><span class="comment"># M    338.0</span></span><br><span class="line"><span class="comment"># dtype: float64</span></span><br></pre></td></tr></table></figure>

<p>将数据写出到⽂本格式:<br>to_csv⽅法:</p>
<ul>
<li>sep分隔符</li>
<li>na_rep:将缺失值表示成什么字符串</li>
<li>index:是否展示行标签</li>
<li>header:是否展示列标签</li>
<li>columns:指定要输出的列并排序</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">data = pd.read_csv(<span class="string">&#x27;examples/ex5.csv&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(data)</span><br><span class="line"><span class="comment">#   something  a   b     c   d message</span></span><br><span class="line"><span class="comment"># 0       one  1   2   3.0   4     NaN</span></span><br><span class="line"><span class="comment"># 1       two  5   6   NaN   8   world</span></span><br><span class="line"><span class="comment"># 2     three  9  10  11.0  12     foo</span></span><br><span class="line"></span><br><span class="line">data.to_csv(<span class="string">&#x27;out.csv&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="comment"># sep:使用分隔符</span></span><br><span class="line">data.to_csv(sys.stdout, sep=<span class="string">&#x27;|&#x27;</span>)</span><br><span class="line"><span class="comment"># |something|a|b|c|d|message</span></span><br><span class="line"><span class="comment"># 0|one|1|2|3.0|4|</span></span><br><span class="line"><span class="comment"># 1|two|5|6||8|world</span></span><br><span class="line"><span class="comment"># 2|three|9|10|11.0|12|foo</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># na_rep:缺失值在输出结果中会被表示为空字符串,na_rep参数改为其他标记值</span></span><br><span class="line"><span class="comment"># 空字符串变成NULL</span></span><br><span class="line">data.to_csv(sys.stdout, na_rep=<span class="string">&#x27;NULL&#x27;</span>)</span><br><span class="line"><span class="comment"># ,something,a,b,c,d,message</span></span><br><span class="line"><span class="comment"># 0,one,1,2,3.0,4,NULL</span></span><br><span class="line"><span class="comment"># 1,two,5,6,NULL,8,world</span></span><br><span class="line"><span class="comment"># 2,three,9,10,11.0,12,foo</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># index,header:不输出行标签和列标签.注意这里是header,不是columns</span></span><br><span class="line">data.to_csv(sys.stdout, index=<span class="literal">False</span>, header=<span class="literal">False</span>)</span><br><span class="line"><span class="comment"># one,1,2,3.0,4,</span></span><br><span class="line"><span class="comment"># two,5,6,,8,world</span></span><br><span class="line"><span class="comment"># three,9,10,11.0,12,foo</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># columns:指定要输出的列并排序</span></span><br><span class="line">data.to_csv(sys.stdout, index=<span class="literal">False</span>, columns=[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>])</span><br><span class="line"><span class="comment"># a,b,c</span></span><br><span class="line"><span class="comment"># 1,2,3.0</span></span><br><span class="line"><span class="comment"># 5,6,</span></span><br><span class="line"><span class="comment"># 9,10,11.0</span></span><br></pre></td></tr></table></figure>

<p>Series也有to_csv方法:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">dates = pd.date_range(<span class="string">&#x27;1/1/2000&#x27;</span>, periods=<span class="number">7</span>)</span><br><span class="line"><span class="built_in">print</span>(dates)</span><br><span class="line"><span class="comment"># DatetimeIndex([&#x27;2000-01-01&#x27;, &#x27;2000-01-02&#x27;, &#x27;2000-01-03&#x27;, &#x27;2000-01-04&#x27;,</span></span><br><span class="line"><span class="comment">#                &#x27;2000-01-05&#x27;, &#x27;2000-01-06&#x27;, &#x27;2000-01-07&#x27;],</span></span><br><span class="line"><span class="comment">#               dtype=&#x27;datetime64[ns]&#x27;, freq=&#x27;D&#x27;)</span></span><br><span class="line"></span><br><span class="line">ts = pd.Series(np.arange(<span class="number">7</span>), index=dates)</span><br><span class="line">ts.to_csv(sys.stdout)</span><br><span class="line"><span class="comment"># 2000-01-01,0</span></span><br><span class="line"><span class="comment"># 2000-01-02,1</span></span><br><span class="line"><span class="comment"># 2000-01-03,2</span></span><br><span class="line"><span class="comment"># 2000-01-04,3</span></span><br><span class="line"><span class="comment"># 2000-01-05,4</span></span><br><span class="line"><span class="comment"># 2000-01-06,5</span></span><br><span class="line"><span class="comment"># 2000-01-07,6</span></span><br></pre></td></tr></table></figure>

<p>处理分隔符格式</p>
<p>⼤部分存储在磁盘上的<strong>表格型数据</strong>都能⽤<code>pandas.read_table</code>进⾏加载。</p>
<p>使用python的csv模块:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> csv</span><br><span class="line"></span><br><span class="line">f = <span class="built_in">open</span>(<span class="string">&#x27;examples/ex7.csv&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将打开的文件对象传给csv.reader</span></span><br><span class="line">reader = csv.reader(f)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 对这个reader进⾏迭代将会为每⾏产⽣⼀个元组</span></span><br><span class="line"><span class="comment"># type(line)为list</span></span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> reader:</span><br><span class="line">	<span class="built_in">print</span>(line)</span><br><span class="line"><span class="comment"># [&#x27;a&#x27;, &#x27;b&#x27;, &#x27;c&#x27;]</span></span><br><span class="line"><span class="comment"># [&#x27;1&#x27;, &#x27;2&#x27;, &#x27;3&#x27;]</span></span><br><span class="line"><span class="comment"># [&#x27;1&#x27;, &#x27;2&#x27;, &#x27;3&#x27;]</span></span><br></pre></td></tr></table></figure>

<p>可以修改一下,产生格式化输出</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> csv</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;examples/ex7.csv&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    lines = <span class="built_in">list</span>(csv.reader(f))</span><br><span class="line">    <span class="comment"># 获取列标签和剩余的数据</span></span><br><span class="line">    header,values = lines[<span class="number">0</span>],lines[<span class="number">1</span>:]</span><br><span class="line">    data_dict = &#123;h: v <span class="keyword">for</span> h, v <span class="keyword">in</span> <span class="built_in">zip</span>(header, <span class="built_in">zip</span>(*values))&#125;</span><br><span class="line">    <span class="built_in">print</span>(data_dict)</span><br><span class="line">    <span class="comment"># &#123;&#x27;a&#x27;: (&#x27;1&#x27;, &#x27;1&#x27;), &#x27;b&#x27;: (&#x27;2&#x27;, &#x27;2&#x27;), &#x27;c&#x27;: (&#x27;3&#x27;, &#x27;3&#x27;)&#125;</span></span><br></pre></td></tr></table></figure>

<p>甚至还可以定义一个类:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> csv</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">my_dialect</span>(<span class="params">csv.Dialect</span>):</span></span><br><span class="line">    lineterminator = <span class="string">&#x27;\n&#x27;</span></span><br><span class="line">    <span class="comment"># 将换行符作为分隔符</span></span><br><span class="line">    delimiter = <span class="string">&#x27;;&#x27;</span></span><br><span class="line">    quotechar = <span class="string">&#x27;&quot;&#x27;</span></span><br><span class="line">    quoting = csv.QUOTE_MINIMAL</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;examples/ex7.csv&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    lines = <span class="built_in">list</span>(csv.reader(f,dialect=my_dialect))</span><br><span class="line">    <span class="comment"># 获取列标签和剩余的数据</span></span><br><span class="line">    header,values = lines[<span class="number">0</span>],lines[<span class="number">1</span>:]</span><br><span class="line">    data_dict = &#123;h: v <span class="keyword">for</span> h, v <span class="keyword">in</span> <span class="built_in">zip</span>(header, <span class="built_in">zip</span>(*values))&#125;</span><br><span class="line">    <span class="built_in">print</span>(data_dict)</span><br><span class="line">    <span class="comment"># &#123;&#x27;a,&quot;b&quot;,&quot;c&quot;&#x27;: (&#x27;1,&quot;2&quot;,&quot;3&quot;&#x27;, &#x27;1,&quot;2&quot;,&quot;3&quot;&#x27;)&#125;</span></span><br></pre></td></tr></table></figure>

<p>CSV.Dialect选项</p>
<p><img src="/images/269702537.png" alt="269702537"></p>
<p>写csv文件:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> csv</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;mydata.csv&#x27;</span>, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    writer = csv.writer(f, dialect=my_dialect)</span><br><span class="line">    writer.writerow((<span class="string">&#x27;one&#x27;</span>, <span class="string">&#x27;two&#x27;</span>, <span class="string">&#x27;three&#x27;</span>))</span><br><span class="line">    writer.writerow((<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;3&#x27;</span>))</span><br><span class="line">    writer.writerow((<span class="string">&#x27;4&#x27;</span>, <span class="string">&#x27;5&#x27;</span>, <span class="string">&#x27;6&#x27;</span>))</span><br><span class="line">    writer.writerow((<span class="string">&#x27;7&#x27;</span>, <span class="string">&#x27;8&#x27;</span>, <span class="string">&#x27;9&#x27;</span>))</span><br></pre></td></tr></table></figure>



<p>JSON数据</p>
<p>除其<strong>空值为null</strong>和一些其他的细微差别（如列表末尾不允许存在多余的逗号）之外，JSON非常接近于有效的Python代码。</p>
<p><strong>JSON数据所有的键都必须是字符串</strong>。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">obj = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">&#123;&quot;name&quot;: &quot;Wes&quot;,</span></span><br><span class="line"><span class="string"> &quot;places_lived&quot;: [&quot;United States&quot;, &quot;Spain&quot;, &quot;Germany&quot;],</span></span><br><span class="line"><span class="string"> &quot;pet&quot;: null,</span></span><br><span class="line"><span class="string"> &quot;siblings&quot;: [&#123;&quot;name&quot;: &quot;Scott&quot;, &quot;age&quot;: 30, &quot;pets&quot;: [&quot;Zeus&quot;, &quot;Zuko&quot;]&#125;,</span></span><br><span class="line"><span class="string">              &#123;&quot;name&quot;: &quot;Katie&quot;, &quot;age&quot;: 38,</span></span><br><span class="line"><span class="string">               &quot;pets&quot;: [&quot;Sixes&quot;, &quot;Stache&quot;, &quot;Cisco&quot;]&#125;]</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># json.loads:读取json字符串</span></span><br><span class="line">result = json.loads(obj)</span><br><span class="line"><span class="built_in">print</span>(result)  <span class="comment"># 输出略</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># json.dumps:将python对象转为json</span></span><br><span class="line">asjson = json.dumps(result)</span><br><span class="line"></span><br><span class="line"><span class="comment"># json.load:读取json文件</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;../config/record.json&quot;</span>,<span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> load_f:</span><br><span class="line">    load_dict = json.load(load_f)</span><br><span class="line">    <span class="built_in">print</span>(load_dict)  <span class="comment"># 输出略</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># json.dump:将数据写入json文件中</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;../config/record.json&quot;</span>,<span class="string">&quot;w&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    json.dump(new_dict,f)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;加载入文件完成...&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>将json数据转为DataFrame对象:</p>
<ul>
<li><p>json对象转为DataFrame对象:<br><code>pd.DataFrame(result[&#39;siblings&#39;])</code><br>直接传入DataFrame()即可</p>
</li>
<li><p>DataFrame对象转为json对象:</p>
<p><code>df.to_json()</code></p>
</li>
<li><p>json文件转为DataFrame对象:<br><code>pd.read_json(&#39;example.json&#39;)</code></p>
</li>
<li><p>DataFrame对象转为json文件:<br><code>df.to_json(&#39;hyl.json&#39;)</code></p>
</li>
</ul>
<p>也就是说,DataFrame转为json文件和转为json对象共用一个to_json方法.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">obj = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">&#123;&quot;name&quot;: &quot;Wes&quot;,</span></span><br><span class="line"><span class="string"> &quot;places_lived&quot;: [&quot;United States&quot;, &quot;Spain&quot;, &quot;Germany&quot;],</span></span><br><span class="line"><span class="string"> &quot;pet&quot;: null,</span></span><br><span class="line"><span class="string"> &quot;siblings&quot;: [&#123;&quot;name&quot;: &quot;Scott&quot;, &quot;age&quot;: 30, &quot;pets&quot;: [&quot;Zeus&quot;, &quot;Zuko&quot;]&#125;,</span></span><br><span class="line"><span class="string">              &#123;&quot;name&quot;: &quot;Katie&quot;, &quot;age&quot;: 38,</span></span><br><span class="line"><span class="string">               &quot;pets&quot;: [&quot;Sixes&quot;, &quot;Stache&quot;, &quot;Cisco&quot;]&#125;]</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 读取为json数据</span></span><br><span class="line">result = json.loads(obj)</span><br><span class="line"><span class="built_in">print</span>(result)  <span class="comment"># 输出略</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 转为DateFrame对象</span></span><br><span class="line">siblings = pd.DataFrame(result[<span class="string">&#x27;siblings&#x27;</span>], columns=[<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;age&#x27;</span>])</span><br><span class="line"><span class="built_in">print</span>(siblings)</span><br><span class="line"><span class="comment">#     name  age</span></span><br><span class="line"><span class="comment"># 0  Scott   30</span></span><br><span class="line"><span class="comment"># 1  Katie   38</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># examples/example.json文件数据为:</span></span><br><span class="line">	<span class="comment"># [&#123;&quot;a&quot;:	1,	&quot;b&quot;:	2,	&quot;c&quot;:	3&#125;,</span></span><br><span class="line">	<span class="comment">#  &#123;&quot;a&quot;:	4,	&quot;b&quot;:	5,	&quot;c&quot;:	6&#125;,</span></span><br><span class="line">	<span class="comment">#  &#123;&quot;a&quot;:	7,	&quot;b&quot;:	8,	&quot;c&quot;:	9&#125;]</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 读取json文件</span></span><br><span class="line"><span class="comment"># pandas.read_json的默认选项假设JSON数组中的每个对象是表格中的⼀⾏：</span></span><br><span class="line"><span class="comment"># 第七章介绍很深嵌套的json的读取</span></span><br><span class="line">data = pd.read_json(<span class="string">&#x27;examples/example.json&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(data)</span><br><span class="line"><span class="comment">#    a  b  c</span></span><br><span class="line"><span class="comment"># 0  1  2  3</span></span><br><span class="line"><span class="comment"># 1  4  5  6</span></span><br><span class="line"><span class="comment"># 2  7  8  9</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># DataFrame转为json数据:</span></span><br><span class="line"><span class="built_in">print</span>(data.to_json())</span><br><span class="line"><span class="comment"># &#123;&quot;a&quot;:&#123;&quot;0&quot;:1,&quot;1&quot;:4,&quot;2&quot;:7&#125;,&quot;b&quot;:&#123;&quot;0&quot;:2,&quot;1&quot;:5,&quot;2&quot;:8&#125;,&quot;c&quot;:&#123;&quot;0&quot;:3,&quot;1&quot;:6,&quot;2&quot;:9&#125;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 更改输出样式</span></span><br><span class="line"><span class="built_in">print</span>(data.to_json(orient=<span class="string">&#x27;records&#x27;</span>))</span><br><span class="line"><span class="comment"># [&#123;&quot;a&quot;:1,&quot;b&quot;:2,&quot;c&quot;:3&#125;,&#123;&quot;a&quot;:4,&quot;b&quot;:5,&quot;c&quot;:6&#125;,&#123;&quot;a&quot;:7,&quot;b&quot;:8,&quot;c&quot;:9&#125;]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 写入json文件</span></span><br><span class="line"><span class="built_in">print</span>(data.to_json(<span class="string">&#x27;hyl.json&#x27;</span>,orient=<span class="string">&#x27;records&#x27;</span>))</span><br><span class="line"><span class="comment"># [&#123;&quot;a&quot;:1,&quot;b&quot;:2,&quot;c&quot;:3&#125;,&#123;&quot;a&quot;:4,&quot;b&quot;:5,&quot;c&quot;:6&#125;,&#123;&quot;a&quot;:7,&quot;b&quot;:8,&quot;c&quot;:9&#125;]</span></span><br></pre></td></tr></table></figure>

<p>json的格式如下 :</p>
<ul>
<li>split，样式为 {index -&gt; [index], columns -&gt; [columns], data -&gt; [values]}</li>
<li>records，样式为[{column -&gt; value}, … , {column -&gt; value}]</li>
<li>index ，样式为 {index -&gt; {column -&gt; value}}</li>
<li>columns，样式为 {index -&gt; {column -&gt; value}}</li>
<li>values，数组样式</li>
<li>table，样式为{‘schema’: {schema}, ‘data’: {data}}，和records类似</li>
</ul>
<p>XML和HTML：Web信息收集<br>read_html方法：它可以使⽤lxml和Beautiful Soup⾃动将HTML⽂件中的<strong>表格</strong>解析为DataFrame对象。</p>
<p>pandas.read_html有⼀些选项，默认条件下，它会<strong>搜索</strong>、尝试解析标签内的的表格数据。结果是⼀个列表的DataFrame对象：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">tables = pd.read_html(<span class="string">&#x27;examples/fdic_failed_bank_list.html&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(tables)</span><br><span class="line"><span class="comment"># [                                  Bank Name         ...                Updated Date</span></span><br><span class="line"><span class="comment"># 0                               Allied Bank         ...           November 17, 2016</span></span><br><span class="line"><span class="comment"># 1              The Woodbury Banking Company         ...           November 17, 2016</span></span><br><span class="line"><span class="comment"># 2                    First CornerStone Bank         ...           September 6, 2016</span></span><br><span class="line"><span class="comment">#                                                     ...</span></span><br><span class="line"><span class="comment"># 544         First Alliance Bank &amp; Trust Co.         ...           February 18, 2003</span></span><br><span class="line"><span class="comment"># 545       National State Bank of Metropolis         ...              March 17, 2005</span></span><br><span class="line"><span class="comment"># 546                        Bank of Honolulu         ...              March 17, 2005</span></span><br><span class="line"><span class="comment"># [547 rows x 7 columns]]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 说明这个html中只有一个表格</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(tables))</span><br><span class="line"><span class="comment"># 1</span></span><br><span class="line"></span><br><span class="line">failures = tables[<span class="number">0</span>]</span><br><span class="line"><span class="comment"># 读取前5条数据</span></span><br><span class="line"><span class="built_in">print</span>(failures.head())</span><br><span class="line"><span class="comment">#                       Bank Name        ...               Updated Date</span></span><br><span class="line"><span class="comment"># 0                   Allied Bank        ...          November 17, 2016</span></span><br><span class="line"><span class="comment"># 1  The Woodbury Banking Company        ...          November 17, 2016</span></span><br><span class="line"><span class="comment"># 2        First CornerStone Bank        ...          September 6, 2016</span></span><br><span class="line"><span class="comment"># 3            Trust Company Bank        ...          September 6, 2016</span></span><br><span class="line"><span class="comment"># 4    North Milwaukee State Bank        ...              June 16, 2016</span></span><br><span class="line"><span class="comment"># [5 rows x 7 columns]</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">close_timestamps = pd.to_datetime(failures[<span class="string">&#x27;Closing Date&#x27;</span>])</span><br><span class="line"><span class="comment"># 计算按年份计算倒闭的银⾏数：</span></span><br><span class="line"><span class="built_in">print</span>(close_timestamps.dt.year.value_counts())</span><br><span class="line"><span class="comment"># 2010    157</span></span><br><span class="line"><span class="comment"># 2009    140</span></span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line"><span class="comment"># 2003      3</span></span><br><span class="line"><span class="comment"># 2000      2</span></span><br><span class="line"><span class="comment"># Name: Closing Date, dtype: int64</span></span><br></pre></td></tr></table></figure>



<p>利⽤lxml.objectify解析XML</p>
<p>XML和HTML的结构很相似，但XML更为通用。<br>XML记录形如下面格式:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">INDICATOR</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">INDICATOR_SEQ</span>&gt;</span>373889<span class="tag">&lt;/<span class="name">INDICATOR_SEQ</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">PARENT_SEQ</span>&gt;</span><span class="tag">&lt;/<span class="name">PARENT_SEQ</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">AGENCY_NAME</span>&gt;</span>Metro-North Railroad<span class="tag">&lt;/<span class="name">AGENCY_NAME</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">INDICATOR_NAME</span>&gt;</span>Escalator Availability<span class="tag">&lt;/<span class="name">INDICATOR_NAME</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">DESCRIPTION</span>&gt;</span>Percent of the time that escalators are operational</span><br><span class="line">  systemwide. The availability rate is based on physical observations performed</span><br><span class="line">  the morning of regular business days only. This is a new indicator the agency</span><br><span class="line">  began reporting in 2009.<span class="tag">&lt;/<span class="name">DESCRIPTION</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">PERIOD_YEAR</span>&gt;</span>2011<span class="tag">&lt;/<span class="name">PERIOD_YEAR</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">PERIOD_MONTH</span>&gt;</span>12<span class="tag">&lt;/<span class="name">PERIOD_MONTH</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">CATEGORY</span>&gt;</span>Service Indicators<span class="tag">&lt;/<span class="name">CATEGORY</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">FREQUENCY</span>&gt;</span>M<span class="tag">&lt;/<span class="name">FREQUENCY</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">DESIRED_CHANGE</span>&gt;</span>U<span class="tag">&lt;/<span class="name">DESIRED_CHANGE</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">INDICATOR_UNIT</span>&gt;</span>%<span class="tag">&lt;/<span class="name">INDICATOR_UNIT</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">DECIMAL_PLACES</span>&gt;</span>1<span class="tag">&lt;/<span class="name">DECIMAL_PLACES</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">YTD_TARGET</span>&gt;</span>97.00<span class="tag">&lt;/<span class="name">YTD_TARGET</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">YTD_ACTUAL</span>&gt;</span><span class="tag">&lt;/<span class="name">YTD_ACTUAL</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">MONTHLY_TARGET</span>&gt;</span>97.00<span class="tag">&lt;/<span class="name">MONTHLY_TARGET</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">MONTHLY_ACTUAL</span>&gt;</span><span class="tag">&lt;/<span class="name">MONTHLY_ACTUAL</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">INDICATOR</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>使用lxml解析HTML代码:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> io <span class="keyword">import</span> StringIO</span><br><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> objectify</span><br><span class="line"></span><br><span class="line">tag = <span class="string">&#x27;&lt;a href=&quot;http://www.google.com&quot;&gt;Google&lt;/a&gt;&#x27;</span></span><br><span class="line"><span class="comment"># 使用lxml解析HTML代码</span></span><br><span class="line">root = objectify.parse(StringIO(tag)).getroot()</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(root)</span><br><span class="line"><span class="comment"># Google</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(root.get(<span class="string">&#x27;href&#x27;</span>))</span><br><span class="line"><span class="comment"># http://www.google.com</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(root.text)</span><br><span class="line"><span class="comment"># Google</span></span><br></pre></td></tr></table></figure>

<p>将XML转为DataFrame:<br><strong>直接传给DataFrame即可</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> objectify</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">path = <span class="string">&#x27;datasets/mta_perf/Performance_MNR.xml&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(path) <span class="keyword">as</span> f:</span><br><span class="line">	parsed = objectify.parse(f)</span><br><span class="line">	root = parsed.getroot()</span><br><span class="line"></span><br><span class="line">	data = []</span><br><span class="line">	skip_fields = [<span class="string">&#x27;PARENT_SEQ&#x27;</span>, <span class="string">&#x27;INDICATOR_SEQ&#x27;</span>,</span><br><span class="line">	               <span class="string">&#x27;DESIRED_CHANGE&#x27;</span>, <span class="string">&#x27;DECIMAL_PLACES&#x27;</span>]</span><br><span class="line"></span><br><span class="line">	<span class="comment"># root.INDICATOR返回⼀个⽤于产⽣各个&lt;INDICATOR&gt;XML元素的⽣成器</span></span><br><span class="line">	<span class="keyword">for</span> elt <span class="keyword">in</span> root.INDICATOR:</span><br><span class="line">	    el_data = &#123;&#125;</span><br><span class="line">	    <span class="keyword">for</span> child <span class="keyword">in</span> elt.getchildren():</span><br><span class="line">	    	<span class="comment"># 跳过某些字段</span></span><br><span class="line">	        <span class="keyword">if</span> child.tag <span class="keyword">in</span> skip_fields:</span><br><span class="line">	            <span class="keyword">continue</span></span><br><span class="line">	        el_data[child.tag] = child.pyval</span><br><span class="line">	    data.append(el_data)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 转化为DataFrame</span></span><br><span class="line">perf = pd.DataFrame(data)</span><br><span class="line"><span class="built_in">print</span>(perf.head())</span><br><span class="line"><span class="comment">#             AGENCY_NAME            CATEGORY    ...     YTD_ACTUAL YTD_TARGET</span></span><br><span class="line"><span class="comment"># 0  Metro-North Railroad  Service Indicators    ...           96.9         95</span></span><br><span class="line"><span class="comment"># 1  Metro-North Railroad  Service Indicators    ...             96         95</span></span><br><span class="line"><span class="comment"># 2  Metro-North Railroad  Service Indicators    ...           96.3         95</span></span><br><span class="line"><span class="comment"># 3  Metro-North Railroad  Service Indicators    ...           96.8         95</span></span><br><span class="line"><span class="comment"># 4  Metro-North Railroad  Service Indicators    ...           96.6         95</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># [5 rows x 12 columns]</span></span><br></pre></td></tr></table></figure>



<hr>
<h2 id="6-2-⼆进制数据格式"><a href="#6-2-⼆进制数据格式" class="headerlink" title="6.2 ⼆进制数据格式"></a>6.2 ⼆进制数据格式</h2><p>pickle:就是一种⼆进制格式</p>
<p>DataFrame有to_json(),to_csv(),自然也有to_pickle方法:</p>
<ul>
<li>将DataFrame对象转成pickle文件:<br><code>fd.to_pickle(&#39;frame_pickle&#39;)</code></li>
<li>将pickle文件转为DataFrame对象:<br><code>data = pd.read_pickle(&#39;frame_pickle&#39;)</code></li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">frame = pd.read_csv(<span class="string">&#x27;examples/ex1.csv&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(frame)</span><br><span class="line"><span class="comment">#    a   b   c   d message</span></span><br><span class="line"><span class="comment"># 0  1   2   3   4   hello</span></span><br><span class="line"><span class="comment"># 1  5   6   7   8   world</span></span><br><span class="line"><span class="comment"># 2  9  10  11  12     foo</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 将DataFrame对象转为pickle文件</span></span><br><span class="line">frame.to_pickle(<span class="string">&#x27;frame_pickle&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">data = pd.read_pickle(<span class="string">&#x27;frame_pickle&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(data)</span><br><span class="line"><span class="comment">#    a   b   c   d message</span></span><br><span class="line"><span class="comment"># 0  1   2   3   4   hello</span></span><br><span class="line"><span class="comment"># 1  5   6   7   8   world</span></span><br><span class="line"><span class="comment"># 2  9  10  11  12     foo</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(data))</span><br><span class="line"><span class="comment"># &lt;class &#x27;pandas.core.frame.DataFrame&#x27;&gt;</span></span><br></pre></td></tr></table></figure>

<p>pandas内置了两个⼆进制数据格式:</p>
<ul>
<li>HDF5</li>
<li>MessagePack。</li>
</ul>
<p>其他的存储格式:</p>
<ul>
<li>bcolz：⼀种可压缩的列存储⼆进制格式，基于Blosc压缩库。</li>
<li>Feather：⼀种跨语⾔的列存储⽂件格式。Feather使⽤了Apache Arrow的列式内存格式。</li>
</ul>
<p>使⽤HDF5格式</p>
<p>HDF5是⼀种<strong>存储大规模科学数组数据</strong>的⾮常好的⽂件格式。<br>HDF5中的HDF指的是<code>层次型数据格式</code>（hierarchical data format）。它最适合⽤作“⼀次写多次读”的数据集。</p>
<p>DataFrame与HDF5的互转:</p>
<ul>
<li>DataFrame对象转为HDF5文件:<br><code>store = pd.HDFStore(&#39;mydata.h5&#39;)</code></li>
</ul>
<p>  返回store这个文件对象,之后可以填充数据:<br>  <code>store.put(&#39;obj2&#39;, df, format=&#39;table&#39;)</code><br>  或者<br>  <code>store[&#39;obj1_col&#39;] = df[&#39;a&#39;]</code></p>
<ul>
<li>HDF5文件转为DataFrame对象:<br><code>x = store.select(&#39;obj2&#39;, where=[&#39;index &gt;= 10 and index &lt;= 15&#39;])</code></li>
</ul>
<p>还有更方便的API:</p>
<ul>
<li>DataFrame对象转为HDF5文件:<br><code>df.to_hdf(&#39;mydata.h5&#39;, &#39;obj3&#39;, format=&#39;table&#39;)</code></li>
<li>HDF5文件转为DataFrame对象:<br><code>df = pd.read_hdf(&#39;mydata.h5&#39;, &#39;obj3&#39;, where=[&#39;index &lt; 5&#39;])</code></li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建一个DataFrame对象</span></span><br><span class="line">frame = pd.DataFrame(&#123;<span class="string">&#x27;a&#x27;</span>: np.random.randn(<span class="number">100</span>)&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将DataFrame对象存储成mydata.h5</span></span><br><span class="line"><span class="comment"># 返回一个文件对象</span></span><br><span class="line">store = pd.HDFStore(<span class="string">&#x27;mydata.h5&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(store))</span><br><span class="line"><span class="comment"># &lt;class &#x27;pandas.io.pytables.HDFStore&#x27;&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 给这个文件对象填充数据</span></span><br><span class="line">store[<span class="string">&#x27;obj1&#x27;</span>] = frame</span><br><span class="line">store[<span class="string">&#x27;obj1_col&#x27;</span>] = frame[<span class="string">&#x27;a&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(store)</span><br><span class="line"><span class="comment"># File path: mydata.h5</span></span><br><span class="line"><span class="comment"># /obj1                frame        (shape-&gt;[100,1])                               </span></span><br><span class="line">        </span><br><span class="line"><span class="comment"># /obj1_col            series       (shape-&gt;[100])                                 </span></span><br><span class="line">        </span><br><span class="line"><span class="comment"># /obj2                frame_table  (typ-&gt;appendable,nrows-&gt;100,ncols-&gt;1,indexers-&gt;</span></span><br><span class="line"><span class="comment"># [index])</span></span><br><span class="line"><span class="comment"># /obj3                frame_table  (typ-&gt;appendable,nrows-&gt;100,ncols-&gt;1,indexers-&gt;</span></span><br><span class="line"><span class="comment"># [index])</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用类似于字典的方式获取HDF5文件的对象</span></span><br><span class="line"><span class="built_in">print</span>(store[<span class="string">&#x27;obj1&#x27;</span>])</span><br><span class="line"><span class="comment">#            a</span></span><br><span class="line"><span class="comment"># 0  -1.093319</span></span><br><span class="line"><span class="comment"># 1   0.863954</span></span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line"><span class="comment"># 98  0.209667</span></span><br><span class="line"><span class="comment"># 99 -0.824430</span></span><br><span class="line"><span class="comment"># [100rows x 1 columns]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 将DataFrame对象存储到HDF5文件中</span></span><br><span class="line">store.put(<span class="string">&#x27;obj2&#x27;</span>, frame, <span class="built_in">format</span>=<span class="string">&#x27;table&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># HDFStore文件转为DataFrame对象</span></span><br><span class="line">df = store.select(<span class="string">&#x27;obj2&#x27;</span>, where=[<span class="string">&#x27;index &gt;= 10 and index &lt;= 15&#x27;</span>])</span><br><span class="line"><span class="built_in">print</span>(df)</span><br><span class="line"><span class="comment">#            a</span></span><br><span class="line"><span class="comment"># 10  0.108707</span></span><br><span class="line"><span class="comment"># 11  0.346106</span></span><br><span class="line"><span class="comment"># 12 -2.397788</span></span><br><span class="line"><span class="comment"># 13  0.948306</span></span><br><span class="line"><span class="comment"># 14  0.442709</span></span><br><span class="line"><span class="comment"># 15 -0.902998</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(df))</span><br><span class="line"><span class="comment"># &lt;class &#x27;pandas.core.frame.DataFrame&#x27;&gt;</span></span><br><span class="line"></span><br><span class="line">store.close()</span><br></pre></td></tr></table></figure>

<p>HDFStore⽀持两种存储模式，’fixed’和’table’。<br>后者通常会更慢，但是⽀持使⽤特殊语法进⾏查询操作.</p>
<p><code>store.put(&#39;obj2&#39;, df, format=&#39;table&#39;)</code>是<code>store[&#39;obj2&#39;] = frame</code>⽅法的显示版本，允许我们设置其它的选项，⽐如格式。</p>
<p>使用更方便API:read_hdf和to_hdf</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">frame = pd.DataFrame(&#123;<span class="string">&#x27;a&#x27;</span>: np.random.randn(<span class="number">100</span>)&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(frame)</span><br><span class="line"><span class="comment">#            a</span></span><br><span class="line"><span class="comment"># 0  -0.022453</span></span><br><span class="line"><span class="comment"># 1   0.117988</span></span><br><span class="line"><span class="comment"># 2  -0.102322</span></span><br><span class="line"><span class="comment"># 3  -1.179342</span></span><br><span class="line"><span class="comment"># 4  -0.177205</span></span><br><span class="line"><span class="comment"># ..       ...</span></span><br><span class="line"><span class="comment"># 98 -0.905328</span></span><br><span class="line"><span class="comment"># 99  0.589680</span></span><br><span class="line"><span class="comment"># [100 rows x 1 columns]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># DataFrame对象写入到HDF文件</span></span><br><span class="line">frame.to_hdf(<span class="string">&#x27;mydata.h5&#x27;</span>, <span class="string">&#x27;obj3&#x27;</span>, <span class="built_in">format</span>=<span class="string">&#x27;table&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 读取HDF文件中的数据</span></span><br><span class="line">df = pd.read_hdf(<span class="string">&#x27;mydata.h5&#x27;</span>, <span class="string">&#x27;obj3&#x27;</span>, where=[<span class="string">&#x27;index &lt; 5&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(df))</span><br><span class="line"><span class="comment"># &lt;class &#x27;pandas.core.frame.DataFrame&#x27;&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(df)</span><br><span class="line"><span class="comment">#            a</span></span><br><span class="line"><span class="comment"># 0  -0.022453</span></span><br><span class="line"><span class="comment"># 1   0.117988</span></span><br><span class="line"><span class="comment"># 2  -0.102322</span></span><br><span class="line"><span class="comment"># 3  -1.179342</span></span><br><span class="line"><span class="comment"># 4  -0.177205</span></span><br></pre></td></tr></table></figure>



<p>读取Microsoft Excel⽂件</p>
<p>ExcelFile类或pandas.read_excel函数⽀持读取Excel的表格型数据</p>
<ul>
<li>Excel文件转为DataFrame对象:<br><code>read_excel</code><br>参数可以是excel文件路径,也可以是ExcelFile对象</li>
<li>DataFrame对象转为Excel文件:<br><code>to_excel</code><br>参数可以是excel文件路径,也可以是ExcelWriter对象</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 传入路径来创建ExcelFile实例</span></span><br><span class="line">excelfile = pd.ExcelFile(<span class="string">&#x27;examples/ex1.xlsx&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(excelfile)</span><br><span class="line"><span class="comment"># &lt;pandas.io.excel.ExcelFile object at 0x00000249ECB3A080&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 传入一个ExcelFile实例来创建DataFrame对象</span></span><br><span class="line">df = pd.read_excel(excelfile, <span class="string">&#x27;Sheet1&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(df))</span><br><span class="line"><span class="comment"># &lt;class &#x27;pandas.core.frame.DataFrame&#x27;&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(df)</span><br><span class="line"><span class="comment">#    a   b   c   d message</span></span><br><span class="line"><span class="comment"># 0  1   2   3   4   hello</span></span><br><span class="line"><span class="comment"># 1  5   6   7   8   world</span></span><br><span class="line"><span class="comment"># 2  9  10  11  12     foo</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 也可以传入Excel文件路径来创建DataFrame对象</span></span><br><span class="line">df = pd.read_excel(<span class="string">&#x27;examples/ex1.xlsx&#x27;</span>, <span class="string">&#x27;Sheet1&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(df))</span><br><span class="line"><span class="comment"># &lt;class &#x27;pandas.core.frame.DataFrame&#x27;&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(df)</span><br><span class="line"><span class="comment">#    a   b   c   d message</span></span><br><span class="line"><span class="comment"># 0  1   2   3   4   hello</span></span><br><span class="line"><span class="comment"># 1  5   6   7   8   world</span></span><br><span class="line"><span class="comment"># 2  9  10  11  12     foo</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建ExcelWriter对象</span></span><br><span class="line">writer = pd.ExcelWriter(<span class="string">&#x27;ex2.xlsx&#x27;</span>)</span><br><span class="line"><span class="comment"># 将DataFrame对象写入到Excel文件中</span></span><br><span class="line">frame.to_excel(writer, <span class="string">&#x27;Sheet1&#x27;</span>)</span><br><span class="line"><span class="comment"># 注意要保存writer对象</span></span><br><span class="line">writer.save()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 当然也可以不创建ExcelWriter对象,直接传入文件路径来写入</span></span><br><span class="line">frame.to_excel(<span class="string">&#x27;ex2.xlsx&#x27;</span>)</span><br></pre></td></tr></table></figure>



<hr>
<h2 id="6-3-Web-APIs交互"><a href="#6-3-Web-APIs交互" class="headerlink" title="6.3 Web APIs交互"></a>6.3 Web APIs交互</h2><p>老本行了,不多谈:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;https://api.github.com/repos/pandas-dev/pandas/issues&#x27;</span></span><br><span class="line">resp = requests.get(url)</span><br><span class="line"></span><br><span class="line"><span class="comment"># json():读取这个Http响应为json文件</span></span><br><span class="line">data = resp.json()</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(data[<span class="number">0</span>].get(<span class="string">&#x27;title&#x27;</span>))</span><br><span class="line"><span class="comment"># 输出略</span></span><br><span class="line"></span><br><span class="line">issues = pd.DataFrame(data, columns=[<span class="string">&#x27;number&#x27;</span>, <span class="string">&#x27;title&#x27;</span>,<span class="string">&#x27;labels&#x27;</span>, <span class="string">&#x27;state&#x27;</span>])</span><br><span class="line"><span class="built_in">print</span>(issues)</span><br><span class="line"><span class="comment"># 输出略</span></span><br></pre></td></tr></table></figure>



<hr>
<h2 id="6-4-数据库交互"><a href="#6-4-数据库交互" class="headerlink" title="6.4 数据库交互"></a>6.4 数据库交互</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> sqlite3</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建表</span></span><br><span class="line">query = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">	CREATE TABLE test</span></span><br><span class="line"><span class="string">	(a VARCHAR(20), b VARCHAR(20),</span></span><br><span class="line"><span class="string">	 c REAL,        d INTEGER</span></span><br><span class="line"><span class="string">	);</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="comment"># 连接数据库</span></span><br><span class="line">con = sqlite3.connect(<span class="string">&#x27;mydata.sqlite&#x27;</span>)</span><br><span class="line">con.execute(query)</span><br><span class="line">con.commit()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 插入数据</span></span><br><span class="line">data = [(<span class="string">&#x27;Atlanta&#x27;</span>, <span class="string">&#x27;Georgia&#x27;</span>, <span class="number">1.25</span>, <span class="number">6</span>),</span><br><span class="line">        (<span class="string">&#x27;Tallahassee&#x27;</span>, <span class="string">&#x27;Florida&#x27;</span>, <span class="number">2.6</span>, <span class="number">3</span>),</span><br><span class="line">        (<span class="string">&#x27;Sacramento&#x27;</span>, <span class="string">&#x27;California&#x27;</span>, <span class="number">1.7</span>, <span class="number">5</span>)]</span><br><span class="line">sql = <span class="string">&quot;INSERT INTO test VALUES(?, ?, ?, ?)&quot;</span></span><br><span class="line">con.executemany(sql, data)</span><br><span class="line">con.commit()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 读取数据</span></span><br><span class="line"><span class="comment"># 创建游标</span></span><br><span class="line">cursor = con.execute(<span class="string">&#x27;select * from test&#x27;</span>)</span><br><span class="line">rows = cursor.fetchall()</span><br><span class="line"></span><br><span class="line"><span class="comment"># ⼤部分Python SQL驱动器（PyODBC、</span></span><br><span class="line"><span class="comment"># psycopg2、MySQLdb、pymssql等）都会返回⼀个元组列表：</span></span><br><span class="line"><span class="built_in">print</span>(rows)</span><br><span class="line"><span class="comment"># [(&#x27;Atlanta&#x27;, &#x27;Georgia&#x27;, 1.25, 6),</span></span><br><span class="line"><span class="comment">#  (&#x27;Tallahassee&#x27;, &#x27;Florida&#x27;, 2.6, 3), </span></span><br><span class="line"><span class="comment">#  (&#x27;Sacramento&#x27;, &#x27;California&#x27;, 1.7, 5)]</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 列名就位于光标的description属性中</span></span><br><span class="line"><span class="built_in">print</span>(cursor.description)</span><br><span class="line"><span class="comment"># ((&#x27;a&#x27;, None, None, None, None, None, None), </span></span><br><span class="line"><span class="comment"># (&#x27;b&#x27;, None, None, None, None, None, None), </span></span><br><span class="line"><span class="comment"># (&#x27;c&#x27;, None, None, None, None, None, None), </span></span><br><span class="line"><span class="comment"># (&#x27;d&#x27;, None, None, None, None, None, None))</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 元组列表传给DataFrame构造器，创建DataFrame对象</span></span><br><span class="line"><span class="comment"># 列名就位于光标的description属性中</span></span><br><span class="line">df = pd.DataFrame(rows, columns=[x[<span class="number">0</span>] <span class="keyword">for</span> x <span class="keyword">in</span> cursor.description])</span><br><span class="line"><span class="built_in">print</span>(df)</span><br><span class="line"><span class="comment">#              a           b     c  d</span></span><br><span class="line"><span class="comment"># 0      Atlanta     Georgia  1.25  6</span></span><br><span class="line"><span class="comment"># 1  Tallahassee     Florida  2.60  3</span></span><br><span class="line"><span class="comment"># 2   Sacramento  California  1.70  5</span></span><br></pre></td></tr></table></figure>

<p>当然也有<code>read_sql</code>用于从SQLAlchemy连接读取数据。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> sqlalchemy <span class="keyword">as</span> sqla</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">db = sqla.create_engine(<span class="string">&#x27;sqlite:///mydata.sqlite&#x27;</span>)</span><br><span class="line">df = pd.read_sql(<span class="string">&#x27;select * from test&#x27;</span>, db)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(df))</span><br><span class="line"><span class="comment"># &lt;class &#x27;pandas.core.frame.DataFrame&#x27;&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(df)</span><br><span class="line"><span class="comment">#              a           b     c  d</span></span><br><span class="line"><span class="comment"># 0      Atlanta     Georgia  1.25  6</span></span><br><span class="line"><span class="comment"># 1  Tallahassee     Florida  2.60  3</span></span><br><span class="line"><span class="comment"># 2   Sacramento  California  1.70  5</span></span><br></pre></td></tr></table></figure>










</div></div><div class="post-main post-comment"></div></article><link rel="stylesheet" type="text/css" href="/css/font.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.css"><script src="//cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script><script src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script>$(document).ready(function() {
  $(".fancybox").fancybox();
});
</script></body></html>
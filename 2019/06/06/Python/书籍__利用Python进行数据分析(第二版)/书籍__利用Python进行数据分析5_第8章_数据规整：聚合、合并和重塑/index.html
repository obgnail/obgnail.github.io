<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content=" id=&quot;第8章-数据规整：聚合、合并和重塑&quot;&gt;&lt;a href=&quot;#第8章-数据规整：聚合、合并和重塑&quot; class=&quot;headerlink&quot; title=&quot;第8章 数据规整：聚合、合并和重塑&quot;&gt;&lt;/a&gt;第8章 数据规整：聚合、合并和重塑&lt;/h1&gt;&lt;p&gt;本章关注可以聚合、合并、重塑数据的⽅法。"><link rel="stylesheet" type="text/css" href="/css/normalize.css"><link rel="stylesheet" type="text/css" href="/css/highlight.css"><link rel="stylesheet" type="text/css" href="/css/noise.css"><title>利用Python进行数据分析5_第8章_数据规整：聚合、合并和重塑 | 凉薄的自动书记人偶</title><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><meta name="generator" content="Hexo 5.4.0"></head><body><article class="wrapper"><div class="post-main"><div class="nav"><nav class="container"><a class="sidebar-nav-item active" href="/">Home</a></nav><div class="container post-meta"><div class="post-tags"><a class="post-tag-none-link" href="/tags/Python/" rel="tag">Python</a></div><div class="post-time">2019-06-06</div></div></div><div class="container post-header"><h1>利用Python进行数据分析5_第8章_数据规整：聚合、合并和重塑</h1></div><div class="container post-toc"><details class="toc"><summary class="toc-accordion">Table of Contents</summary><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC8%E7%AB%A0-%E6%95%B0%E6%8D%AE%E8%A7%84%E6%95%B4%EF%BC%9A%E8%81%9A%E5%90%88%E3%80%81%E5%90%88%E5%B9%B6%E5%92%8C%E9%87%8D%E5%A1%91"><span class="toc-number">1.</span> <span class="toc-text">第8章 数据规整：聚合、合并和重塑</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#8-1-%E5%B1%82%E6%AC%A1%E5%8C%96%E7%B4%A2%E5%BC%95"><span class="toc-number">1.1.</span> <span class="toc-text">8.1 层次化索引</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-2-%E5%90%88%E5%B9%B6%E6%95%B0%E6%8D%AE%E9%9B%86"><span class="toc-number">1.2.</span> <span class="toc-text">8.2 合并数据集</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-3-%E9%87%8D%E5%A1%91%E5%92%8C%E8%BD%B4%E5%90%91%E6%97%8B%E8%BD%AC"><span class="toc-number">1.3.</span> <span class="toc-text">8.3 重塑和轴向旋转</span></a></li></ol></li></ol></details></div><div class="container post-content"><h1 id="第8章-数据规整：聚合、合并和重塑"><a href="#第8章-数据规整：聚合、合并和重塑" class="headerlink" title="第8章 数据规整：聚合、合并和重塑"></a>第8章 数据规整：聚合、合并和重塑</h1><p>本章关注可以聚合、合并、重塑数据的⽅法。</p>
<h2 id="8-1-层次化索引"><a href="#8-1-层次化索引" class="headerlink" title="8.1 层次化索引"></a>8.1 层次化索引</h2><p>层次化索引:使你能在⼀个轴上拥有多个（两个以上）索引级别。抽象点说，它使你能以低维度形式处理⾼维度数据。</p>
<p>简单来说,就是多层索引</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过传入嵌套的列表作为index来创建多层索引</span></span><br><span class="line">data = pd.Series(np.random.randn(<span class="number">9</span>),</span><br><span class="line">                 index=[[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;d&#x27;</span>, <span class="string">&#x27;d&#x27;</span>],</span><br><span class="line">                        [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">3</span>]])</span><br><span class="line"><span class="built_in">print</span>(data)</span><br><span class="line"><span class="comment"># a  1    0.616399</span></span><br><span class="line"><span class="comment">#    2    0.966187</span></span><br><span class="line"><span class="comment">#    3   -1.281433</span></span><br><span class="line"><span class="comment"># b  1    0.886411</span></span><br><span class="line"><span class="comment">#    3   -0.148181</span></span><br><span class="line"><span class="comment"># c  1   -0.145789</span></span><br><span class="line"><span class="comment">#    2    0.119735</span></span><br><span class="line"><span class="comment"># d  2   -0.333327</span></span><br><span class="line"><span class="comment">#    3    0.047652</span></span><br><span class="line"><span class="comment"># dtype: float64</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(data.index)</span><br><span class="line"><span class="comment"># MultiIndex(levels=[[&#x27;a&#x27;, &#x27;b&#x27;, &#x27;c&#x27;, &#x27;d&#x27;], [1, 2, 3]],</span></span><br><span class="line"><span class="comment">#            labels=[[0, 0, 0, 1, 1, 2, 2, 3, 3], [0, 1, 2, 0, 2, 0, 1, 1, 2]])</span></span><br></pre></td></tr></table></figure>

<p>注意:</p>
<ul>
<li>通过传入列表的方式作为index来创建多层索引时嵌套的列表的len必须一致</li>
<li>不能通过传入字典的方式作为index来创建多层索引</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 不能通过传入字典的方式作为index来创建多层索引</span></span><br><span class="line">data = pd.Series(np.random.randn(<span class="number">9</span>),</span><br><span class="line">                 index=&#123;<span class="string">&#x27;a&#x27;</span>:[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>],<span class="string">&#x27;b&#x27;</span>:[<span class="number">1</span>,<span class="number">3</span>],<span class="string">&#x27;c&#x27;</span>:[<span class="number">1</span>,<span class="number">2</span>],<span class="string">&#x27;d&#x27;</span>:[<span class="number">2</span>,<span class="number">3</span>]&#125;)</span><br><span class="line"><span class="comment"># ValueError: Length of passed values is 9, index implies 4</span></span><br></pre></td></tr></table></figure>

<p>对于⼀个层次化索引的对象，可以使⽤所谓的<strong>部分索引</strong>，使⽤它选取数据⼦集的操作更简单,也可以直接进行<strong>内部索引</strong>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过传入嵌套的列表作为index来创建多层索引</span></span><br><span class="line">data = pd.Series(np.arange(<span class="number">10000</span>,<span class="number">10009</span>),</span><br><span class="line">                 index=[[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;d&#x27;</span>, <span class="string">&#x27;d&#x27;</span>],</span><br><span class="line">                        [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">3</span>]])</span><br><span class="line"><span class="built_in">print</span>(data)</span><br><span class="line"><span class="comment"># a  1    10000</span></span><br><span class="line"><span class="comment">#    2    10001</span></span><br><span class="line"><span class="comment">#    3    10002</span></span><br><span class="line"><span class="comment"># b  1    10003</span></span><br><span class="line"><span class="comment">#    3    10004</span></span><br><span class="line"><span class="comment"># c  1    10005</span></span><br><span class="line"><span class="comment">#    2    10006</span></span><br><span class="line"><span class="comment"># d  2    10007</span></span><br><span class="line"><span class="comment">#    3    10008</span></span><br><span class="line"><span class="comment"># dtype: int32</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 部分索引</span></span><br><span class="line"><span class="built_in">print</span>(data[<span class="string">&#x27;b&#x27;</span>])</span><br><span class="line"><span class="comment"># 1    10003</span></span><br><span class="line"><span class="comment"># 3    10004</span></span><br><span class="line"><span class="comment"># dtype: int32</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(data[<span class="string">&#x27;b&#x27;</span>:<span class="string">&#x27;c&#x27;</span>])</span><br><span class="line"><span class="comment"># b  1    10003</span></span><br><span class="line"><span class="comment">#    3    10004</span></span><br><span class="line"><span class="comment"># c  1    10005</span></span><br><span class="line"><span class="comment">#    2    10006</span></span><br><span class="line"><span class="comment"># dtype: int32</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 花式索引,索引bd两个外层</span></span><br><span class="line"><span class="built_in">print</span>(data.loc[[<span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;d&#x27;</span>]])</span><br><span class="line"><span class="comment"># b  1    10003</span></span><br><span class="line"><span class="comment">#    3    10004</span></span><br><span class="line"><span class="comment"># d  2    10007</span></span><br><span class="line"><span class="comment">#    3    10008</span></span><br><span class="line"><span class="comment"># dtype: int32</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 在&quot;内层&quot;进行选取</span></span><br><span class="line"><span class="comment"># 先选择外层全部,然后选择每个外层的idx=2的行</span></span><br><span class="line"><span class="built_in">print</span>(data.loc[:, <span class="number">2</span>])</span><br><span class="line"><span class="comment"># a    10001</span></span><br><span class="line"><span class="comment"># c    10006</span></span><br><span class="line"><span class="comment"># d    10007</span></span><br><span class="line"><span class="comment"># dtype: int32</span></span><br></pre></td></tr></table></figure>

<p>层次化索引在数据重塑和基于分组的操作（如⽣成透视表）中扮演着重要的⻆⾊。</p>
<ul>
<li>se.unstack():<br>让excel所谓的<code>一维表</code>变成<code>二维表</code></li>
<li>se.stack():<br>逆运算,让excel所谓的<code>二维表</code>变成<code>一维表</code></li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过传入嵌套的列表作为index来创建多层索引</span></span><br><span class="line">data = pd.Series(np.arange(<span class="number">10000</span>,<span class="number">10009</span>),</span><br><span class="line">                 index=[[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;d&#x27;</span>, <span class="string">&#x27;d&#x27;</span>],</span><br><span class="line">                        [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">3</span>]])</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(data)</span><br><span class="line"><span class="comment"># a  1    10000</span></span><br><span class="line"><span class="comment">#    2    10001</span></span><br><span class="line"><span class="comment">#    3    10002</span></span><br><span class="line"><span class="comment"># b  1    10003</span></span><br><span class="line"><span class="comment">#    3    10004</span></span><br><span class="line"><span class="comment"># c  1    10005</span></span><br><span class="line"><span class="comment">#    2    10006</span></span><br><span class="line"><span class="comment"># d  2    10007</span></span><br><span class="line"><span class="comment">#    3    10008</span></span><br><span class="line"><span class="comment"># dtype: int32</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(data.unstack())</span><br><span class="line"><span class="comment">#          1        2        3</span></span><br><span class="line"><span class="comment"># a  10000.0  10001.0  10002.0</span></span><br><span class="line"><span class="comment"># b  10003.0      NaN  10004.0</span></span><br><span class="line"><span class="comment"># c  10005.0  10006.0      NaN</span></span><br><span class="line"><span class="comment"># d      NaN  10007.0  10008.0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(data.unstack().stack())</span><br><span class="line"><span class="comment"># a  1    10000.0</span></span><br><span class="line"><span class="comment">#    2    10001.0</span></span><br><span class="line"><span class="comment">#    3    10002.0</span></span><br><span class="line"><span class="comment"># b  1    10003.0</span></span><br><span class="line"><span class="comment">#    3    10004.0</span></span><br><span class="line"><span class="comment"># c  1    10005.0</span></span><br><span class="line"><span class="comment">#    2    10006.0</span></span><br><span class="line"><span class="comment"># d  2    10007.0</span></span><br><span class="line"><span class="comment">#    3    10008.0</span></span><br><span class="line"><span class="comment"># dtype: float64</span></span><br></pre></td></tr></table></figure>

<ul>
<li>DataFrame有两条轴,所以可以创建两个层次索引</li>
<li>每层索引都可以取一个名字:<br>df.index.names = [‘floor1’,’floor2’]</li>
<li>层次索引的索引方法回忆numpy的索引方法,二者没有本质区别</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">df = pd.DataFrame(np.arange(<span class="number">10000</span>,<span class="number">10012</span>).reshape((<span class="number">4</span>, <span class="number">3</span>)),</span><br><span class="line">                     index=[[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;b&#x27;</span>], [<span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>]],</span><br><span class="line">                     columns=[[<span class="string">&#x27;Ohio&#x27;</span>, <span class="string">&#x27;Ohio&#x27;</span>, <span class="string">&#x27;Colorado&#x27;</span>],</span><br><span class="line">                              [<span class="string">&#x27;Green&#x27;</span>, <span class="string">&#x27;Red&#x27;</span>, <span class="string">&#x27;Green&#x27;</span>]])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">df.index.names = [<span class="string">&#x27;floor1&#x27;</span>,<span class="string">&#x27;floor2&#x27;</span>]</span><br><span class="line">df.columns.names = [<span class="string">&#x27;state&#x27;</span>, <span class="string">&#x27;color&#x27;</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(df)</span><br><span class="line"><span class="comment"># state           Ohio        Colorado</span></span><br><span class="line"><span class="comment"># color          Green    Red    Green</span></span><br><span class="line"><span class="comment"># floor1 floor2                       </span></span><br><span class="line"><span class="comment"># a      1       10000  10001    10002</span></span><br><span class="line"><span class="comment">#        2       10003  10004    10005</span></span><br><span class="line"><span class="comment"># b      1       10006  10007    10008</span></span><br><span class="line"><span class="comment">#        2       10009  10010    10011</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(df[<span class="string">&#x27;Ohio&#x27;</span>])</span><br><span class="line"><span class="comment"># color          Green    Red</span></span><br><span class="line"><span class="comment"># floor1 floor2              </span></span><br><span class="line"><span class="comment"># a      1       10000  10001</span></span><br><span class="line"><span class="comment">#        2       10003  10004</span></span><br><span class="line"><span class="comment"># b      1       10006  10007</span></span><br><span class="line"><span class="comment">#        2       10009  10010</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(df[<span class="string">&#x27;Ohio&#x27;</span>][<span class="string">&#x27;Green&#x27;</span>])</span><br><span class="line"><span class="comment"># floor1  floor2</span></span><br><span class="line"><span class="comment"># a       1         10000</span></span><br><span class="line"><span class="comment">#         2         10003</span></span><br><span class="line"><span class="comment"># b       1         10006</span></span><br><span class="line"><span class="comment">#         2         10009</span></span><br><span class="line"><span class="comment"># Name: Green, dtype: int32</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(df[<span class="string">&#x27;Ohio&#x27;</span>].loc[<span class="string">&#x27;a&#x27;</span>])</span><br><span class="line"><span class="comment"># color   Green    Red</span></span><br><span class="line"><span class="comment"># floor2              </span></span><br><span class="line"><span class="comment"># 1       10000  10001</span></span><br><span class="line"><span class="comment"># 2       10003  10004</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(df[<span class="string">&#x27;Ohio&#x27;</span>][<span class="string">&#x27;Green&#x27;</span>].loc[<span class="string">&#x27;a&#x27;</span>][<span class="number">1</span>])</span><br><span class="line"><span class="comment"># 10000</span></span><br></pre></td></tr></table></figure>

<p>第二种创建MultiIndex的方法:<br>独立使用MultiIndex对象from_arrays自行创建.之后就可以将这个idx赋给其他DataFrame或者Series对象了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">idx = pd.MultiIndex.from_arrays([[<span class="string">&#x27;col1&#x27;</span>,<span class="string">&#x27;col2&#x27;</span>],</span><br><span class="line">                           [<span class="string">&#x27;inner1&#x27;</span>,<span class="string">&#x27;inner2&#x27;</span>]])</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(idx)</span><br><span class="line"><span class="comment"># MultiIndex(levels=[[&#x27;col1&#x27;, &#x27;col2&#x27;], [&#x27;inner1&#x27;, &#x27;inner2&#x27;]],</span></span><br><span class="line"><span class="comment">#            labels=[[0, 1], [0, 1]])</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">df = pd.DataFrame(np.arange(<span class="number">10000</span>,<span class="number">10004</span>).reshape((<span class="number">2</span>, <span class="number">2</span>)),</span><br><span class="line">                     index=idx)</span><br><span class="line"><span class="built_in">print</span>(df)</span><br><span class="line"><span class="comment">#                  0      1</span></span><br><span class="line"><span class="comment"># col1 inner1  10000  10001</span></span><br><span class="line"><span class="comment"># col2 inner2  10002  10003</span></span><br></pre></td></tr></table></figure>



<p>重排与分级排序</p>
<ul>
<li><p>swaplevel:<br><strong>调换MultiIndex对象的两个层次index的顺序</strong></p>
</li>
<li><p>sort_index:<br>根据单个级别中的<strong>值</strong>对数据进⾏排序。<br>(既然是对数据进行排序,那么就只能对行进行排序了,不能对列进行排序,而且对列进行排序也没有意义)</p>
</li>
<li><p>使用花式索引来重排列:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">df = pd.DataFrame(np.arange(<span class="number">10000</span>,<span class="number">10012</span>).reshape((<span class="number">4</span>, <span class="number">3</span>)),</span><br><span class="line">                     index=[[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;b&#x27;</span>], [<span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>]],</span><br><span class="line">                     columns=[[<span class="string">&#x27;Ohio&#x27;</span>, <span class="string">&#x27;Ohio&#x27;</span>, <span class="string">&#x27;Colorado&#x27;</span>],</span><br><span class="line">                              [<span class="string">&#x27;Green&#x27;</span>, <span class="string">&#x27;Red&#x27;</span>, <span class="string">&#x27;Green&#x27;</span>]])</span><br><span class="line"></span><br><span class="line">df.index.names = [<span class="string">&#x27;floor1&#x27;</span>,<span class="string">&#x27;floor2&#x27;</span>]</span><br><span class="line">df.columns.names = [<span class="string">&#x27;state&#x27;</span>, <span class="string">&#x27;color&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(df)</span><br><span class="line"><span class="comment"># state           Ohio        Colorado</span></span><br><span class="line"><span class="comment"># color          Green    Red    Green</span></span><br><span class="line"><span class="comment"># floor1 floor2                       </span></span><br><span class="line"><span class="comment"># a      1       10000  10001    10002</span></span><br><span class="line"><span class="comment">#        2       10003  10004    10005</span></span><br><span class="line"><span class="comment"># b      1       10006  10007    10008</span></span><br><span class="line"><span class="comment">#        2       10009  10010    10011</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 调换MultiIndex对象的两个层次index的顺序</span></span><br><span class="line">df2 = df.swaplevel(<span class="string">&#x27;floor1&#x27;</span>, <span class="string">&#x27;floor2&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(df2))</span><br><span class="line"><span class="comment"># &lt;class &#x27;pandas.core.frame.DataFrame&#x27;&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(df2)</span><br><span class="line"><span class="comment"># state           Ohio        Colorado</span></span><br><span class="line"><span class="comment"># color          Green    Red    Green</span></span><br><span class="line"><span class="comment"># floor2 floor1                       </span></span><br><span class="line"><span class="comment"># 1      a       10000  10001    10002</span></span><br><span class="line"><span class="comment"># 2      a       10003  10004    10005</span></span><br><span class="line"><span class="comment"># 1      b       10006  10007    10008</span></span><br><span class="line"><span class="comment"># 2      b       10009  10010    10011</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 根据单个级别中的值对数据进⾏排序</span></span><br><span class="line"><span class="built_in">print</span>(df.sort_index(level=<span class="number">1</span>))</span><br><span class="line"><span class="comment"># state           Ohio        Colorado</span></span><br><span class="line"><span class="comment"># color          Green    Red    Green</span></span><br><span class="line"><span class="comment"># floor1 floor2                       </span></span><br><span class="line"><span class="comment"># a      1       10000  10001    10002</span></span><br><span class="line"><span class="comment"># b      1       10006  10007    10008</span></span><br><span class="line"><span class="comment"># a      2       10003  10004    10005</span></span><br><span class="line"><span class="comment"># b      2       10009  10010    10011</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 交换floor2和floor1位置后,再根据值来排序</span></span><br><span class="line"><span class="built_in">print</span>(df.swaplevel(<span class="number">0</span>, <span class="number">1</span>).sort_index(level=<span class="number">0</span>))</span><br><span class="line"><span class="comment"># state           Ohio        Colorado</span></span><br><span class="line"><span class="comment"># color          Green    Red    Green</span></span><br><span class="line"><span class="comment"># floor2 floor1                       </span></span><br><span class="line"><span class="comment"># 1      a       10000  10001    10002</span></span><br><span class="line"><span class="comment">#        b       10006  10007    10008</span></span><br><span class="line"><span class="comment"># 2      a       10003  10004    10005</span></span><br><span class="line"><span class="comment">#        b       10009  10010    10011</span></span><br></pre></td></tr></table></figure>

<p>使用花式索引来实现列的排序:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">                 </span><br><span class="line"><span class="comment"># 通过传入嵌套的列表作为index来创建多层索引</span></span><br><span class="line">data = pd.DataFrame(np.arange(<span class="number">10000</span>,<span class="number">10012</span>).reshape((-<span class="number">1</span>,<span class="number">4</span>)),</span><br><span class="line">					columns=[<span class="string">&#x27;col1&#x27;</span>,<span class="string">&#x27;col2&#x27;</span>,<span class="string">&#x27;col3&#x27;</span>,<span class="string">&#x27;col4&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(data)</span><br><span class="line"><span class="comment">#     col1   col2   col3   col4</span></span><br><span class="line"><span class="comment"># 0  10000  10001  10002  10003</span></span><br><span class="line"><span class="comment"># 1  10004  10005  10006  10007</span></span><br><span class="line"><span class="comment"># 2  10008  10009  10010  10011</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用花式索引来实现列的排序</span></span><br><span class="line">data = data[[<span class="string">&#x27;col4&#x27;</span>,<span class="string">&#x27;col2&#x27;</span>,<span class="string">&#x27;col3&#x27;</span>,<span class="string">&#x27;col1&#x27;</span>]]</span><br><span class="line"><span class="built_in">print</span>(data)</span><br><span class="line"><span class="comment">#     col4   col2   col3   col1</span></span><br><span class="line"><span class="comment"># 0  10003  10001  10002  10000</span></span><br><span class="line"><span class="comment"># 1  10007  10005  10006  10004</span></span><br><span class="line"><span class="comment"># 2  10011  10009  10010  10008</span></span><br></pre></td></tr></table></figure></li>
</ul>
<p>根据级别汇总统计</p>
<p>许多对DataFrame和Series的描述和汇总统计都有⼀个level选项，它⽤于指定在某条轴上求和的级别。<br>简单来说,==当DataFrame或Series有多重索引的时候,可以使用level来合并数据==</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">df = pd.DataFrame(np.arange(<span class="number">10000</span>,<span class="number">10012</span>).reshape((<span class="number">4</span>, <span class="number">3</span>)),</span><br><span class="line">                     index=[[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;b&#x27;</span>], [<span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>]],</span><br><span class="line">                     columns=[[<span class="string">&#x27;Ohio&#x27;</span>, <span class="string">&#x27;Ohio&#x27;</span>, <span class="string">&#x27;Colorado&#x27;</span>],</span><br><span class="line">                              [<span class="string">&#x27;Green&#x27;</span>, <span class="string">&#x27;Red&#x27;</span>, <span class="string">&#x27;Green&#x27;</span>]])</span><br><span class="line"></span><br><span class="line">df.index.names = [<span class="string">&#x27;floor1&#x27;</span>,<span class="string">&#x27;floor2&#x27;</span>]</span><br><span class="line">df.columns.names = [<span class="string">&#x27;state&#x27;</span>, <span class="string">&#x27;color&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(df)</span><br><span class="line"><span class="comment"># state           Ohio        Colorado</span></span><br><span class="line"><span class="comment"># color          Green    Red    Green</span></span><br><span class="line"><span class="comment"># floor1 floor2                       </span></span><br><span class="line"><span class="comment"># a      1       10000  10001    10002</span></span><br><span class="line"><span class="comment">#        2       10003  10004    10005</span></span><br><span class="line"><span class="comment"># b      1       10006  10007    10008</span></span><br><span class="line"><span class="comment">#        2       10009  10010    10011</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 当是多重索引的时候,可以使用level来合并数据</span></span><br><span class="line"><span class="built_in">print</span>(df.<span class="built_in">sum</span>(level=<span class="string">&#x27;floor1&#x27;</span>))</span><br><span class="line"><span class="comment"># state    Ohio        Colorado</span></span><br><span class="line"><span class="comment"># color   Green    Red    Green</span></span><br><span class="line"><span class="comment"># floor1                       </span></span><br><span class="line"><span class="comment"># a       20003  20005    20007</span></span><br><span class="line"><span class="comment"># b       20015  20017    20019</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(df.<span class="built_in">sum</span>(level=<span class="string">&#x27;floor2&#x27;</span>))</span><br><span class="line"><span class="comment"># state    Ohio        Colorado</span></span><br><span class="line"><span class="comment"># color   Green    Red    Green</span></span><br><span class="line"><span class="comment"># floor2                       </span></span><br><span class="line"><span class="comment"># 1       20006  20008    20010</span></span><br><span class="line"><span class="comment"># 2       20012  20014    20016</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(df.<span class="built_in">sum</span>(level=<span class="string">&#x27;color&#x27;</span>, axis=<span class="number">1</span>))</span><br><span class="line"><span class="comment"># color          Green    Red</span></span><br><span class="line"><span class="comment"># floor1 floor2              </span></span><br><span class="line"><span class="comment"># a      1       20002  10001</span></span><br><span class="line"><span class="comment">#        2       20008  10004</span></span><br><span class="line"><span class="comment"># b      1       20014  10007</span></span><br><span class="line"><span class="comment">#        2       20020  10010</span></span><br></pre></td></tr></table></figure>

<p>这其实是利⽤了pandas的<code>groupby</code>功能</p>
<hr>
<p>使⽤DataFrame的列进⾏索引</p>
<p>set_index函数:</p>
<ul>
<li>将其⼀个或多个列转换为行索引,如果传入的参数大于等于2,那么就会形成多级索引</li>
<li>默认情况下，那些列会从DataFrame中移除，但也可以使用drop=False将其保留下来：</li>
</ul>
<p>reset_index:<br>功能跟set_index刚好相反，层次化索引的级别会被转移到列⾥⾯.<br>就是说不管你现在的index是什么,全部都会变成columns(index变成<code>RangeIndex</code>)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">frame = pd.DataFrame(&#123;<span class="string">&#x27;a&#x27;</span>: <span class="built_in">range</span>(<span class="number">7</span>), <span class="string">&#x27;b&#x27;</span>: <span class="built_in">range</span>(<span class="number">7</span>, <span class="number">0</span>, -<span class="number">1</span>),</span><br><span class="line">                      <span class="string">&#x27;c&#x27;</span>: [<span class="string">&#x27;one&#x27;</span>, <span class="string">&#x27;one&#x27;</span>, <span class="string">&#x27;one&#x27;</span>, <span class="string">&#x27;two&#x27;</span>, <span class="string">&#x27;two&#x27;</span>,</span><br><span class="line">                            <span class="string">&#x27;two&#x27;</span>, <span class="string">&#x27;two&#x27;</span>],</span><br><span class="line">                      <span class="string">&#x27;d&#x27;</span>: [<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(frame)</span><br><span class="line"><span class="comment">#    a  b    c  d</span></span><br><span class="line"><span class="comment"># 0  0  7  one  0</span></span><br><span class="line"><span class="comment"># 1  1  6  one  1</span></span><br><span class="line"><span class="comment"># 2  2  5  one  2</span></span><br><span class="line"><span class="comment"># 3  3  4  two  0</span></span><br><span class="line"><span class="comment"># 4  4  3  two  1</span></span><br><span class="line"><span class="comment"># 5  5  2  two  2</span></span><br><span class="line"><span class="comment"># 6  6  1  two  3</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">frame2 = frame.set_index([<span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;d&#x27;</span>])</span><br><span class="line"><span class="built_in">print</span>(frame2)</span><br><span class="line"><span class="comment">#        a  b</span></span><br><span class="line"><span class="comment"># c   d      </span></span><br><span class="line"><span class="comment"># one 0  0  7</span></span><br><span class="line"><span class="comment">#     1  1  6</span></span><br><span class="line"><span class="comment">#     2  2  5</span></span><br><span class="line"><span class="comment"># two 0  3  4</span></span><br><span class="line"><span class="comment">#     1  4  3</span></span><br><span class="line"><span class="comment">#     2  5  2</span></span><br><span class="line"><span class="comment">#     3  6  1</span></span><br><span class="line"></span><br><span class="line">frame3 = frame.set_index([<span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;d&#x27;</span>],drop=<span class="literal">False</span>)</span><br><span class="line"><span class="built_in">print</span>(frame3)</span><br><span class="line"><span class="comment">#        a  b    c  d</span></span><br><span class="line"><span class="comment"># c   d              </span></span><br><span class="line"><span class="comment"># one 0  0  7  one  0</span></span><br><span class="line"><span class="comment">#     1  1  6  one  1</span></span><br><span class="line"><span class="comment">#     2  2  5  one  2</span></span><br><span class="line"><span class="comment"># two 0  3  4  two  0</span></span><br><span class="line"><span class="comment">#     1  4  3  two  1</span></span><br><span class="line"><span class="comment">#     2  5  2  two  2</span></span><br><span class="line"><span class="comment">#     3  6  1  two  3</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 不管原来的Index是什么,全部都会变成RangeIndex</span></span><br><span class="line"><span class="built_in">print</span>(frame2.reset_index())</span><br><span class="line"><span class="comment">#      c  d  a  b</span></span><br><span class="line"><span class="comment"># 0  one  0  0  7</span></span><br><span class="line"><span class="comment"># 1  one  1  1  6</span></span><br><span class="line"><span class="comment"># 2  one  2  2  5</span></span><br><span class="line"><span class="comment"># 3  two  0  3  4</span></span><br><span class="line"><span class="comment"># 4  two  1  4  3</span></span><br><span class="line"><span class="comment"># 5  two  2  5  2</span></span><br><span class="line"><span class="comment"># 6  two  3  6  1</span></span><br></pre></td></tr></table></figure>



<hr>
<h2 id="8-2-合并数据集"><a href="#8-2-合并数据集" class="headerlink" title="8.2 合并数据集"></a>8.2 合并数据集</h2><ul>
<li>pandas.merge:<br>根据⼀个或多个键将不同DataFrame中的⾏连接起来。<strong>类似于数据库的join操作。</strong>默认做inner join</li>
<li>pandas.concat:<br>沿着⼀条轴将多个对象堆叠到⼀起。</li>
<li>实例⽅法combine_first:<br>将重复数据编接在⼀起，⽤⼀个对象中的值填充另⼀个对象中的缺失值。</li>
</ul>
<p>数据库风格的DataFrame合并</p>
<ul>
<li><p>pandas.merge:<br>默认做inner join.拥有how属性,当<code>how=&#39;left/right/outer&#39;</code>可以执行left join on和right join on和全外连接</p>
</li>
<li><p>pandas.merge如果不指定on参数,那么重叠列的列名当做键。最好还是明确指定一下</p>
</li>
<li><p>left_on参数和right_on参数:<br>当左右列名不相同的时候使用</p>
<p>左侧DataFrame中用作连接键的列名<br>右侧DataFrame中用作 连接键的列名</p>
</li>
<li><p>suffixes参数:<br>当左右对象中存在<strong>除连接键外</strong>的同名列时，指定附加到左右两个DataFrame对象的重叠列名上的字符串(就是给同名列各自加一个小尾巴)</p>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">df1 = pd.DataFrame(&#123;<span class="string">&#x27;key&#x27;</span>: [<span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>],</span><br><span class="line">                    <span class="string">&#x27;data1&#x27;</span>: <span class="built_in">range</span>(<span class="number">7</span>)&#125;)</span><br><span class="line">df2 = pd.DataFrame(&#123;<span class="string">&#x27;key&#x27;</span>: [<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;d&#x27;</span>],</span><br><span class="line">                    <span class="string">&#x27;data2&#x27;</span>: <span class="built_in">range</span>(<span class="number">3</span>)&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(df1)</span><br><span class="line"><span class="comment">#   key  data1</span></span><br><span class="line"><span class="comment"># 0   b      0</span></span><br><span class="line"><span class="comment"># 1   b      1</span></span><br><span class="line"><span class="comment"># 2   a      2</span></span><br><span class="line"><span class="comment"># 3   c      3</span></span><br><span class="line"><span class="comment"># 4   a      4</span></span><br><span class="line"><span class="comment"># 5   a      5</span></span><br><span class="line"><span class="comment"># 6   b      6</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(df2)</span><br><span class="line"><span class="comment">#   key  data2</span></span><br><span class="line"><span class="comment"># 0   a      0</span></span><br><span class="line"><span class="comment"># 1   b      1</span></span><br><span class="line"><span class="comment"># 2   d      2</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 就是数据库中的一对多的join链接</span></span><br><span class="line"><span class="comment"># df2为一,df1为多,默认inner join on</span></span><br><span class="line"><span class="comment"># 如果不指定on参数,就会将重叠列的列名作为键</span></span><br><span class="line"><span class="built_in">print</span>(pd.merge(df1, df2))</span><br><span class="line"><span class="comment">#   key  data1  data2</span></span><br><span class="line"><span class="comment"># 0   b      0      1</span></span><br><span class="line"><span class="comment"># 1   b      1      1</span></span><br><span class="line"><span class="comment"># 2   b      6      1</span></span><br><span class="line"><span class="comment"># 3   a      2      0</span></span><br><span class="line"><span class="comment"># 4   a      4      0</span></span><br><span class="line"><span class="comment"># 5   a      5      0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 明确指定join on的列</span></span><br><span class="line"><span class="built_in">print</span>(pd.merge(df1, df2,on=<span class="string">&#x27;key&#x27;</span>))</span><br><span class="line"><span class="comment">#   key  data1  data2</span></span><br><span class="line"><span class="comment"># 0   b      0      1</span></span><br><span class="line"><span class="comment"># 1   b      1      1</span></span><br><span class="line"><span class="comment"># 2   b      6      1</span></span><br><span class="line"><span class="comment"># 3   a      2      0</span></span><br><span class="line"><span class="comment"># 4   a      4      0</span></span><br><span class="line"><span class="comment"># 5   a      5      0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 全外连接</span></span><br><span class="line"><span class="built_in">print</span>(pd.merge(df1, df2,on=<span class="string">&#x27;key&#x27;</span>,how=<span class="string">&#x27;outer&#x27;</span>))</span><br><span class="line"><span class="comment">#   key  data1  data2</span></span><br><span class="line"><span class="comment"># 0   b    0.0    1.0</span></span><br><span class="line"><span class="comment"># 1   b    1.0    1.0</span></span><br><span class="line"><span class="comment"># 2   b    6.0    1.0</span></span><br><span class="line"><span class="comment"># 3   a    2.0    0.0</span></span><br><span class="line"><span class="comment"># 4   a    4.0    0.0</span></span><br><span class="line"><span class="comment"># 5   a    5.0    0.0</span></span><br><span class="line"><span class="comment"># 6   c    3.0    NaN</span></span><br><span class="line"><span class="comment"># 7   d    NaN    2.0</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">df3 = pd.DataFrame(&#123;<span class="string">&#x27;lkey&#x27;</span>: [<span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>],</span><br><span class="line">                    <span class="string">&#x27;data1&#x27;</span>: <span class="built_in">range</span>(<span class="number">7</span>)&#125;)</span><br><span class="line">df4 = pd.DataFrame(&#123;<span class="string">&#x27;rkey&#x27;</span>: [<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;d&#x27;</span>],</span><br><span class="line">                    <span class="string">&#x27;data2&#x27;</span>: <span class="built_in">range</span>(<span class="number">3</span>)&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(df3)</span><br><span class="line"><span class="comment">#   lkey  data1</span></span><br><span class="line"><span class="comment"># 0    b      0</span></span><br><span class="line"><span class="comment"># 1    b      1</span></span><br><span class="line"><span class="comment"># 2    a      2</span></span><br><span class="line"><span class="comment"># 3    c      3</span></span><br><span class="line"><span class="comment"># 4    a      4</span></span><br><span class="line"><span class="comment"># 5    a      5</span></span><br><span class="line"><span class="comment"># 6    b      6</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(df4)</span><br><span class="line"><span class="comment">#   rkey  data2</span></span><br><span class="line"><span class="comment"># 0    a      0</span></span><br><span class="line"><span class="comment"># 1    b      1</span></span><br><span class="line"><span class="comment"># 2    d      2</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 两个列的列名不同,使用left_on和right_on指定</span></span><br><span class="line"><span class="comment"># 下面代码用SQL解释为:</span></span><br><span class="line"><span class="comment"># df3 inner join df4 on df3.lkey = df4.rkey</span></span><br><span class="line">df = pd.merge(df3, df4, left_on=<span class="string">&#x27;lkey&#x27;</span>, right_on=<span class="string">&#x27;rkey&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(df)</span><br><span class="line"><span class="comment">#   lkey  data1 rkey  data2</span></span><br><span class="line"><span class="comment"># 0    b      0    b      1</span></span><br><span class="line"><span class="comment"># 1    b      1    b      1</span></span><br><span class="line"><span class="comment"># 2    b      6    b      1</span></span><br><span class="line"><span class="comment"># 3    a      2    a      0</span></span><br><span class="line"><span class="comment"># 4    a      4    a      0</span></span><br><span class="line"><span class="comment"># 5    a      5    a      0</span></span><br></pre></td></tr></table></figure>

<p>注意:</p>
<ul>
<li>我们在数据库使用join on的时候是不会遇到多对多的关系的,永远都是一对多.<br>比如:班级表和学生表.班级是一,学生是多.<strong>学生表班级号列是外键</strong>.<br>班级表存储了全校的所有班级,如1班,2班.==在班级表里是不会存在相同的班级号的==(比如班级表里存在两个1班)</li>
<li>但是在pandas中,两个表可能存在多对多的关系</li>
<li>==多对多连接产⽣的是⾏的笛卡尔积==。</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">df1 = pd.DataFrame(&#123;<span class="string">&#x27;key&#x27;</span>: [<span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>],</span><br><span class="line">                    <span class="string">&#x27;data1&#x27;</span>: <span class="built_in">range</span>(<span class="number">6</span>)&#125;)</span><br><span class="line">df2 = pd.DataFrame(&#123;<span class="string">&#x27;key&#x27;</span>: [<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;d&#x27;</span>],</span><br><span class="line">                    <span class="string">&#x27;data2&#x27;</span>: <span class="built_in">range</span>(<span class="number">5</span>)&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(df1)</span><br><span class="line"><span class="comment">#   key  data1</span></span><br><span class="line"><span class="comment"># 0   b      0</span></span><br><span class="line"><span class="comment"># 1   b      1</span></span><br><span class="line"><span class="comment"># 2   a      2</span></span><br><span class="line"><span class="comment"># 3   c      3</span></span><br><span class="line"><span class="comment"># 4   a      4</span></span><br><span class="line"><span class="comment"># 5   b      5</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(df2)</span><br><span class="line"><span class="comment">#   key  data2</span></span><br><span class="line"><span class="comment"># 0   a      0</span></span><br><span class="line"><span class="comment"># 1   b      1</span></span><br><span class="line"><span class="comment"># 2   a      2</span></span><br><span class="line"><span class="comment"># 3   b      3</span></span><br><span class="line"><span class="comment"># 4   d      4</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># df1和df2的key都是多,说明这是多对多的关系</span></span><br><span class="line"><span class="comment"># 多对多的关系返回的是行的笛卡尔积</span></span><br><span class="line"><span class="built_in">print</span>(pd.merge(df1, df2, on=<span class="string">&#x27;key&#x27;</span>, how=<span class="string">&#x27;left&#x27;</span>))</span><br><span class="line"><span class="comment">#    key  data1  data2</span></span><br><span class="line"><span class="comment"># 0    b      0    1.0</span></span><br><span class="line"><span class="comment"># 1    b      0    3.0</span></span><br><span class="line"><span class="comment"># 2    b      1    1.0</span></span><br><span class="line"><span class="comment"># 3    b      1    3.0</span></span><br><span class="line"><span class="comment"># 4    a      2    0.0</span></span><br><span class="line"><span class="comment"># 5    a      2    2.0</span></span><br><span class="line"><span class="comment"># 6    c      3    NaN</span></span><br><span class="line"><span class="comment"># 7    a      4    0.0</span></span><br><span class="line"><span class="comment"># 8    a      4    2.0</span></span><br><span class="line"><span class="comment"># 9    b      5    1.0</span></span><br><span class="line"><span class="comment"># 10   b      5    3.0</span></span><br></pre></td></tr></table></figure>

<p>由于左边的DataFrame有3个”b”⾏，右边的有2个，所以最终结果中就有6个”b”⾏。连接⽅式只影响出现在结果中的不同的键的值</p>
<p>SQL为了保证约束,也不会存在多键连接的问题,但是pandas可以:<br>使用多键连接就类似于形成了一个<code>联合外键</code>的东西</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">left = pd.DataFrame(&#123;<span class="string">&#x27;key1&#x27;</span>: [<span class="string">&#x27;foo&#x27;</span>, <span class="string">&#x27;foo&#x27;</span>, <span class="string">&#x27;bar&#x27;</span>],</span><br><span class="line">                     <span class="string">&#x27;key2&#x27;</span>: [<span class="string">&#x27;one&#x27;</span>, <span class="string">&#x27;two&#x27;</span>, <span class="string">&#x27;one&#x27;</span>],</span><br><span class="line">                     <span class="string">&#x27;lval&#x27;</span>: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]&#125;)</span><br><span class="line">right = pd.DataFrame(&#123;<span class="string">&#x27;key1&#x27;</span>: [<span class="string">&#x27;foo&#x27;</span>, <span class="string">&#x27;foo&#x27;</span>, <span class="string">&#x27;bar&#x27;</span>, <span class="string">&#x27;bar&#x27;</span>],</span><br><span class="line">                      <span class="string">&#x27;key2&#x27;</span>: [<span class="string">&#x27;one&#x27;</span>, <span class="string">&#x27;one&#x27;</span>, <span class="string">&#x27;one&#x27;</span>, <span class="string">&#x27;two&#x27;</span>],</span><br><span class="line">                      <span class="string">&#x27;rval&#x27;</span>: [<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>]&#125;)</span><br><span class="line"><span class="built_in">print</span>(left)</span><br><span class="line"><span class="comment">#   key1 key2  lval</span></span><br><span class="line"><span class="comment"># 0  foo  one     1</span></span><br><span class="line"><span class="comment"># 1  foo  two     2</span></span><br><span class="line"><span class="comment"># 2  bar  one     3</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(right)</span><br><span class="line"><span class="comment">#   key1 key2  rval</span></span><br><span class="line"><span class="comment"># 0  foo  one     4</span></span><br><span class="line"><span class="comment"># 1  foo  one     5</span></span><br><span class="line"><span class="comment"># 2  bar  one     6</span></span><br><span class="line"><span class="comment"># 3  bar  two     7</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 多键连接</span></span><br><span class="line">df = pd.merge(left, right, on=[<span class="string">&#x27;key1&#x27;</span>, <span class="string">&#x27;key2&#x27;</span>], how=<span class="string">&#x27;outer&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(df)</span><br><span class="line"><span class="comment">#   key1 key2  lval  rval</span></span><br><span class="line"><span class="comment"># 0  foo  one   1.0   4.0</span></span><br><span class="line"><span class="comment"># 1  foo  one   1.0   5.0</span></span><br><span class="line"><span class="comment"># 2  foo  two   2.0   NaN</span></span><br><span class="line"><span class="comment"># 3  bar  one   3.0   6.0</span></span><br><span class="line"><span class="comment"># 4  bar  two   NaN   7.0</span></span><br></pre></td></tr></table></figure>

<p>注意：在进⾏列－列连接时，DataFrame对象中的索引会被<br>丢弃。</p>
<p>suffixes:<br>当左右对象中存在除连接键外的同名列时，结果集中的区分方式，可以各加一个小尾巴。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">left = pd.DataFrame(&#123;<span class="string">&#x27;key1&#x27;</span>: [<span class="string">&#x27;foo&#x27;</span>, <span class="string">&#x27;foo&#x27;</span>, <span class="string">&#x27;bar&#x27;</span>],</span><br><span class="line">                     <span class="string">&#x27;key2&#x27;</span>: [<span class="string">&#x27;one&#x27;</span>, <span class="string">&#x27;two&#x27;</span>, <span class="string">&#x27;one&#x27;</span>],</span><br><span class="line">                     <span class="string">&#x27;lval&#x27;</span>: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]&#125;)</span><br><span class="line">right = pd.DataFrame(&#123;<span class="string">&#x27;key1&#x27;</span>: [<span class="string">&#x27;foo&#x27;</span>, <span class="string">&#x27;foo&#x27;</span>, <span class="string">&#x27;bar&#x27;</span>, <span class="string">&#x27;bar&#x27;</span>],</span><br><span class="line">                      <span class="string">&#x27;key2&#x27;</span>: [<span class="string">&#x27;one&#x27;</span>, <span class="string">&#x27;one&#x27;</span>, <span class="string">&#x27;one&#x27;</span>, <span class="string">&#x27;two&#x27;</span>],</span><br><span class="line">                      <span class="string">&#x27;rval&#x27;</span>: [<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>]&#125;)</span><br><span class="line"><span class="built_in">print</span>(left)</span><br><span class="line"><span class="comment">#   key1 key2  lval</span></span><br><span class="line"><span class="comment"># 0  foo  one     1</span></span><br><span class="line"><span class="comment"># 1  foo  two     2</span></span><br><span class="line"><span class="comment"># 2  bar  one     3</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(right)</span><br><span class="line"><span class="comment">#   key1 key2  rval</span></span><br><span class="line"><span class="comment"># 0  foo  one     4</span></span><br><span class="line"><span class="comment"># 1  foo  one     5</span></span><br><span class="line"><span class="comment"># 2  bar  one     6</span></span><br><span class="line"><span class="comment"># 3  bar  two     7</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(pd.merge(left, right, on=<span class="string">&#x27;key1&#x27;</span>))</span><br><span class="line"><span class="comment">#   key1 key2_x  lval key2_y  rval</span></span><br><span class="line"><span class="comment"># 0  foo    one     1    one     4</span></span><br><span class="line"><span class="comment"># 1  foo    one     1    one     5</span></span><br><span class="line"><span class="comment"># 2  foo    two     2    one     4</span></span><br><span class="line"><span class="comment"># 3  foo    two     2    one     5</span></span><br><span class="line"><span class="comment"># 4  bar    one     3    one     6</span></span><br><span class="line"><span class="comment"># 5  bar    one     3    two     7</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(pd.merge(left, right, on=<span class="string">&#x27;key1&#x27;</span>, suffixes=(<span class="string">&#x27;_left&#x27;</span>, <span class="string">&#x27;_right&#x27;</span>)))</span><br><span class="line"><span class="comment">#   key1 key2_left  lval key2_right  rval</span></span><br><span class="line"><span class="comment"># 0  foo       one     1        one     4</span></span><br><span class="line"><span class="comment"># 1  foo       one     1        one     5</span></span><br><span class="line"><span class="comment"># 2  foo       two     2        one     4</span></span><br><span class="line"><span class="comment"># 3  foo       two     2        one     5</span></span><br><span class="line"><span class="comment"># 4  bar       one     3        one     6</span></span><br><span class="line"><span class="comment"># 5  bar       one     3        two     7</span></span><br></pre></td></tr></table></figure>

<p>right_index:<br>使用索引作为连接键</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">left1 = pd.DataFrame(&#123;<span class="string">&#x27;key&#x27;</span>: [<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>],</span><br><span class="line">                      <span class="string">&#x27;value&#x27;</span>: <span class="built_in">range</span>(<span class="number">6</span>)&#125;)</span><br><span class="line">right1 = pd.DataFrame(&#123;<span class="string">&#x27;group_val&#x27;</span>: [<span class="number">3.5</span>, <span class="number">7</span>]&#125;, index=[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(left1)</span><br><span class="line"><span class="comment">#   key  value</span></span><br><span class="line"><span class="comment"># 0   a      0</span></span><br><span class="line"><span class="comment"># 1   b      1</span></span><br><span class="line"><span class="comment"># 2   a      2</span></span><br><span class="line"><span class="comment"># 3   a      3</span></span><br><span class="line"><span class="comment"># 4   b      4</span></span><br><span class="line"><span class="comment"># 5   c      5</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(right1)</span><br><span class="line"><span class="comment">#    group_val</span></span><br><span class="line"><span class="comment"># a        3.5</span></span><br><span class="line"><span class="comment"># b        7.0</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(pd.merge(left1, right1, left_on=<span class="string">&#x27;key&#x27;</span>, right_index=<span class="literal">True</span>))</span><br><span class="line"><span class="comment">#   key  value  group_val</span></span><br><span class="line"><span class="comment"># 0   a      0        3.5</span></span><br><span class="line"><span class="comment"># 2   a      2        3.5</span></span><br><span class="line"><span class="comment"># 3   a      3        3.5</span></span><br><span class="line"><span class="comment"># 1   b      1        7.0</span></span><br><span class="line"><span class="comment"># 4   b      4        7.0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># DataFrame中的连接键位于其索引中</span></span><br><span class="line"><span class="comment"># right_index=True:使用索引作为连接键</span></span><br><span class="line"><span class="built_in">print</span>(pd.merge(left1, right1, left_on=<span class="string">&#x27;key&#x27;</span>,right_index=<span class="literal">True</span>))</span><br><span class="line"><span class="comment">#   key  value  group_val</span></span><br><span class="line"><span class="comment"># 0   a      0        3.5</span></span><br><span class="line"><span class="comment"># 2   a      2        3.5</span></span><br><span class="line"><span class="comment"># 3   a      3        3.5</span></span><br><span class="line"><span class="comment"># 1   b      1        7.0</span></span><br><span class="line"><span class="comment"># 4   b      4        7.0</span></span><br></pre></td></tr></table></figure>

<p>双方都使用index作为连接键:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">left2 = pd.DataFrame([[<span class="number">1.</span>, <span class="number">2.</span>], [<span class="number">3.</span>, <span class="number">4.</span>], [<span class="number">5.</span>, <span class="number">6.</span>]],</span><br><span class="line">                     index=[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;e&#x27;</span>],</span><br><span class="line">                     columns=[<span class="string">&#x27;Ohio&#x27;</span>, <span class="string">&#x27;Nevada&#x27;</span>])</span><br><span class="line">right2 = pd.DataFrame([[<span class="number">7.</span>, <span class="number">8.</span>], [<span class="number">9.</span>, <span class="number">10.</span>], [<span class="number">11.</span>, <span class="number">12.</span>], [<span class="number">13</span>, <span class="number">14</span>]],</span><br><span class="line">                      index=[<span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;d&#x27;</span>, <span class="string">&#x27;e&#x27;</span>],</span><br><span class="line">                      columns=[<span class="string">&#x27;Missouri&#x27;</span>, <span class="string">&#x27;Alabama&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(left2)</span><br><span class="line"><span class="comment">#    Ohio  Nevada</span></span><br><span class="line"><span class="comment"># a   1.0     2.0</span></span><br><span class="line"><span class="comment"># c   3.0     4.0</span></span><br><span class="line"><span class="comment"># e   5.0     6.0</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(right2)</span><br><span class="line"><span class="comment">#    Missouri  Alabama</span></span><br><span class="line"><span class="comment"># b       7.0      8.0</span></span><br><span class="line"><span class="comment"># c       9.0     10.0</span></span><br><span class="line"><span class="comment"># d      11.0     12.0</span></span><br><span class="line"><span class="comment"># e      13.0     14.0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 双方都使用index作为连接键</span></span><br><span class="line"><span class="built_in">print</span>(pd.merge(left2, right2, how=<span class="string">&#x27;outer&#x27;</span>, left_index=<span class="literal">True</span>, right_index=<span class="literal">True</span>))</span><br><span class="line"><span class="comment">#    Ohio  Nevada  Missouri  Alabama</span></span><br><span class="line"><span class="comment"># a   1.0     2.0       NaN      NaN</span></span><br><span class="line"><span class="comment"># b   NaN     NaN       7.0      8.0</span></span><br><span class="line"><span class="comment"># c   3.0     4.0       9.0     10.0</span></span><br><span class="line"><span class="comment"># d   NaN     NaN      11.0     12.0</span></span><br><span class="line"><span class="comment"># e   5.0     6.0      13.0     14.0</span></span><br></pre></td></tr></table></figure>

<p>merge函数参数说明:</p>
<ul>
<li>left与right：<br>两个不同的DataFrame</li>
<li>how：<br>指的是合并(连接)的方式有inner(内连接),left(左外连接),right(右外连接),outer(全外连接);默认为inner</li>
<li>on :<br>指的是用于连接的列索引名称。必须存在右右两个DataFrame对象中，如果没有指定且其他参数也未指定则以两个DataFrame的列名交集做为连接键</li>
<li>left_on：<br>左则DataFrame中用作连接键的列名;这个参数中左右列名不相同，但代表的含义相同时非常有用。</li>
<li>right_on：<br>右则DataFrame中用作 连接键的列名</li>
<li>left_index：<br><strong>使用左则DataFrame中的行索引做为连接键</strong></li>
<li>right_index：<br>使用右则DataFrame中的行索引做为连接键</li>
<li>sort：<br>默认为True，将合并的数据进行排序。在大多数情况下设置为False可以提高性能</li>
<li>suffixes：<br>字符串值组成的元组，用于指定当左右DataFrame存在相同列名时在列名后面附加的后缀名称，默认为(‘_x’,’_y’)</li>
<li>copy：<br>默认为True,总是将数据复制到数据结构中；大多数情况下设置为False可以提高性能</li>
<li>indicator：<br>显示合并数据中来源情况(指明每个⾏的来源)；如只来自己于左边(left_only)、右边(right_only)、两者(both)</li>
</ul>
<p>索引上的合并</p>
<p>对于层次化索引的数据，事情就有点复杂了，因为<strong>索引的合并默认是多键合并</strong>：</p>
<p>就是说,一旦用上多层次索引,那么就必须要用<code>多键连接</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">lefth = pd.DataFrame(&#123;<span class="string">&#x27;key1&#x27;</span>: [<span class="string">&#x27;Ohio&#x27;</span>, <span class="string">&#x27;Ohio&#x27;</span>, <span class="string">&#x27;Ohio&#x27;</span>,<span class="string">&#x27;Nevada&#x27;</span>, <span class="string">&#x27;Nevada&#x27;</span>],</span><br><span class="line">                      <span class="string">&#x27;key2&#x27;</span>: [<span class="number">2000</span>, <span class="number">2001</span>, <span class="number">2002</span>, <span class="number">2001</span>, <span class="number">2002</span>],</span><br><span class="line">                      <span class="string">&#x27;data&#x27;</span>: np.arange(<span class="number">5.</span>)&#125;)</span><br><span class="line">righth = pd.DataFrame(np.arange(<span class="number">12</span>).reshape((<span class="number">6</span>, <span class="number">2</span>)),</span><br><span class="line">                      index=[[<span class="string">&#x27;Nevada&#x27;</span>, <span class="string">&#x27;Nevada&#x27;</span>, <span class="string">&#x27;Ohio&#x27;</span>, <span class="string">&#x27;Ohio&#x27;</span>,<span class="string">&#x27;Ohio&#x27;</span>, <span class="string">&#x27;Ohio&#x27;</span>],</span><br><span class="line">                             [<span class="number">2001</span>, <span class="number">2000</span>, <span class="number">2000</span>, <span class="number">2000</span>, <span class="number">2001</span>, <span class="number">2002</span>]],</span><br><span class="line">                      columns=[<span class="string">&#x27;event1&#x27;</span>, <span class="string">&#x27;event2&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(lefth)</span><br><span class="line"><span class="comment">#      key1  key2  data</span></span><br><span class="line"><span class="comment"># 0    Ohio  2000   0.0</span></span><br><span class="line"><span class="comment"># 1    Ohio  2001   1.0</span></span><br><span class="line"><span class="comment"># 2    Ohio  2002   2.0</span></span><br><span class="line"><span class="comment"># 3  Nevada  2001   3.0</span></span><br><span class="line"><span class="comment"># 4  Nevada  2002   4.0</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(righth)</span><br><span class="line"><span class="comment">#              event1  event2</span></span><br><span class="line"><span class="comment"># Nevada 2001       0       1</span></span><br><span class="line"><span class="comment">#        2000       2       3</span></span><br><span class="line"><span class="comment"># Ohio   2000       4       5</span></span><br><span class="line"><span class="comment">#        2000       6       7</span></span><br><span class="line"><span class="comment">#        2001       8       9</span></span><br><span class="line"><span class="comment">#        2002      10      11</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 索引的合并默认是多键合并,要使用多键连接</span></span><br><span class="line"><span class="comment"># 第一层index对应key1,第二层index对应key2</span></span><br><span class="line"><span class="built_in">print</span>(pd.merge(lefth, righth, left_on=[<span class="string">&#x27;key1&#x27;</span>, <span class="string">&#x27;key2&#x27;</span>], right_index=<span class="literal">True</span>))</span><br><span class="line"><span class="comment">#      key1  key2  data  event1  event2</span></span><br><span class="line"><span class="comment"># 0    Ohio  2000   0.0       4       5</span></span><br><span class="line"><span class="comment"># 0    Ohio  2000   0.0       6       7</span></span><br><span class="line"><span class="comment"># 1    Ohio  2001   1.0       8       9</span></span><br><span class="line"><span class="comment"># 2    Ohio  2002   2.0      10      11</span></span><br><span class="line"><span class="comment"># 3  Nevada  2001   3.0       0       1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(pd.merge(lefth, righth, left_on=[<span class="string">&#x27;key1&#x27;</span>, <span class="string">&#x27;key2&#x27;</span>], right_index=<span class="literal">True</span>, how=<span class="string">&#x27;outer&#x27;</span>,sort=<span class="literal">False</span>))</span><br><span class="line"><span class="comment">#      key1  key2  data  event1  event2</span></span><br><span class="line"><span class="comment"># 0    Ohio  2000   0.0     4.0     5.0</span></span><br><span class="line"><span class="comment"># 0    Ohio  2000   0.0     6.0     7.0</span></span><br><span class="line"><span class="comment"># 1    Ohio  2001   1.0     8.0     9.0</span></span><br><span class="line"><span class="comment"># 2    Ohio  2002   2.0    10.0    11.0</span></span><br><span class="line"><span class="comment"># 3  Nevada  2001   3.0     0.0     1.0</span></span><br><span class="line"><span class="comment"># 4  Nevada  2002   4.0     NaN     NaN</span></span><br><span class="line"><span class="comment"># 4  Nevada  2000   NaN     2.0     3.0</span></span><br></pre></td></tr></table></figure>

<p>上面的方法很复杂,这时就可以使用更加便捷的<code>join实例⽅法</code><br>它能更为⽅便地实现<strong>按索引合并</strong>。(它还可⽤于合并多个带有相同或相似索引的DataFrame对象，但要求没有重叠的列)</p>
<p>重要:<br><strong>默认按索引合并，可以合并相同或相似的索引</strong>，==不管他们有没有重叠列。==如果有on参数,就会把右图的行索引和左图的列进行join</p>
<ul>
<li><p>on参数:</p>
<p>在实际应用中如果==右表的索引值正是左表的某一列的值==，这时可以通过将 右表的索引 和 左表的列 对齐合并这样灵活的方式进行合并。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line">left = pd.DataFrame(&#123;<span class="string">&#x27;A&#x27;</span>: [<span class="string">&#x27;A0&#x27;</span>, <span class="string">&#x27;A1&#x27;</span>, <span class="string">&#x27;A2&#x27;</span>, <span class="string">&#x27;A3&#x27;</span>],</span><br><span class="line">					 <span class="string">&#x27;B&#x27;</span>: [<span class="string">&#x27;B0&#x27;</span>, <span class="string">&#x27;B1&#x27;</span>, <span class="string">&#x27;B2&#x27;</span>, <span class="string">&#x27;B3&#x27;</span>],</span><br><span class="line">					 <span class="string">&#x27;key&#x27;</span>: [<span class="string">&#x27;K0&#x27;</span>, <span class="string">&#x27;K1&#x27;</span>, <span class="string">&#x27;K0&#x27;</span>, <span class="string">&#x27;K1&#x27;</span>]&#125;)</span><br><span class="line"></span><br><span class="line">right = pd.DataFrame(&#123;<span class="string">&#x27;C&#x27;</span>: [<span class="string">&#x27;C0&#x27;</span>, <span class="string">&#x27;C1&#x27;</span>],</span><br><span class="line">					  <span class="string">&#x27;D&#x27;</span>: [<span class="string">&#x27;D0&#x27;</span>, <span class="string">&#x27;D1&#x27;</span>]&#125;,</span><br><span class="line">					   index=[<span class="string">&#x27;K0&#x27;</span>, <span class="string">&#x27;K1&#x27;</span>])</span><br><span class="line"></span><br><span class="line">result = left.join(right, on=<span class="string">&#x27;key&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p><img src="/images/20160918154752800.jpg" alt="è¿éåå¾çæè¿°"></p>
</li>
<li><p>suffix后缀参数:<br>给每个表的重复列名添加小尾巴</p>
</li>
<li><p>组合多个dataframe:<br>传入元素为dataframe的列表或者tuple。一次join多个，一次解决多次烦恼</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">left2 = pd.DataFrame([[<span class="number">1.</span>, <span class="number">2.</span>], [<span class="number">3.</span>, <span class="number">4.</span>], [<span class="number">5.</span>, <span class="number">6.</span>]],</span><br><span class="line">                     index=[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;e&#x27;</span>],</span><br><span class="line">                     columns=[<span class="string">&#x27;Ohio&#x27;</span>, <span class="string">&#x27;Nevada&#x27;</span>])</span><br><span class="line"></span><br><span class="line">right2 = pd.DataFrame([[<span class="number">7.</span>, <span class="number">8.</span>], [<span class="number">9.</span>, <span class="number">10.</span>], [<span class="number">11.</span>, <span class="number">12.</span>], [<span class="number">13</span>, <span class="number">14</span>]],</span><br><span class="line">                      index=[<span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;d&#x27;</span>, <span class="string">&#x27;e&#x27;</span>],</span><br><span class="line">                      columns=[<span class="string">&#x27;Missouri&#x27;</span>, <span class="string">&#x27;Alabama&#x27;</span>])</span><br><span class="line"></span><br><span class="line">another = pd.DataFrame([[<span class="number">7.</span>, <span class="number">8.</span>], [<span class="number">9.</span>, <span class="number">10.</span>], [<span class="number">11.</span>, <span class="number">12.</span>], [<span class="number">16.</span>, <span class="number">17.</span>]],</span><br><span class="line">                       index=[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;e&#x27;</span>, <span class="string">&#x27;f&#x27;</span>],</span><br><span class="line">                       columns=[<span class="string">&#x27;New York&#x27;</span>, <span class="string">&#x27;Oregon&#x27;</span>])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(left2)</span><br><span class="line"><span class="comment">#    Ohio  Nevada</span></span><br><span class="line"><span class="comment"># a   1.0     2.0</span></span><br><span class="line"><span class="comment"># c   3.0     4.0</span></span><br><span class="line"><span class="comment"># e   5.0     6.0</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(right2)</span><br><span class="line"><span class="comment">#    Missouri  Alabama</span></span><br><span class="line"><span class="comment"># b       7.0      8.0</span></span><br><span class="line"><span class="comment"># c       9.0     10.0</span></span><br><span class="line"><span class="comment"># d      11.0     12.0</span></span><br><span class="line"><span class="comment"># e      13.0     14.0</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(another)</span><br><span class="line"><span class="comment">#    New York  Oregon</span></span><br><span class="line"><span class="comment"># a       7.0     8.0</span></span><br><span class="line"><span class="comment"># c       9.0    10.0</span></span><br><span class="line"><span class="comment"># e      11.0    12.0</span></span><br><span class="line"><span class="comment"># f      16.0    17.0</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(left2.join([right2, another]))</span><br><span class="line"><span class="comment">#    Ohio  Nevada  Missouri  Alabama  New York  Oregon</span></span><br><span class="line"><span class="comment"># a   1.0     2.0       NaN      NaN       7.0     8.0</span></span><br><span class="line"><span class="comment"># c   3.0     4.0       9.0     10.0       9.0    10.0</span></span><br><span class="line"><span class="comment"># e   5.0     6.0      13.0     14.0      11.0    12.0</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(left2.join([right2, another], how=<span class="string">&#x27;outer&#x27;</span>))</span><br><span class="line"><span class="comment">#    Ohio  Nevada  Missouri  Alabama  New York  Oregon</span></span><br><span class="line"><span class="comment"># a   1.0     2.0       NaN      NaN       7.0     8.0</span></span><br><span class="line"><span class="comment"># b   NaN     NaN       7.0      8.0       NaN     NaN</span></span><br><span class="line"><span class="comment"># c   3.0     4.0       9.0     10.0       9.0    10.0</span></span><br><span class="line"><span class="comment"># d   NaN     NaN      11.0     12.0       NaN     NaN</span></span><br><span class="line"><span class="comment"># e   5.0     6.0      13.0     14.0      11.0    12.0</span></span><br><span class="line"><span class="comment"># f   NaN     NaN       NaN      NaN      16.0    17.0</span></span><br></pre></td></tr></table></figure></li>
</ul>
<p>join的实际使用:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">left1 = pd.DataFrame(&#123;<span class="string">&#x27;key&#x27;</span>: [<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>],</span><br><span class="line">                      <span class="string">&#x27;value&#x27;</span>: <span class="built_in">range</span>(<span class="number">6</span>)&#125;)</span><br><span class="line">right1 = pd.DataFrame(&#123;<span class="string">&#x27;group_val&#x27;</span>: [<span class="number">3.5</span>, <span class="number">7</span>]&#125;, index=[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(left1)</span><br><span class="line"><span class="comment">#   key  value</span></span><br><span class="line"><span class="comment"># 0   a      0</span></span><br><span class="line"><span class="comment"># 1   b      1</span></span><br><span class="line"><span class="comment"># 2   a      2</span></span><br><span class="line"><span class="comment"># 3   a      3</span></span><br><span class="line"><span class="comment"># 4   b      4</span></span><br><span class="line"><span class="comment"># 5   c      5</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(right1)</span><br><span class="line"><span class="comment">#    group_val</span></span><br><span class="line"><span class="comment"># a        3.5</span></span><br><span class="line"><span class="comment"># b        7.0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 把右图的index和左图的key列进行连接</span></span><br><span class="line"><span class="built_in">print</span>(left1.join(right1, on=<span class="string">&#x27;key&#x27;</span>))</span><br><span class="line"><span class="comment">#   key  value  group_val</span></span><br><span class="line"><span class="comment"># 0   a      0        3.5</span></span><br><span class="line"><span class="comment"># 1   b      1        7.0</span></span><br><span class="line"><span class="comment"># 2   a      2        3.5</span></span><br><span class="line"><span class="comment"># 3   a      3        3.5</span></span><br><span class="line"><span class="comment"># 4   b      4        7.0</span></span><br><span class="line"><span class="comment"># 5   c      5        NaN</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 没有on参数的情况下只会查找两个表的行索引,不管列有没有重叠</span></span><br><span class="line"><span class="comment"># 这里因为没有相同或相似的列,所以group_val为NaN</span></span><br><span class="line"><span class="built_in">print</span>(left1.join(right1))</span><br><span class="line"><span class="comment">#   key  value  group_val</span></span><br><span class="line"><span class="comment"># 0   a      0        NaN</span></span><br><span class="line"><span class="comment"># 1   b      1        NaN</span></span><br><span class="line"><span class="comment"># 2   a      2        NaN</span></span><br><span class="line"><span class="comment"># 3   a      3        NaN</span></span><br><span class="line"><span class="comment"># 4   b      4        NaN</span></span><br><span class="line"><span class="comment"># 5   c      5        NaN</span></span><br></pre></td></tr></table></figure>

<p>两种连接方式的对比:</p>
<ul>
<li>使用merge的left_index和right_index参数</li>
<li>使用DataFrame(left2)的实例方法join</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">left2 = pd.DataFrame([[<span class="number">1.</span>, <span class="number">2.</span>], [<span class="number">3.</span>, <span class="number">4.</span>], [<span class="number">5.</span>, <span class="number">6.</span>]],</span><br><span class="line">                     index=[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;e&#x27;</span>],</span><br><span class="line">                     columns=[<span class="string">&#x27;Ohio&#x27;</span>, <span class="string">&#x27;Nevada&#x27;</span>])</span><br><span class="line">right2 = pd.DataFrame([[<span class="number">7.</span>, <span class="number">8.</span>], [<span class="number">9.</span>, <span class="number">10.</span>], [<span class="number">11.</span>, <span class="number">12.</span>], [<span class="number">13</span>, <span class="number">14</span>]],</span><br><span class="line">                      index=[<span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;d&#x27;</span>, <span class="string">&#x27;e&#x27;</span>],</span><br><span class="line">                      columns=[<span class="string">&#x27;Missouri&#x27;</span>, <span class="string">&#x27;Alabama&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(left2)</span><br><span class="line"><span class="comment">#    Ohio  Nevada</span></span><br><span class="line"><span class="comment"># a   1.0     2.0</span></span><br><span class="line"><span class="comment"># c   3.0     4.0</span></span><br><span class="line"><span class="comment"># e   5.0     6.0</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(right2)</span><br><span class="line"><span class="comment">#    Missouri  Alabama</span></span><br><span class="line"><span class="comment"># b       7.0      8.0</span></span><br><span class="line"><span class="comment"># c       9.0     10.0</span></span><br><span class="line"><span class="comment"># d      11.0     12.0</span></span><br><span class="line"><span class="comment"># e      13.0     14.0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用merge的left_index和right_index参数</span></span><br><span class="line"><span class="built_in">print</span>(pd.merge(left2, right2, how=<span class="string">&#x27;outer&#x27;</span>, left_index=<span class="literal">True</span>, right_index=<span class="literal">True</span>))</span><br><span class="line"><span class="comment">#    Ohio  Nevada  Missouri  Alabama</span></span><br><span class="line"><span class="comment"># a   1.0     2.0       NaN      NaN</span></span><br><span class="line"><span class="comment"># b   NaN     NaN       7.0      8.0</span></span><br><span class="line"><span class="comment"># c   3.0     4.0       9.0     10.0</span></span><br><span class="line"><span class="comment"># d   NaN     NaN      11.0     12.0</span></span><br><span class="line"><span class="comment"># e   5.0     6.0      13.0     14.0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用DataFrame(left2)的实例方法join</span></span><br><span class="line"><span class="comment"># 因为没有on参数,会比较两个表的行索引值来进行join</span></span><br><span class="line"><span class="built_in">print</span>(left2.join(right2, how=<span class="string">&#x27;outer&#x27;</span>))</span><br><span class="line"><span class="comment">#    Ohio  Nevada  Missouri  Alabama</span></span><br><span class="line"><span class="comment"># a   1.0     2.0       NaN      NaN</span></span><br><span class="line"><span class="comment"># b   NaN     NaN       7.0      8.0</span></span><br><span class="line"><span class="comment"># c   3.0     4.0       9.0     10.0</span></span><br><span class="line"><span class="comment"># d   NaN     NaN      11.0     12.0</span></span><br><span class="line"><span class="comment"># e   5.0     6.0      13.0     14.0</span></span><br></pre></td></tr></table></figure>

<p>因为⼀些历史版本的遗留,DataFrame的join⽅法默认使⽤的是<strong>左连接</strong>，保留左边表的⾏索引。</p>
<p>轴向连接</p>
<ul>
<li><code>连接</code>（concatenation）、<code>绑定</code>（binding）或<code>堆叠</code>（stacking）指的都是轴向连接</li>
<li>轴向连接,顾名思义,就是同一个轴的数据连接.不管数据如何,不管列于列之间有没有关系,就只会发生连接(沿着一条轴将多个对象堆叠到一起)</li>
<li>concat方法相当于数据库中的全连接(UNION ALL)</li>
<li>拥有axis参数<ol>
<li>默认的axis=0 情况下，pd.concat([obj1,obj2]) 函数的效果与 obj1.append(obj2) 是相同的；</li>
<li>在 axis=1 的情况下，pd.concat([df1,df2],axis=1) 的效果与 pd.merge(df1,df2,left_index=True,right_index=True,how=’outer’) 是相同的</li>
</ol>
</li>
<li>join_axes参数:<br>自定义索引。说人话**:指定部分索引进行连接**</li>
<li>keys参数:<br>创建层次化索引,会将每个表制作成一个外层,每个表的列就是内层.<br>注意:如果传入的两个表不是list形式而是dict形式,那么也会创建多级索引</li>
<li>ignore_index:<br>重建索引</li>
</ul>
<p>NumPy的轴线连接函数:<br>concatenation函数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">arr1 = np.arange(<span class="number">12</span>).reshape((<span class="number">3</span>, <span class="number">4</span>))</span><br><span class="line"><span class="built_in">print</span>(arr1)</span><br><span class="line"><span class="comment"># [[ 0  1  2  3]</span></span><br><span class="line"><span class="comment">#  [ 4  5  6  7]</span></span><br><span class="line"><span class="comment">#  [ 8  9 10 11]]</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">arr2 = np.arange(<span class="number">10000</span>,<span class="number">10012</span>).reshape((<span class="number">3</span>, <span class="number">4</span>))</span><br><span class="line"><span class="built_in">print</span>(arr2)</span><br><span class="line"><span class="comment"># [[10000 10001 10002 10003]</span></span><br><span class="line"><span class="comment">#  [10004 10005 10006 10007]</span></span><br><span class="line"><span class="comment">#  [10008 10009 10010 10011]]</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(np.concatenate([arr1, arr2], axis=<span class="number">1</span>))</span><br><span class="line"><span class="comment"># [[    0     1     2     3 10000 10001 10002 10003]</span></span><br><span class="line"><span class="comment">#  [    4     5     6     7 10004 10005 10006 10007]</span></span><br><span class="line"><span class="comment">#  [    8     9    10    11 10008 10009 10010 10011]]</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(np.concatenate([arr1, arr2], axis=<span class="number">0</span>))</span><br><span class="line"><span class="comment"># [[    0     1     2     3]</span></span><br><span class="line"><span class="comment">#  [    4     5     6     7]</span></span><br><span class="line"><span class="comment">#  [    8     9    10    11]</span></span><br><span class="line"><span class="comment">#  [10000 10001 10002 10003]</span></span><br><span class="line"><span class="comment">#  [10004 10005 10006 10007]</span></span><br><span class="line"><span class="comment">#  [10008 10009 10010 10011]]</span></span><br></pre></td></tr></table></figure>

<p>pandas的轴向连接函数:<br>concat函数:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pandas <span class="keyword">import</span> Series,DataFrame</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">series1 = Series(<span class="built_in">range</span>(<span class="number">2</span>),index = [<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>])</span><br><span class="line">series2 = Series(<span class="built_in">range</span>(<span class="number">3</span>),index = [<span class="string">&#x27;c&#x27;</span>,<span class="string">&#x27;d&#x27;</span>,<span class="string">&#x27;e&#x27;</span>])</span><br><span class="line">series3 = Series(<span class="built_in">range</span>(<span class="number">2</span>),index = [<span class="string">&#x27;f&#x27;</span>,<span class="string">&#x27;g&#x27;</span>])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(series1)</span><br><span class="line"><span class="comment"># a    0</span></span><br><span class="line"><span class="comment"># b    1</span></span><br><span class="line"><span class="comment"># dtype: int64</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(series2)</span><br><span class="line"><span class="comment"># c    0</span></span><br><span class="line"><span class="comment"># d    1</span></span><br><span class="line"><span class="comment"># e    2</span></span><br><span class="line"><span class="comment"># dtype: int64</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(series3)</span><br><span class="line"><span class="comment"># f    0</span></span><br><span class="line"><span class="comment"># g    1</span></span><br><span class="line"><span class="comment"># dtype: int64</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 默认axis=0</span></span><br><span class="line">y = pd.concat([series1,series2,series3])</span><br><span class="line"><span class="built_in">print</span>(y)</span><br><span class="line"><span class="comment"># a    0</span></span><br><span class="line"><span class="comment"># b    1</span></span><br><span class="line"><span class="comment"># c    0</span></span><br><span class="line"><span class="comment"># d    1</span></span><br><span class="line"><span class="comment"># e    2</span></span><br><span class="line"><span class="comment"># f    0</span></span><br><span class="line"><span class="comment"># g    1</span></span><br><span class="line"><span class="comment"># dtype: int64</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(y))</span><br><span class="line"><span class="comment"># &lt;class &#x27;pandas.core.series.Series&#x27;&gt;</span></span><br><span class="line"></span><br><span class="line">x = pd.concat([series1,series3],axis=<span class="number">1</span>)</span><br><span class="line"><span class="built_in">print</span>(x)</span><br><span class="line"><span class="comment">#      0    1</span></span><br><span class="line"><span class="comment"># a  0.0  NaN</span></span><br><span class="line"><span class="comment"># b  1.0  NaN</span></span><br><span class="line"><span class="comment"># f  NaN  0.0</span></span><br><span class="line"><span class="comment"># g  NaN  1.0</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(x))</span><br><span class="line"><span class="comment"># &lt;class &#x27;pandas.core.frame.DataFrame&#x27;&gt;</span></span><br></pre></td></tr></table></figure>

<p>对于series,两种连接后的类型不同,可以看出，concat的操作仅仅是单纯的连接，并没有涉及到数据的整合。如果想要进行整合，还是使用merge的方法。</p>
<p>join里的how参数在concat里是join参数,默认为outer</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">s1 = pd.Series([<span class="number">0</span>, <span class="number">1</span>], index=[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>])</span><br><span class="line">s3 = pd.Series([<span class="number">5</span>, <span class="number">6</span>], index=[<span class="string">&#x27;f&#x27;</span>, <span class="string">&#x27;g&#x27;</span>])</span><br><span class="line">s4 = pd.concat([s1, s3])</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(s1)</span><br><span class="line"><span class="comment"># a    0</span></span><br><span class="line"><span class="comment"># b    1</span></span><br><span class="line"><span class="comment"># dtype: int64</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(s3)</span><br><span class="line"><span class="comment"># f    5</span></span><br><span class="line"><span class="comment"># g    6</span></span><br><span class="line"><span class="comment"># dtype: int64</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(s4)</span><br><span class="line"><span class="comment"># a    0</span></span><br><span class="line"><span class="comment"># b    1</span></span><br><span class="line"><span class="comment"># f    5</span></span><br><span class="line"><span class="comment"># g    6</span></span><br><span class="line"><span class="comment"># dtype: int64</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(pd.concat([s1, s4], axis=<span class="number">1</span>))</span><br><span class="line"><span class="comment">#      0  1</span></span><br><span class="line"><span class="comment"># a  0.0  0</span></span><br><span class="line"><span class="comment"># b  1.0  1</span></span><br><span class="line"><span class="comment"># f  NaN  5</span></span><br><span class="line"><span class="comment"># g  NaN  6</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(pd.concat([s1, s4], axis=<span class="number">1</span>, join=<span class="string">&#x27;inner&#x27;</span>))</span><br><span class="line"><span class="comment">#    0  1</span></span><br><span class="line"><span class="comment"># a  0  0</span></span><br><span class="line"><span class="comment"># b  1  1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定索引名称：join_axes(指定要在其它轴上使⽤的索引)</span></span><br><span class="line"><span class="built_in">print</span>(pd.concat([s1, s4], axis=<span class="number">1</span>, join_axes=[[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;e&#x27;</span>]]))</span><br><span class="line"><span class="comment">#      0    1</span></span><br><span class="line"><span class="comment"># a  0.0  0.0</span></span><br><span class="line"><span class="comment"># c  NaN  NaN</span></span><br><span class="line"><span class="comment"># b  1.0  1.0</span></span><br><span class="line"><span class="comment"># e  NaN  NaN</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(pd.concat([s1, s1, s3]))</span><br><span class="line"><span class="comment"># a    0</span></span><br><span class="line"><span class="comment"># b    1</span></span><br><span class="line"><span class="comment"># a    0</span></span><br><span class="line"><span class="comment"># b    1</span></span><br><span class="line"><span class="comment"># f    5</span></span><br><span class="line"><span class="comment"># g    6</span></span><br><span class="line"><span class="comment"># dtype: int64</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># key:创建多级索引.会将每个表制作成一个外层</span></span><br><span class="line">result = pd.concat([s1, s1, s3], keys=[<span class="string">&#x27;one&#x27;</span>, <span class="string">&#x27;two&#x27;</span>, <span class="string">&#x27;three&#x27;</span>])</span><br><span class="line"><span class="built_in">print</span>(result)</span><br><span class="line"><span class="comment"># one    a    0</span></span><br><span class="line"><span class="comment">#        b    1</span></span><br><span class="line"><span class="comment"># two    a    0</span></span><br><span class="line"><span class="comment">#        b    1</span></span><br><span class="line"><span class="comment"># three  f    5</span></span><br><span class="line"><span class="comment">#        g    6</span></span><br><span class="line"><span class="comment"># dtype: int64</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(result.unstack())</span><br><span class="line"><span class="comment">#          a    b    f    g</span></span><br><span class="line"><span class="comment"># one    0.0  1.0  NaN  NaN</span></span><br><span class="line"><span class="comment"># two    0.0  1.0  NaN  NaN</span></span><br><span class="line"><span class="comment"># three  NaN  NaN  5.0  6.0</span></span><br></pre></td></tr></table></figure>

<p>有两种方式创建多级索引:</p>
<ul>
<li>使用keys参数</li>
<li>传入的两张表是dict形式</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">df1 = pd.DataFrame(np.arange(<span class="number">6</span>).reshape(<span class="number">3</span>, <span class="number">2</span>), index=[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>],</span><br><span class="line">                   columns=[<span class="string">&#x27;one&#x27;</span>, <span class="string">&#x27;two&#x27;</span>])</span><br><span class="line">df2 = pd.DataFrame(<span class="number">5</span> + np.arange(<span class="number">4</span>).reshape(<span class="number">2</span>, <span class="number">2</span>), index=[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;c&#x27;</span>],</span><br><span class="line">                   columns=[<span class="string">&#x27;three&#x27;</span>, <span class="string">&#x27;four&#x27;</span>])</span><br><span class="line"><span class="built_in">print</span>(df1)</span><br><span class="line"><span class="comment">#    one  two</span></span><br><span class="line"><span class="comment"># a    0    1</span></span><br><span class="line"><span class="comment"># b    2    3</span></span><br><span class="line"><span class="comment"># c    4    5</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(df2)</span><br><span class="line"><span class="comment">#    three  four</span></span><br><span class="line"><span class="comment"># a      5     6</span></span><br><span class="line"><span class="comment"># c      7     8</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用key参数创建多级索引</span></span><br><span class="line"><span class="built_in">print</span>(pd.concat([df1, df2], axis=<span class="number">1</span>, keys=[<span class="string">&#x27;level1&#x27;</span>, <span class="string">&#x27;level2&#x27;</span>]))</span><br><span class="line"><span class="comment">#   level1     level2     </span></span><br><span class="line"><span class="comment">#      one two  three four</span></span><br><span class="line"><span class="comment"># a      0   1    5.0  6.0</span></span><br><span class="line"><span class="comment"># b      2   3    NaN  NaN</span></span><br><span class="line"><span class="comment"># c      4   5    7.0  8.0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 传入的两个表是dict形式的话,也会创建多级列表</span></span><br><span class="line"><span class="built_in">print</span>(pd.concat(&#123;<span class="string">&#x27;level1&#x27;</span>: df1, <span class="string">&#x27;level2&#x27;</span>: df2&#125;, axis=<span class="number">1</span>))</span><br><span class="line"><span class="comment">#   level1     level2     </span></span><br><span class="line"><span class="comment">#      one two  three four</span></span><br><span class="line"><span class="comment"># a      0   1    5.0  6.0</span></span><br><span class="line"><span class="comment"># b      2   3    NaN  NaN</span></span><br><span class="line"><span class="comment"># c      4   5    7.0  8.0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># names为每个层级索引取一个名字</span></span><br><span class="line">x = pd.concat([df1, df2], axis=<span class="number">1</span>, keys=[<span class="string">&#x27;level1&#x27;</span>, <span class="string">&#x27;level2&#x27;</span>],</span><br><span class="line">              names=[<span class="string">&#x27;upper&#x27;</span>, <span class="string">&#x27;lower&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(x)</span><br><span class="line"><span class="comment"># upper level1     level2     </span></span><br><span class="line"><span class="comment"># lower    one two  three four</span></span><br><span class="line"><span class="comment"># a          0   1    5.0  6.0</span></span><br><span class="line"><span class="comment"># b          2   3    NaN  NaN</span></span><br><span class="line"><span class="comment"># c          4   5    7.0  8.0</span></span><br></pre></td></tr></table></figure>

<p>ignore_index:<br>重新构建行索引</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">df1 = pd.DataFrame(np.random.randn(<span class="number">3</span>, <span class="number">4</span>), columns=[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;d&#x27;</span>])</span><br><span class="line">df2 = pd.DataFrame(np.random.randn(<span class="number">2</span>, <span class="number">3</span>), columns=[<span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;d&#x27;</span>, <span class="string">&#x27;a&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(df1)</span><br><span class="line"><span class="comment">#           a         b         c         d</span></span><br><span class="line"><span class="comment"># 0  0.711512 -1.825266  0.290078 -0.609434</span></span><br><span class="line"><span class="comment"># 1  0.455575  1.153067 -0.382234  0.244137</span></span><br><span class="line"><span class="comment"># 2 -0.875710 -0.344917 -0.592318 -0.547368</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(df2)</span><br><span class="line"><span class="comment">#           b         d         a</span></span><br><span class="line"><span class="comment"># 0 -2.402685  0.545582  0.108030</span></span><br><span class="line"><span class="comment"># 1 -0.531514 -0.412463 -1.120856</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(pd.concat([df1, df2]))</span><br><span class="line"><span class="comment">#           a         b         c         d</span></span><br><span class="line"><span class="comment"># 0  1.059438  0.034609  0.377808 -1.165982</span></span><br><span class="line"><span class="comment"># 1  0.273088  0.106017  0.144853 -0.193084</span></span><br><span class="line"><span class="comment"># 2  0.534972 -0.192445  0.976238 -0.801584</span></span><br><span class="line"><span class="comment"># 0  1.038617  0.752434       NaN -0.581950</span></span><br><span class="line"><span class="comment"># 1 -1.122194  0.453861       NaN  1.123797</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 重新构建行索引</span></span><br><span class="line"><span class="built_in">print</span>(pd.concat([df1, df2], ignore_index=<span class="literal">True</span>))</span><br><span class="line"><span class="comment">#           a         b         c         d</span></span><br><span class="line"><span class="comment"># 0 -0.770785 -0.253207 -1.581104  0.332197</span></span><br><span class="line"><span class="comment"># 1 -1.327015  1.345481  0.231273  0.419707</span></span><br><span class="line"><span class="comment"># 2 -1.245914  0.232951  1.132064 -0.304925</span></span><br><span class="line"><span class="comment"># 3  1.900761 -0.252633       NaN  0.198270</span></span><br><span class="line"><span class="comment"># 4  0.197476 -1.607946       NaN  0.654311</span></span><br></pre></td></tr></table></figure>

<p>concat函数的参数</p>
<p><img src="/images/42f73737.png" alt="42f73737"></p>
<hr>
<p>合并重叠数据</p>
<ul>
<li>NumPy的where函数，它表示⼀种等价于⾯向数组的if-else:<br><code>np.where(pd.isnull(a), b, a)</code>:如果a是空,那么取nb.否则取a</li>
<li>Series有⼀个combine_first⽅法，实现的也是⼀样的功能，<strong>还带有pandas的数据对⻬</strong>:<br><code>a.combine_first(b)</code>:用b的数据填补a的缺失值</li>
<li>数据对齐功能:<ol>
<li>会自动根据行索引来匹配填充数据</li>
<li>如果a没有的列,但是b有,那么这个列也会填充到返回的结果上</li>
</ol>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">a = pd.Series([np.nan, <span class="number">2.5</span>, np.nan, <span class="number">3.5</span>, <span class="number">4.5</span>, np.nan],</span><br><span class="line">              index=[<span class="string">&#x27;f&#x27;</span>, <span class="string">&#x27;e&#x27;</span>, <span class="string">&#x27;d&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;a&#x27;</span>])</span><br><span class="line">b = pd.Series(np.arange(<span class="built_in">len</span>(a), dtype=np.float64),</span><br><span class="line">              index=[<span class="string">&#x27;f&#x27;</span>, <span class="string">&#x27;e&#x27;</span>, <span class="string">&#x27;d&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;a&#x27;</span>])</span><br><span class="line"></span><br><span class="line">b[-<span class="number">1</span>] = np.nan</span><br><span class="line"><span class="built_in">print</span>(a)</span><br><span class="line"><span class="comment"># f    NaN</span></span><br><span class="line"><span class="comment"># e    2.5</span></span><br><span class="line"><span class="comment"># d    NaN</span></span><br><span class="line"><span class="comment"># c    3.5</span></span><br><span class="line"><span class="comment"># b    4.5</span></span><br><span class="line"><span class="comment"># a    NaN</span></span><br><span class="line"><span class="comment"># dtype: float64</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(b)</span><br><span class="line"><span class="comment"># f    0.0</span></span><br><span class="line"><span class="comment"># e    1.0</span></span><br><span class="line"><span class="comment"># d    2.0</span></span><br><span class="line"><span class="comment"># c    3.0</span></span><br><span class="line"><span class="comment"># b    4.0</span></span><br><span class="line"><span class="comment"># a    NaN</span></span><br><span class="line"><span class="comment"># dtype: float64</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果a是空,那么取nb.否则取a</span></span><br><span class="line"><span class="built_in">print</span>(np.where(pd.isnull(a), b, a))</span><br><span class="line"><span class="comment"># [0.  2.5 2.  3.5 4.5 nan]</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 用a的数据填补b的缺失值</span></span><br><span class="line"><span class="built_in">print</span>(b.combine_first(a))</span><br><span class="line"><span class="comment"># f    0.0</span></span><br><span class="line"><span class="comment"># e    1.0</span></span><br><span class="line"><span class="comment"># d    2.0</span></span><br><span class="line"><span class="comment"># c    3.0</span></span><br><span class="line"><span class="comment"># b    4.0</span></span><br><span class="line"><span class="comment"># a    NaN</span></span><br><span class="line"><span class="comment"># dtype: float64</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 用b的数据填补a的缺失值</span></span><br><span class="line"><span class="built_in">print</span>(a.combine_first(b))</span><br><span class="line"><span class="comment"># f    0.0</span></span><br><span class="line"><span class="comment"># e    2.5</span></span><br><span class="line"><span class="comment"># d    2.0</span></span><br><span class="line"><span class="comment"># c    3.5</span></span><br><span class="line"><span class="comment"># b    4.5</span></span><br><span class="line"><span class="comment"># a    NaN</span></span><br><span class="line"><span class="comment"># dtype: float64</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果b[:-2]没有的列,但是a[2:]有,那么a[2:]的列会填充到b[:-2]上</span></span><br><span class="line"><span class="built_in">print</span>(b[:-<span class="number">2</span>].combine_first(a[<span class="number">2</span>:]))</span><br><span class="line"><span class="comment"># a    NaN</span></span><br><span class="line"><span class="comment"># b    4.5</span></span><br><span class="line"><span class="comment"># c    3.0</span></span><br><span class="line"><span class="comment"># d    2.0</span></span><br><span class="line"><span class="comment"># e    1.0</span></span><br><span class="line"><span class="comment"># f    0.0</span></span><br><span class="line"><span class="comment"># dtype: float64</span></span><br></pre></td></tr></table></figure>



<hr>
<h2 id="8-3-重塑和轴向旋转"><a href="#8-3-重塑和轴向旋转" class="headerlink" title="8.3 重塑和轴向旋转"></a>8.3 重塑和轴向旋转</h2><p>有许多⽤于重新排列表格型数据的基础运算。这些函数也称作<code>重塑</code>（reshape）或<code>轴向旋转</code>（pivot）运算。</p>
<p>重塑层次化索引</p>
<p>多级索引的两个主要功能:<br>(实际上就像是Excel中的<code>一维表</code>与<code>二维表</code>的互转)</p>
<ul>
<li>stack：<br>将数据的列“旋转”为⾏。<br>(一维表转为二维表)</li>
<li>unstack：<br>将数据的⾏“旋转”为列。<br>(二维表转为一维表)</li>
</ul>
<p>参数:</p>
<ul>
<li><p>level:<br>默认情况下，stack和unstack操作的是最内层.(默认值-1)<br>传⼊分层级别的编号或名称即可对其它级别进⾏stack和unstack操作:(level=1或level=’列名’)</p>
<p>==在对DataFrame进⾏unstack操作时，作为旋转轴的级别将会成为结果中的最低级别==</p>
</li>
<li><p>dropna:<br>在转化过程中,可能会出现全部都是NaN的行,该参数设置这些行是否保留</p>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">data = pd.DataFrame(np.arange(<span class="number">6</span>).reshape((<span class="number">2</span>, <span class="number">3</span>)),</span><br><span class="line">                    index=pd.Index([<span class="string">&#x27;Ohio&#x27;</span>, <span class="string">&#x27;Colorado&#x27;</span>], name=<span class="string">&#x27;state&#x27;</span>),</span><br><span class="line">                    columns=pd.Index([<span class="string">&#x27;one&#x27;</span>, <span class="string">&#x27;two&#x27;</span>, <span class="string">&#x27;three&#x27;</span>],name=<span class="string">&#x27;number&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(data)</span><br><span class="line"><span class="comment"># number    one  two  three</span></span><br><span class="line"><span class="comment"># state                    </span></span><br><span class="line"><span class="comment"># Ohio        0    1      2</span></span><br><span class="line"><span class="comment"># Colorado    3    4      5</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 一维表转为二维表</span></span><br><span class="line"><span class="comment"># 默认情况下，stack操作的是最内层.</span></span><br><span class="line">result = data.stack()</span><br><span class="line"><span class="built_in">print</span>(result)</span><br><span class="line"><span class="comment"># state     number</span></span><br><span class="line"><span class="comment"># Ohio      one       0</span></span><br><span class="line"><span class="comment">#           two       1</span></span><br><span class="line"><span class="comment">#           three     2</span></span><br><span class="line"><span class="comment"># Colorado  one       3</span></span><br><span class="line"><span class="comment">#           two       4</span></span><br><span class="line"><span class="comment">#           three     5</span></span><br><span class="line"><span class="comment"># dtype: int32</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 二维表转为一维表</span></span><br><span class="line"><span class="comment"># # 默认情况下，unstack操作的是最内层.</span></span><br><span class="line"><span class="built_in">print</span>(result.unstack())</span><br><span class="line"><span class="comment"># number    one  two  three</span></span><br><span class="line"><span class="comment"># state                    </span></span><br><span class="line"><span class="comment"># Ohio        0    1      2</span></span><br><span class="line"><span class="comment"># Colorado    3    4      5</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(result.unstack(level=<span class="number">0</span>))</span><br><span class="line"><span class="comment"># state   Ohio  Colorado</span></span><br><span class="line"><span class="comment"># number                </span></span><br><span class="line"><span class="comment"># one        0         3</span></span><br><span class="line"><span class="comment"># two        1         4</span></span><br><span class="line"><span class="comment"># three      2         5</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(result.unstack(level=<span class="number">1</span>))</span><br><span class="line"><span class="comment"># number    one  two  three</span></span><br><span class="line"><span class="comment"># state                    </span></span><br><span class="line"><span class="comment"># Ohio        0    1      2</span></span><br><span class="line"><span class="comment"># Colorado    3    4      5</span></span><br><span class="line"><span class="comment"># state   Ohio  Colorado</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(result.unstack(level=<span class="string">&#x27;state&#x27;</span>))</span><br><span class="line"><span class="comment"># state   Ohio  Colorado</span></span><br><span class="line"><span class="comment"># number                </span></span><br><span class="line"><span class="comment"># one        0         3</span></span><br><span class="line"><span class="comment"># two        1         4</span></span><br><span class="line"><span class="comment"># three      2         5</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">s1 = pd.Series([<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], index=[<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;d&#x27;</span>])</span><br><span class="line">s2 = pd.Series([<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>], index=[<span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;d&#x27;</span>, <span class="string">&#x27;e&#x27;</span>])</span><br><span class="line">data2 = pd.concat([s1, s2], keys=[<span class="string">&#x27;one&#x27;</span>, <span class="string">&#x27;two&#x27;</span>])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(data2)</span><br><span class="line"><span class="comment"># one  a    0</span></span><br><span class="line"><span class="comment">#      b    1</span></span><br><span class="line"><span class="comment">#      c    2</span></span><br><span class="line"><span class="comment">#      d    3</span></span><br><span class="line"><span class="comment"># two  c    4</span></span><br><span class="line"><span class="comment">#      d    5</span></span><br><span class="line"><span class="comment">#      e    6</span></span><br><span class="line"><span class="comment"># dtype: int64</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">data3 = data2.unstack()</span><br><span class="line"><span class="built_in">print</span>(data3)</span><br><span class="line"><span class="comment">#        a    b    c    d    e</span></span><br><span class="line"><span class="comment"># one  0.0  1.0  2.0  3.0  NaN</span></span><br><span class="line"><span class="comment"># two  NaN  NaN  4.0  5.0  6.0</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(data2.unstack().stack())</span><br><span class="line"><span class="comment"># one  a    0.0</span></span><br><span class="line"><span class="comment">#      b    1.0</span></span><br><span class="line"><span class="comment">#      c    2.0</span></span><br><span class="line"><span class="comment">#      d    3.0</span></span><br><span class="line"><span class="comment"># two  c    4.0</span></span><br><span class="line"><span class="comment">#      d    5.0</span></span><br><span class="line"><span class="comment">#      e    6.0</span></span><br><span class="line"><span class="comment"># dtype: float64</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(data2.unstack().stack(dropna=<span class="literal">False</span>))</span><br><span class="line"><span class="comment"># one  a    0.0</span></span><br><span class="line"><span class="comment">#      b    1.0</span></span><br><span class="line"><span class="comment">#      c    2.0</span></span><br><span class="line"><span class="comment">#      d    3.0</span></span><br><span class="line"><span class="comment">#      e    NaN</span></span><br><span class="line"><span class="comment"># two  a    NaN</span></span><br><span class="line"><span class="comment">#      b    NaN</span></span><br><span class="line"><span class="comment">#      c    4.0</span></span><br><span class="line"><span class="comment">#      d    5.0</span></span><br><span class="line"><span class="comment">#      e    6.0</span></span><br><span class="line"><span class="comment"># dtype: float64</span></span><br></pre></td></tr></table></figure>

<p>在对DataFrame进⾏unstack操作时，作为旋转轴的级别将会成为结果中的最低级别</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">data = pd.DataFrame(np.arange(<span class="number">6</span>).reshape((<span class="number">2</span>, <span class="number">3</span>)),</span><br><span class="line">                    index=pd.Index([<span class="string">&#x27;Ohio&#x27;</span>, <span class="string">&#x27;Colorado&#x27;</span>], name=<span class="string">&#x27;state&#x27;</span>),</span><br><span class="line">                    columns=pd.Index([<span class="string">&#x27;one&#x27;</span>, <span class="string">&#x27;two&#x27;</span>, <span class="string">&#x27;three&#x27;</span>],name=<span class="string">&#x27;number&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(data)</span><br><span class="line"><span class="comment"># number    one  two  three</span></span><br><span class="line"><span class="comment"># state                    </span></span><br><span class="line"><span class="comment"># Ohio        0    1      2</span></span><br><span class="line"><span class="comment"># Colorado    3    4      5</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 一维表转为二维表</span></span><br><span class="line"><span class="comment"># 默认情况下，stack操作的是最内层.</span></span><br><span class="line">result = data.stack()</span><br><span class="line"><span class="built_in">print</span>(result)</span><br><span class="line"><span class="comment"># state     number</span></span><br><span class="line"><span class="comment"># Ohio      one       0</span></span><br><span class="line"><span class="comment">#           two       1</span></span><br><span class="line"><span class="comment">#           three     2</span></span><br><span class="line"><span class="comment"># Colorado  one       3</span></span><br><span class="line"><span class="comment">#           two       4</span></span><br><span class="line"><span class="comment">#           three     5</span></span><br><span class="line"><span class="comment"># dtype: int32</span></span><br><span class="line"></span><br><span class="line">df = pd.DataFrame(&#123;<span class="string">&#x27;left&#x27;</span>: result, <span class="string">&#x27;right&#x27;</span>: result + <span class="number">5</span>&#125;,</span><br><span class="line">                  columns=pd.Index([<span class="string">&#x27;left&#x27;</span>, <span class="string">&#x27;right&#x27;</span>], name=<span class="string">&#x27;side&#x27;</span>))</span><br><span class="line"><span class="built_in">print</span>(df)</span><br><span class="line"><span class="comment"># side             left  right</span></span><br><span class="line"><span class="comment"># state    number             </span></span><br><span class="line"><span class="comment"># Ohio     one        0      5</span></span><br><span class="line"><span class="comment">#          two        1      6</span></span><br><span class="line"><span class="comment">#          three      2      7</span></span><br><span class="line"><span class="comment"># Colorado one        3      8</span></span><br><span class="line"><span class="comment">#          two        4      9</span></span><br><span class="line"><span class="comment">#          three      5     10</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 在对DataFrame进⾏unstack操作时，作为旋转轴的级别将会成为结果中的最低级别</span></span><br><span class="line"><span class="built_in">print</span>(df.unstack(<span class="string">&#x27;state&#x27;</span>))</span><br><span class="line"><span class="comment"># side   left          right         </span></span><br><span class="line"><span class="comment"># state  Ohio Colorado  Ohio Colorado</span></span><br><span class="line"><span class="comment"># number                             </span></span><br><span class="line"><span class="comment"># one       0        3     5        8</span></span><br><span class="line"><span class="comment"># two       1        4     6        9</span></span><br><span class="line"><span class="comment"># three     2        5     7       10</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(df.unstack(<span class="string">&#x27;state&#x27;</span>).stack(<span class="string">&#x27;side&#x27;</span>))</span><br><span class="line"><span class="comment"># state         Colorado  Ohio</span></span><br><span class="line"><span class="comment"># number side                 </span></span><br><span class="line"><span class="comment"># one    left          3     0</span></span><br><span class="line"><span class="comment">#        right         8     5</span></span><br><span class="line"><span class="comment"># two    left          4     1</span></span><br><span class="line"><span class="comment">#        right         9     6</span></span><br><span class="line"><span class="comment"># three  left          5     2</span></span><br><span class="line"><span class="comment">#        right        10     7</span></span><br></pre></td></tr></table></figure>



<p>将“⻓格式”旋转为“宽格式”(<strong>数据透视</strong>)</p>
<p>多个时间序列数据通常是以所谓的“⻓格式”（long）或“堆叠格式”（stacked）存储在数据库和CSV中的。</p>
<p>reindex说明:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">from</span> pandas <span class="keyword">import</span> Series, DataFrame</span><br><span class="line"></span><br><span class="line">np.random.seed(<span class="number">666</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># series reindex</span></span><br><span class="line">s1 = Series([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>], index=[<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;C&#x27;</span>, <span class="string">&#x27;D&#x27;</span>])</span><br><span class="line"><span class="built_in">print</span>(s1)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">A    1</span></span><br><span class="line"><span class="string">B    2</span></span><br><span class="line"><span class="string">C    3</span></span><br><span class="line"><span class="string">D    4</span></span><br><span class="line"><span class="string">dtype: int64</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 重新指定 index， 多出来的index，可以使用fill_value 填充</span></span><br><span class="line"><span class="built_in">print</span>(s1.reindex(index=[<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;C&#x27;</span>, <span class="string">&#x27;D&#x27;</span>, <span class="string">&#x27;E&#x27;</span>], fill_value = <span class="number">10</span>))</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">A     1</span></span><br><span class="line"><span class="string">B     2</span></span><br><span class="line"><span class="string">C     3</span></span><br><span class="line"><span class="string">D     4</span></span><br><span class="line"><span class="string">E    10</span></span><br><span class="line"><span class="string">dtype: int64</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">s2 = Series([<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;C&#x27;</span>], index = [<span class="number">1</span>, <span class="number">5</span>, <span class="number">10</span>])</span><br><span class="line"><span class="built_in">print</span>(s2)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">1     A</span></span><br><span class="line"><span class="string">5     B</span></span><br><span class="line"><span class="string">10    C</span></span><br><span class="line"><span class="string">dtype: object</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改索引，</span></span><br><span class="line"><span class="comment"># 将s2的索引增加到15个</span></span><br><span class="line"><span class="comment"># 如果新增加的索引值不存在，默认为 Nan</span></span><br><span class="line"><span class="built_in">print</span>(s2.reindex(index=<span class="built_in">range</span>(<span class="number">15</span>)))</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">0     NaN</span></span><br><span class="line"><span class="string">1       A</span></span><br><span class="line"><span class="string">2     NaN</span></span><br><span class="line"><span class="string">3     NaN</span></span><br><span class="line"><span class="string">4     NaN</span></span><br><span class="line"><span class="string">5       B</span></span><br><span class="line"><span class="string">6     NaN</span></span><br><span class="line"><span class="string">7     NaN</span></span><br><span class="line"><span class="string">8     NaN</span></span><br><span class="line"><span class="string">9     NaN</span></span><br><span class="line"><span class="string">10      C</span></span><br><span class="line"><span class="string">11    NaN</span></span><br><span class="line"><span class="string">12    NaN</span></span><br><span class="line"><span class="string">13    NaN</span></span><br><span class="line"><span class="string">14    NaN</span></span><br><span class="line"><span class="string">dtype: object</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ffill ： foreaward fill 向前填充，</span></span><br><span class="line"><span class="comment"># 如果新增加索引的值不存在，那么按照前一个非nan的值填充进去</span></span><br><span class="line"><span class="built_in">print</span>(s2.reindex(index=<span class="built_in">range</span>(<span class="number">15</span>), method=<span class="string">&#x27;ffill&#x27;</span>))</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">0     NaN</span></span><br><span class="line"><span class="string">1       A</span></span><br><span class="line"><span class="string">2       A</span></span><br><span class="line"><span class="string">3       A</span></span><br><span class="line"><span class="string">4       A</span></span><br><span class="line"><span class="string">5       B</span></span><br><span class="line"><span class="string">6       B</span></span><br><span class="line"><span class="string">7       B</span></span><br><span class="line"><span class="string">8       B</span></span><br><span class="line"><span class="string">9       B</span></span><br><span class="line"><span class="string">10      C</span></span><br><span class="line"><span class="string">11      C</span></span><br><span class="line"><span class="string">12      C</span></span><br><span class="line"><span class="string">13      C</span></span><br><span class="line"><span class="string">14      C</span></span><br><span class="line"><span class="string">dtype: object</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># reindex dataframe</span></span><br><span class="line">df1 = DataFrame(np.random.rand(<span class="number">25</span>).reshape([<span class="number">5</span>, <span class="number">5</span>]), index=[<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;D&#x27;</span>, <span class="string">&#x27;E&#x27;</span>, <span class="string">&#x27;F&#x27;</span>], columns=[<span class="string">&#x27;c1&#x27;</span>, <span class="string">&#x27;c2&#x27;</span>, <span class="string">&#x27;c3&#x27;</span>, <span class="string">&#x27;c4&#x27;</span>, <span class="string">&#x27;c5&#x27;</span>])</span><br><span class="line"><span class="built_in">print</span>(df1)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">         c1        c2        c3        c4        c5</span></span><br><span class="line"><span class="string">A  0.700437  0.844187  0.676514  0.727858  0.951458</span></span><br><span class="line"><span class="string">B  0.012703  0.413588  0.048813  0.099929  0.508066</span></span><br><span class="line"><span class="string">D  0.200248  0.744154  0.192892  0.700845  0.293228</span></span><br><span class="line"><span class="string">E  0.774479  0.005109  0.112858  0.110954  0.247668</span></span><br><span class="line"><span class="string">F  0.023236  0.727321  0.340035  0.197503  0.909180</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 为 dataframe 添加一个新的索引</span></span><br><span class="line"><span class="comment"># 可以看到 自动 扩充为 nan</span></span><br><span class="line"><span class="built_in">print</span>(df1.reindex(index=[<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;C&#x27;</span>, <span class="string">&#x27;D&#x27;</span>, <span class="string">&#x27;E&#x27;</span>, <span class="string">&#x27;F&#x27;</span>]))</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27; 自动填充为 nan</span></span><br><span class="line"><span class="string">         c1        c2        c3        c4        c5</span></span><br><span class="line"><span class="string">A  0.700437  0.844187  0.676514  0.727858  0.951458</span></span><br><span class="line"><span class="string">B  0.012703  0.413588  0.048813  0.099929  0.508066</span></span><br><span class="line"><span class="string">C       NaN       NaN       NaN       NaN       NaN</span></span><br><span class="line"><span class="string">D  0.200248  0.744154  0.192892  0.700845  0.293228</span></span><br><span class="line"><span class="string">E  0.774479  0.005109  0.112858  0.110954  0.247668</span></span><br><span class="line"><span class="string">F  0.023236  0.727321  0.340035  0.197503  0.909180</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#　扩充列，　也是一样的</span></span><br><span class="line"><span class="built_in">print</span>(df1.reindex(columns=[<span class="string">&#x27;c1&#x27;</span>, <span class="string">&#x27;c2&#x27;</span>, <span class="string">&#x27;c3&#x27;</span>, <span class="string">&#x27;c4&#x27;</span>, <span class="string">&#x27;c5&#x27;</span>, <span class="string">&#x27;c6&#x27;</span>]))</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">         c1        c2        c3        c4        c5  c6</span></span><br><span class="line"><span class="string">A  0.700437  0.844187  0.676514  0.727858  0.951458 NaN</span></span><br><span class="line"><span class="string">B  0.012703  0.413588  0.048813  0.099929  0.508066 NaN</span></span><br><span class="line"><span class="string">D  0.200248  0.744154  0.192892  0.700845  0.293228 NaN</span></span><br><span class="line"><span class="string">E  0.774479  0.005109  0.112858  0.110954  0.247668 NaN</span></span><br><span class="line"><span class="string">F  0.023236  0.727321  0.340035  0.197503  0.909180 NaN</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 减小 index</span></span><br><span class="line"><span class="built_in">print</span>(s1.reindex([<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>]))</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27; 相当于一个切割效果</span></span><br><span class="line"><span class="string">A    1</span></span><br><span class="line"><span class="string">B    2</span></span><br><span class="line"><span class="string">dtype: int64</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(df1.reindex(index=[<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>]))</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27; 同样是一个切片的效果</span></span><br><span class="line"><span class="string">         c1        c2        c3        c4        c5</span></span><br><span class="line"><span class="string">A  0.601977  0.619927  0.251234  0.305101  0.491200</span></span><br><span class="line"><span class="string">B  0.244261  0.734863  0.569936  0.889996  0.017936</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 对于一个 serie 来说，可以使用 drop，来丢掉某些 index</span></span><br><span class="line"><span class="built_in">print</span>(s1.drop(<span class="string">&#x27;A&#x27;</span>))</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27; 就只剩下 三个了</span></span><br><span class="line"><span class="string">B    2</span></span><br><span class="line"><span class="string">C    3</span></span><br><span class="line"><span class="string">D    4</span></span><br><span class="line"><span class="string">dtype: int64</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># dataframe drop(A) 直接去掉一行</span></span><br><span class="line"><span class="built_in">print</span>(df1.drop(<span class="string">&#x27;A&#x27;</span>, axis=<span class="number">0</span>))</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27; axis 默认 是 行</span></span><br><span class="line"><span class="string">         c1        c2        c3        c4        c5</span></span><br><span class="line"><span class="string">B  0.571883  0.254364  0.530883  0.295224  0.352663</span></span><br><span class="line"><span class="string">D  0.858452  0.379495  0.593284  0.786078  0.949718</span></span><br><span class="line"><span class="string">E  0.556276  0.643187  0.808664  0.289422  0.501041</span></span><br><span class="line"><span class="string">F  0.737993  0.286072  0.332714  0.873371  0.421615</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(df1.drop(<span class="string">&#x27;c1&#x27;</span>, axis=<span class="number">1</span>))</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27; 将 c1 的列 去掉</span></span><br><span class="line"><span class="string">         c2        c3        c4        c5</span></span><br><span class="line"><span class="string">A  0.326681  0.247832  0.601982  0.145905</span></span><br><span class="line"><span class="string">B  0.373961  0.393819  0.439284  0.926706</span></span><br><span class="line"><span class="string">D  0.558490  0.617851  0.461280  0.373102</span></span><br><span class="line"><span class="string">E  0.030434  0.566498  0.383103  0.739243</span></span><br><span class="line"><span class="string">F  0.982220  0.989826  0.957863  0.411514</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<p>多个时间序列数据清洗成一列</p>
<p>pivot:制作透视表,接受三个参数:</p>
<ul>
<li>行:用哪个字段作为行</li>
<li>列:用哪个字段作为列</li>
<li>值:用哪个字段作为单元格的值</li>
</ul>
<p><img src="/images/20171012220116977.png" alt="img"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># examples/macrodata.csv的内容为:</span></span><br><span class="line">	<span class="comment"># year,quarter,realgdp,realcons,realinv,realgovt,realdpi,cpi,m1,tbilrate,unemp,pop,infl,realint</span></span><br><span class="line">	<span class="comment"># 1959.0,1.0,2710.349,1707.4,286.898,470.045,1886.9,28.98,139.7,2.82,5.8,177.146,0.0,0.0</span></span><br><span class="line">	<span class="comment"># 1959.0,2.0,2778.801,1733.7,310.859,481.301,1919.7,29.15,141.7,3.08,5.1,177.83,2.34,0.74</span></span><br><span class="line">	<span class="comment"># 1959.0,3.0,2775.488,1751.8,289.226,491.26,1916.4,29.35,140.5,3.82,5.3,178.657,2.74,1.09</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">data = pd.read_csv(<span class="string">&#x27;examples/macrodata.csv&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(data.head())</span><br><span class="line"><span class="comment">#      year  quarter   realgdp  realcons   ...     unemp      pop  infl  realint</span></span><br><span class="line"><span class="comment"># 0  1959.0      1.0  2710.349    1707.4   ...       5.8  177.146  0.00     0.00</span></span><br><span class="line"><span class="comment"># 1  1959.0      2.0  2778.801    1733.7   ...       5.1  177.830  2.34     0.74</span></span><br><span class="line"><span class="comment"># 2  1959.0      3.0  2775.488    1751.8   ...       5.3  178.657  2.74     1.09</span></span><br><span class="line"><span class="comment"># 3  1959.0      4.0  2785.204    1753.7   ...       5.6  179.386  0.27     4.06</span></span><br><span class="line"><span class="comment"># 4  1960.0      1.0  2847.699    1770.5   ...       5.2  180.007  2.31     1.19</span></span><br><span class="line"><span class="comment"># [5 rows x 14 columns]</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">periods = pd.PeriodIndex(year=data.year, quarter=data.quarter,name=<span class="string">&#x27;date&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(periods)</span><br><span class="line"><span class="comment"># PeriodIndex([&#x27;1959Q1&#x27;, &#x27;1959Q2&#x27;, &#x27;1959Q3&#x27;, &#x27;1959Q4&#x27;, &#x27;1960Q1&#x27;, &#x27;1960Q2&#x27;,</span></span><br><span class="line"><span class="comment">#              &#x27;1960Q3&#x27;, &#x27;1960Q4&#x27;, &#x27;1961Q1&#x27;, &#x27;1961Q2&#x27;,</span></span><br><span class="line"><span class="comment">#              ...</span></span><br><span class="line"><span class="comment">#              &#x27;2007Q2&#x27;, &#x27;2007Q3&#x27;, &#x27;2007Q4&#x27;, &#x27;2008Q1&#x27;, &#x27;2008Q2&#x27;, &#x27;2008Q3&#x27;,</span></span><br><span class="line"><span class="comment">#              &#x27;2008Q4&#x27;, &#x27;2009Q1&#x27;, &#x27;2009Q2&#x27;, &#x27;2009Q3&#x27;],</span></span><br><span class="line"><span class="comment">#             dtype=&#x27;period[Q-DEC]&#x27;, name=&#x27;date&#x27;, length=203, freq=&#x27;Q-DEC&#x27;)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">columns = pd.Index([<span class="string">&#x27;realgdp&#x27;</span>, <span class="string">&#x27;infl&#x27;</span>, <span class="string">&#x27;unemp&#x27;</span>], name=<span class="string">&#x27;item&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(columns)</span><br><span class="line"><span class="comment"># Index([&#x27;realgdp&#x27;, &#x27;infl&#x27;, &#x27;unemp&#x27;], dtype=&#x27;object&#x27;, name=&#x27;item&#x27;)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">data = data.reindex(columns=columns)</span><br><span class="line">data.index = periods.to_timestamp(<span class="string">&#x27;D&#x27;</span>, <span class="string">&#x27;end&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(data.index)</span><br><span class="line"><span class="comment"># DatetimeIndex([&#x27;1959-03-31&#x27;, &#x27;1959-06-30&#x27;, &#x27;1959-09-30&#x27;, &#x27;1959-12-31&#x27;,</span></span><br><span class="line"><span class="comment">#                &#x27;1960-03-31&#x27;, &#x27;1960-06-30&#x27;, &#x27;1960-09-30&#x27;, &#x27;1960-12-31&#x27;,</span></span><br><span class="line"><span class="comment">#                &#x27;1961-03-31&#x27;, &#x27;1961-06-30&#x27;,</span></span><br><span class="line"><span class="comment">#                ...</span></span><br><span class="line"><span class="comment">#                &#x27;2007-06-30&#x27;, &#x27;2007-09-30&#x27;, &#x27;2007-12-31&#x27;, &#x27;2008-03-31&#x27;,</span></span><br><span class="line"><span class="comment">#                &#x27;2008-06-30&#x27;, &#x27;2008-09-30&#x27;, &#x27;2008-12-31&#x27;, &#x27;2009-03-31&#x27;,</span></span><br><span class="line"><span class="comment">#                &#x27;2009-06-30&#x27;, &#x27;2009-09-30&#x27;],</span></span><br><span class="line"><span class="comment">#               dtype=&#x27;datetime64[ns]&#x27;, name=&#x27;date&#x27;, length=203, freq=&#x27;Q-DEC&#x27;)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># reset_index():重新索引,就是把将行索引变回RangeIndex.(原来行索引变成列,如果开启drop=True,那么将直接抛弃原行索引)</span></span><br><span class="line">ldata = data.stack().reset_index().rename(columns=&#123;<span class="number">0</span>: <span class="string">&#x27;value&#x27;</span>&#125;)</span><br><span class="line"><span class="built_in">print</span>(ldata)</span><br><span class="line"><span class="comment">#           date     item      value</span></span><br><span class="line"><span class="comment"># 0   1959-03-31  realgdp   2710.349</span></span><br><span class="line"><span class="comment"># 1   1959-03-31     infl      0.000</span></span><br><span class="line"><span class="comment"># 2   1959-03-31    unemp      5.800</span></span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line"><span class="comment"># 606 2009-09-30  realgdp  12990.341</span></span><br><span class="line"><span class="comment"># 607 2009-09-30     infl      3.560</span></span><br><span class="line"><span class="comment"># 608 2009-09-30    unemp      9.600</span></span><br><span class="line"><span class="comment"># [609 rows x 3 columns]</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># pivot:制作透视表,行为date,列为item,值为value</span></span><br><span class="line">pivoted = ldata.pivot(index=<span class="string">&#x27;date&#x27;</span>,columns=<span class="string">&#x27;item&#x27;</span>, values=<span class="string">&#x27;value&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(pivoted)</span><br><span class="line"><span class="comment"># item        infl    realgdp  unemp</span></span><br><span class="line"><span class="comment"># date                              </span></span><br><span class="line"><span class="comment"># 1959-03-31  0.00   2710.349    5.8</span></span><br><span class="line"><span class="comment"># 1959-06-30  2.34   2778.801    5.1</span></span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line"><span class="comment"># 2009-06-30  3.37  12901.504    9.2</span></span><br><span class="line"><span class="comment"># 2009-09-30  3.56  12990.341    9.6</span></span><br><span class="line"><span class="comment"># [203 rows x 3 columns]</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">np.random.seed(<span class="number">666</span>)</span><br><span class="line"></span><br><span class="line">ldata[<span class="string">&#x27;value2&#x27;</span>] = np.random.randn(<span class="built_in">len</span>(ldata))</span><br><span class="line"><span class="built_in">print</span>(ldata[:<span class="number">5</span>])</span><br><span class="line"><span class="comment">#         date     item     value    value2</span></span><br><span class="line"><span class="comment"># 0 1959-03-31  realgdp  2710.349  0.824188</span></span><br><span class="line"><span class="comment"># 1 1959-03-31     infl     0.000  0.479966</span></span><br><span class="line"><span class="comment"># 2 1959-03-31    unemp     5.800  1.173468</span></span><br><span class="line"><span class="comment"># 3 1959-06-30  realgdp  2778.801  0.909048</span></span><br><span class="line"><span class="comment"># 4 1959-06-30     infl     2.340 -0.571721</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 带有层次化的列 的透视表：</span></span><br><span class="line">pivoted = ldata.pivot(<span class="string">&#x27;date&#x27;</span>, <span class="string">&#x27;item&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(pivoted[:<span class="number">5</span>])</span><br><span class="line">           value                    value2                    </span><br><span class="line"><span class="comment"># item        infl   realgdp unemp      infl   realgdp     unemp</span></span><br><span class="line"><span class="comment"># date                                                          </span></span><br><span class="line"><span class="comment"># 1959-03-31  0.00  2710.349   5.8  0.479966  0.824188  1.173468</span></span><br><span class="line"><span class="comment"># 1959-06-30  2.34  2778.801   5.1 -0.571721  0.909048 -0.109497</span></span><br><span class="line"><span class="comment"># 1959-09-30  2.74  2775.488   5.3 -0.943761  0.019028  0.640573</span></span><br><span class="line"><span class="comment"># 1959-12-31  0.27  2785.204   5.6  0.608870 -0.786443 -0.931012</span></span><br><span class="line"><span class="comment"># 1960-03-31  2.31  2847.699   5.2 -0.736918  0.978222 -0.298733</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(pivoted[<span class="string">&#x27;value&#x27;</span>][:<span class="number">5</span>])</span><br><span class="line"><span class="comment"># item        infl   realgdp  unemp</span></span><br><span class="line"><span class="comment"># date                             </span></span><br><span class="line"><span class="comment"># 1959-03-31  0.00  2710.349    5.8</span></span><br><span class="line"><span class="comment"># 1959-06-30  2.34  2778.801    5.1</span></span><br><span class="line"><span class="comment"># 1959-09-30  2.74  2775.488    5.3</span></span><br><span class="line"><span class="comment"># 1959-12-31  0.27  2785.204    5.6</span></span><br><span class="line"><span class="comment"># 1960-03-31  2.31  2847.699    5.2</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 注意，pivot其实就是⽤set_index创建层次化索引，再⽤unstack重塑：</span></span><br><span class="line">unstacked = ldata.set_index([<span class="string">&#x27;date&#x27;</span>, <span class="string">&#x27;item&#x27;</span>]).unstack(<span class="string">&#x27;item&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(unstacked[:<span class="number">5</span>])</span><br><span class="line"><span class="comment">#            value                    value2                    </span></span><br><span class="line"><span class="comment"># item        infl   realgdp unemp      infl   realgdp     unemp</span></span><br><span class="line"><span class="comment"># date                                                          </span></span><br><span class="line"><span class="comment"># 1959-03-31  0.00  2710.349   5.8  0.479966  0.824188  1.173468</span></span><br><span class="line"><span class="comment"># 1959-06-30  2.34  2778.801   5.1 -0.571721  0.909048 -0.109497</span></span><br><span class="line"><span class="comment"># 1959-09-30  2.74  2775.488   5.3 -0.943761  0.019028  0.640573</span></span><br><span class="line"><span class="comment"># 1959-12-31  0.27  2785.204   5.6  0.608870 -0.786443 -0.931012</span></span><br><span class="line"><span class="comment"># 1960-03-31  2.31  2847.699   5.2 -0.736918  0.978222 -0.298733</span></span><br></pre></td></tr></table></figure>



<p>将“宽格式”旋转为“⻓格式”(<strong>逆透视</strong>)</p>
<p>旋转DataFrame的逆运算是pandas.melt。</p>
<p>它合并多个列成为⼀个，产⽣⼀个⽐输⼊⻓的DataFrame。</p>
<p>参数：<br><code>pandas.melt(frame, id_vars=None, value_vars=None, var_name=None, value_name=&#39;value&#39;, col_level=None)</code></p>
<ul>
<li>frame:<br>要处理的数据集。</li>
<li>id_vars:<br>不需要被转换的列名。</li>
<li>value_vars:<br>需要转换的列名，如果剩下的列全部都要转换，就不用写了。</li>
<li>var_name和value_name:<br>是自定义设置对应的列名。</li>
<li>col_level :<br>如果列是MultiIndex，则使用此级别。</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">df = pd.DataFrame(&#123;<span class="string">&#x27;key&#x27;</span>: [<span class="string">&#x27;foo&#x27;</span>, <span class="string">&#x27;bar&#x27;</span>, <span class="string">&#x27;baz&#x27;</span>],</span><br><span class="line">                   <span class="string">&#x27;A&#x27;</span>: [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>],</span><br><span class="line">                   <span class="string">&#x27;B&#x27;</span>: [<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>],</span><br><span class="line">                   <span class="string">&#x27;C&#x27;</span>: [<span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>]&#125;)</span><br><span class="line"><span class="built_in">print</span>(df)</span><br><span class="line"><span class="comment">#    key  A  B  C</span></span><br><span class="line"><span class="comment"># 0  foo  1  4  7</span></span><br><span class="line"><span class="comment"># 1  bar  2  5  8</span></span><br><span class="line"><span class="comment"># 2  baz  3  6  9</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># melt:逆透视</span></span><br><span class="line"><span class="comment"># id_vars:不需要转换的列</span></span><br><span class="line">melted = pd.melt(df, id_vars=[<span class="string">&#x27;key&#x27;</span>])</span><br><span class="line"><span class="built_in">print</span>(melted)</span><br><span class="line"><span class="comment">#    key variable  value</span></span><br><span class="line"><span class="comment"># 0  foo        A      1</span></span><br><span class="line"><span class="comment"># 1  bar        A      2</span></span><br><span class="line"><span class="comment"># 2  baz        A      3</span></span><br><span class="line"><span class="comment"># 3  foo        B      4</span></span><br><span class="line"><span class="comment"># 4  bar        B      5</span></span><br><span class="line"><span class="comment"># 5  baz        B      6</span></span><br><span class="line"><span class="comment"># 6  foo        C      7</span></span><br><span class="line"><span class="comment"># 7  bar        C      8</span></span><br><span class="line"><span class="comment"># 8  baz        C      9</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># pivot:数据透视</span></span><br><span class="line">reshaped = melted.pivot(<span class="string">&#x27;key&#x27;</span>, <span class="string">&#x27;variable&#x27;</span>, <span class="string">&#x27;value&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(reshaped)</span><br><span class="line"><span class="comment"># variable  A  B  C</span></span><br><span class="line"><span class="comment"># key              </span></span><br><span class="line"><span class="comment"># bar       2  5  8</span></span><br><span class="line"><span class="comment"># baz       3  6  9</span></span><br><span class="line"><span class="comment"># foo       1  4  7</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># pivot数据透视其实也是一种创建索引的过程</span></span><br><span class="line"><span class="comment"># 所以可以使用set_index复原</span></span><br><span class="line"><span class="built_in">print</span>(reshaped.reset_index())</span><br><span class="line"><span class="comment"># variable  key  A  B  C</span></span><br><span class="line"><span class="comment"># 0         bar  2  5  8</span></span><br><span class="line"><span class="comment"># 1         baz  3  6  9</span></span><br><span class="line"><span class="comment"># 2         foo  1  4  7</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># id_vars:不需要被转换的列名</span></span><br><span class="line"><span class="comment"># value_vars:需要转换的列名</span></span><br><span class="line"><span class="built_in">print</span>(pd.melt(df, id_vars=[<span class="string">&#x27;key&#x27;</span>], value_vars=[<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>]))</span><br><span class="line"><span class="comment">#    key variable  value</span></span><br><span class="line"><span class="comment"># 0  foo        A      1</span></span><br><span class="line"><span class="comment"># 1  bar        A      2</span></span><br><span class="line"><span class="comment"># 2  baz        A      3</span></span><br><span class="line"><span class="comment"># 3  foo        B      4</span></span><br><span class="line"><span class="comment"># 4  bar        B      5</span></span><br><span class="line"><span class="comment"># 5  baz        B      6</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># value_vars:需要转换的列名</span></span><br><span class="line"><span class="built_in">print</span>(pd.melt(df, value_vars=[<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;C&#x27;</span>]))</span><br><span class="line"><span class="comment">#   variable  value</span></span><br><span class="line"><span class="comment"># 0        A      1</span></span><br><span class="line"><span class="comment"># 1        A      2</span></span><br><span class="line"><span class="comment"># 2        A      3</span></span><br><span class="line"><span class="comment"># 3        B      4</span></span><br><span class="line"><span class="comment"># 4        B      5</span></span><br><span class="line"><span class="comment"># 5        B      6</span></span><br><span class="line"><span class="comment"># 6        C      7</span></span><br><span class="line"><span class="comment"># 7        C      8</span></span><br><span class="line"><span class="comment"># 8        C      9</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># value_vars:需要转换的列名</span></span><br><span class="line"><span class="built_in">print</span>(pd.melt(df, value_vars=[<span class="string">&#x27;key&#x27;</span>, <span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>]))</span><br><span class="line"><span class="comment">#   variable value</span></span><br><span class="line"><span class="comment"># 0      key   foo</span></span><br><span class="line"><span class="comment"># 1      key   bar</span></span><br><span class="line"><span class="comment"># 2      key   baz</span></span><br><span class="line"><span class="comment"># 3        A     1</span></span><br><span class="line"><span class="comment"># 4        A     2</span></span><br><span class="line"><span class="comment"># 5        A     3</span></span><br><span class="line"><span class="comment"># 6        B     4</span></span><br><span class="line"><span class="comment"># 7        B     5</span></span><br><span class="line"><span class="comment"># 8        B     6</span></span><br></pre></td></tr></table></figure>



</div></div><div class="post-main post-comment"></div></article><link rel="stylesheet" type="text/css" href="/css/font.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.css"><script src="//cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script><script src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script>$(document).ready(function() {
  $(".fancybox").fancybox();
});
</script></body></html>
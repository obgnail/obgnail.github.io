<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content=" id=&quot;NginxLNMP动态网站&quot;&gt;&lt;a href=&quot;#NginxLNMP动态网站&quot; class=&quot;headerlink&quot; title=&quot;NginxLNMP动态网站&quot;&gt;&lt;/a&gt;NginxLNMP动态网站&lt;/h1&gt;&lt;ol&gt;
&lt;li&gt;安装LNMP架构&lt;/li&gt;
&lt;li&gt;配置LNMP架构&lt;/li&gt;
&lt;li&gt;检测LNMP架构&lt;/li&gt;
&lt;li&gt;Nginx与PHP原理&lt;/li&gt;
&lt;li&gt;PHP配置⽂件优化&lt;ul&gt;
&lt;li&gt;php-ini优化&lt;/li&gt;
&lt;li&gt;php-fpm优化&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&quot;配置LNMP架构&quot;&gt;&lt;a href=&quot;#配置LNMP架构&quot; class=&quot;headerlink&quot; title=&quot;配置LNMP架构&quot;&gt;&lt;/a&gt;配置LNMP架构&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;配置 Nginx 实现动态请求转发⾄ php&lt;/li&gt;
&lt;/ol&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;server &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	server_name _;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	listen 80;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	root /soft/code;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	index index.php index.html;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	location ~ \.php$ &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		fastcgi_pass 127.0.0.1:9000;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		fastcgi_index index.php;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		fastcgi_param SCRIPT_FILENAME /soft/code&lt;span class=&quot;variable&quot;&gt;$fastcgi_script_name&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		include fastcgi_params;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;



&lt;ol start=&quot;2&quot;&gt;
&lt;li&gt;添加 php 测试⻚⾯&lt;/li&gt;
&lt;/ol&gt;
&lt;figure class=&quot;highlight php&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;&amp;lt;?php&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    phpinfo();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;?&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;使⽤mysqli模块测试连接mysql"><link rel="stylesheet" type="text/css" href="/css/normalize.css"><link rel="stylesheet" type="text/css" href="/css/highlight.css"><link rel="stylesheet" type="text/css" href="/css/noise.css"><title>NginxLNMP动态⽹站 | 凉薄的自动书记人偶</title><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><meta name="generator" content="Hexo 5.4.0"></head><body><article class="wrapper"><div class="post-main"><div class="nav"><nav class="container"><a class="sidebar-nav-item active" href="/">Home</a><a class="sidebar-nav-item" href="/archives">Tags</a><a class="sidebar-nav-item" href="/About">About</a></nav><div class="container post-meta"><div class="post-tags"><a class="post-tag-link" href="/tags/Nginx/" rel="tag">Nginx</a></div><div class="post-time">2019-12-09</div></div></div><div class="container post-header"><h1>NginxLNMP动态⽹站</h1></div><div class="container post-toc"><details class="toc"><summary class="toc-accordion">Table of Contents</summary><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#NginxLNMP%E5%8A%A8%E6%80%81%E7%BD%91%E7%AB%99"><span class="toc-number">1.</span> <span class="toc-text">NginxLNMP动态网站</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%85%8D%E7%BD%AELNMP%E6%9E%B6%E6%9E%84"><span class="toc-number">1.1.</span> <span class="toc-text">配置LNMP架构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Nginx%E4%B8%8EPHP%E5%8E%9F%E7%90%86"><span class="toc-number">1.2.</span> <span class="toc-text">Nginx与PHP原理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#PHP%E9%85%8D%E7%BD%AE%E2%BD%82%E4%BB%B6%E4%BC%98%E5%8C%96"><span class="toc-number">1.3.</span> <span class="toc-text">PHP配置⽂件优化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#php-ini%E4%BC%98%E5%8C%96"><span class="toc-number">1.3.1.</span> <span class="toc-text">php-ini优化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#php-fpm%E4%BC%98%E5%8C%96"><span class="toc-number">1.3.2.</span> <span class="toc-text">php-fpm优化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PHP5-FPM%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3%E9%87%8A"><span class="toc-number">1.3.3.</span> <span class="toc-text">PHP5-FPM配置详解释</span></a></li></ol></li></ol></li></ol></details></div><div class="container post-content"><h1 id="NginxLNMP动态网站"><a href="#NginxLNMP动态网站" class="headerlink" title="NginxLNMP动态网站"></a>NginxLNMP动态网站</h1><ol>
<li>安装LNMP架构</li>
<li>配置LNMP架构</li>
<li>检测LNMP架构</li>
<li>Nginx与PHP原理</li>
<li>PHP配置⽂件优化<ul>
<li>php-ini优化</li>
<li>php-fpm优化</li>
</ul>
</li>
</ol>
<h2 id="配置LNMP架构"><a href="#配置LNMP架构" class="headerlink" title="配置LNMP架构"></a>配置LNMP架构</h2><ol>
<li>配置 Nginx 实现动态请求转发⾄ php</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">	server_name _;</span><br><span class="line">	listen 80;</span><br><span class="line">	root /soft/code;</span><br><span class="line">	index index.php index.html;</span><br><span class="line">	location ~ \.php$ &#123;</span><br><span class="line">		fastcgi_pass 127.0.0.1:9000;</span><br><span class="line">		fastcgi_index index.php;</span><br><span class="line">		fastcgi_param SCRIPT_FILENAME /soft/code<span class="variable">$fastcgi_script_name</span>;</span><br><span class="line">		include fastcgi_params;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<ol start="2">
<li>添加 php 测试⻚⾯</li>
</ol>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    phpinfo();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>使⽤mysqli模块测试连接mysql</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat	/soft/code/mysqli.php</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="variable">$servername</span> = <span class="string">&quot;localhost&quot;</span>;</span><br><span class="line">    <span class="variable">$username</span> = <span class="string">&quot;root&quot;</span>;</span><br><span class="line">    <span class="variable">$password</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建连接</span></span><br><span class="line">    <span class="variable">$conn</span> = mysqli_connect(<span class="variable">$servername</span>, <span class="variable">$username</span>, <span class="variable">$password</span>);</span><br><span class="line">    <span class="comment">// 检测连接</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="variable">$conn</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;Connection failed: &quot;</span> . mysqli_connect_error());</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;连接成功&quot;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>使⽤pdo模块测试连接mysql</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat	/soft/code/mysqlpdo.php</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="variable">$servername</span> = <span class="string">&quot;localhost&quot;</span>;</span><br><span class="line">    <span class="variable">$username</span> = <span class="string">&quot;root&quot;</span>;</span><br><span class="line">     <span class="variable">$password</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="variable">$conn</span> =  <span class="keyword">new</span>  PDO(<span class="string">&quot;mysql:host=<span class="subst">$servername</span>;dbname=test&quot;</span>, <span class="variable">$username</span>, <span class="variable">$password</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;连接成功&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span>(PDOException <span class="variable">$e</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$e</span>-&gt;getMessage();</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>



<ol start="3">
<li>检测LNMP架构</li>
</ol>
<ul>
<li>访问<code>47.104.250169/info.php</code></li>
<li>访问<code>47.104.250169/mysqli.php</code></li>
<li>访问<code>47.104.250169/mysqli.php</code></li>
</ul>
<h2 id="Nginx与PHP原理"><a href="#Nginx与PHP原理" class="headerlink" title="Nginx与PHP原理"></a>Nginx与PHP原理</h2><p><img src="/images/1575796929911.png" alt="1575796929911"></p>
<p>nginx fastcgi 访问 php</p>
<ol>
<li>⽤户发送http请求报⽂给nginx服务器</li>
<li>nginx会根据⽂件url和后缀来判断请求</li>
<li>如果请求的是静态内容,nginx会将结果直接返回给⽤户</li>
<li>如果请求的是动态内容,nginx会将请求交给<code>fastcgi客户端</code>,通过fastcgi_pass将这个请求发送给php-fpm</li>
<li>php-fpm收到请求后会通过本地监听的socket交给wrapper</li>
<li>wrapper收到请求会⽣成<strong>新的线程</strong>调⽤php动态程序解析服务器</li>
<li>如果⽤户请求的是博⽂、或者内容、PHP会请求MySQL查询结果</li>
<li>如果⽤户请求的是图⽚、附件、PHP会请求nfs存储查询结果</li>
<li>php会将查询到的结果交给Nginx</li>
<li>nginx会⽣成⼀个响应报⽂返还给⽤户</li>
</ol>
<h2 id="PHP配置⽂件优化"><a href="#PHP配置⽂件优化" class="headerlink" title="PHP配置⽂件优化"></a>PHP配置⽂件优化</h2><h3 id="php-ini优化"><a href="#php-ini优化" class="headerlink" title="php-ini优化"></a>php-ini优化</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 打开php的安全模式,控制php执⾏危险函数, 默认是Off,改为On</span></span><br><span class="line">sql.safe_mode = Off</span><br><span class="line"><span class="comment"># 关闭php头部信息, 隐藏版本号, 默认是On,该为Off</span></span><br><span class="line">expose_php = On</span><br><span class="line"><span class="comment"># 错误信息输出控制</span></span><br><span class="line">display_error = Off</span><br><span class="line">error_reporting = E_WARNING &amp; E_ERROR</span><br><span class="line"><span class="comment"># 记录错误⽇志⾄后台, ⽅便追溯</span></span><br><span class="line">log_errors = On</span><br><span class="line">error_log =  /var/<span class="built_in">log</span>/php_error.log</span><br><span class="line"><span class="comment"># 每个脚本时间最⼤内存</span></span><br><span class="line">memory_limit = 128M</span><br><span class="line"><span class="comment"># 上传⽂件最⼤许可,默认2M, 建议调整为16,32M</span></span><br><span class="line">upload_max_filesize = 2M</span><br><span class="line"><span class="comment"># 禁⽌远程执⾏phpshell,默认On, 建议Off</span></span><br><span class="line">allow_url_fopen = On</span><br><span class="line"><span class="comment"># 时区调整,默认PRC, 建议调整为Asia/Shanghai</span></span><br><span class="line">date.timezone = PRC</span><br><span class="line"><span class="comment"># 整体优化后配置⽂件</span></span><br><span class="line">sql.safe_mode = Off</span><br><span class="line">expose_php = Off</span><br><span class="line">display_error = Off</span><br><span class="line">error_reporting = E_WARNING &amp; E_ERROR</span><br><span class="line">log_errors = On</span><br><span class="line">error_log = /var/<span class="built_in">log</span>/php_error.log</span><br><span class="line">upload_max_filesize = 50M</span><br><span class="line">allow_url_fopen = Off</span><br><span class="line">date.timezone = Asia/Shanghai</span><br></pre></td></tr></table></figure>



<h3 id="php-fpm优化"><a href="#php-fpm优化" class="headerlink" title="php-fpm优化"></a>php-fpm优化</h3><p>PHP-FPM配置⽂件 4核16G、8核16G</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /etc/php-fpm.d/www.conf</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">[global]</span><br><span class="line">pid = /var/run/php-fpm.pid</span><br><span class="line"><span class="comment">#php-fpm程序错误⽇志</span></span><br><span class="line">error_log = /var/<span class="built_in">log</span>/php/php-fpm.log</span><br><span class="line">log_level = warning</span><br><span class="line">rlimit_files = 655350</span><br><span class="line">events.mechanism = epoll</span><br><span class="line">[www]</span><br><span class="line">user = nginx</span><br><span class="line">group = nginx</span><br><span class="line">listen = 127.0.0.1:9000</span><br><span class="line">listen.owner = www</span><br><span class="line">listen.group = www</span><br><span class="line">listen.mode = 0660</span><br><span class="line">listen.allowed_clients = 127.0.0.1</span><br><span class="line">pm = dynamic</span><br><span class="line">pm.max_children = 512</span><br><span class="line">pm.start_servers = 10</span><br><span class="line">pm.min_spare_servers = 10</span><br><span class="line">pm.max_spare_servers = 30</span><br><span class="line">pm.process_idle_timeout = 15s;</span><br><span class="line">pm.max_requests = 2048</span><br><span class="line"><span class="comment">#php-www模块错误⽇志</span></span><br><span class="line">php_flag[display_errors] = off</span><br><span class="line">php_admin_value[error_log] = /var/<span class="built_in">log</span>/php/php-www.log</span><br><span class="line">php_admin_flag[log_errors] = on</span><br><span class="line"><span class="comment">#php慢查询⽇志</span></span><br><span class="line">request_slowlog_timeout = 5s</span><br><span class="line">slowlog = /var/<span class="built_in">log</span>/php/php-slow.log</span><br></pre></td></tr></table></figure>



<h3 id="PHP5-FPM配置详解释"><a href="#PHP5-FPM配置详解释" class="headerlink" title="PHP5-FPM配置详解释"></a>PHP5-FPM配置详解释</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">[global]</span><br><span class="line"><span class="comment">#pid设置,	记录程序启动后pid</span></span><br><span class="line">pid = /var/run/php-fpm.pid</span><br><span class="line"><span class="comment">#php-fpm程序启动错误⽇志路径</span></span><br><span class="line">error_log = /soft/<span class="built_in">log</span>/php/php-fpm_error.log</span><br><span class="line"><span class="comment"># 错误级别. 可⽤级别为: alert （必须⽴即处理）,error（错误情况）, warning（警告情况）,notice（⼀般重要信息）, debug（调试信息）. 默认: notice.</span></span><br><span class="line">log_level = warning</span><br><span class="line"><span class="comment">#设置⽂件打开描述符的rlimit限制.</span></span><br><span class="line">rlimit_files = 65535</span><br><span class="line">events.mechanism = epoll</span><br><span class="line"><span class="comment">#启动进程的⽤户和组</span></span><br><span class="line">[www]</span><br><span class="line">user = www</span><br><span class="line">group = www</span><br><span class="line"><span class="comment"># fpm监听端⼝</span></span><br><span class="line">listen = 127.0.0.1:9000</span><br><span class="line"><span class="comment"># unix socket设置选项，如果使⽤tcp⽅式访问，这⾥注释即可。</span></span><br><span class="line">listen.owner = www</span><br><span class="line">listen.group = www</span><br><span class="line"><span class="comment"># 允许访问FastCGI进程的IP，any不限制</span></span><br><span class="line">listen.allowed_clients = 127.0.0.1</span><br><span class="line"><span class="comment"># pm设置动态调度</span></span><br><span class="line">pm = dynamic</span><br><span class="line"><span class="comment"># 同⼀时刻最⼤的php-fpm⼦进程数量</span></span><br><span class="line">pm.max_children = 200</span><br><span class="line"><span class="comment"># 动态⽅式下的起始php-fpm进程数量</span></span><br><span class="line">pm.start_servers = 20</span><br><span class="line"><span class="comment"># 动态⽅式下服务器空闲时最⼩php-fpm进程数量</span></span><br><span class="line">pm.min_spare_servers = 10</span><br><span class="line"><span class="comment"># 动态⽅式下服务器空闲时最⼤php-fpm进程数量</span></span><br><span class="line">pm.max_spare_servers = 30</span><br><span class="line"><span class="comment"># 最⼤请求</span></span><br><span class="line">pm.max_requests = 1024</span><br><span class="line">pm.process_idle_timeout = 15s;</span><br><span class="line"><span class="comment"># FPM状态⻚⾯,⽤于监控php-fpm状态使⽤</span></span><br><span class="line">pm.status_path = /status</span><br><span class="line"><span class="comment"># 错误⽇志</span></span><br><span class="line">php_flag[display_errors] = off</span><br><span class="line">php_admin_value[error_log] = /soft/<span class="built_in">log</span>/php/php-www_error.log</span><br><span class="line">php_admin_flag[log_errors] = on</span><br><span class="line"><span class="comment"># 配置php慢查询, 以及慢查询记录⽇志位置</span></span><br><span class="line">request_slowlog_timeout = 5s</span><br><span class="line">slowlog = /soft/<span class="built_in">log</span>/php/php-slow.log</span><br></pre></td></tr></table></figure>









</div></div></article><link rel="stylesheet" type="text/css" href="/css/font.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.css"><script src="//cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script><script src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script>$(document).ready(function() {
  $(".fancybox").fancybox();
});
</script></body></html>
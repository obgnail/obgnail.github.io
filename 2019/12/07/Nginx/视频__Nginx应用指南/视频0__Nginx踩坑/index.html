<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content=" id=&quot;location中的Index&quot;&gt;&lt;a href=&quot;#location中的Index&quot; class=&quot;headerlink&quot; title=&quot;location中的Index&quot;&gt;&lt;/a&gt;location中的Index&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;该指令拥有默认值，&lt;code&gt;index index.html&lt;/code&gt; ，即，如果没有给出index，默认初始页为index.html&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;server &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    listen      80;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    server_name example.org www.example.org;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    location / &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        root    /data/www;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        index   index.html index.php;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    location ~ \.php$ &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        root    /data/www/&lt;span class=&quot;built_in&quot;&gt;test&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;

&lt;p&gt;上面的例子中，"><link rel="stylesheet" type="text/css" href="/css/normalize.css"><link rel="stylesheet" type="text/css" href="/css/highlight.css"><link rel="stylesheet" type="text/css" href="/css/noise.css"><title>Nginx踩坑 | 凉薄的自动书记人偶</title><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><meta name="generator" content="Hexo 5.4.0"></head><body><article class="wrapper"><div class="post-main"><div class="nav"><nav class="container"><a class="sidebar-nav-item active" href="/">Home</a><a class="sidebar-nav-item" href="/archives">Tags</a><a class="sidebar-nav-item" href="/About">About</a></nav><div class="container post-meta"><div class="post-tags"><a class="post-tag-link" href="/tags/Nginx/" rel="tag">Nginx</a></div><div class="post-time">2019-12-07</div></div></div><div class="container post-header"><h1>Nginx踩坑</h1></div><div class="container post-toc"><details class="toc"><summary class="toc-accordion">Table of Contents</summary><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#location%E4%B8%AD%E7%9A%84Index"><span class="toc-number">1.</span> <span class="toc-text">location中的Index</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B5%8B%E8%AF%95%E6%8C%87%E5%AE%9A%E7%9A%84Nginx%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">2.</span> <span class="toc-text">测试指定的Nginx配置文件</span></a></li></ol></details></div><div class="container post-content"><h2 id="location中的Index"><a href="#location中的Index" class="headerlink" title="location中的Index"></a>location中的Index</h2><ul>
<li>该指令拥有默认值，<code>index index.html</code> ，即，如果没有给出index，默认初始页为index.html</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen      80;</span><br><span class="line">    server_name example.org www.example.org;    </span><br><span class="line">    </span><br><span class="line">    location / &#123;</span><br><span class="line">        root    /data/www;</span><br><span class="line">        index   index.html index.php;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    location ~ \.php$ &#123;</span><br><span class="line">        root    /data/www/<span class="built_in">test</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面的例子中，</p>
<ol>
<li>如果你使用example.org或<a target="_blank" rel="noopener" href="http://www.example.org直接发起请求,那么首先会访问到“/%E2%80%9D%E7%9A%84location%EF%BC%8C">www.example.org直接发起请求，那么首先会访问到“/”的location，</a></li>
<li>结合root与index指令，会先判断/data/www/index.html是否存在，<ul>
<li>如果不存在，则接着查看/data/www/index.php ，</li>
<li>如果存在，则使用/index.php发起内部重定向，就像从客户端再一次发起请求一样，Nginx会再一次搜索location，毫无疑问匹配到第二个~ .php$，从而访问到/data/www/test/index.php。</li>
</ul>
</li>
</ol>
<blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">location / &#123;</span><br><span class="line"><span class="comment">#           alias  /screct_user/;</span></span><br><span class="line"> index  /screct_user/index.html;</span><br><span class="line"> autoindex on;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在没有alias或者root的情况下 , 访问的<code>/</code>就会映射到目录<code>/usr/html/</code> ,所以会指向<code>/usr/html/screct_user/index.html</code> ,文件不存在 , 返回404</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">location / &#123;</span><br><span class="line"><span class="comment">#           alias  /screct_user/;</span></span><br><span class="line"><span class="comment">#  index  /screct_user/index.html;</span></span><br><span class="line"><span class="comment">#  autoindex on;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在没有alias或者root的情况下 , 访问的<code>/</code>就会映射到目录<code>/usr/html/</code> , index的默认值是<code>index.html</code> , 所以会使用<code>/usr/html/index.html</code> , 即返回nginx默认的初始页.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">location / &#123;</span><br><span class="line"> <span class="built_in">alias</span>  /screct_user/;</span><br><span class="line"><span class="comment">#  index  /screct_user/index.html;</span></span><br><span class="line"><span class="comment">#  autoindex on;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>有alias , 访问的<code>/</code>就会映射到目录<code>/screct_user/</code> ,  index的默认值是<code>index.html</code> , 所以会使用<code>/screct_user/index.html</code></p>
</blockquote>
<p>总结:</p>
<ul>
<li>index的默认值是<code>index.html</code> , </li>
<li>index使用的是相对路径 , 如果没有alias或者root , 那么就是<code>/usr/html</code> , 如果有alias或者root , 那么index就是基于该路径的相对路径</li>
</ul>
<h2 id="测试指定的Nginx配置文件"><a href="#测试指定的Nginx配置文件" class="headerlink" title="测试指定的Nginx配置文件"></a>测试指定的Nginx配置文件</h2><p>使用<code>-c</code>参数指定配置文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nginx -t -c /etc/nginx/nginx. conf</span><br></pre></td></tr></table></figure>

</div></div></article><link rel="stylesheet" type="text/css" href="/css/font.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.css"><script src="//cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script><script src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script>$(document).ready(function() {
  $(".fancybox").fancybox();
});
</script></body></html>
<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="es 的查询接口为："><link rel="stylesheet" type="text/css" href="/css/normalize.css"><link rel="stylesheet" type="text/css" href="/css/highlight.css"><link rel="stylesheet" type="text/css" href="/css/noise.css"><title>ElasticSearch查询速查 | 凉薄的自动书记人偶</title><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><meta name="generator" content="Hexo 5.4.0"></head><body><article class="wrapper"><div class="post-main"><div class="nav"><nav class="container"><a class="sidebar-nav-item active" href="/">Home</a><a class="sidebar-nav-item" href="/archives">Tags</a><a class="sidebar-nav-item" href="/About">About</a></nav><div class="container post-meta"><div class="post-tags"><a class="post-tag-link" href="/tags/ElasticSearch/" rel="tag">ElasticSearch</a></div><div class="post-time">2022-06-21</div></div></div><div class="container post-header"><h1>ElasticSearch查询速查</h1></div><div class="container post-toc"><details class="toc"><summary class="toc-accordion">Table of Contents</summary><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E5%B8%B8%E7%94%A8%E6%9F%A5%E8%AF%A2%E5%85%B3%E9%94%AE%E5%AD%97"><span class="toc-number">1.</span> <span class="toc-text">一、常用查询关键字</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81match"><span class="toc-number">1.1.</span> <span class="toc-text">1、match</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81match-pharse"><span class="toc-number">1.2.</span> <span class="toc-text">2、match_pharse</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81fuzzy"><span class="toc-number">1.3.</span> <span class="toc-text">3、fuzzy</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E3%80%81multi-match"><span class="toc-number">1.4.</span> <span class="toc-text">4、multi_match</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5%E3%80%81regexp"><span class="toc-number">1.5.</span> <span class="toc-text">5、regexp</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6%E3%80%81wildcard"><span class="toc-number">1.6.</span> <span class="toc-text">6、wildcard</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7%E3%80%81term"><span class="toc-number">1.7.</span> <span class="toc-text">7、term</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8%E3%80%81-terms"><span class="toc-number">1.8.</span> <span class="toc-text">8、 terms</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9%E3%80%81range"><span class="toc-number">1.9.</span> <span class="toc-text">9、range</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E7%BB%84%E5%90%88%E5%A4%9A%E6%9F%A5%E8%AF%A2"><span class="toc-number">2.</span> <span class="toc-text">二、组合多查询</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81must"><span class="toc-number">2.1.</span> <span class="toc-text">1、must</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81must-not"><span class="toc-number">2.2.</span> <span class="toc-text">2、must_not</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81should"><span class="toc-number">2.3.</span> <span class="toc-text">3、should</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E3%80%81filter"><span class="toc-number">2.4.</span> <span class="toc-text">4、filter</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5%E3%80%81must%E3%80%81must-not%E3%80%81should-%E7%BB%84%E5%90%88%E7%94%A8%E4%BE%8B"><span class="toc-number">2.5.</span> <span class="toc-text">5、must、must_not、should 组合用例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E5%88%86%E9%A1%B5%E5%92%8C%E6%8E%92%E5%BA%8F"><span class="toc-number">2.6.</span> <span class="toc-text">三、分页和排序</span></a></li></ol></li></ol></details></div><div class="container post-content"><p>es 的查询接口为：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /索引名/_search</span><br></pre></td></tr></table></figure>



<h2 id="一、常用查询关键字"><a href="#一、常用查询关键字" class="headerlink" title="一、常用查询关键字"></a>一、常用查询关键字</h2><h3 id="1、match"><a href="#1、match" class="headerlink" title="1、match"></a>1、match</h3><p>match 是模糊匹配查询，根据分词器 (如果创建 mapping 没有指定分词器，Es 将会采取默认的分词器:standard,standard 分词将会把匹配的词组分成单个的字，而不是短语) 将指定的 query 查询的语句进行分词匹配。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">查询索引中name为Tom的文档：</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&#x27;query&#x27;</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;match&#x27;</span>: &#123;</span><br><span class="line">            <span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;Tom&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2、match-pharse"><a href="#2、match-pharse" class="headerlink" title="2、match_pharse"></a>2、match_pharse</h3><p>match_pharse 属于短语匹配，要求查询的词句和匹配的短语顺序必须一致，并且是连续的，但可以设置 <code>slop</code> 值来指定查询项之间可以分隔多远的距离</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">查询索引中woke为程序员的文档：</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&#x27;query&#x27;</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;match_pharse&#x27;</span>: &#123;</span><br><span class="line">            <span class="string">&#x27;woke&#x27;</span>: <span class="string">&#x27;程序员&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3、fuzzy"><a href="#3、fuzzy" class="headerlink" title="3、fuzzy"></a>3、fuzzy</h3><p>fuzzy 查询的时候，不会根据分词器匹配，只会进行拆分，比如查询的是 <code>海zei王</code>， 在分词器下 (也就是 match 中) 是无法匹配到单个词的，因为它不是一个短语，但是在 fuzzy 中是可以匹配的，并且 fuzzy 支持模糊和一定的容错查询匹配，因为它做的是匹配词的拆分，并不是短语。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">查询索引中name为海zei王的文档：</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&#x27;query&#x27;</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;fuzzy&#x27;</span>: &#123;</span><br><span class="line">            <span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;海zei王&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4、multi-match"><a href="#4、multi-match" class="headerlink" title="4、multi_match"></a>4、multi_match</h3><p>多字段匹配，比如在查询 test 这个值的时候我们不仅需要在 A 这个字段中查询，同时它也有可能存在 B 中，按照普通的写法你可能需要写两次查询，但是使用了 multi_search 只需要指定具体的 fields 就可以实现多字段查询</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">同时在age字段和phone字段搜索包含<span class="number">38</span>这个数字的文档：</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&#x27;query&#x27;</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;multi_match&#x27;</span>: &#123;</span><br><span class="line">            <span class="string">&#x27;query&#x27;</span>: <span class="string">&#x27;38&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;fields&#x27;</span>:[<span class="string">&#x27;age&#x27;</span>,<span class="string">&#x27;phone&#x27;</span>]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5、regexp"><a href="#5、regexp" class="headerlink" title="5、regexp"></a>5、regexp</h3><p>正则表达式匹配，该匹配模式下我们可以按照正则表达式的符号去匹配具体的值，比如 name 字段，可以包含有。和 * 去正则匹配具体的值，? 表示任一字符，* 表示所有字符，还有其他的正则符号都可以使用</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">匹配手机号以<span class="number">1</span>到<span class="number">9</span>之前的开头，并且第二位是<span class="number">3</span>最后一位是<span class="number">0</span>或者<span class="number">1</span>的手机号的文档：</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&#x27;query&#x27;</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;regexp&#x27;</span>: &#123;</span><br><span class="line">            <span class="string">&#x27;phone&#x27;</span>: &#123;</span><br><span class="line">                <span class="string">&#x27;value&#x27;</span>:<span class="string">&#x27;[1-9]3.*[0-1]&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="6、wildcard"><a href="#6、wildcard" class="headerlink" title="6、wildcard"></a>6、wildcard</h3><p>通配符匹配，wildcard 和 regexp 类似，不过它们也有不同之处。regexp 的实际匹配能力要大于 wildcard，在进行简单的匹配时候，比如名字的 * 或者？的简单普通匹配，建议使用 wildcard 而不是 regexp,wildcard 的效率要高于 regexp，regexp 可以实现更为复杂的场景，但是效率低一些，通俗的说 wildcard 是 regexp 的简化版本.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">采用通配符匹配手机的电话号</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&#x27;query&#x27;</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;wildcard&#x27;</span>: &#123;</span><br><span class="line">            <span class="string">&#x27;phone&#x27;</span>: <span class="string">&#x27;13643091*&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="7、term"><a href="#7、term" class="headerlink" title="7、term"></a>7、term</h3><p>term 的英文含义表示是：精确的意思，在 term 查询中，表示做的是精确查询，整词匹配，不会对所匹配项进行拆分。直接以整词进行匹配，如果能查询到就命中该文档</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">查询的name为鲁班的文档</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&#x27;query&#x27;</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;term&#x27;</span>: &#123;</span><br><span class="line">            <span class="string">&#x27;name&#x27;</span>: &#123;</span><br><span class="line">                <span class="string">&#x27;value&#x27;</span>:<span class="string">&#x27;鲁班&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="8、-terms"><a href="#8、-terms" class="headerlink" title="8、 terms"></a>8、 terms</h3><p>terms 和 term 的区别就是 terms 允许匹配多个值，而 term 只允许匹配一个值，在进行多值匹配的场景中可以使用 terms,terms 匹配到其中任何一个值就会认为整个文档是匹配的，terms 多个值如果多个都匹配会返回所有文档</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">查询age为<span class="number">24</span>、<span class="number">66</span>的任一值，查到就返回文档</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&#x27;query&#x27;</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;terms&#x27;</span>: &#123;</span><br><span class="line">            <span class="string">&#x27;age&#x27;</span>: [<span class="string">&#x27;24&#x27;</span>,<span class="string">&#x27;36&#x27;</span>]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="9、range"><a href="#9、range" class="headerlink" title="9、range"></a>9、range</h3><p>range 表示一个区间范围查找，这个范围可以是日期或者数值，ES 的 range 比较灵活和明确，可以指定两个边界是否包含，通过参数 include_lower:true 、include_upper:true 来控制</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">查询age为<span class="number">20</span>到<span class="number">30</span>区间所有文档,</span><br><span class="line">include_lower表示是否包含边界最小值(true表示包含),</span><br><span class="line">include_upper表示是否包含边界最大值(true表示包含,false表示不包含)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&#x27;query&#x27;</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;range&#x27;</span>: &#123;</span><br><span class="line">            <span class="string">&#x27;age&#x27;</span>: &#123;</span><br><span class="line">                <span class="string">&#x27;from&#x27;</span>: <span class="number">20</span>,</span><br><span class="line">                <span class="string">&#x27;to&#x27;</span>: <span class="number">30</span>,</span><br><span class="line">                <span class="string">&#x27;include_lower&#x27;</span>:true,</span><br><span class="line">                <span class="string">&#x27;include_upper&#x27;</span>:false</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">查询log_time对应时间区间内的所有文档,</span><br><span class="line">gt/gt表示起始时间，gte包含起始时间点,gt不包含起始时间点,</span><br><span class="line">lt/lte表示结束时间，lte包结束时间点,lt不包含结束时间点</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&#x27;query&#x27;</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;range&#x27;</span>: &#123;</span><br><span class="line">                <span class="string">&#x27;log_time&#x27;</span>: &#123;</span><br><span class="line">                    <span class="string">&#x27;gte&#x27;</span>: <span class="string">&#x27;2022-04-02 00:00:00&#x27;</span>,</span><br><span class="line">                    <span class="string">&#x27;lt&#x27;</span>: <span class="string">&#x27;2022-04-02 23:00:00&#x27;</span>,</span><br><span class="line">                    <span class="string">&#x27;format&#x27;</span>: <span class="string">&#x27;yyyy-MM-dd HH:mm:ss&#x27;</span>,</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="二、组合多查询"><a href="#二、组合多查询" class="headerlink" title="二、组合多查询"></a>二、组合多查询</h2><p>bool （布尔）过滤器。 这是个 复合过滤器（compound filter） ，它可以接受多个其他过滤器作为参数，并将这些过滤器结合成各式各样的布尔（逻辑）组合。</p>
<h3 id="1、must"><a href="#1、must" class="headerlink" title="1、must"></a>1、must</h3><p>文档 必须 must 匹配这些条件才能被包含进来，与 AND 等价。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">must数组里面可以插入多个关键字查询条件</span><br><span class="line">以下用例中查询sn为<span class="number">00000000</span>， date_time为<span class="number">2022</span>-04-02 <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> 到<span class="number">2022</span>-04-02 <span class="number">23</span>:<span class="number">00</span>:<span class="number">00</span>的文件</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&#x27;query&#x27;</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;bool&#x27;</span>: &#123;</span><br><span class="line">                <span class="string">&#x27;must&#x27;</span>: [</span><br><span class="line">                        &#123;<span class="string">&#x27;terms&#x27;</span>: &#123; <span class="string">&#x27;sn&#x27;</span>: [<span class="string">&#x27;00000000&#x27;</span>]&#125;&#125;,</span><br><span class="line">                        &#123;<span class="string">&#x27;range&#x27;</span>: &#123;<span class="string">&#x27;date_time&#x27;</span>: &#123;</span><br><span class="line">                                <span class="string">&#x27;gt&#x27;</span>: <span class="string">&#x27;2022-04-02 00:00:00&#x27;</span>,</span><br><span class="line">                                <span class="string">&#x27;lt&#x27;</span>: <span class="string">&#x27;2022-04-02 23:00:00&#x27;</span>,</span><br><span class="line">                                <span class="string">&#x27;format&#x27;</span>: <span class="string">&#x27;yyyy-MM-dd HH:mm:ss&#x27;</span>,</span><br><span class="line">                            &#125;&#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    ]</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2、must-not"><a href="#2、must-not" class="headerlink" title="2、must_not"></a>2、must_not</h3><p>文档 必须不 must_not 匹配这些条件才能被包含进来，与 NOT 等价。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">用例为：查询name不为李白的文件</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&#x27;query&#x27;</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;bool&#x27;</span>: &#123;</span><br><span class="line">                <span class="string">&#x27;must_not&#x27;</span>: [</span><br><span class="line">                        &#123;<span class="string">&#x27;terms&#x27;</span>: &#123; <span class="string">&#x27;name&#x27;</span>: [<span class="string">&#x27;李白&#x27;</span>]&#125;&#125;</span><br><span class="line">                    ]</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3、should"><a href="#3、should" class="headerlink" title="3、should"></a>3、should</h3><p>至少有一个语句要匹配，与 OR 等价</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">用例为：查询name为李白或者age为<span class="number">12</span> 的文件</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&#x27;query&#x27;</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;bool&#x27;</span>: &#123;</span><br><span class="line">                <span class="string">&#x27;should&#x27;</span>: [</span><br><span class="line">                        &#123;<span class="string">&#x27;terms&#x27;</span>: &#123; <span class="string">&#x27;name&#x27;</span>: [<span class="string">&#x27;李白&#x27;</span>]&#125;&#125;,</span><br><span class="line">                        &#123;<span class="string">&#x27;term&#x27;</span>: &#123; <span class="string">&#x27;age&#x27;</span>: <span class="string">&#x27;12&#x27;</span>&#125;&#125;</span><br><span class="line">                    ]</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4、filter"><a href="#4、filter" class="headerlink" title="4、filter"></a>4、filter</h3><p>必须 匹配，但它以不评分、过滤模式来进行。这些语句对评分没有贡献，只是根据过滤标准来排除或包含文档。filter 不会计算搜索条件相关度分数，也不会根据相关度分数进行排序，相对效率更高一些。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">用例为：查询name为李白同的文件</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&#x27;query&#x27;</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;bool&#x27;</span>: &#123;</span><br><span class="line">                <span class="string">&#x27;filter&#x27;</span>: [</span><br><span class="line">                        &#123;<span class="string">&#x27;terms&#x27;</span>: &#123; <span class="string">&#x27;name&#x27;</span>: [<span class="string">&#x27;李白&#x27;</span>]&#125;&#125;</span><br><span class="line">                    ]</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5、must、must-not、should-组合用例"><a href="#5、must、must-not、should-组合用例" class="headerlink" title="5、must、must_not、should 组合用例"></a>5、must、must_not、should 组合用例</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">以下用例中查询</span><br><span class="line">sn为<span class="number">00000000</span>， date_time为<span class="number">2022</span>-04-02 <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> 到<span class="number">2022</span>-04-02 <span class="number">23</span>:<span class="number">00</span>:<span class="number">00</span></span><br><span class="line">或者name为Tom并且detail不以智能开头的文档</span><br><span class="line">name为To</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">&#x27;query&#x27;</span>: &#123;</span><br><span class="line">        <span class="string">&#x27;bool&#x27;</span>: &#123;</span><br><span class="line">                <span class="string">&#x27;must&#x27;</span>: [</span><br><span class="line">                        &#123;<span class="string">&#x27;terms&#x27;</span>: &#123; <span class="string">&#x27;sn&#x27;</span>: [<span class="string">&#x27;00000000&#x27;</span>]&#125;&#125;,</span><br><span class="line">                        &#123;<span class="string">&#x27;range&#x27;</span>: &#123;<span class="string">&#x27;date_time&#x27;</span>: &#123;</span><br><span class="line">                                <span class="string">&#x27;gt&#x27;</span>: <span class="string">&#x27;2022-04-02 00:00:00&#x27;</span>,</span><br><span class="line">                                <span class="string">&#x27;lt&#x27;</span>: <span class="string">&#x27;2022-04-02 23:00:00&#x27;</span>,</span><br><span class="line">                                <span class="string">&#x27;format&#x27;</span>: <span class="string">&#x27;yyyy-MM-dd HH:mm:ss&#x27;</span>,</span><br><span class="line">                            &#125;&#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    ],</span><br><span class="line">                <span class="string">&#x27;must_not&#x27;</span>: [</span><br><span class="line">                        &#123;<span class="string">&#x27;regexp&#x27;</span>: &#123;<span class="string">&#x27;detail&#x27;</span>:<span class="string">&#x27;智能*&#x27;</span>&#125;&#125;</span><br><span class="line">                    ],</span><br><span class="line">                <span class="string">&#x27;should&#x27;</span>: [</span><br><span class="line">                        &#123;<span class="string">&#x27;match&#x27;</span>: &#123; <span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;Tom&#x27;</span>&#125;&#125;</span><br><span class="line">                   ]</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="三、分页和排序"><a href="#三、分页和排序" class="headerlink" title="三、分页和排序"></a>三、分页和排序</h3><p>分页检索，可以通过 size 和 from 来实现，size 返回的条数，默认是 10 条，from 返回的开始。</p>
<p>排序，可以根据 sort 来实现，该字段可以指定索引字段，也可以指定返回结果中的其他字段。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;query&quot;</span>:&#123;</span><br><span class="line">        <span class="string">&quot;match_all&quot;</span>:&#123;&#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;from&quot;</span>:<span class="number">1</span>,</span><br><span class="line">    <span class="string">&quot;size&quot;</span>:<span class="number">10</span>，</span><br><span class="line">     <span class="string">&quot;sort&quot;</span>: &#123;</span><br><span class="line">           <span class="string">&quot;age&quot;</span>:<span class="string">&quot;desc&quot;</span>,</span><br><span class="line">           <span class="string">&quot;money&quot;</span>:<span class="string">&quot;asc&quot;</span></span><br><span class="line">       &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></div></article><link rel="stylesheet" type="text/css" href="/css/font.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.css"><script src="//cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script><script src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script>$(document).ready(function() {
  $(".fancybox").fancybox();
});
</script></body></html>
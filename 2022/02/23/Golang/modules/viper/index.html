<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="gure class=&quot;highlight plaintext&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;go get github.com/spf13/viper&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;



&lt;h2 id=&quot;viper-是什么&quot;&gt;&lt;a href=&quot;#viper-是什么&quot; class=&quot;headerlink&quot; title=&quot;viper 是什么&quot;&gt;&lt;/a&gt;viper 是什么&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;go 开发工具，主要是用于处理各种格式的配置文件，简化程序配置的读取问题&lt;/li&gt;
&lt;li&gt;viper 支持：&lt;ul&gt;
&lt;li&gt;设置默认配置&lt;/li&gt;
&lt;li&gt;支持读取 JSON TOML YAML HCL 和 Java 属性配置文件&lt;/li&gt;
&lt;li&gt;监听配置文件变化，实时读取读取配置文件内容&lt;/li&gt;
&lt;li&gt;读取环境变量值&lt;/li&gt;
&lt;li&gt;读取远程配置系统 (etcd Consul) 和监控配置变化&lt;/li&gt;
&lt;li&gt;读取命令 Flag 值&lt;/li&gt;
&lt;li&gt;读取 buffer 值&lt;/li&gt;
&lt;li&gt;读取确切值&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;quick-start&quot;&gt;&lt;a href=&quot;#quick-start&quot; class=&quot;headerlink&quot; title=&quot;quick start&quot;&gt;&lt;/a&gt;quick start&lt;/h2&gt;&lt;p&gt;&lt;code&gt;json 配置文件 (config.json)&lt;/code&gt;："><link rel="stylesheet" type="text/css" href="/css/normalize.css"><link rel="stylesheet" type="text/css" href="/css/highlight.css"><link rel="stylesheet" type="text/css" href="/css/noise.css"><title>viper | 凉薄的自动书记人偶</title><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><meta name="generator" content="Hexo 5.4.0"></head><body><article class="wrapper"><div class="post-main"><div class="nav"><nav class="container"><a class="sidebar-nav-item active" href="/">Home</a><a class="sidebar-nav-item" href="/archives">Tags</a><a class="sidebar-nav-item" href="/About">About</a></nav><div class="container post-meta"><div class="post-tags"><a class="post-tag-link" href="/tags/Golang/" rel="tag">Golang</a></div><div class="post-time">2022-02-23</div></div></div><div class="container post-header"><h1>viper</h1></div><div class="container post-toc"><details class="toc"><summary class="toc-accordion">Table of Contents</summary><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#viper-%E6%98%AF%E4%BB%80%E4%B9%88"><span class="toc-number">1.</span> <span class="toc-text">viper 是什么</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#quick-start"><span class="toc-number">2.</span> <span class="toc-text">quick start</span></a></li></ol></details></div><div class="container post-content"><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go get github.com/spf13/viper</span><br></pre></td></tr></table></figure>



<h2 id="viper-是什么"><a href="#viper-是什么" class="headerlink" title="viper 是什么"></a>viper 是什么</h2><ul>
<li>go 开发工具，主要是用于处理各种格式的配置文件，简化程序配置的读取问题</li>
<li>viper 支持：<ul>
<li>设置默认配置</li>
<li>支持读取 JSON TOML YAML HCL 和 Java 属性配置文件</li>
<li>监听配置文件变化，实时读取读取配置文件内容</li>
<li>读取环境变量值</li>
<li>读取远程配置系统 (etcd Consul) 和监控配置变化</li>
<li>读取命令 Flag 值</li>
<li>读取 buffer 值</li>
<li>读取确切值</li>
</ul>
</li>
</ul>
<h2 id="quick-start"><a href="#quick-start" class="headerlink" title="quick start"></a>quick start</h2><p><code>json 配置文件 (config.json)</code>：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;port&quot;</span>: <span class="number">10666</span>,</span><br><span class="line">  <span class="attr">&quot;mysql&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;url&quot;</span>: <span class="string">&quot;(127.0.0.1:3306)/biezhi&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;username&quot;</span>: <span class="string">&quot;root&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;password&quot;</span>: <span class="string">&quot;123456&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;redis&quot;</span>: [<span class="string">&quot;127.0.0.1:6377&quot;</span>, <span class="string">&quot;127.0.0.1:6378&quot;</span>, <span class="string">&quot;127.0.0.1:6379&quot;</span>],</span><br><span class="line">  <span class="attr">&quot;smtp&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;enable&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">&quot;addr&quot;</span>: <span class="string">&quot;mail_addr&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;username&quot;</span>: <span class="string">&quot;mail_user&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;password&quot;</span>: <span class="string">&quot;mail_password&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;to&quot;</span>: [<span class="string">&quot;xxx@gmail.com&quot;</span>, <span class="string">&quot;xxx@163.com&quot;</span>]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><code>yaml 配置文件 (config1.yaml)</code>：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">port:</span> <span class="number">10666</span></span><br><span class="line"><span class="attr">mysql:</span></span><br><span class="line"><span class="attr">url:</span> <span class="string">&quot;(127.0.0.1:3306)/biezhi&quot;</span></span><br><span class="line"><span class="attr">username:</span> <span class="string">root</span></span><br><span class="line"><span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line"><span class="attr">redis:</span></span><br><span class="line"><span class="bullet">-</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:6377</span></span><br><span class="line"><span class="bullet">-</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:6378</span></span><br><span class="line"><span class="bullet">-</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:6379</span></span><br><span class="line"><span class="attr">smtp:</span></span><br><span class="line"><span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">addr:</span> <span class="string">mail_addr</span></span><br><span class="line"><span class="attr">username:</span> <span class="string">mail_user</span></span><br><span class="line"><span class="attr">password:</span> <span class="string">mail_password</span></span><br><span class="line"><span class="attr">to:</span> </span><br><span class="line"><span class="bullet">-</span> <span class="string">xxx@gmail.com</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">xxx@163.com</span></span><br></pre></td></tr></table></figure>



<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;log&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="string">&quot;github.com/spf13/viper&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">init</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">// viper.SetConfigName(&quot;config1&quot;)        // 读取yaml配置文件</span></span><br><span class="line">    viper.SetConfigName(<span class="string">&quot;config&quot;</span>)            <span class="comment">// 读取json配置文件</span></span><br><span class="line">    <span class="comment">//viper.AddConfigPath(&quot;/etc/appname/&quot;)   //设置配置文件的搜索目录</span></span><br><span class="line">    <span class="comment">//viper.AddConfigPath(&quot;$HOME/.appname&quot;)  // 设置配置文件的搜索目录</span></span><br><span class="line">    viper.AddConfigPath(<span class="string">&quot;.&quot;</span>)                 <span class="comment">// 设置配置文件和可执行二进制文件在用一个目录</span></span><br><span class="line">    <span class="keyword">if</span> err := viper.ReadInConfig(); err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> _, ok := err.(viper.ConfigFileNotFoundError); ok &#123;</span><br><span class="line">            <span class="comment">// Config file not found; ignore error if desired</span></span><br><span class="line">            log.Println(<span class="string">&quot;no such config file&quot;</span>)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// Config file was found but another error was produced</span></span><br><span class="line">            log.Println(<span class="string">&quot;read config error&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        log.Fatal(err) <span class="comment">// 读取配置文件失败致命错误</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;获取配置文件的port&quot;</span>, viper.GetInt(<span class="string">&quot;port&quot;</span>))</span><br><span class="line">    fmt.Println(<span class="string">&quot;获取配置文件的mysql.url&quot;</span>, viper.GetString(<span class="string">`mysql.url`</span>))</span><br><span class="line">    fmt.Println(<span class="string">&quot;获取配置文件的mysql.username&quot;</span>, viper.GetString(<span class="string">`mysql.username`</span>))</span><br><span class="line">    fmt.Println(<span class="string">&quot;获取配置文件的mysql.password&quot;</span>, viper.GetString(<span class="string">`mysql.password`</span>))</span><br><span class="line">    fmt.Println(<span class="string">&quot;获取配置文件的redis&quot;</span>, viper.GetStringSlice(<span class="string">&quot;redis&quot;</span>))</span><br><span class="line">    fmt.Println(<span class="string">&quot;获取配置文件的smtp&quot;</span>, viper.GetStringMap(<span class="string">&quot;smtp&quot;</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>viper.SetConfigName (“config”) 设置配置文件名为 config, 不需要配置文件扩展名，配置文件的类型 viper 会自动根据扩展名自动匹配.</p>
</li>
<li><p>viper.AddConfigPath (“.”) 设置配置文件搜索的目录，. 表示和<strong>当前编译好的二进制文件</strong>在同一个目录。可以添加多个配置文件目录，如在第一个目录中找到就不不继续到其他目录中查找.</p>
</li>
<li><p>viper.ReadInConfig () 加载配置文件内容</p>
</li>
<li><p>viper.Get 获取配置文件中配置项的信息</p>
</li>
</ul>
<p><code>io.Reader</code>：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;bytes&quot;</span></span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="string">&quot;github.com/spf13/viper&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    v := viper.New()</span><br><span class="line">    v.SetConfigType(<span class="string">&quot;json&quot;</span>) <span class="comment">// 设置配置文件的类型</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 配置文件内容</span></span><br><span class="line">    <span class="keyword">var</span> jsonExample = []<span class="keyword">byte</span>(<span class="string">`</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">  &quot;port&quot;: 10666,</span></span><br><span class="line"><span class="string">  &quot;mysql&quot;: &#123;</span></span><br><span class="line"><span class="string">    &quot;url&quot;: &quot;(127.0.0.1:3306)/biezhi&quot;,</span></span><br><span class="line"><span class="string">    &quot;username&quot;: &quot;root&quot;,</span></span><br><span class="line"><span class="string">    &quot;password&quot;: &quot;123456&quot;</span></span><br><span class="line"><span class="string">  &#125;,</span></span><br><span class="line"><span class="string">  &quot;redis&quot;: [&quot;127.0.0.1:6377&quot;, &quot;127.0.0.1:6378&quot;, &quot;127.0.0.1:6379&quot;],</span></span><br><span class="line"><span class="string">  &quot;smtp&quot;: &#123;</span></span><br><span class="line"><span class="string">    &quot;enable&quot;: true,</span></span><br><span class="line"><span class="string">    &quot;addr&quot;: &quot;mail_addr&quot;,</span></span><br><span class="line"><span class="string">    &quot;username&quot;: &quot;mail_user&quot;,</span></span><br><span class="line"><span class="string">    &quot;password&quot;: &quot;mail_password&quot;,</span></span><br><span class="line"><span class="string">    &quot;to&quot;: [&quot;xxx@gmail.com&quot;, &quot;xxx@163.com&quot;]</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">`</span>)</span><br><span class="line">    <span class="comment">//创建io.Reader</span></span><br><span class="line">    v.ReadConfig(bytes.NewBuffer(jsonExample))</span><br><span class="line"></span><br><span class="line">    fmt.Println(<span class="string">&quot;获取配置文件的port&quot;</span>, v.GetInt(<span class="string">&quot;port&quot;</span>))</span><br><span class="line">    fmt.Println(<span class="string">&quot;获取配置文件的mysql.url&quot;</span>, v.GetString(<span class="string">`mysql.url`</span>))</span><br><span class="line">    fmt.Println(<span class="string">&quot;获取配置文件的mysql.username&quot;</span>, v.GetString(<span class="string">`mysql.username`</span>))</span><br><span class="line">    fmt.Println(<span class="string">&quot;获取配置文件的mysql.password&quot;</span>, v.GetString(<span class="string">`mysql.password`</span>))</span><br><span class="line">    fmt.Println(<span class="string">&quot;获取配置文件的redis&quot;</span>, v.GetStringSlice(<span class="string">&quot;redis&quot;</span>))</span><br><span class="line">    fmt.Println(<span class="string">&quot;获取配置文件的smtp&quot;</span>, v.GetStringMap(<span class="string">&quot;smtp&quot;</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</div></div></article><link rel="stylesheet" type="text/css" href="/css/font.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.css"><script src="//cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script><script src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script>$(document).ready(function() {
  $(".fancybox").fancybox();
});
</script></body></html>
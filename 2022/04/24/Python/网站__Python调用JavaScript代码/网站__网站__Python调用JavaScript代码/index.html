<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content=" id=&quot;PyExecJS-的使用&quot;&gt;&lt;a href=&quot;#PyExecJS-的使用&quot; class=&quot;headerlink&quot; title=&quot;PyExecJS 的使用&quot;&gt;&lt;/a&gt;PyExecJS 的使用&lt;/h2&gt;&lt;p&gt;安装 JS 运行环境推荐安装 Node.js，安装方便，执行效率也高。"><link rel="stylesheet" type="text/css" href="/css/normalize.css"><link rel="stylesheet" type="text/css" href="/css/highlight.css"><link rel="stylesheet" type="text/css" href="/css/noise.css"><title>网站 | 凉薄的自动书记人偶</title><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><meta name="generator" content="Hexo 5.4.0"></head><body><article class="wrapper"><div class="post-main"><div class="nav"><nav class="container"><a class="sidebar-nav-item active" href="/">Home</a><a class="sidebar-nav-item" href="/archives">Tags</a><a class="sidebar-nav-item" href="/About">About</a></nav><div class="container post-meta"><div class="post-tags"><a class="post-tag-link" href="/tags/Python/" rel="tag">Python</a></div><div class="post-time">2022-04-24</div></div></div><div class="container post-header"><h1>网站</h1></div><div class="container post-toc"><details class="toc"><summary class="toc-accordion">Table of Contents</summary><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#PyExecJS-%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">1.</span> <span class="toc-text">PyExecJS 的使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#demo"><span class="toc-number">1.1.</span> <span class="toc-text">demo</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#PyExecJS-%E5%AD%98%E5%9C%A8%E7%9A%84%E4%B8%80%E4%BA%9B%E9%97%AE%E9%A2%98"><span class="toc-number">1.2.</span> <span class="toc-text">PyExecJS 存在的一些问题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E4%BD%BF%E7%94%A8-Python-%E8%B0%83%E7%94%A8-JS-%E7%9A%84%E9%AA%9A%E6%93%8D%E4%BD%9C"><span class="toc-number">2.</span> <span class="toc-text">其他使用 Python 调用 JS 的骚操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Selenium"><span class="toc-number">2.1.</span> <span class="toc-text">Selenium</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#reference"><span class="toc-number"></span> <span class="toc-text">reference</span></a></details></div><div class="container post-content"><h2 id="PyExecJS-的使用"><a href="#PyExecJS-的使用" class="headerlink" title="PyExecJS 的使用"></a>PyExecJS 的使用</h2><p>安装 JS 运行环境推荐安装 Node.js，安装方便，执行效率也高。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install pyexecjs</span><br></pre></td></tr></table></figure>

<p>Test：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">In [1]: import execjs</span><br><span class="line"></span><br><span class="line">In [2]: execjs.get().name # 查看调用环境</span><br><span class="line">Out[2]: &#x27;Node.js (V8)&#x27;</span><br></pre></td></tr></table></figure>

<p>如果你检测出来的引擎不是 <code>node.js</code> 的话，那你就需要手动设置一下了，这里有两种设置形式： <strong>选择不同引擎进行解析</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 长期使用</span></span><br><span class="line">os.environ[<span class="string">&quot;EXECJS_RUNTIME&quot;</span>]=<span class="string">&quot;Node&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 临时使用</span></span><br><span class="line"><span class="keyword">import</span> execjs.runtime_names</span><br><span class="line">node=execjs.get(execjs.runtime_names.Node)</span><br></pre></td></tr></table></figure>



<h3 id="demo"><a href="#demo" class="headerlink" title="demo"></a>demo</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> execjs</span><br><span class="line">jstext = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">function hello(str)&#123;return str;&#125;</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">ctx = execjs.<span class="built_in">compile</span>(jstext) <span class="comment"># 编译 JS 代码</span></span><br><span class="line">a = ctx.call(<span class="string">&quot;hello&quot;</span>, <span class="string">&quot;hello aiyc&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(a)  <span class="comment"># hello aiyc</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pprint <span class="keyword">import</span> pprint</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> execjs</span><br><span class="line"><span class="keyword">import</span> pathlib</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">js_path = pathlib.Path(os.path.abspath(os.path.dirname(__file__)))</span><br><span class="line">js_path = js_path / <span class="string">&quot;crypto.js&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> js_path.<span class="built_in">open</span>(<span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    script = f.read()</span><br><span class="line"></span><br><span class="line">c = <span class="string">&quot;1234&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 传入python中的变量</span></span><br><span class="line">add = (<span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">aesEncrypt = function() &#123;</span></span><br><span class="line"><span class="string">    result=&#123;&#125;</span></span><br><span class="line"><span class="string">    var t = CryptoJS.MD5(&quot;login.xxx.com&quot;),</span></span><br><span class="line"><span class="string">        i = CryptoJS.enc.Utf8.parse(t),</span></span><br><span class="line"><span class="string">        r = CryptoJS.enc.Utf8.parse(&quot;1234567812345678&quot;),</span></span><br><span class="line"><span class="string">        u = CryptoJS.AES.encrypt(&#x27;&#x27;&#x27;</span> + <span class="string">&quot;&#x27;&#123;&#125;&#x27;&quot;</span>.<span class="built_in">format</span>(c) + <span class="string">&#x27;&#x27;&#x27;,i, &#123;</span></span><br><span class="line"><span class="string">        iv: r</span></span><br><span class="line"><span class="string">    &#125;);</span></span><br><span class="line"><span class="string">        result.t=t.toString()</span></span><br><span class="line"><span class="string">        result.i =i.toString()</span></span><br><span class="line"><span class="string">        result.r =r.toString()</span></span><br><span class="line"><span class="string">        result.u =u.toString()</span></span><br><span class="line"><span class="string">        return result</span></span><br><span class="line"><span class="string">    &#125;;</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span>)</span><br><span class="line">script = script + add</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;script&quot;</span>,script)</span><br><span class="line"></span><br><span class="line">x = execjs.<span class="built_in">compile</span>(script)</span><br><span class="line">result = x.call(<span class="string">&quot;aesEncrypt&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(result)</span><br></pre></td></tr></table></figure>



<h3 id="PyExecJS-存在的一些问题"><a href="#PyExecJS-存在的一些问题" class="headerlink" title="PyExecJS 存在的一些问题"></a>PyExecJS 存在的一些问题</h3><ul>
<li><p>执行大型 JS 时会有点慢（这个是因为，每次执行 JS 代码的时候，都是从命令行去调用到的 JS，所以 JS 代码越复杂的话，nodejs 的初始化时间就越长，这个基本上是无解的）</p>
</li>
<li><p>特殊编码的输入或输出参数会出现报错的情况（因为，是从命令行调用的，所以在碰到一些特殊字符输入或输出参数或者 JS 代码本身就有一些特殊字符的情况下，就会直接执行不了，给你抛出一个异常。不过这个跟系统的命令行默认编码有一定关系，具体的话这里就不深究了，直接就说解决方案吧。）</p>
<p>可以把输入或输出的参数使用 Base64 编码一下（如果看报错是 JS 代码部分导致的，那就去看看能不能删除代码中的那部分字符或者你自己 new 一个上下文对象，将那个名叫 tempfile 的参数打开，这样在调用的时候，它就直接去执行那个文件了，不过大量调用的情况下，可能会对磁盘造成一定压力。</p>
</li>
</ul>
<h2 id="其他使用-Python-调用-JS-的骚操作"><a href="#其他使用-Python-调用-JS-的骚操作" class="headerlink" title="其他使用 Python 调用 JS 的骚操作"></a>其他使用 Python 调用 JS 的骚操作</h2><h3 id="Selenium"><a href="#Selenium" class="headerlink" title="Selenium"></a>Selenium</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">js = <span class="string">&quot;一大段 JS&quot;</span></span><br><span class="line">result = browser.execute_script(js)</span><br></pre></td></tr></table></figure>



<h1 id="reference"><a href="#reference" class="headerlink" title="reference"></a>reference</h1><ul>
<li><a target="_blank" rel="noopener" href="https://cuiqingcai.com/9581.html">JS 逆向的时候 Python 如何调用 JavaScript 代码？</a></li>
</ul>
</div></div></article><link rel="stylesheet" type="text/css" href="/css/font.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.css"><script src="//cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script><script src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script>$(document).ready(function() {
  $(".fancybox").fancybox();
});
</script></body></html>
<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="&lt;a href=&quot;https://juejin.im/post/5b0bb85af265da091337d236&quot;&gt;https://juejin.im/post/5b0bb85af265da091337d236&lt;/a&gt;"><link rel="stylesheet" type="text/css" href="/css/normalize.css"><link rel="stylesheet" type="text/css" href="/css/highlight.css"><link rel="stylesheet" type="text/css" href="/css/noise.css"><title>propTypes | 凉薄的自动书记人偶</title><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><meta name="generator" content="Hexo 5.4.0"></head><body><article class="wrapper"><div class="post-main"><div class="nav"><nav class="container"><a class="sidebar-nav-item active" href="/">Home</a><a class="sidebar-nav-item" href="/archives">Tags</a><a class="sidebar-nav-item" href="/About">About</a></nav><div class="container post-meta"><div class="post-tags"><a class="post-tag-link" href="/tags/React/" rel="tag">React</a></div><div class="post-time">2020-07-21</div></div></div><div class="container post-header"><h1>propTypes</h1></div><div class="container post-toc"><details class="toc"><summary class="toc-accordion">Table of Contents</summary><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%95%E5%85%A5"><span class="toc-number">1.</span> <span class="toc-text">引入</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#PropTypes-%E4%BD%BF%E7%94%A8"><span class="toc-number">2.</span> <span class="toc-text">PropTypes 使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E7%AE%80%E5%8D%95%E4%BE%8B%E5%AD%90"><span class="toc-number">2.1.</span> <span class="toc-text">1 简单例子</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E4%B8%8D%E5%90%8C%E7%9A%84%E9%AA%8C%E8%AF%81%E5%99%A8"><span class="toc-number">2.2.</span> <span class="toc-text">2 不同的验证器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E9%99%90%E5%88%B6%E5%8D%95%E4%B8%AA%E5%AD%90%E4%BB%A3"><span class="toc-number">2.3.</span> <span class="toc-text">3 限制单个子代</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E5%B1%9E%E6%80%A7%E9%BB%98%E8%AE%A4%E5%80%BC"><span class="toc-number">2.4.</span> <span class="toc-text">4 属性默认值</span></a></li></ol></li></ol></details></div><div class="container post-content"><p><a target="_blank" rel="noopener" href="https://juejin.im/post/5b0bb85af265da091337d236">https://juejin.im/post/5b0bb85af265da091337d236</a></p>
<h2 id="引入"><a href="#引入" class="headerlink" title="引入"></a>引入</h2><p>定义 <code>let prodList = []</code> , 你代码中 <code>prodList.push(...)</code></p>
<p>但是初始的时候被设置 <code>prodList = 123</code> 而且没有任何提示, 那运行 <code>push(...)</code> 肯定要报未知方法的错误</p>
<p>这种问题在自由的 <code>JavaScript</code> 世界很普遍，如果在 <code>编译</code> <code>运行</code> 两个阶段都没提示的话，排错是很麻烦的，全靠经验和对业务的熟悉 (陈年老项目又没文档简直是地狱)</p>
<p>所以我们要把问题消灭在萌芽中，就是申明对象的时候同时把类型也定义掉了， <code>react</code> 的自带方案是 <code>PropTypes</code> 组件</p>
<p>当然还有 <code>Flow</code> <code>TypeScript</code> 我个人比较喜欢 <code>TypeScript</code> 这在以后的进阶文章我再写</p>
<p><code>PropTypes</code> 是一个在 <code>编码</code> 阶段提供类型检查的方案 有提示总是好的，那我们开始</p>
<h2 id="PropTypes-使用"><a href="#PropTypes-使用" class="headerlink" title="PropTypes 使用"></a>PropTypes 使用</h2><p>先来个基础简单的例子</p>
<h3 id="1-简单例子"><a href="#1-简单例子" class="headerlink" title="1 简单例子"></a>1 简单例子</h3><ul>
<li>导入包</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> PropTypes <span class="keyword">from</span> <span class="string">&#x27;prop-types&#x27;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>编写组件</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Greeting</span> <span class="keyword">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello, &#123;this.props.name&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>编写类型检查</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Greeting.propTypes = &#123;</span><br><span class="line">  <span class="attr">name</span>: PropTypes.string</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>设置 <code>name</code> 属性类型为 <code>string</code> 字符串</p>
</blockquote>
<ul>
<li>容器</li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;div&gt;</span><br><span class="line">  <span class="xml"><span class="tag">&lt;<span class="name">Greeting</span> <span class="attr">name</span>=<span class="string">&#123;123&#125;</span> /&gt;</span></span></span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<p>显然这里设置数字类型和定义不一致</p>
<ul>
<li>页面打印</li>
</ul>
<p>发现页面能正常显示，没有错误，这是因为<strong>错误以 <code>console</code> 方式反馈</strong></p>
<h3 id="2-不同的验证器"><a href="#2-不同的验证器" class="headerlink" title="2 不同的验证器"></a>2 不同的验证器</h3><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 数组、布尔、函数、数字、对象、字符串、symbol</span></span><br><span class="line">MyComponent.propTypes = &#123;</span><br><span class="line">  <span class="attr">optionalArray</span>: PropTypes.array,</span><br><span class="line">  <span class="attr">optionalBool</span>: PropTypes.bool,</span><br><span class="line">  <span class="attr">optionalFunc</span>: PropTypes.func,</span><br><span class="line">  <span class="attr">optionalNumber</span>: PropTypes.number,</span><br><span class="line">  <span class="attr">optionalObject</span>: PropTypes.object,</span><br><span class="line">  <span class="attr">optionalString</span>: PropTypes.string,</span><br><span class="line">  <span class="attr">optionalSymbol</span>: PropTypes.symbol,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 任何东西都可以被渲染:numbers, strings, elements,或者是包含这些类型的数组(或者是片段)。</span></span><br><span class="line">  <span class="attr">optionalNode</span>: PropTypes.node,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 一个 React 元素。</span></span><br><span class="line">  <span class="attr">optionalElement</span>: PropTypes.element,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 你也可以声明一个 prop 是类的一个实例。</span></span><br><span class="line">  <span class="comment">// 使用 JS 的 instanceof 运算符。</span></span><br><span class="line">  <span class="attr">optionalMessage</span>: PropTypes.instanceOf(Message),</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 你可以声明 prop 是特定的值，类似于枚举</span></span><br><span class="line">  <span class="attr">optionalEnum</span>: PropTypes.oneOf([<span class="string">&#x27;News&#x27;</span>, <span class="string">&#x27;Photos&#x27;</span>]),</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 一个对象可以是多种类型其中之一</span></span><br><span class="line">  <span class="attr">optionalUnion</span>: PropTypes.oneOfType([</span><br><span class="line">    PropTypes.string,</span><br><span class="line">    PropTypes.number,</span><br><span class="line">    PropTypes.instanceOf(Message)</span><br><span class="line">  ]),</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 一个某种类型的数组</span></span><br><span class="line">  <span class="attr">optionalArrayOf</span>: PropTypes.arrayOf(PropTypes.number),</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 属性值为某种类型的对象</span></span><br><span class="line">  <span class="attr">optionalObjectOf</span>: PropTypes.objectOf(PropTypes.number),</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 一个特定形式的对象</span></span><br><span class="line">  <span class="attr">optionalObjectWithShape</span>: PropTypes.shape(&#123;</span><br><span class="line">    <span class="attr">color</span>: PropTypes.string,</span><br><span class="line">    <span class="attr">fontSize</span>: PropTypes.number</span><br><span class="line">  &#125;),</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 你可以使用 `isRequired&#x27; 链接上述任何一个，以确保在没有提供 prop 的情况下显示警告。</span></span><br><span class="line">  <span class="attr">requiredFunc</span>: PropTypes.func.isRequired,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 任何数据类型的值</span></span><br><span class="line">  <span class="attr">requiredAny</span>: PropTypes.any.isRequired,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 你也可以声明自定义的验证器。如果验证失败返回 Error 对象。不要使用 `console.warn` 或者 throw ，</span></span><br><span class="line">  <span class="comment">// 因为这不会在 `oneOfType` 类型的验证器中起作用。</span></span><br><span class="line">  <span class="attr">customProp</span>: <span class="function"><span class="keyword">function</span>(<span class="params">props, propName, componentName</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="regexp">/matchme/</span>.test(props[propName])) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Error</span>(</span><br><span class="line">        <span class="string">&#x27;Invalid prop `&#x27;</span> + propName + <span class="string">&#x27;` supplied to&#x27;</span> +</span><br><span class="line">        <span class="string">&#x27; `&#x27;</span> + componentName + <span class="string">&#x27;`. Validation failed.&#x27;</span></span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 也可以声明`arrayOf`和`objectOf`类型的验证器，如果验证失败需要返回Error对象。</span></span><br><span class="line">  <span class="comment">// 会在数组或者对象的每一个元素上调用验证器。验证器的前两个参数分别是数组或者对象本身，</span></span><br><span class="line">  <span class="comment">// 以及当前元素的键值。</span></span><br><span class="line">  <span class="attr">customArrayProp</span>: PropTypes.arrayOf(<span class="function"><span class="keyword">function</span>(<span class="params">propValue, key, componentName, location, propFullName</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="regexp">/matchme/</span>.test(propValue[key])) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Error</span>(</span><br><span class="line">        <span class="string">&#x27;Invalid prop `&#x27;</span> + propFullName + <span class="string">&#x27;` supplied to&#x27;</span> +</span><br><span class="line">        <span class="string">&#x27; `&#x27;</span> + componentName + <span class="string">&#x27;`. Validation failed.&#x27;</span></span><br><span class="line">      );</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>



<h3 id="3-限制单个子代"><a href="#3-限制单个子代" class="headerlink" title="3 限制单个子代"></a>3 限制单个子代</h3><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 组件</span></span><br><span class="line"><span class="keyword">const</span> OnlyOneChild = <span class="function"><span class="params">props</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> children = props.children</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;children&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line">OnlyOneChild.propTypes = &#123;</span><br><span class="line">  <span class="attr">children</span>: PropTypes.element.isRequired</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 容器</span></span><br><span class="line">&lt;OnlyOneChild&gt;</span><br><span class="line">  <span class="xml"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>第一个子节点<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span></span><br><span class="line">  <span class="xml"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>第二个子节点<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span></span><br><span class="line">&lt;/OnlyOneChild&gt;</span><br></pre></td></tr></table></figure>



<h3 id="4-属性默认值"><a href="#4-属性默认值" class="headerlink" title="4 属性默认值"></a>4 属性默认值</h3><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 组件</span></span><br><span class="line"><span class="keyword">const</span> DefaultVal = <span class="function"><span class="params">props</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>&#123;props.name&#125;<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line">DefaultVal.defaultProps = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;我是默认值!&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 容器</span></span><br><span class="line">&lt;div&gt;</span><br><span class="line">  <span class="xml"><span class="tag">&lt;<span class="name">DefaultVal</span> /&gt;</span></span></span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<p>如果父组件没有设置并传入 <code>name</code> ，<code>defaultProps</code> 将确保 <code>this.props.name</code> 将有一个默认值。</p>
</div></div></article><link rel="stylesheet" type="text/css" href="/css/font.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.css"><script src="//cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script><script src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script>$(document).ready(function() {
  $(".fancybox").fancybox();
});
</script></body></html>
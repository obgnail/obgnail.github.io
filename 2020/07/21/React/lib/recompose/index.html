<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content=" id=&quot;Building-HOCs-with-Recompose&quot;&gt;&lt;a href=&quot;#Building-HOCs-with-Recompose&quot; class=&quot;headerlink&quot; title=&quot;Building HOCs with Recompose&quot;&gt;&lt;/a&gt;&lt;a href=&quot;https://medium.com/front-end-developers/building-hocs-with-recompose-7debb951d101&quot;&gt;Building HOCs with Recompose&lt;/a&gt;&lt;/h2&gt;&lt;h2 id=&quot;什么是高阶组件？&quot;&gt;&lt;a href=&quot;#什么是高阶组件？&quot; class=&quot;headerlink&quot; title=&quot;什么是高阶组件？&quot;&gt;&lt;/a&gt;什么是高阶组件？&lt;/h2&gt;&lt;p&gt;&lt;strong&gt;高阶组件只是一个函数，只不过它返回的是用来渲染 React 组件的函数。&lt;/strong&gt;"><link rel="stylesheet" type="text/css" href="/css/normalize.css"><link rel="stylesheet" type="text/css" href="/css/highlight.css"><link rel="stylesheet" type="text/css" href="/css/noise.css"><title>recompose | 凉薄的自动书记人偶</title><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><meta name="generator" content="Hexo 5.4.0"></head><body><article class="wrapper"><div class="post-main"><div class="nav"><nav class="container"><a class="sidebar-nav-item active" href="/">Home</a></nav><div class="container post-meta"><div class="post-tags"><a class="post-tag-none-link" href="/tags/React/" rel="tag">React</a></div><div class="post-time">2020-07-21</div></div></div><div class="container post-header"><h1>recompose</h1></div><div class="container post-toc"><details class="toc"><summary class="toc-accordion">Table of Contents</summary><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Building-HOCs-with-Recompose"><span class="toc-number">1.</span> <span class="toc-text">Building HOCs with Recompose</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E9%AB%98%E9%98%B6%E7%BB%84%E4%BB%B6%EF%BC%9F"><span class="toc-number">2.</span> <span class="toc-text">什么是高阶组件？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%AB%98%E9%98%B6%E7%BB%84%E4%BB%B6%E6%89%80%E9%81%87%E9%97%AE%E9%A2%98"><span class="toc-number">3.</span> <span class="toc-text">高阶组件所遇问题</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Recompose%E6%98%AF%E4%BB%80%E4%B9%88"><span class="toc-number">4.</span> <span class="toc-text">Recompose是什么</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8"><span class="toc-number">5.</span> <span class="toc-text">快速入门</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4-1-%E2%80%94-%E7%BC%96%E5%86%99%E5%B1%95%E7%A4%BA%E5%9E%8B%E7%BB%84%E4%BB%B6"><span class="toc-number">5.1.</span> <span class="toc-text">步骤 1 — 编写展示型组件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4-2-%E2%80%94-%E7%BC%96%E5%86%99%E5%AE%B9%E5%99%A8"><span class="toc-number">5.2.</span> <span class="toc-text">步骤 2 — 编写容器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4-3-%E2%80%94-%E6%AD%A3%E7%A1%AE%E8%8E%B7%E5%8F%96-state"><span class="toc-number">5.3.</span> <span class="toc-text">步骤 3 — 正确获取 state</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%AD%A5%E9%AA%A4-4-%E2%80%94-%E6%B7%BB%E5%8A%A0-props"><span class="toc-number">5.4.</span> <span class="toc-text">步骤 4 — 添加 props</span></a></li></ol></li></ol></details></div><div class="container post-content"><h2 id="Building-HOCs-with-Recompose"><a href="#Building-HOCs-with-Recompose" class="headerlink" title="Building HOCs with Recompose"></a><a target="_blank" rel="noopener" href="https://medium.com/front-end-developers/building-hocs-with-recompose-7debb951d101">Building HOCs with Recompose</a></h2><h2 id="什么是高阶组件？"><a href="#什么是高阶组件？" class="headerlink" title="什么是高阶组件？"></a>什么是高阶组件？</h2><p><strong>高阶组件只是一个函数，只不过它返回的是用来渲染 React 组件的函数。</strong></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Component &#125; <span class="keyword">from</span> <span class="string">&#x27;React&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">enhancer</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"> <span class="keyword">return</span> <span class="function">(<span class="params">BaseComponent</span>) =&gt;</span> &#123;</span><br><span class="line">   <span class="keyword">return</span> <span class="class"><span class="keyword">class</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">     <span class="function"><span class="title">constructor</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.state = &#123; <span class="attr">visible</span>: <span class="literal">false</span> &#125;; </span><br><span class="line">     &#125;</span><br><span class="line">     <span class="function"><span class="title">componentDidMount</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.setState(&#123; <span class="attr">visible</span>: <span class="literal">true</span> &#125;);</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">       <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">BaseComponent</span> &#123;<span class="attr">...this.props</span>&#125; &#123;<span class="attr">...this.state</span>&#125; /&gt;</span></span>;</span><br><span class="line">     &#125;</span><br><span class="line">   &#125;  </span><br><span class="line"> &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 展示型组件</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Sample</span>(<span class="params">&#123; visible &#125;</span>) </span>&#123;</span><br><span class="line"> <span class="keyword">return</span> visible ? <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span> I am Visible <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span> : <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span> I am not Visible <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> enhance()(Sample);</span><br></pre></td></tr></table></figure>



<p>高阶组件的用途：</p>
<ul>
<li>可以给其他的展示型组件进行相同的代码复用；</li>
<li>简化可读性较差的臃肿的组件；</li>
<li>可以控制传入组件的渲染；</li>
<li>可以给任何组件增加 <code>state</code>，这意味着你不再需要依赖 Redux 来托管所有 <code>state</code>；</li>
<li>操作你传给展示型组件的 <code>props</code>（map，reduce 等任何你喜欢的方法）。</li>
</ul>
<h2 id="高阶组件所遇问题"><a href="#高阶组件所遇问题" class="headerlink" title="高阶组件所遇问题"></a>高阶组件所遇问题</h2><p>高阶组件在使用过程中遇到了几个问题。</p>
<ul>
<li>为简单的场景不断地编写简单地高阶组件就很无聊，</li>
<li><strong>没有将多个高阶组件进行合成的方法，也无法避免开发出冗余的高阶组件</strong>。</li>
</ul>
<p>我们真正需要的解决方案是这样的：</p>
<ul>
<li>强制模式</li>
<li>易于组合</li>
<li>易于使用</li>
</ul>
<h2 id="Recompose是什么"><a href="#Recompose是什么" class="headerlink" title="Recompose是什么"></a>Recompose是什么</h2><p>Recompose 是一个为<code>函数式组件</code>和<code>高阶组件</code>开发的 React 工具库。可以把它<strong>当做 React 的 Lodash</strong>。</p>
<h2 id="快速入门"><a href="#快速入门" class="headerlink" title="快速入门"></a>快速入门</h2><p>假如我们有这样一个组件约束：</p>
<ul>
<li>需要 <code>state</code> 来控制可见性；</li>
<li>需要将改变可见性的函数放到我们的组件中；</li>
<li>需要在组件中添加一些 props。</li>
</ul>
<h3 id="步骤-1-—-编写展示型组件"><a href="#步骤-1-—-编写展示型组件" class="headerlink" title="步骤 1 — 编写展示型组件"></a>步骤 1 — 编写展示型组件</h3><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">Presentation</span>(<span class="params">&#123; title, message, toggleVisibility, isVisible &#125;</span>) </span>&#123;</span><br><span class="line"> <span class="keyword">return</span>  (</span><br><span class="line">   <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">     <span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;title&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="xml">     &#123;isVisible ? <span class="tag">&lt;<span class="name">p</span>&gt;</span>I&#x27;m visible<span class="tag">&lt;/<span class="name">p</span>&gt;</span> : <span class="tag">&lt;<span class="name">p</span>&gt;</span> Not Visible <span class="tag">&lt;/<span class="name">p</span>&gt;</span>&#125;</span></span><br><span class="line"><span class="xml">     <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;message&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml">     <span class="tag">&lt;<span class="name">button</span> <span class="attr">onClick</span>=<span class="string">&#123;toggleVisibility&#125;</span>&gt;</span> Click me! <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span></span><br><span class="line"><span class="xml">   <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span> </span><br><span class="line"> );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="步骤-2-—-编写容器"><a href="#步骤-2-—-编写容器" class="headerlink" title="步骤 2 — 编写容器"></a>步骤 2 — 编写容器</h3><p>通常会把一些 Recompose 的增强型组件合成在一起，所以这个步骤是建立你的 compose：</p>
<blockquote>
<ul>
<li>什么是 Recompose 中的 compose？它相当于 <code>Lodash</code> 中的 <code>flowRight</code> 函数。我们可以使用 compose 来将多个高阶组件转化为一个高阶组件。</li>
</ul>
</blockquote>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; compose &#125; <span class="keyword">from</span> <span class="string">&#x27;recompose&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> compose(</span><br><span class="line">  <span class="comment">/*********************************** </span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * 我们将把增强型组件放在这里</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   ***********************************/</span></span><br><span class="line">)(Presentation);</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="步骤-3-—-正确获取-state"><a href="#步骤-3-—-正确获取-state" class="headerlink" title="步骤 3 — 正确获取 state"></a>步骤 3 — 正确获取 <code>state</code></h3><p>在 Recompose 中，我们可以使用 <code>withState</code> 这个高阶组件来设置组件内的 <code>state</code>，并且使用 <code>withHandlers</code> 高阶组件来设置组件的事件处理函数。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; compose, withState, withHandlers &#125; <span class="keyword">from</span> <span class="string">&#x27;recompose&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> compose(</span><br><span class="line">  withState(<span class="string">&#x27;isVisible&#x27;</span>, <span class="string">&#x27;toggleVis&#x27;</span>, <span class="literal">false</span>),  </span><br><span class="line">  withHandlers(&#123;</span><br><span class="line">    <span class="attr">toggleVisibility</span>: <span class="function">(<span class="params">&#123; toggleVis, isVisible &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">     <span class="keyword">return</span> <span class="function">(<span class="params">event</span>) =&gt;</span> &#123;</span><br><span class="line">       <span class="keyword">return</span> toggleVis(!isVisible);</span><br><span class="line">     &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;)</span><br><span class="line">)(Presentation);</span><br></pre></td></tr></table></figure>

<p>这里我们设置了一个 <code>isVisible</code> 的 <code>state</code>，一个控制可见性的方法 <code>toggleVis</code>，和一个初始值 false。</p>
<p><code>withHandlers</code> 创建了一个高阶组件，它接受一系列 <code>props</code> 并返回一个处理函数，在这个例子中是切换可见性 <code>state</code> 的函数。<code>toggleVisibility</code> 这个函数将作为 <code>Presentation</code> 组件的一个 <code>prop</code>。</p>
<h3 id="步骤-4-—-添加-props"><a href="#步骤-4-—-添加-props" class="headerlink" title="步骤 4 — 添加 props"></a>步骤 4 — 添加 props</h3><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; compose, withState, withHandlers, withProps &#125; <span class="keyword">from</span> <span class="string">&#x27;recompose&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> compose(</span><br><span class="line">  withState(<span class="string">&#x27;isVisible&#x27;</span>, <span class="string">&#x27;toggleVis&#x27;</span>, <span class="literal">false</span>),  </span><br><span class="line">  withHandlers(&#123;</span><br><span class="line">    <span class="attr">toggleVisibility</span>: <span class="function">(<span class="params">&#123; toggleVis, isVisible &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">     <span class="keyword">return</span> <span class="function">(<span class="params">event</span>) =&gt;</span> &#123;</span><br><span class="line">       <span class="keyword">return</span> toggleVis(!isVisible);</span><br><span class="line">     &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;),</span><br><span class="line">  withProps(<span class="function">(<span class="params">&#123; isVisible &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">title</span>: isVisible ? <span class="string">&#x27;This is the visible title&#x27;</span> : <span class="string">&#x27;This is the default title&#x27;</span>,</span><br><span class="line">      <span class="attr">message</span>: isVisible ? <span class="string">&#x27;Hello I am Visible&#x27;</span> : <span class="string">&#x27;I am not visible yet, click the button!&#x27;</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;)</span><br><span class="line">)(Presentation);</span><br></pre></td></tr></table></figure>

<p>这个模式最酷的地方在于我们现在就可以操作组件的 <code>props</code> 了，在这里，通过操作控制可见性的 <code>state</code>，我们可以展示不同的 title 和 message。依我看，这个增强型组件<strong>远比</strong>原来全写在 render 函数中的方式简洁。</p>
<p><a target="_blank" rel="noopener" href="https://juejin.im/post/5c484a43e51d452ec621b6a9">https://juejin.im/post/5c484a43e51d452ec621b6a9</a></p>
</div></div><div class="post-main post-comment"></div></article><link rel="stylesheet" type="text/css" href="/css/font.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.css"><script src="//cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script><script src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script>$(document).ready(function() {
  $(".fancybox").fancybox();
});
</script></body></html>
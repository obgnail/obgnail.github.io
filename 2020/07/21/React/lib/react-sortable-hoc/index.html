<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content=" id=&quot;简介&quot;&gt;&lt;a href=&quot;#简介&quot; class=&quot;headerlink&quot; title=&quot;简介&quot;&gt;&lt;/a&gt;简介&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;能将&lt;strong&gt;任意列表转换为可拖动排序&lt;/strong&gt;的 React 高阶组件，可将任何列表转换为动画，可访问和触摸友好的可排序列表 .&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;React 社区提供了许多的库来&lt;strong&gt;实现拖放的功能&lt;/strong&gt;，例如 &lt;a href=&quot;https://github.com/react-dnd/react-dnd&quot;&gt;react-dnd&lt;/a&gt;, &lt;a href=&quot;https://github.com/atlassian/react-beautiful-dnd&quot;&gt;react-beautiful-dnd&lt;/a&gt;, &lt;a href=&quot;https://www.npmjs.com/package/react-drag-and-drop&quot;&gt;react-drag-n-drop&lt;/a&gt;，等等。但是它们有一些共同的缺陷："><link rel="stylesheet" type="text/css" href="/css/normalize.css"><link rel="stylesheet" type="text/css" href="/css/highlight.css"><link rel="stylesheet" type="text/css" href="/css/noise.css"><title>react-sortable-hoc | 凉薄的自动书记人偶</title><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><meta name="generator" content="Hexo 5.4.0"></head><body><article class="wrapper"><div class="post-main"><div class="nav"><nav class="container"><a class="sidebar-nav-item active" href="/">Home</a></nav><div class="container post-meta"><div class="post-tags"><a class="post-tag-none-link" href="/tags/React/" rel="tag">React</a></div><div class="post-time">2020-07-21</div></div></div><div class="container post-header"><h1>react-sortable-hoc</h1></div><div class="container post-toc"><details class="toc"><summary class="toc-accordion">Table of Contents</summary><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AE%80%E4%BB%8B"><span class="toc-number">1.</span> <span class="toc-text">简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BE%8B%E5%AD%90"><span class="toc-number">2.</span> <span class="toc-text">例子</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BE%8B%E5%AD%902"><span class="toc-number">3.</span> <span class="toc-text">例子2</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%87%86%E5%A4%87%E6%8B%96%E6%8B%BD%E7%9A%84%E5%85%83%E7%B4%A0"><span class="toc-number">3.1.</span> <span class="toc-text">准备拖拽的元素</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E6%8B%96%E6%94%BE%E5%8A%9F%E8%83%BD"><span class="toc-number">3.2.</span> <span class="toc-text">添加拖放功能</span></a></li></ol></li></ol></details></div><div class="container post-content"><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><ul>
<li>能将<strong>任意列表转换为可拖动排序</strong>的 React 高阶组件，可将任何列表转换为动画，可访问和触摸友好的可排序列表 .</li>
</ul>
<p>React 社区提供了许多的库来<strong>实现拖放的功能</strong>，例如 <a target="_blank" rel="noopener" href="https://github.com/react-dnd/react-dnd">react-dnd</a>, <a target="_blank" rel="noopener" href="https://github.com/atlassian/react-beautiful-dnd">react-beautiful-dnd</a>, <a target="_blank" rel="noopener" href="https://www.npmjs.com/package/react-drag-and-drop">react-drag-n-drop</a>，等等。但是它们有一些共同的缺陷：</p>
<ul>
<li>使用复杂，有时候需要做很多工作才能构建一个简单的拖放演示；</li>
<li>功能有限，例如无法实现多个拖放实例这样复杂的功能，</li>
</ul>
<p>为了解决这些问题，<a target="_blank" rel="noopener" href="https://github.com/clauderic/react-sortable-hoc">react-sortable-hoc</a> 应运而生。</p>
<p>React 官方推荐的封装高阶组件的方式是 HOC，我们需要借助它来实现一个具有拖放功能的高阶组件。</p>
<ul>
<li>HOC 自身不是 React API 的一部分，它是一种基于 React 的组合特性而形成的设计模式。</li>
<li>HOC：<code>higher Order Component</code>，高阶组件。本质上是<strong>参数为组件，返回值为新组件的函数。</strong></li>
</ul>
<h2 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h2><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123;Component&#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;render&#125; <span class="keyword">from</span> <span class="string">&#x27;react-dom&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;SortableContainer, SortableElement&#125; <span class="keyword">from</span> <span class="string">&#x27;react-sortable-hoc&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> arrayMove <span class="keyword">from</span> <span class="string">&#x27;array-move&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> SortableItem = SortableElement(<span class="function">(<span class="params">&#123;value&#125;</span>) =&gt;</span> <span class="xml"><span class="tag">&lt;<span class="name">li</span>&gt;</span>&#123;value&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> SortableList = SortableContainer(<span class="function">(<span class="params">&#123;items&#125;</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="xml">      &#123;items.map((value, index) =&gt; (</span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">SortableItem</span> <span class="attr">key</span>=<span class="string">&#123;</span>`<span class="attr">item-</span>$&#123;<span class="attr">index</span>&#125;`&#125; <span class="attr">index</span>=<span class="string">&#123;index&#125;</span> <span class="attr">value</span>=<span class="string">&#123;value&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">      ))&#125;</span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SortableComponent</span> <span class="keyword">extends</span> <span class="title">Component</span> </span>&#123;</span><br><span class="line">  state = &#123;</span><br><span class="line">    <span class="attr">items</span>: [<span class="string">&#x27;Item 1&#x27;</span>, <span class="string">&#x27;Item 2&#x27;</span>, <span class="string">&#x27;Item 3&#x27;</span>, <span class="string">&#x27;Item 4&#x27;</span>, <span class="string">&#x27;Item 5&#x27;</span>, <span class="string">&#x27;Item 6&#x27;</span>],</span><br><span class="line">  &#125;;</span><br><span class="line">  onSortEnd = <span class="function">(<span class="params">&#123;oldIndex, newIndex&#125;</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.setState(<span class="function">(<span class="params">&#123;items&#125;</span>) =&gt;</span> (&#123;</span><br><span class="line">      <span class="attr">items</span>: arrayMove(items, oldIndex, newIndex),</span><br><span class="line">    &#125;));</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">SortableList</span> <span class="attr">items</span>=<span class="string">&#123;this.state.items&#125;</span> <span class="attr">onSortEnd</span>=<span class="string">&#123;this.onSortEnd&#125;</span> /&gt;</span></span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">render(<span class="xml"><span class="tag">&lt;<span class="name">SortableComponent</span> /&gt;</span></span>, <span class="built_in">document</span>.getElementById(<span class="string">&#x27;root&#x27;</span>));</span><br></pre></td></tr></table></figure>



<h2 id="例子2"><a href="#例子2" class="headerlink" title="例子2"></a>例子2</h2><h3 id="准备拖拽的元素"><a href="#准备拖拽的元素" class="headerlink" title="准备拖拽的元素"></a>准备拖拽的元素</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Gif.js</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> PropTypes <span class="keyword">from</span> <span class="string">&#x27;prop-types&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Gif = <span class="function">(<span class="params">&#123; gif &#125;</span>) =&gt;</span> (<span class="xml"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&#123;gif&#125;</span> <span class="attr">alt</span>=<span class="string">&quot;gif&quot;</span> /&gt;</span></span>)</span><br><span class="line"></span><br><span class="line">Gif.propTypes = &#123;</span><br><span class="line">  <span class="attr">gif</span>: PropTypes.string.isRequired,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Gif;</span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.js</span></span><br><span class="line"><span class="keyword">import</span> React, &#123; useState &#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;./App.css&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> Gif <span class="keyword">from</span> <span class="string">&#x27;./Gif&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> App = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> [gifs, setGifs] = useState([</span><br><span class="line">    <span class="string">&#x27;https://media.giphy.com/media/3ohhwoWSCtJzznXbuo/giphy.gif&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;https://media.giphy.com/media/l46CbZ7KWEhN1oci4/giphy.gif&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;https://media.giphy.com/media/3ohzgD1wRxpvpkDCSI/giphy.gif&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;https://media.giphy.com/media/xT1XGYy9NPhWRPp4pq/giphy.gif&#x27;</span>,</span><br><span class="line">  ]);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;App&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Drag those GIFs around<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">h2</span>&gt;</span>Set 1<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="xml">        &#123;gifs.map((gif,  i) =&gt; <span class="tag">&lt;<span class="name">Gif</span> <span class="attr">key</span>=<span class="string">&#123;gif&#125;</span> <span class="attr">gif</span>=<span class="string">&#123;gif&#125;</span> /&gt;</span>)&#125;</span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> App;</span><br></pre></td></tr></table></figure>



<h3 id="添加拖放功能"><a href="#添加拖放功能" class="headerlink" title="添加拖放功能"></a>添加拖放功能</h3><p>现在让我们对 Gif 组件添加拖拽功能。</p>
<blockquote>
<p>首先，我们需要了解 react-sortable-hoc 的两个 HOC，以及 array-move 的 <code>arrayMove</code> 方法，以便于在拖动发生修改数组。</p>
<ul>
<li><code>sortableContainer</code> 是所有可排序元素的容器；</li>
<li><code>sortableElement</code> 是每个可渲染元素的容器。</li>
</ul>
</blockquote>
<p>首先引入对应组件以及方法</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; sortableContainer, sortableElement &#125; <span class="keyword">from</span> <span class="string">&#x27;react-sortable-hoc&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> arrayMove <span class="keyword">from</span> <span class="string">&#x27;array-move&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// SortableGif 为每个子元素创建了一个容器，也就是为单个 Gif 组件创建。它们将使用在SortableGifsContainer 中，以 children 属性传递进去</span></span><br><span class="line"><span class="keyword">const</span> SortableGifsContainer = sortableContainer(<span class="function">(<span class="params">&#123; children &#125;</span>) =&gt;</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">className</span>=<span class="string">&quot;gifs&quot;</span>&gt;</span>&#123;children&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> SortableGif = sortableElement(<span class="function">(<span class="params">&#123; gif &#125;</span>) =&gt;</span> <span class="xml"><span class="tag">&lt;<span class="name">Gif</span> <span class="attr">key</span>=<span class="string">&#123;gif&#125;</span> <span class="attr">gif</span>=<span class="string">&#123;gif&#125;</span> /&gt;</span></span>);</span><br></pre></td></tr></table></figure>

<p>然后用新创建的 <code>SortableGif</code> 替换原有的 <code>Gif</code> 组件，并在 <code>SortableGifsContainer</code> 中使用。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;SortableGifsContainer axis=<span class="string">&quot;x&quot;</span> onSortEnd=&#123;onSortEnd&#125;&gt;</span><br><span class="line">  &#123;gifs.map(<span class="function">(<span class="params">gif, i</span>) =&gt;</span></span><br><span class="line">    <span class="xml"><span class="tag">&lt;<span class="name">SortableGif</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">    // <span class="attr">don</span>&#x27;<span class="attr">t</span> <span class="attr">forget</span> <span class="attr">to</span> <span class="attr">pass</span> <span class="attr">index</span> <span class="attr">prop</span> <span class="attr">with</span> <span class="attr">item</span> <span class="attr">index</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">      <span class="attr">index</span>=<span class="string">&#123;i&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">      <span class="attr">key</span>=<span class="string">&#123;gif&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">      <span class="attr">gif</span>=<span class="string">&#123;gif&#125;</span></span></span></span><br><span class="line"><span class="tag"><span class="xml">    /&gt;</span></span></span><br><span class="line">  )&#125;</span><br><span class="line">&lt;/SortableGifsContainer&gt;</span><br></pre></td></tr></table></figure>





















</div></div><div class="post-main post-comment"></div></article><link rel="stylesheet" type="text/css" href="/css/font.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.css"><script src="//cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script><script src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script>$(document).ready(function() {
  $(".fancybox").fancybox();
});
</script></body></html>
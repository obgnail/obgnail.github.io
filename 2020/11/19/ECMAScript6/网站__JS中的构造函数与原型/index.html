<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content=" id=&quot;构造函数&quot;&gt;&lt;a href=&quot;#构造函数&quot; class=&quot;headerlink&quot; title=&quot;构造函数&quot;&gt;&lt;/a&gt;构造函数&lt;/h2&gt;&lt;p&gt;看下面的Star构造函数"><link rel="stylesheet" type="text/css" href="/css/normalize.css"><link rel="stylesheet" type="text/css" href="/css/highlight.css"><link rel="stylesheet" type="text/css" href="/css/noise.css"><title>JS中的构造函数与原型 | 凉薄的自动书记人偶</title><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><meta name="generator" content="Hexo 5.4.0"></head><body><article class="wrapper"><div class="post-main"><div class="nav"><nav class="container"><a class="sidebar-nav-item active" href="/">Home</a><a class="sidebar-nav-item" href="/archives">Tags</a><a class="sidebar-nav-item" href="/About">About</a></nav><div class="container post-meta"><div class="post-tags"><a class="post-tag-link" href="/tags/ECMAScript6/" rel="tag">ECMAScript6</a></div><div class="post-time">2020-11-19</div></div></div><div class="container post-header"><h1>JS中的构造函数与原型</h1></div><div class="container post-toc"><details class="toc"><summary class="toc-accordion">Table of Contents</summary><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0"><span class="toc-number">1.</span> <span class="toc-text">构造函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#prototype%E5%AF%B9%E8%B1%A1"><span class="toc-number">2.</span> <span class="toc-text">prototype对象</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%B9%E8%B1%A1%E5%8E%9F%E5%9E%8B-proto"><span class="toc-number">3.</span> <span class="toc-text">对象原型__proto__</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8E%9F%E5%9E%8B%E5%AF%B9%E8%B1%A1%E7%9A%84construtor%E5%B1%9E%E6%80%A7"><span class="toc-number">4.</span> <span class="toc-text">原型对象的construtor属性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B0%86%E5%8E%9F%E5%9E%8B%E5%AF%B9%E8%B1%A1%E4%BB%8Eobject%E6%94%B9%E6%88%90map"><span class="toc-number">5.</span> <span class="toc-text">将原型对象从object改成map</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8E%9F%E5%9E%8B%E9%93%BE"><span class="toc-number">6.</span> <span class="toc-text">原型链</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8E%9F%E5%9E%8B%E7%9A%84this%E6%8C%87%E5%90%91"><span class="toc-number">7.</span> <span class="toc-text">原型的this指向</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#call%E5%87%BD%E6%95%B0%E4%BF%AE%E6%94%B9this%E7%9A%84%E6%8C%87%E5%90%91"><span class="toc-number">8.</span> <span class="toc-text">call函数修改this的指向</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AD%90%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0-%E7%BB%A7%E6%89%BF-%E7%88%B6%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0-%E7%9A%84construtor"><span class="toc-number">9.</span> <span class="toc-text">子构造函数 继承 父构造函数 的construtor</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AD%90%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0-%E7%BB%A7%E6%89%BF-%E7%88%B6%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0-%E7%9A%84%E8%87%AA%E5%AE%9A%E4%B9%89%E6%96%B9%E6%B3%95"><span class="toc-number">10.</span> <span class="toc-text">子构造函数 继承 父构造函数 的自定义方法</span></a></li></ol></details></div><div class="container post-content"><h2 id="构造函数"><a href="#构造函数" class="headerlink" title="构造函数"></a>构造函数</h2><p>看下面的Star构造函数</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Star</span>(<span class="params">uname, age</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.uname = uname</span><br><span class="line">  <span class="built_in">this</span>.age = age</span><br><span class="line">  <span class="built_in">this</span>.sing = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;i am singing&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> ldh = <span class="keyword">new</span> Star(<span class="string">&quot;ldh&quot;</span>, <span class="number">22</span>)</span><br><span class="line"><span class="keyword">let</span> zxy = <span class="keyword">new</span> Star(<span class="string">&quot;zxy&quot;</span>, <span class="number">23</span>)</span><br><span class="line">ldh.sing()</span><br><span class="line">zxy.sing()</span><br></pre></td></tr></table></figure>

<p>构造函数最大的问题就是：存在浪费内存的问题。</p>
<blockquote>
<p><code>ldh</code>和<code>zxy</code>的sing方法都是一样的，但是必须创建两个地址块分别给两个人用</p>
</blockquote>
<p><img src="/images/image-20201118100816807.png" alt="image-20201118100816807"></p>
<h2 id="prototype对象"><a href="#prototype对象" class="headerlink" title="prototype对象"></a>prototype对象</h2><p>为了解决这个的问题，<strong>让所有对象使用同一个函数，节省内存</strong>，就需要使用<code>原型</code></p>
<ul>
<li>猴枣函数通过原型分配的函数是所有对象共享的。</li>
<li>每个构造函数都有一个prototype属性，用于指向prototype对象，这个对象的所有属性和方法，都会构造函数所拥有</li>
</ul>
<blockquote>
<p>简单来说，原型对象的作用就是：共享方法。</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Star</span>(<span class="params">uname, age</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.uname = uname;</span><br><span class="line">  <span class="built_in">this</span>.age = age;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Star.prototype.sing = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;i am singing&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> ldh = <span class="keyword">new</span> Star(<span class="string">&quot;ldh&quot;</span>, <span class="number">22</span>)</span><br><span class="line"><span class="keyword">let</span> zxy = <span class="keyword">new</span> Star(<span class="string">&quot;zxy&quot;</span>, <span class="number">23</span>)</span><br><span class="line"><span class="built_in">console</span>.log(ldh.sing === zxy.sing) <span class="comment">// true</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>一般情况下，把公共属性定义到构造函数里面，公共方法放到原型对象对象上</p>
</blockquote>
<h2 id="对象原型-proto"><a href="#对象原型-proto" class="headerlink" title="对象原型__proto__"></a>对象原型<code>__proto__</code></h2><ul>
<li><p>所有对象都会有一个<code>__proto__</code>只想够高函数的prototype原型对象，致所有我们对象可以使用构造函数的prototype对象的属性和方法，就是因为对象有<code>__proto__</code>属性。</p>
</li>
<li><p><code>__proto__</code>属性和构造函数的prototype是等价的。</p>
</li>
<li><p><code>__proto__</code>的意义就在于为查找对象的属性和方法提供一条查找路线。</p>
<p>方法的查找规则：先在ldh对象身上是否有sing方法，如果没有，就根据<code>__proto__</code>属性，去对应的原型对象查找</p>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Star</span>(<span class="params">uname, age</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.uname = uname;</span><br><span class="line">  <span class="built_in">this</span>.age = age;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Star.prototype.sing = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;i am singing&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> ldh = <span class="keyword">new</span> Star(<span class="string">&quot;ldh&quot;</span>, <span class="number">22</span>)</span><br><span class="line"><span class="keyword">let</span> zxy = <span class="keyword">new</span> Star(<span class="string">&quot;zxy&quot;</span>, <span class="number">23</span>)</span><br><span class="line"><span class="built_in">console</span>.log(ldh.__proto__ === Star.prototype) <span class="comment">// true</span></span><br></pre></td></tr></table></figure>



<h2 id="原型对象的construtor属性"><a href="#原型对象的construtor属性" class="headerlink" title="原型对象的construtor属性"></a>原型对象的construtor属性</h2><p>一般来说，每个prototype对象都有一个constructor属性，用于记录该对象引用于那个构造函数，将原型对象重新指向原来的构造函数。</p>
<blockquote>
<p>简单来说，构造函数和原型对象是互相引用的</p>
<ul>
<li>构造函数通过<code>prototype</code>属性引用到原型对象。</li>
<li>原型对象通过<code>coustructor</code>属性引用到构造函数。</li>
</ul>
</blockquote>
<h2 id="将原型对象从object改成map"><a href="#将原型对象从object改成map" class="headerlink" title="将原型对象从object改成map"></a>将原型对象从object改成map</h2><p>因为原型对象本身只会用到<strong>点号去获取属性</strong>，根据鸭子类型，我们可以将构造函数的prototype属性改成map。但是因为原型对象有一个constructor属性，所以需要另加一个constructor这个key</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Star</span>(<span class="params">uname, age</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.uname = uname;</span><br><span class="line">  <span class="built_in">this</span>.age = age;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Star.prototype = &#123;</span><br><span class="line">  <span class="attr">constructor</span> : Star,</span><br><span class="line">  <span class="attr">sing</span> : <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="built_in">console</span>.log(<span class="string">&quot;i am singing&quot;</span>) &#125;,</span><br><span class="line">	<span class="attr">dance</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="built_in">console</span>.log(<span class="string">&quot;i am dancing&quot;</span>) &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="原型链"><a href="#原型链" class="headerlink" title="原型链"></a>原型链</h2><p><img src="/images/image-20201119101332202.png" alt="image-20201119101332202"></p>
<h2 id="原型的this指向"><a href="#原型的this指向" class="headerlink" title="原型的this指向"></a>原型的this指向</h2><p>原型的this就是指向实例本身</p>
<h2 id="call函数修改this的指向"><a href="#call函数修改this的指向" class="headerlink" title="call函数修改this的指向"></a>call函数修改this的指向</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fn</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;hello world&quot;</span>)</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="built_in">this</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> hyl = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;123&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fn.call();</span><br><span class="line">fn.call(hyl); <span class="comment">// 改变this的指向，this变成了hyl</span></span><br></pre></td></tr></table></figure>



<h2 id="子构造函数-继承-父构造函数-的construtor"><a href="#子构造函数-继承-父构造函数-的construtor" class="headerlink" title="子构造函数 继承 父构造函数 的construtor"></a>子构造函数 继承 父构造函数 的construtor</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Father</span>(<span class="params">uname, age</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.uname = uname</span><br><span class="line">  <span class="built_in">this</span>.age = age</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Son</span>(<span class="params">uname, age, sex</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// this指向子构造函数的对象实例</span></span><br><span class="line">  Father.call(<span class="built_in">this</span>, uname, age)</span><br><span class="line">  <span class="built_in">this</span>.sex = sex</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> son = <span class="keyword">new</span> Son(<span class="string">&quot;asd&quot;</span>,<span class="number">15</span>,<span class="string">&quot;male&quot;</span>)</span><br></pre></td></tr></table></figure>



<h2 id="子构造函数-继承-父构造函数-的自定义方法"><a href="#子构造函数-继承-父构造函数-的自定义方法" class="headerlink" title="子构造函数 继承 父构造函数 的自定义方法"></a>子构造函数 继承 父构造函数 的自定义方法</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Father</span>(<span class="params">uname, age</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.uname = uname</span><br><span class="line">  <span class="built_in">this</span>.age = age</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Father.prototype.money = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;i am earnMoney&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Son</span>(<span class="params">uname, age, sex</span>) </span>&#123;</span><br><span class="line">  Father.call(<span class="built_in">this</span>, uname, age)</span><br><span class="line">  <span class="built_in">this</span>.sex = sex</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Son.prototype指向新的Father实例对象</span></span><br><span class="line">Son.prototype = <span class="keyword">new</span> Father();</span><br><span class="line"><span class="comment">// 注意要把constructor指回原来的原型对象</span></span><br><span class="line">Son.prototype.constructor = Son;</span><br><span class="line"></span><br><span class="line">Son.protptype.exam = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&quot;i am examing&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> son = <span class="keyword">new</span> Son(<span class="string">&quot;asd&quot;</span>,<span class="number">15</span>,<span class="string">&quot;male&quot;</span>)</span><br></pre></td></tr></table></figure>

<p><img src="/images/image-20201119102924559.png" alt="image-20201119102924559"></p>
</div></div></article><link rel="stylesheet" type="text/css" href="/css/font.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.css"><script src="//cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script><script src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script>$(document).ready(function() {
  $(".fancybox").fancybox();
});
</script></body></html>
<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="地址 : "><link rel="stylesheet" type="text/css" href="/css/normalize.css"><link rel="stylesheet" type="text/css" href="/css/highlight.css"><link rel="stylesheet" type="text/css" href="/css/noise.css"><title>Go语言web框架Beego从入门到放弃 | 凉薄的自动书记人偶</title><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><meta name="generator" content="Hexo 5.4.0"></head><body><article class="wrapper"><div class="post-main"><div class="nav"><nav class="container"><a class="sidebar-nav-item active" href="/">Home</a><a class="sidebar-nav-item" href="/archives">Tags</a><a class="sidebar-nav-item" href="/About">About</a></nav><div class="container post-meta"><div class="post-tags"><a class="post-tag-link" href="/tags/Beego/" rel="tag">Beego</a></div><div class="post-time">2020-06-12</div></div></div><div class="container post-header"><h1>Go语言web框架Beego从入门到放弃</h1></div><div class="container post-toc"><details class="toc"><summary class="toc-accordion">Table of Contents</summary><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8"><span class="toc-number">1.</span> <span class="toc-text">快速入门</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#controller"><span class="toc-number">1.1.</span> <span class="toc-text">controller</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#template"><span class="toc-number">1.2.</span> <span class="toc-text">template</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#beego-%E7%9A%84-MVC-%E6%9E%B6%E6%9E%84"><span class="toc-number">2.</span> <span class="toc-text">beego 的 MVC 架构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#app-conf"><span class="toc-number">3.</span> <span class="toc-text">app.conf</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ORM"><span class="toc-number">4.</span> <span class="toc-text">ORM</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85"><span class="toc-number">4.1.</span> <span class="toc-text">安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E8%A1%A8"><span class="toc-number">4.2.</span> <span class="toc-text">创建表</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A8%A1%E5%9E%8B%E5%AE%9A%E4%B9%89"><span class="toc-number">4.3.</span> <span class="toc-text">模型定义</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E8%A1%A8%E5%90%8D"><span class="toc-number">4.3.1.</span> <span class="toc-text">自定义表名</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E7%B4%A2%E5%BC%95"><span class="toc-number">4.3.2.</span> <span class="toc-text">自定义索引</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E5%8F%82%E6%95%B0"><span class="toc-number">4.3.3.</span> <span class="toc-text">自定义参数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A1%A8%E5%85%B3%E7%B3%BB"><span class="toc-number">4.3.4.</span> <span class="toc-text">表关系</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8-1"><span class="toc-number">4.4.</span> <span class="toc-text">快速入门</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CURD"><span class="toc-number">4.5.</span> <span class="toc-text">CURD</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#create"><span class="toc-number">4.5.1.</span> <span class="toc-text">create</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#read"><span class="toc-number">4.5.2.</span> <span class="toc-text">read</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ReadOrCreate"><span class="toc-number">4.5.3.</span> <span class="toc-text">ReadOrCreate</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#InsertMulti"><span class="toc-number">4.5.4.</span> <span class="toc-text">InsertMulti</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Update"><span class="toc-number">4.5.5.</span> <span class="toc-text">Update</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Delete"><span class="toc-number">4.5.6.</span> <span class="toc-text">Delete</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%AB%98%E7%BA%A7%E6%9F%A5%E8%AF%A2"><span class="toc-number">4.6.</span> <span class="toc-text">高级查询</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#expr"><span class="toc-number">4.6.1.</span> <span class="toc-text">expr</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Operators"><span class="toc-number">4.6.2.</span> <span class="toc-text">Operators</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%AB%98%E7%BA%A7%E6%9F%A5%E8%AF%A2%E6%8E%A5%E5%8F%A3"><span class="toc-number">4.6.3.</span> <span class="toc-text">高级查询接口</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#filter"><span class="toc-number">5.</span> <span class="toc-text">filter</span></a></li></ol></details></div><div class="container post-content"><p>地址 : </p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV16441137ut">https://www.bilibili.com/video/BV16441137ut</a></li>
<li><a target="_blank" rel="noopener" href="https://beego.me/">https://beego.me/</a></li>
</ul>
<p>创建项目</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bee new hellobee</span><br></pre></td></tr></table></figure>



<h2 id="快速入门"><a href="#快速入门" class="headerlink" title="快速入门"></a>快速入门</h2><ul>
<li>和<code>Django</code>很像 , <ul>
<li>使用<code>urls.py</code> 绑定路由和<code>处理类</code></li>
<li><code>处理类</code>使用<code>get</code>,<code>post</code>等方法处理不同的http请求</li>
<li>使用<code>templates</code>作为模板</li>
</ul>
</li>
<li><code>beego</code>是:<ul>
<li>使用<code>router.go</code>绑定路由和<code>处理结构体</code></li>
<li><code>处理结构体</code>使用<code>get</code>,<code>post</code>等方法处理不同的http请求</li>
<li>使用<code>views</code>作为模板</li>
</ul>
</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// routers/router.go</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">init</span><span class="params">()</span></span> &#123;</span><br><span class="line">    beego.Router(<span class="string">&quot;/&quot;</span>, &amp;controllers.MainController&#123;&#125;)</span><br><span class="line">    <span class="comment">// 第三参数为mappingMethods , 对于get请求方法,将强制调用MainController结构体的Login方法 , post同理</span></span><br><span class="line">    beego.Router(<span class="string">&quot;/login&quot;</span>, &amp;controllers.MainController&#123;&#125;,<span class="string">&quot;get:Login;post:HandleLogin&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// controllers/hellobee.go</span></span><br><span class="line"><span class="keyword">type</span> MainController <span class="keyword">struct</span> &#123;</span><br><span class="line">	beego.Controller</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *MainController)</span> <span class="title">Get</span><span class="params">()</span></span> &#123;</span><br><span class="line">	c.Data[<span class="string">&quot;name&quot;</span>] = <span class="string">&quot;Get&quot;</span></span><br><span class="line">	c.TplName = <span class="string">&quot;hellobeego.html&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *MainController)</span> <span class="title">Post</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 获取form中的字段</span></span><br><span class="line">	username := c.GetString(<span class="string">&quot;username&quot;</span>)</span><br><span class="line">	c.Data[<span class="string">&quot;name&quot;</span>] = username</span><br><span class="line">	c.TplName = <span class="string">&quot;hellobeego.html&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *MainController)</span> <span class="title">Login</span><span class="params">()</span></span> &#123;</span><br><span class="line">	c.Data[<span class="string">&quot;name&quot;</span>] = <span class="string">&quot;login&quot;</span></span><br><span class="line">	c.TplName = <span class="string">&quot;hellobeego.html&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *MainController)</span> <span class="title">HandleLogin</span><span class="params">()</span></span> &#123;</span><br><span class="line">	c.Data[<span class="string">&quot;name&quot;</span>] = <span class="string">&quot;login&quot;</span></span><br><span class="line">	<span class="comment">// 重定向,参数分别为ul和code</span></span><br><span class="line">	c.Redirect(<span class="string">&quot;/login&quot;</span>,<span class="number">302</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 处理文件上传</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *MainController)</span> <span class="title">HandleFile</span><span class="params">()</span></span> &#123;</span><br><span class="line">	file, fileheader, err := c.GetFile(<span class="string">&quot;uploadname&quot;</span>)</span><br><span class="line">	<span class="keyword">defer</span> file.Close()</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// 限定格式</span></span><br><span class="line">	fileext := path.Ext(fileheader.Filename)</span><br><span class="line">	<span class="keyword">if</span> fileext != <span class="string">&quot;.jpg&quot;</span> &amp;&amp; fileext != <span class="string">&quot;.png&quot;</span> &#123;</span><br><span class="line">		beego.Warn(<span class="string">&quot;上传文件格式错误&quot;</span>)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// 限定大小</span></span><br><span class="line">	<span class="keyword">if</span> fileheader.Size &gt; <span class="number">5000000</span> &#123;</span><br><span class="line">		beego.Warn(<span class="string">&quot;上传文件过大&quot;</span>)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;getfile err&quot;</span>, err)</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		c.SaveToFile(<span class="string">&quot;uploadname&quot;</span>, <span class="string">&quot;./static/file/&quot;</span>+fileheader.Filename)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[ hellobeego.html ]</span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>&#123;&#123;.name&#125;&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">value</span>=<span class="string">&quot;post数据&quot;</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span>&gt;</span>按钮<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h3 id="controller"><a href="#controller" class="headerlink" title="controller"></a>controller</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> controllers</span><br><span class="line"><span class="keyword">import</span>  <span class="string">&quot;github.com/astaxie/beego&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 内嵌了 beego.Controller , MainController 自动拥有了所有 beego.Controller 的方法。</span></span><br><span class="line"><span class="keyword">type</span> MainController <span class="keyword">struct</span> &#123;</span><br><span class="line">        beego.Controller</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *MainController)</span> <span class="title">Get</span><span class="params">()</span></span> &#123;</span><br><span class="line">        this.Data[<span class="string">&quot;Website&quot;</span>] = <span class="string">&quot;beego.me&quot;</span></span><br><span class="line">        this.Data[<span class="string">&quot;Email&quot;</span>] = <span class="string">&quot;astaxie@gmail.com&quot;</span></span><br><span class="line">        this.TplName = <span class="string">&quot;index.tpl&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p><code>this.Data</code> 是一个用来存储输出数据的 map，可以赋值任意类型的值</p>
</li>
<li><p><code>this.TplName</code> 就是需要渲染的模板，如果用户不设置该参数，那么默认会去到模板目录的 <code>Controller/&lt;方法名&gt;.tpl</code> 查找</p>
<blockquote>
<ul>
<li><p>用户设置了模板之后系统会自动的调用 <code>Render</code> 函数（这个函数是在 beego.Controller 中实现的），所以无需用户自己来调用渲染。</p>
</li>
<li><p>也可以直接用 <code>this.Ctx.WriteString</code> 输出字符串</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(this *MainController)</span> <span class="title">Get</span><span class="params">()</span></span> &#123;</span><br><span class="line">        this.Ctx.WriteString(<span class="string">&quot;hello&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</blockquote>
</li>
</ul>
<h3 id="template"><a href="#template" class="headerlink" title="template"></a>template</h3><ul>
<li>支持 <code>tpl</code> 和 <code>html</code> 的后缀名 , 如果想设置其他后缀你可以调用 <code>beego.AddTemplateExt</code> 接口设置</li>
</ul>
<h2 id="beego-的-MVC-架构"><a href="#beego-的-MVC-架构" class="headerlink" title="beego 的 MVC 架构"></a>beego 的 MVC 架构</h2><p><img src="/images/detail.png" alt="img"></p>
<h2 id="app-conf"><a href="#app-conf" class="headerlink" title="app.conf"></a>app.conf</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">appname = beepkg</span><br><span class="line">httpaddr = &quot;127.0.0.1&quot;</span><br><span class="line">httpport = 9090</span><br><span class="line">runmode =&quot;dev&quot;</span><br><span class="line">autorender = false</span><br><span class="line">recoverpanic = false</span><br><span class="line">viewspath = &quot;myview&quot;</span><br><span class="line"></span><br><span class="line">mysqluser = &quot;root&quot;</span><br><span class="line">mysqlpass = &quot;rootpass&quot;</span><br></pre></td></tr></table></figure>

<p>获取设置的配置信息:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">beego.AppConfig.String(<span class="string">&quot;mysqluser&quot;</span>)</span><br><span class="line">beego.AppConfig.String(<span class="string">&quot;mysqlpass&quot;</span>)</span><br></pre></td></tr></table></figure>



<h2 id="ORM"><a href="#ORM" class="headerlink" title="ORM"></a>ORM</h2><h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">go get github.com/astaxie/beego/orm</span><br><span class="line"></span><br><span class="line">go get -u github.com/go-sql-driver/mysql</span><br><span class="line">或者</span><br><span class="line">go get -u github.com/lib/pq</span><br></pre></td></tr></table></figure>



<h3 id="创建表"><a href="#创建表" class="headerlink" title="创建表"></a>创建表</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> models</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;github.com/astaxie/beego/orm&quot;</span></span><br><span class="line">	_ <span class="string">&quot;github.com/lib/pq&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">	Id   <span class="keyword">int</span> <span class="string">`orm:&quot;pk&quot;`</span></span><br><span class="line">	Name <span class="keyword">string</span></span><br><span class="line">	Pwd  <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">init</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 注册驱动</span></span><br><span class="line">	orm.RegisterDriver(<span class="string">&quot;postgres&quot;</span>, orm.DRPostgres)</span><br><span class="line">	<span class="comment">// 设置数据库基本信息</span></span><br><span class="line">	orm.RegisterDataBase(<span class="string">&quot;default&quot;</span>, <span class="string">&quot;postgres&quot;</span>,</span><br><span class="line">		<span class="string">&quot;user=postgres password=liangbo4869 dbname=hellobeego host=127.0.0.1 port=5432 sslmode=disable&quot;</span>)</span><br><span class="line">	<span class="comment">// 映射model数据</span></span><br><span class="line">	orm.RegisterModel(<span class="built_in">new</span>(User))</span><br><span class="line">	<span class="comment">// 生成表</span></span><br><span class="line">	orm.RunSyncdb(<span class="string">&quot;default&quot;</span>, <span class="literal">false</span>, <span class="literal">true</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意要在<code>main.go</code>里注册<code>init()函数</code></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line">           ...</span><br><span class="line">	_ <span class="string">&quot;hellobee/models&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	beego.Run()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这点很像flask中的<code>from ... import XXX</code></p>
</blockquote>
<h3 id="模型定义"><a href="#模型定义" class="headerlink" title="模型定义"></a>模型定义</h3><p>默认的表名规则，使用驼峰转蛇形：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">AuthUser -&gt; auth_user</span><br><span class="line">Auth_User -&gt; auth__user</span><br><span class="line">DB_AuthUser -&gt; d_b__auth_user</span><br></pre></td></tr></table></figure>

<p>除了开头的大写字母以外，遇到大写会增加 <code>_</code>，原名称中的下划线保留。</p>
<h4 id="自定义表名"><a href="#自定义表名" class="headerlink" title="自定义表名"></a>自定义表名</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">    Id <span class="keyword">int</span></span><br><span class="line">    Name <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(u *User)</span> <span class="title">TableName</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;auth_user&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="自定义索引"><a href="#自定义索引" class="headerlink" title="自定义索引"></a>自定义索引</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">    Id    <span class="keyword">int</span></span><br><span class="line">    Name  <span class="keyword">string</span></span><br><span class="line">    Email <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 多字段索引</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(u *User)</span> <span class="title">TableIndex</span><span class="params">()</span> [][]<span class="title">string</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> [][]<span class="keyword">string</span>&#123;</span><br><span class="line">        []<span class="keyword">string</span>&#123;<span class="string">&quot;Id&quot;</span>, <span class="string">&quot;Name&quot;</span>&#125;,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 多字段唯一键</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(u *User)</span> <span class="title">TableUnique</span><span class="params">()</span> [][]<span class="title">string</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> [][]<span class="keyword">string</span>&#123;</span><br><span class="line">        []<span class="keyword">string</span>&#123;<span class="string">&quot;Name&quot;</span>, <span class="string">&quot;Email&quot;</span>&#125;,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="自定义参数"><a href="#自定义参数" class="headerlink" title="自定义参数"></a>自定义参数</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">orm:<span class="string">&quot;null;rel(fk)&quot;</span></span><br></pre></td></tr></table></figure>

<p>多个设置间使用 <code>;</code> 分隔，设置的值如果是多个，使用 <code>,</code> 分隔。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">    Id    <span class="keyword">int</span> <span class="string">`orm:&quot;pk&quot;`</span> <span class="comment">// 主键</span></span><br><span class="line">    Id2 <span class="keyword">int</span> <span class="string">`orm:&quot;auto&quot;`</span> <span class="comment">// 当 Field 类型为 int, int32, int64, uint, uint32, uint64 时，可以设置字段为自增健</span></span><br><span class="line">    Name  <span class="keyword">string</span> <span class="string">`orm:&quot;null&quot;`</span> <span class="comment">// 数据库表默认为 NOT NULL，设置 null 代表 ALLOW NULL</span></span><br><span class="line">    Email <span class="keyword">string</span> <span class="string">`orm:&quot;index&quot;`</span> <span class="comment">// 为单个字段增加索引</span></span><br><span class="line">    AnyField <span class="keyword">string</span> <span class="string">`orm:&quot;-&quot;`</span> <span class="comment">// 忽略 struct 中的字段</span></span><br><span class="line">    AnyField <span class="keyword">string</span> <span class="string">`orm:&quot;unique&quot;`</span> <span class="comment">// 为单个字段增加 unique 键</span></span><br><span class="line">    Name <span class="keyword">string</span> <span class="string">`orm:&quot;column(user_name)&quot;`</span> <span class="comment">// 为字段设置 db 字段的名称</span></span><br><span class="line">    Title <span class="keyword">string</span> <span class="string">`orm:&quot;size(60)&quot;`</span> <span class="comment">// string 类型字段默认为 varchar(255),设置后db type 将使用 varchar(size)</span></span><br><span class="line">    Money <span class="keyword">float64</span> <span class="string">`orm:&quot;digits(12);decimals(4)&quot;`</span> <span class="comment">// 设置 float32, float64 类型的浮点精度</span></span><br><span class="line">    Created time.Time <span class="string">`orm:&quot;auto_now_add;type(datetime)&quot;`</span> <span class="comment">// auto_now_add 第一次保存时才设置时间</span></span><br><span class="line">    Updated time.Time <span class="string">`orm:&quot;auto_now;type(datetime)&quot;`</span> <span class="comment">// auto_now 每次 model 保存时都会对时间自动更新</span></span><br><span class="line">    Created time.Time <span class="string">`orm:&quot;auto_now_add;type(date)&quot;`</span> <span class="comment">// 设置为 date 时，time.Time 字段的对应 db 类型使用 date</span></span><br><span class="line">    Created time.Time <span class="string">`orm:&quot;auto_now_add;type(datetime)&quot;`</span> <span class="comment">// 设置为 datetime 时，time.Time 字段的对应 db 类型使用 datetime</span></span><br><span class="line">    Status <span class="keyword">int</span> <span class="string">`orm:&quot;default(1)&quot;`</span> <span class="comment">// 为字段设置默认值</span></span><br><span class="line">    Status <span class="keyword">int</span> <span class="string">`orm:&quot;default(1)&quot; description:&quot;这是状态字段&quot;`</span> <span class="comment">// 为字段添加注释</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="表关系"><a href="#表关系" class="headerlink" title="表关系"></a>表关系</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// RelOneToOne</span></span><br><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">    Profile *Profile <span class="string">`orm:&quot;null;rel(one);on_delete(set_null)&quot;`</span> <span class="comment">// RelOneToOne</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"> <span class="comment">// 对应的反向关系 RelReverseOne:</span></span><br><span class="line"><span class="keyword">type</span> Profile <span class="keyword">struct</span> &#123;</span><br><span class="line">    User *User <span class="string">`orm:&quot;reverse(one)&quot;`</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// RelForeignKey:</span></span><br><span class="line"><span class="keyword">type</span> Post <span class="keyword">struct</span> &#123;</span><br><span class="line">    User *User <span class="string">`orm:&quot;rel(fk)&quot;`</span> <span class="comment">// RelForeignKey relation</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 对应的反向关系 RelReverseMany</span></span><br><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">    Posts []*Post <span class="string">`orm:&quot;reverse(many)&quot;`</span> <span class="comment">// fk 的反向关系</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// RelManyToMany</span></span><br><span class="line"><span class="keyword">type</span> Post <span class="keyword">struct</span> &#123;</span><br><span class="line">    Tags []*Tag <span class="string">`orm:&quot;rel(m2m)&quot;`</span> <span class="comment">// ManyToMany relation</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 对应的反向关系 RelReverseMany</span></span><br><span class="line"><span class="keyword">type</span> Tag <span class="keyword">struct</span> &#123;</span><br><span class="line">    Posts []*Post <span class="string">`orm:&quot;reverse(many)&quot;`</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="快速入门-1"><a href="#快速入门-1" class="headerlink" title="快速入门"></a>快速入门</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> models</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;github.com/astaxie/beego/orm&quot;</span></span><br><span class="line">	_ <span class="string">&quot;github.com/lib/pq&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">	Id   <span class="keyword">int</span> <span class="string">`orm:&quot;pk&quot;`</span></span><br><span class="line">	Name <span class="keyword">string</span></span><br><span class="line">	Pwd  <span class="keyword">string</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> controllers</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *MyController2)</span> <span class="title">Get</span><span class="params">()</span></span> &#123;</span><br><span class="line">	o := orm.NewOrm()</span><br><span class="line">	<span class="keyword">var</span> users []models.User</span><br><span class="line">	_,err := o.QueryTable(<span class="string">&quot;User&quot;</span>).All(&amp;users)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		beego.Info(<span class="string">&quot;查询所有用户信息出错&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line">	c.Data[<span class="string">&quot;users&quot;</span>] = users</span><br><span class="line">	c.TplName = <span class="string">&quot;orm.html&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[ orm.html ]</span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">&#123;&#123;range .users&#125;&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; .Id &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; .Name &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; .RegTime.Fotmat &quot;2006-01-02&quot; &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; .Pwd &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">&#123;&#123;end&#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h3 id="CURD"><a href="#CURD" class="headerlink" title="CURD"></a>CURD</h3><h4 id="create"><a href="#create" class="headerlink" title="create"></a>create</h4><p>beego要添加一行数据很麻烦 :</p>
<ol>
<li>创建ORM对象</li>
<li>创建待插入数据库的结构体对象</li>
<li>给结构体对象赋值</li>
<li>插入数据库</li>
</ol>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> controllers</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *MyController)</span> <span class="title">Get</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 创建ORM对象</span></span><br><span class="line">	o := orm.NewOrm()</span><br><span class="line">	<span class="comment">// 创建待插入数据库的结构体对象</span></span><br><span class="line">	user := models.User&#123;Name: <span class="string">&quot;heyingliang&quot;</span>, Pwd: <span class="string">&quot;123456&quot;</span>&#125;</span><br><span class="line">	<span class="comment">// 插入数据库,返回操作的行数和错误</span></span><br><span class="line">	_, err := o.Insert(&amp;user)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		beego.Warning(<span class="string">&quot;插入失败&quot;</span>, err)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	c.Data[<span class="string">&quot;name&quot;</span>] = <span class="string">&quot;Get&quot;</span></span><br><span class="line">	c.TplName = <span class="string">&quot;hellobeego.html&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="read"><a href="#read" class="headerlink" title="read"></a>read</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">o := orm.NewOrm()</span><br><span class="line">user := User&#123;Id: <span class="number">1</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 查找后自动填充user结构体的其他字段</span></span><br><span class="line">err := o.Read(&amp;user)</span><br><span class="line"><span class="keyword">if</span> err == orm.ErrNoRows &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;查询不到&quot;</span>)</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> err == orm.ErrMissPK &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;找不到主键&quot;</span>)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    fmt.Println(user.Id, user.Name)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Read 默认通过查询主键赋值，可以使用指定的字段进行查询：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">user := User&#123;Name: <span class="string">&quot;slene&quot;</span>&#125;</span><br><span class="line">err = o.Read(&amp;user, <span class="string">&quot;Name&quot;</span>)</span><br></pre></td></tr></table></figure>



<h4 id="ReadOrCreate"><a href="#ReadOrCreate" class="headerlink" title="ReadOrCreate"></a>ReadOrCreate</h4><p>尝试从数据库读取，不存在的话就创建一个</p>
<p>默认必须传入一个参数作为条件字段，同时也支持多个参数多个条件字段</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">o := orm.NewOrm()</span><br><span class="line">user := User&#123;Name: <span class="string">&quot;slene&quot;</span>&#125;</span><br><span class="line"><span class="comment">// 三个返回参数依次为：是否新创建的，对象 Id 值，错误</span></span><br><span class="line"><span class="keyword">if</span> created, id, err := o.ReadOrCreate(&amp;user, <span class="string">&quot;Name&quot;</span>); err == <span class="literal">nil</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> created &#123;</span><br><span class="line">        fmt.Println(<span class="string">&quot;New Insert an object. Id:&quot;</span>, id)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        fmt.Println(<span class="string">&quot;Get an object. Id:&quot;</span>, id)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="InsertMulti"><a href="#InsertMulti" class="headerlink" title="InsertMulti"></a>InsertMulti</h4><p>同时插入多个对象</p>
<p>类似sql语句</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">insert into table (name, age) values(<span class="string">&quot;slene&quot;</span>, <span class="number">28</span>),(<span class="string">&quot;astaxie&quot;</span>, <span class="number">30</span>),(<span class="string">&quot;unknown&quot;</span>, <span class="number">20</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 第一个参数 bulk 为并列插入的数量，第二个为对象的slice</span></span><br><span class="line"><span class="comment">// bulk 为 1 时，将会顺序插入 slice 中的数据</span></span><br><span class="line">users := []User&#123;</span><br><span class="line">    &#123;Name: <span class="string">&quot;slene&quot;</span>&#125;,</span><br><span class="line">    &#123;Name: <span class="string">&quot;astaxie&quot;</span>&#125;,</span><br><span class="line">    &#123;Name: <span class="string">&quot;unknown&quot;</span>&#125;,</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 返回值为成功插入的数量</span></span><br><span class="line">successNums, err := o.InsertMulti(<span class="number">100</span>, users)</span><br></pre></td></tr></table></figure>



<h4 id="Update"><a href="#Update" class="headerlink" title="Update"></a>Update</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 第一个返回值为影响的行数</span></span><br><span class="line">o := orm.NewOrm()</span><br><span class="line">user := User&#123;Id: <span class="number">1</span>&#125;</span><br><span class="line"><span class="keyword">if</span> o.Read(&amp;user) == <span class="literal">nil</span> &#123;</span><br><span class="line">    user.Name = <span class="string">&quot;MyName&quot;</span></span><br><span class="line">    <span class="keyword">if</span> num, err := o.Update(&amp;user); err == <span class="literal">nil</span> &#123;</span><br><span class="line">        fmt.Println(num)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Update 默认更新所有的字段，可以更新指定的字段：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 只更新 Name</span></span><br><span class="line">o.Update(&amp;user, <span class="string">&quot;Name&quot;</span>)</span><br><span class="line"><span class="comment">// 指定多个字段</span></span><br><span class="line"><span class="comment">// o.Update(&amp;user, &quot;Field1&quot;, &quot;Field2&quot;, ...)</span></span><br></pre></td></tr></table></figure>



<h4 id="Delete"><a href="#Delete" class="headerlink" title="Delete"></a>Delete</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">o := orm.NewOrm()</span><br><span class="line"><span class="keyword">if</span> num, err := o.Delete(&amp;User&#123;Id: <span class="number">1</span>&#125;); err == <span class="literal">nil</span> &#123;</span><br><span class="line">    fmt.Println(num)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="高级查询"><a href="#高级查询" class="headerlink" title="高级查询"></a>高级查询</h3><p>ORM 以 <strong>QuerySeter</strong> 来组织查询，每个返回 <strong>QuerySeter</strong> 的方法都会获得一个新的 <strong>QuerySeter</strong> 对象。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">o := orm.NewOrm()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取 QuerySeter 对象，user 为表名</span></span><br><span class="line">qs := o.QueryTable(<span class="string">&quot;user&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 也可以直接使用对象作为表名</span></span><br><span class="line">user := <span class="built_in">new</span>(User)</span><br><span class="line">qs = o.QueryTable(user) <span class="comment">// 返回 QuerySeter</span></span><br></pre></td></tr></table></figure>



<h4 id="expr"><a href="#expr" class="headerlink" title="expr"></a>expr</h4><ul>
<li>QuerySeter 中用于描述字段和 sql 操作符，使用简单的 expr 查询方法</li>
<li>字段组合的前后顺序依照表的关系，比如 User 表拥有 Profile 的外键，那么对 User 表查询对应的 Profile.Age 为条件，则使用 <code>Profile__Age</code> </li>
<li>注意，字段的分隔符号使用双下划线 <code>__</code>，除了描述字段， expr 的尾部可以增加操作符以执行对应的 sql 操作。比如 <code>Profile__Age__gt</code> 代表 Profile.Age &gt; 18 的条件查询。</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">qs.Filter(<span class="string">&quot;id&quot;</span>, <span class="number">1</span>) <span class="comment">// WHERE id = 1</span></span><br><span class="line">qs.Filter(<span class="string">&quot;id__exact&quot;</span>,  <span class="number">1</span>) <span class="comment">// WHERE id = 1</span></span><br><span class="line">qs.Filter(<span class="string">&quot;profile__age&quot;</span>, <span class="number">18</span>) <span class="comment">// WHERE profile.age = 18</span></span><br><span class="line">qs.Filter(<span class="string">&quot;Profile__Age&quot;</span>, <span class="number">18</span>) <span class="comment">// 使用字段名和 Field 名都是允许的</span></span><br><span class="line">qs.Filter(<span class="string">&quot;profile__age&quot;</span>, <span class="number">18</span>) <span class="comment">// WHERE profile.age = 18</span></span><br><span class="line">qs.Filter(<span class="string">&quot;profile__age__gt&quot;</span>, <span class="number">18</span>) <span class="comment">// WHERE profile.age &gt; 18</span></span><br><span class="line">qs.Filter(<span class="string">&quot;profile__age__gte&quot;</span>, <span class="number">18</span>) <span class="comment">// WHERE profile.age &gt;= 18</span></span><br><span class="line">qs.Filter(<span class="string">&quot;profile__age__in&quot;</span>, <span class="number">18</span>, <span class="number">20</span>) <span class="comment">// WHERE profile.age IN (18, 20)</span></span><br><span class="line"></span><br><span class="line">qs.Filter(<span class="string">&quot;profile__age__in&quot;</span>, <span class="number">18</span>, <span class="number">20</span>).Exclude(<span class="string">&quot;profile__lt&quot;</span>, <span class="number">1000</span>) <span class="comment">// WHERE profile.age IN (18, 20) AND NOT profile_id &lt; 1000</span></span><br></pre></td></tr></table></figure>



<h4 id="Operators"><a href="#Operators" class="headerlink" title="Operators"></a>Operators</h4><p>当前支持的操作符号：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://beego.me/docs/mvc/model/query.md#exact">exact</a> / <a target="_blank" rel="noopener" href="https://beego.me/docs/mvc/model/query.md#iexact">iexact</a> 等于</li>
<li><a target="_blank" rel="noopener" href="https://beego.me/docs/mvc/model/query.md#contains">contains</a> / <a target="_blank" rel="noopener" href="https://beego.me/docs/mvc/model/query.md#icontains">icontains</a> 包含</li>
<li><a target="_blank" rel="noopener" href="https://beego.me/docs/mvc/model/query.md#gt-%2F-gte">gt / gte</a> 大于 / 大于等于</li>
<li><a target="_blank" rel="noopener" href="https://beego.me/docs/mvc/model/query.md#lt-%2F-lte">lt / lte</a> 小于 / 小于等于</li>
<li><a target="_blank" rel="noopener" href="https://beego.me/docs/mvc/model/query.md#startswith">startswith</a> / <a target="_blank" rel="noopener" href="https://beego.me/docs/mvc/model/query.md#istartswith">istartswith</a> 以…起始</li>
<li><a target="_blank" rel="noopener" href="https://beego.me/docs/mvc/model/query.md#endswith">endswith</a> / <a target="_blank" rel="noopener" href="https://beego.me/docs/mvc/model/query.md#iendswith">iendswith</a> 以…结束</li>
<li><a target="_blank" rel="noopener" href="https://beego.me/docs/mvc/model/query.md#in">in</a></li>
<li><a target="_blank" rel="noopener" href="https://beego.me/docs/mvc/model/query.md#isnull">isnull</a></li>
</ul>
<p>后面以 <code>i</code> 开头的表示：大小写不敏感</p>
<h4 id="高级查询接口"><a href="#高级查询接口" class="headerlink" title="高级查询接口"></a>高级查询接口</h4><p>QuerySeter 是高级查询使用的接口</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> QuerySeter <span class="keyword">interface</span> &#123;</span><br><span class="line">	Filter(<span class="keyword">string</span>, ...<span class="keyword">interface</span>&#123;&#125;) QuerySeter</span><br><span class="line">	Exclude(<span class="keyword">string</span>, ...<span class="keyword">interface</span>&#123;&#125;) QuerySeter</span><br><span class="line">	SetCond(*Condition) QuerySeter</span><br><span class="line">	Limit(<span class="keyword">int</span>, ...<span class="keyword">int64</span>) QuerySeter</span><br><span class="line">	Offset(<span class="keyword">int64</span>) QuerySeter</span><br><span class="line">	GroupBy(...<span class="keyword">string</span>) QuerySeter</span><br><span class="line">	OrderBy(...<span class="keyword">string</span>) QuerySeter</span><br><span class="line">	Distinct() QuerySeter</span><br><span class="line">	RelatedSel(...<span class="keyword">interface</span>&#123;&#125;) QuerySeter</span><br><span class="line">	Count() (<span class="keyword">int64</span>, error)</span><br><span class="line">	Exist() <span class="keyword">bool</span></span><br><span class="line">	Update(Params) (<span class="keyword">int64</span>, error)</span><br><span class="line">	Delete() (<span class="keyword">int64</span>, error)</span><br><span class="line">	PrepareInsert() (Inserter, error)</span><br><span class="line">	All(<span class="keyword">interface</span>&#123;&#125;, ...<span class="keyword">string</span>) (<span class="keyword">int64</span>, error)</span><br><span class="line">	One(<span class="keyword">interface</span>&#123;&#125;, ...<span class="keyword">string</span>) error</span><br><span class="line">	Values(*[]Params, ...<span class="keyword">string</span>) (<span class="keyword">int64</span>, error)</span><br><span class="line">	ValuesList(*[]ParamsList, ...<span class="keyword">string</span>) (<span class="keyword">int64</span>, error)</span><br><span class="line">	ValuesFlat(*ParamsList, <span class="keyword">string</span>) (<span class="keyword">int64</span>, error)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>SetCond</p>
<p>自定义条件表达式</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">cond := orm.NewCondition()</span><br><span class="line">cond1 := cond.And(<span class="string">&quot;profile__isnull&quot;</span>, <span class="literal">false</span>).AndNot(<span class="string">&quot;status__in&quot;</span>, <span class="number">1</span>).Or(<span class="string">&quot;profile__age__gt&quot;</span>, <span class="number">2000</span>)</span><br><span class="line"></span><br><span class="line">qs := orm.QueryTable(<span class="string">&quot;user&quot;</span>)</span><br><span class="line">qs = qs.SetCond(cond1)</span><br><span class="line"><span class="comment">// WHERE ... AND ... AND NOT ... OR ...</span></span><br><span class="line"></span><br><span class="line">cond2 := cond.AndCond(cond1).OrCond(cond.And(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;slene&quot;</span>))</span><br><span class="line">qs = qs.SetCond(cond2).Count()</span><br><span class="line"><span class="comment">// WHERE (... AND ... AND NOT ... OR ...) OR ( ... )</span></span><br></pre></td></tr></table></figure>



<p>GroupBy</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">qs.GroupBy(<span class="string">&quot;id&quot;</span>, <span class="string">&quot;age&quot;</span>)</span><br><span class="line"><span class="comment">// GROUP BY id,age</span></span><br></pre></td></tr></table></figure>



<p>OrderBy</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">qs.OrderBy(<span class="string">&quot;id&quot;</span>, <span class="string">&quot;-profile__age&quot;</span>)</span><br><span class="line"><span class="comment">// ORDER BY id ASC, profile.age DESC</span></span><br><span class="line"></span><br><span class="line">qs.OrderBy(<span class="string">&quot;-profile__age&quot;</span>, <span class="string">&quot;profile&quot;</span>)</span><br><span class="line"><span class="comment">// ORDER BY profile.age DESC, profile_id ASC</span></span><br></pre></td></tr></table></figure>



<p>Distinct</p>
<p>对应 sql 的 distinct 语句, 返回不重复的值.</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">qs.Distinct()</span><br><span class="line"><span class="comment">// SELECT DISTINCT</span></span><br></pre></td></tr></table></figure>



<p>RelatedSel</p>
<p>关系查询，参数使用 expr</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> DefaultRelsDepth = <span class="number">5</span> <span class="comment">// 默认情况下直接调用 RelatedSel 将进行最大 5 层的关系查询</span></span><br><span class="line"></span><br><span class="line">qs := o.QueryTable(<span class="string">&quot;post&quot;</span>)</span><br><span class="line"></span><br><span class="line">qs.RelatedSel()</span><br><span class="line"><span class="comment">// INNER JOIN user ... LEFT OUTER JOIN profile ...</span></span><br><span class="line"></span><br><span class="line">qs.RelatedSel(<span class="string">&quot;user&quot;</span>)</span><br><span class="line"><span class="comment">// INNER JOIN user ...</span></span><br><span class="line"><span class="comment">// 设置 expr 只对设置的字段进行关系查询</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 对设置 null 属性的 Field 将使用 LEFT OUTER JOIN</span></span><br></pre></td></tr></table></figure>



<p>Update</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 批量更新操作</span></span><br><span class="line">num, err := o.QueryTable(<span class="string">&quot;user&quot;</span>).Filter(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;slene&quot;</span>).Update(orm.Params&#123;</span><br><span class="line">    <span class="string">&quot;name&quot;</span>: <span class="string">&quot;astaxie&quot;</span>,</span><br><span class="line">&#125;)</span><br><span class="line">fmt.Printf(<span class="string">&quot;Affected Num: %s, %s&quot;</span>, num, err)</span><br><span class="line"><span class="comment">// SET name = &quot;astaixe&quot; WHERE name = &quot;slene&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 原子操作增加字段值</span></span><br><span class="line"><span class="comment">// 假设 user struct 里有一个 nums int 字段</span></span><br><span class="line">num, err := o.QueryTable(<span class="string">&quot;user&quot;</span>).Update(orm.Params&#123;</span><br><span class="line">    <span class="string">&quot;nums&quot;</span>: orm.ColValue(orm.ColAdd, <span class="number">100</span>),</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// SET nums = nums + 100</span></span><br></pre></td></tr></table></figure>



<p>PrepareInsert</p>
<p>用于一次 prepare 多次 insert 插入，以提高批量插入的速度。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> users []*User</span><br><span class="line"></span><br><span class="line">qs := o.QueryTable(<span class="string">&quot;user&quot;</span>)</span><br><span class="line">i, _ := qs.PrepareInsert()</span><br><span class="line"><span class="keyword">for</span> _, user := <span class="keyword">range</span> users &#123;</span><br><span class="line">    id, err := i.Insert(user)</span><br><span class="line">    <span class="keyword">if</span> err == <span class="literal">nil</span> &#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// PREPARE INSERT INTO user (`name`, ...) VALUES (?, ...)</span></span><br><span class="line"><span class="comment">// EXECUTE INSERT INTO user (`name`, ...) VALUES (&quot;slene&quot;, ...)</span></span><br><span class="line"><span class="comment">// EXECUTE ...</span></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line">i.Close() <span class="comment">// 别忘记关闭 statement</span></span><br></pre></td></tr></table></figure>



<h2 id="filter"><a href="#filter" class="headerlink" title="filter"></a>filter</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">myfiler</span><span class="params">(in <span class="keyword">string</span>)</span> <span class="params">(out <span class="keyword">string</span>)</span></span>&#123;</span><br><span class="line">	out = in + <span class="string">&quot;123&quot;</span></span><br><span class="line">	<span class="keyword">return</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line">beego.AddFuncMap(<span class="string">&quot;mfiler&quot;</span>,myfiler)</span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; .Name | mfiler  &#125;&#125;</span><br></pre></td></tr></table></figure>





</div></div></article><link rel="stylesheet" type="text/css" href="/css/font.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.css"><script src="//cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script><script src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script>$(document).ready(function() {
  $(".fancybox").fancybox();
});
</script></body></html>
<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content=" id=&quot;GraphQL和restful简介&quot;&gt;&lt;a href=&quot;#GraphQL和restful简介&quot; class=&quot;headerlink&quot; title=&quot;GraphQL和restful简介&quot;&gt;&lt;/a&gt;GraphQL和restful简介&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;p&gt;GraphQL是数据查询语言，是Restful API的替代品"><link rel="stylesheet" type="text/css" href="/css/normalize.css"><link rel="stylesheet" type="text/css" href="/css/highlight.css"><link rel="stylesheet" type="text/css" href="/css/noise.css"><title>GrephQL快速梳理 | 凉薄的自动书记人偶</title><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><meta name="generator" content="Hexo 5.4.0"></head><body><article class="wrapper"><div class="post-main"><div class="nav"><nav class="container"><a class="sidebar-nav-item active" href="/">Home</a><a class="sidebar-nav-item" href="/archives">Tags</a><a class="sidebar-nav-item" href="/About">About</a></nav><div class="container post-meta"><div class="post-tags"><a class="post-tag-link" href="/tags/GraphQL/" rel="tag">GraphQL</a></div><div class="post-time">2020-09-23</div></div></div><div class="container post-header"><h1>GrephQL快速梳理</h1></div><div class="container post-toc"><details class="toc"><summary class="toc-accordion">Table of Contents</summary><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#GraphQL%E5%92%8Crestful%E7%AE%80%E4%BB%8B"><span class="toc-number">1.</span> <span class="toc-text">GraphQL和restful简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GraphQL%E5%92%8Crestful%E5%AF%B9%E6%AF%94"><span class="toc-number">2.</span> <span class="toc-text">GraphQL和restful对比</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GraphQL-Sever%E4%BD%BF%E7%94%A8"><span class="toc-number">3.</span> <span class="toc-text">GraphQL Sever使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8"><span class="toc-number">3.1.</span> <span class="toc-text">简单使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%9B%E9%98%B6%E4%BD%BF%E7%94%A8"><span class="toc-number">3.2.</span> <span class="toc-text">进阶使用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E5%8F%82%E6%95%B0%E7%B1%BB%E5%9E%8B"><span class="toc-number">4.</span> <span class="toc-text">基本参数类型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GraphQL-Client%E4%BD%BF%E7%94%A8"><span class="toc-number">5.</span> <span class="toc-text">GraphQL Client使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E6%95%B0%E6%8D%AEMutations"><span class="toc-number">6.</span> <span class="toc-text">修改数据Mutations</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%A4%E8%AF%81%E5%92%8C%E4%B8%AD%E9%97%B4%E4%BB%B6"><span class="toc-number">7.</span> <span class="toc-text">认证和中间件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Constructing-Types"><span class="toc-number">8.</span> <span class="toc-text">Constructing Types</span></a></li></ol></details></div><div class="container post-content"><h2 id="GraphQL和restful简介"><a href="#GraphQL和restful简介" class="headerlink" title="GraphQL和restful简介"></a>GraphQL和restful简介</h2><ul>
<li><p>GraphQL是数据查询语言，是Restful API的替代品</p>
</li>
<li><p>GraphQL 是 API 查询语言，不是数据库查询语言，它跟 REST 是同一层次的东西，没有筛选/排序/分组/聚合这类语法，这些都是需要我们自己实现的。</p>
</li>
<li><p>特点：</p>
<ul>
<li><p>请求需要的数据不多不少。</p>
</li>
<li><p>获取多个资源，只用一个请求。</p>
<blockquote>
<p>比如请求接口A，获取到字段B，然后根据字段B，去请求接口C，获取到字段D，再根据字段D，去请求接口E。</p>
<p>这样的依赖关系，可以使用GraphQL一次解决。</p>
</blockquote>
</li>
<li><p>描述所有可能类型，便于维护，根据需求平滑演进，添加或隐藏字段。</p>
</li>
</ul>
</li>
</ul>
<ul>
<li>restful：Representational State Transfer表示<code>属性状态转移</code>。本质上就是用定义uri，通过API接口来取得资源。通用系统架构，不受语言限制。</li>
</ul>
<h2 id="GraphQL和restful对比"><a href="#GraphQL和restful对比" class="headerlink" title="GraphQL和restful对比"></a>GraphQL和restful对比</h2><ul>
<li>restful一个接口只能返回一个资源，graphQL一次可以获取多个资源</li>
<li>restful用不同的url来区分资源，graphQL用类型区分资源。</li>
</ul>
<h2 id="GraphQL-Sever使用"><a href="#GraphQL-Sever使用" class="headerlink" title="GraphQL Sever使用"></a>GraphQL Sever使用</h2><h3 id="简单使用"><a href="#简单使用" class="headerlink" title="简单使用"></a>简单使用</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">&quot;express&quot;</span>)</span><br><span class="line"><span class="keyword">var</span> graphqlHTTP = <span class="built_in">require</span>(<span class="string">&quot;express-graphql&quot;</span>)</span><br><span class="line"><span class="keyword">var</span> &#123; buildSchema &#125; = <span class="built_in">require</span>(<span class="string">&quot;graphql&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// buildSchema：对外公开的查询方法和查询类型</span></span><br><span class="line"><span class="comment">// 这里定义了一个查询方法hello，返回值为String</span></span><br><span class="line"><span class="keyword">var</span> schema = buildSchema(<span class="string">`</span></span><br><span class="line"><span class="string">	type Query &#123;</span></span><br><span class="line"><span class="string">  	hello:String</span></span><br><span class="line"><span class="string">		accountName:String</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">`</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义查询方法对应的处理函数</span></span><br><span class="line"><span class="keyword">var</span> root = &#123;</span><br><span class="line">  <span class="attr">hello</span>: <span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;hello world&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">accountName</span>: <span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;hyl&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> app = express();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 把graphql地址的请求，转发给graphqlHTTP进行处理</span></span><br><span class="line">app.use(<span class="string">&#x27;/myurl&#x27;</span>,graphqlHTTP(&#123;</span><br><span class="line">  <span class="attr">schema</span>:schema,</span><br><span class="line">  <span class="attr">rootValue</span>:root,</span><br><span class="line">  <span class="attr">graphiql</span>:<span class="literal">true</span>,  <span class="comment">// 是否启用调试界面</span></span><br><span class="line">&#125;))</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">4000</span>);</span><br></pre></td></tr></table></figure>

<p>我们就可以进行请求了：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">query &#123;</span><br><span class="line">	hello</span><br><span class="line">	accountName</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>返回值：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;data&quot;</span>:&#123;</span><br><span class="line">    <span class="attr">&quot;hello&quot;</span>:<span class="string">&quot;hello world&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;accountName&quot;</span>:<span class="string">&quot;hyl&quot;</span>,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="进阶使用"><a href="#进阶使用" class="headerlink" title="进阶使用"></a>进阶使用</h3><p>返回嵌套的数据和自定义参数</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> schema = buildSchema(<span class="string">`</span></span><br><span class="line"><span class="string">  type Account &#123;</span></span><br><span class="line"><span class="string">		name: String</span></span><br><span class="line"><span class="string">		age: Int</span></span><br><span class="line"><span class="string">		sex: String</span></span><br><span class="line"><span class="string">		department: String</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">	type person &#123;</span></span><br><span class="line"><span class="string">		year: Int</span></span><br><span class="line"><span class="string">		salary(city: String): Int</span></span><br><span class="line"><span class="string">	&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">	type Query &#123;</span></span><br><span class="line"><span class="string">		account: Account</span></span><br><span class="line"><span class="string">		getPerson(city: String): Person</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">`</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> root = &#123;</span><br><span class="line">  <span class="attr">hello</span>: <span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;hello world&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">account</span>: <span class="function">()=&gt;</span>&#123;</span><br><span class="line">		<span class="attr">name</span>: <span class="string">&quot;hyl&quot;</span>,</span><br><span class="line">		<span class="attr">age</span>: <span class="number">22</span>,</span><br><span class="line">		<span class="attr">sex</span>: <span class="string">&quot;man&quot;</span>,</span><br><span class="line">		<span class="attr">department</span>: <span class="string">&quot;backend-engineer&quot;</span>,</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="attr">getPerson</span>: <span class="function">(<span class="params">&#123;city&#125;</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> year = <span class="number">80</span></span><br><span class="line">    <span class="keyword">const</span> salary = <span class="function">(<span class="params">&#123;city&#125;</span>)=&gt;</span>&#123;</span><br><span class="line">      <span class="keyword">if</span>(city===<span class="string">&quot;beijing&quot;</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">10000</span></span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        retrun <span class="number">8000</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="string">&quot;year&quot;</span>: year,</span><br><span class="line">      <span class="string">&quot;salary&quot;</span>: salary</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>调用如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">query &#123;</span><br><span class="line">	account</span><br><span class="line">	getPerson(city: &quot;北京&quot;) &#123;</span><br><span class="line">		year</span><br><span class="line">		salary</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="基本参数类型"><a href="#基本参数类型" class="headerlink" title="基本参数类型"></a>基本参数类型</h2><ul>
<li>String</li>
<li>Int</li>
<li>Float</li>
<li>Boolean</li>
<li>ID</li>
</ul>
<ol>
<li><code>[类型]</code>：表示数组，eg：[Int]</li>
<li><code>!</code>：表示参数不能为空</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> schema = buildSchema(<span class="string">`</span></span><br><span class="line"><span class="string">  type Query &#123;</span></span><br><span class="line"><span class="string">    getClassMates(classNo Int!):[String]</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">`</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> root = &#123;</span><br><span class="line">  <span class="attr">getClassMates</span>: <span class="function">(<span class="params">&#123;classNo&#125;</span>)=&gt;</span>&#123;</span><br><span class="line">		<span class="keyword">const</span> obj = &#123;</span><br><span class="line">      <span class="number">123</span>:[<span class="string">&quot;hyl&quot;</span>,<span class="string">&quot;czj&quot;</span>,<span class="string">&quot;gzr&quot;</span>,<span class="string">&quot;dsz&quot;</span>],</span><br><span class="line">      <span class="number">456</span>:[<span class="string">&quot;hds&quot;</span>,<span class="string">&quot;lzy&quot;</span>,<span class="string">&quot;ljw&quot;</span>,<span class="string">&quot;ljh&quot;</span>]</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> obj[classNo]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>调用如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">query &#123;</span><br><span class="line">	getClassMates(classNo: 123)</span><br><span class="line">	getClassMates(classNo: null)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="GraphQL-Client使用"><a href="#GraphQL-Client使用" class="headerlink" title="GraphQL Client使用"></a>GraphQL Client使用</h2><p>在客户端访问myurl接口</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> username = <span class="number">3</span></span><br><span class="line"><span class="keyword">var</span> city = <span class="string">&quot;深圳&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> query = <span class="string">`</span></span><br><span class="line"><span class="string">  query Account($username: Int!, $city: String)&#123;</span></span><br><span class="line"><span class="string">    account(username: $username)&#123;</span></span><br><span class="line"><span class="string">      name</span></span><br><span class="line"><span class="string">      age</span></span><br><span class="line"><span class="string">      sex</span></span><br><span class="line"><span class="string">			salary(city: $city)</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;`</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">fetch(<span class="string">&#x27;myurl&#x27;</span>,&#123;</span><br><span class="line">  <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">  <span class="attr">headers</span>: &#123;</span><br><span class="line">    <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/json&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Accept&quot;</span>: <span class="string">&quot;application/json&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">body</span>: <span class="built_in">JSON</span>.stringify(&#123;</span><br><span class="line">    query,</span><br><span class="line">    <span class="attr">variables</span>: &#123; <span class="attr">username</span>:username, <span class="attr">city</span>:ciry &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line">.then(<span class="function"><span class="params">r</span> =&gt;</span> r.json())</span><br><span class="line">.then(<span class="function"><span class="params">data</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&#x27;data returned:&#x27;</span>, data));</span><br></pre></td></tr></table></figure>



<h2 id="修改数据Mutations"><a href="#修改数据Mutations" class="headerlink" title="修改数据Mutations"></a>修改数据Mutations</h2><ul>
<li>查询使用<code>Query</code>，修改数据使用<code>Mutation</code></li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> schema = buildSchema(<span class="string">`</span></span><br><span class="line"><span class="string">  type Account &#123;</span></span><br><span class="line"><span class="string">		name: String</span></span><br><span class="line"><span class="string">		age: Int</span></span><br><span class="line"><span class="string">		sex: String</span></span><br><span class="line"><span class="string">		department: String</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  input AccountInput &#123;</span></span><br><span class="line"><span class="string">    name: String</span></span><br><span class="line"><span class="string">    age: Int</span></span><br><span class="line"><span class="string">    sex: String</span></span><br><span class="line"><span class="string">    department: String</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  type Mutation &#123;</span></span><br><span class="line"><span class="string">    createAccount(input: AccountInput): Account</span></span><br><span class="line"><span class="string">    updateAccount(id: ID!, input: AccountInput): Account</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">	type Query &#123;</span></span><br><span class="line"><span class="string">    accounts: [Account]</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">`</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> FakeDB = &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> root = &#123;</span><br><span class="line">  <span class="function"><span class="title">createAccount</span>(<span class="params">&#123;input&#125;</span>)</span>&#123;</span><br><span class="line">    <span class="comment">// 模拟数据库的保存</span></span><br><span class="line">    FakeDB[input.name] = input;</span><br><span class="line">    <span class="comment">// 返回保存结果</span></span><br><span class="line">    <span class="keyword">return</span> FakeDB[input.name]</span><br><span class="line">  &#125;，</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="title">updateAccount</span>(<span class="params">&#123;id, input&#125;</span>)</span>&#123;</span><br><span class="line">    <span class="comment">// 模拟数据库的更新</span></span><br><span class="line">    <span class="keyword">const</span> updateAccount = <span class="built_in">Object</span>.assign(&#123;&#125;, FakeDB[id], input)</span><br><span class="line">    Fake[id] = updateAccount</span><br><span class="line">    <span class="comment">// 返回保存结果</span></span><br><span class="line">    <span class="keyword">return</span> FakeDB[input.name]</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="title">accounts</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> arr = []</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">const</span> key <span class="keyword">in</span> FakeDB) &#123;</span><br><span class="line">      arr.push(FakeDB[key])</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> arr</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>调用如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">mutation &#123;</span><br><span class="line">	createAccount&#123;input:&#123;</span><br><span class="line">		name: &quot;hyl&quot;,</span><br><span class="line">		age: 22,</span><br><span class="line">		sex: &quot;man&quot;,</span><br><span class="line">		department: &quot;backend-engieer&quot;</span><br><span class="line">	&#125;&#125; &#123;</span><br><span class="line">		name</span><br><span class="line">		age</span><br><span class="line">		sex</span><br><span class="line">		department</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">mutation &#123;</span><br><span class="line">	updateAccount(id: &quot;hyl&quot;, input: &#123;</span><br><span class="line">		age: 101</span><br><span class="line">	&#125;) &#123;</span><br><span class="line">		age</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">query &#123;</span><br><span class="line">	accounts &#123;</span><br><span class="line">		name</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="认证和中间件"><a href="#认证和中间件" class="headerlink" title="认证和中间件"></a>认证和中间件</h2><ul>
<li>中间件的本质就是一个function，在接口执行之前就拦截请求，然后在决定是否能接着往下走</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">&quot;express&quot;</span>)</span><br><span class="line"><span class="keyword">var</span> graphqlHTTP = <span class="built_in">require</span>(<span class="string">&quot;express-graphql&quot;</span>)</span><br><span class="line"><span class="keyword">var</span> &#123; buildSchema &#125; = <span class="built_in">require</span>(<span class="string">&quot;graphql&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> schema = buildSchema(<span class="string">`</span></span><br><span class="line"><span class="string">	type Query &#123;</span></span><br><span class="line"><span class="string">  	hello:String</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">`</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> root = &#123;</span><br><span class="line">  <span class="attr">hello</span>: <span class="function">()=&gt;</span>&#123; <span class="string">&quot;hello world&quot;</span> &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> app = express();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义中间件function</span></span><br><span class="line"><span class="keyword">const</span> middleware = <span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span>(req.url.indexOf(<span class="string">&#x27;myurl&#x27;</span>) !== -<span class="number">1</span> &amp;&amp; req.headers.cookie.indexOf(<span class="string">&#x27;auth&#x27;</span>) === -<span class="number">1</span>) &#123;</span><br><span class="line">    res.send(<span class="built_in">JSON</span>.stringfy(&#123;</span><br><span class="line">      <span class="attr">error</span>: <span class="string">&quot;您没有权限访问这个接口&quot;</span></span><br><span class="line">    &#125;))</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  next();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 注册中间件</span></span><br><span class="line">app.use(middleware);</span><br><span class="line"></span><br><span class="line">app.use(<span class="string">&#x27;/myurl&#x27;</span>,graphqlHTTP(&#123;</span><br><span class="line">  <span class="attr">schema</span>:schema,</span><br><span class="line">  <span class="attr">rootValue</span>:root,</span><br><span class="line">  <span class="attr">graphiql</span>:<span class="literal">true</span>,</span><br><span class="line">&#125;))</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">4000</span>);</span><br></pre></td></tr></table></figure>



<h2 id="Constructing-Types"><a href="#Constructing-Types" class="headerlink" title="Constructing Types"></a>Constructing Types</h2><ul>
<li>使用<strong>GraphQLObjectType</strong>定义type(类型)</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> schema = buildschema&#123;<span class="string">`</span></span><br><span class="line"><span class="string">	type Account &#123;</span></span><br><span class="line"><span class="string">		name: String</span></span><br><span class="line"><span class="string">		age: Int</span></span><br><span class="line"><span class="string">		sex: String</span></span><br><span class="line"><span class="string">		department: String</span></span><br><span class="line"><span class="string">	&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">	type Query &#123;</span></span><br><span class="line"><span class="string">		account(username: String): Account</span></span><br><span class="line"><span class="string">	&#125;</span></span><br><span class="line"><span class="string">`</span>&#125;</span><br></pre></td></tr></table></figure>

<p>使用类型替换上述的字符串：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1.将type Account字符串 修改成一个 GraphQLObjectType类型</span></span><br><span class="line"><span class="keyword">var</span> AccountType = <span class="keyword">new</span> graphql.GraphQLObjectType(&#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;Account&quot;</span>,</span><br><span class="line">  <span class="attr">fields</span>: &#123;</span><br><span class="line">    <span class="attr">name</span>: &#123;<span class="attr">type</span>: graphql.GraphQLString&#125;,</span><br><span class="line">    <span class="attr">age</span>: &#123;<span class="attr">type</span>: graphql.GraphQLInt&#125;,</span><br><span class="line">    <span class="attr">sex</span>: &#123;<span class="attr">type</span>: graphql.GraphQLString&#125;,</span><br><span class="line">    <span class="attr">department</span>: &#123;<span class="attr">type</span>: graphql.GraphQLString&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2.将type Query字符串 修改成一个 GraphQLObjectType类型</span></span><br><span class="line"><span class="keyword">var</span> queryType = <span class="keyword">new</span> graphql.GraphQLObjectType(&#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;Query&quot;</span>,</span><br><span class="line">  <span class="attr">fields</span>: &#123;</span><br><span class="line">    <span class="attr">account</span>: &#123; <span class="comment">// account: 函数名叫account</span></span><br><span class="line">      <span class="attr">type</span>: AccountType, <span class="comment">// type: 函数返回值是AccountType</span></span><br><span class="line">      <span class="attr">args</span>: &#123; <span class="comment">// args: 函数传入的参数</span></span><br><span class="line">        <span class="attr">username</span>: &#123;<span class="attr">type</span>: graphql.GraphQLString &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">resolve</span>: <span class="function"><span class="keyword">function</span>(<span class="params">_, &#123;username&#125;</span>) </span>&#123; <span class="comment">// resolve: 函数体</span></span><br><span class="line">        <span class="keyword">const</span> name = username;</span><br><span class="line">        <span class="keyword">const</span> sex = <span class="string">&quot;man&quot;</span>;</span><br><span class="line">        <span class="keyword">const</span> age = <span class="number">18</span>;</span><br><span class="line">        <span class="keyword">const</span> department = <span class="string">&quot;backend-engineer&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">          name,</span><br><span class="line">          sex,</span><br><span class="line">          age,</span><br><span class="line">          department</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3.创建Schema</span></span><br><span class="line"><span class="keyword">var</span> schema = <span class="keyword">new</span> graphql.GraphQLSchema(&#123; <span class="attr">query</span>: queryType &#125;);</span><br></pre></td></tr></table></figure>



</div></div></article><link rel="stylesheet" type="text/css" href="/css/font.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.css"><script src="//cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script><script src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script>$(document).ready(function() {
  $(".fancybox").fancybox();
});
</script></body></html>
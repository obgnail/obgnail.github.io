<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="&lt;a href=&quot;https://react-guide.github.io/react-router-cn/index.html&quot;&gt;https://react-guide.github.io/react-router-cn/index.html&lt;/a&gt;"><link rel="stylesheet" type="text/css" href="/css/normalize.css"><link rel="stylesheet" type="text/css" href="/css/highlight.css"><link rel="stylesheet" type="text/css" href="/css/noise.css"><title>react-router官方文档 | 凉薄的自动书记人偶</title><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><meta name="generator" content="Hexo 5.4.0"></head><body><article class="wrapper"><div class="post-main"><div class="nav"><nav class="container"><a class="sidebar-nav-item active" href="/">Home</a></nav><div class="container post-meta"><div class="post-tags"><a class="post-tag-none-link" href="/tags/React/" rel="tag">React</a></div><div class="post-time">2020-08-04</div></div></div><div class="container post-header"><h1>react-router官方文档</h1></div><div class="container post-toc"><details class="toc"><summary class="toc-accordion">Table of Contents</summary><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8"><span class="toc-number">1.</span> <span class="toc-text">快速入门</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E8%B7%AF%E7%94%B1"><span class="toc-number">1.1.</span> <span class="toc-text">简单路由</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B5%8C%E5%A5%97%E8%B7%AF%E7%94%B1"><span class="toc-number">1.2.</span> <span class="toc-text">嵌套路由</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E9%85%8D%E7%BD%AE"><span class="toc-number">2.</span> <span class="toc-text">路由配置</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B7%BB%E5%8A%A0%E9%A6%96%E9%A1%B5"><span class="toc-number">2.1.</span> <span class="toc-text">添加首页</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%A9-UI-%E4%BB%8E-URL-%E4%B8%AD%E8%A7%A3%E8%80%A6%E5%87%BA%E6%9D%A5-%E7%BB%9D%E5%AF%B9%E8%B7%AF%E5%BE%84"><span class="toc-number">2.2.</span> <span class="toc-text">让 UI 从 URL 中解耦出来(绝对路径)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%BC%E5%AE%B9%E6%97%A7%E7%9A%84-URL"><span class="toc-number">2.3.</span> <span class="toc-text">兼容旧的 URL</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%9B%E5%85%A5%E5%92%8C%E7%A6%BB%E5%BC%80%E7%9A%84Hook"><span class="toc-number">2.4.</span> <span class="toc-text">进入和离开的Hook</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9B%BF%E6%8D%A2%E7%9A%84%E9%85%8D%E7%BD%AE%E6%96%B9%E5%BC%8F"><span class="toc-number">2.5.</span> <span class="toc-text">替换的配置方式</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E5%8C%B9%E9%85%8D%E5%8E%9F%E7%90%86"><span class="toc-number">3.</span> <span class="toc-text">路由匹配原理</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B5%8C%E5%A5%97%E5%85%B3%E7%B3%BB"><span class="toc-number">3.1.</span> <span class="toc-text">嵌套关系</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B7%AF%E5%BE%84%E8%AF%AD%E6%B3%95"><span class="toc-number">3.2.</span> <span class="toc-text">路径语法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BC%98%E5%85%88%E7%BA%A7"><span class="toc-number">3.3.</span> <span class="toc-text">优先级</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Histories"><span class="toc-number">4.</span> <span class="toc-text">Histories</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#browserHistory"><span class="toc-number">4.1.</span> <span class="toc-text">browserHistory</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%85%8D%E7%BD%AE"><span class="toc-number">4.1.0.1.</span> <span class="toc-text">服务器配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#IE8-IE9-%E6%94%AF%E6%8C%81%E6%83%85%E5%86%B5"><span class="toc-number">4.1.0.2.</span> <span class="toc-text">IE8, IE9 支持情况</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#hashHistory"><span class="toc-number">4.2.</span> <span class="toc-text">hashHistory</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%88%91%E5%BA%94%E8%AF%A5%E4%BD%BF%E7%94%A8-createHashHistory%E5%90%97%EF%BC%9F"><span class="toc-number">4.2.0.1.</span> <span class="toc-text">我应该使用 createHashHistory吗？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%83%8F%E8%BF%99%E6%A0%B7-k-ckuvup-%E6%B2%A1%E7%94%A8%E7%9A%84%E5%9C%A8-URL-%E4%B8%AD%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F"><span class="toc-number">4.2.0.2.</span> <span class="toc-text">像这样 ?_k&#x3D;ckuvup 没用的在 URL 中是什么？</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#createMemoryHistory"><span class="toc-number">4.3.</span> <span class="toc-text">createMemoryHistory</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E7%A4%BA%E4%BE%8B"><span class="toc-number">4.4.</span> <span class="toc-text">实现示例</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%BB%98%E8%AE%A4%E8%B7%AF%E7%94%B1%EF%BC%88IndexRoute%EF%BC%89%E4%B8%8E-IndexLink"><span class="toc-number">5.</span> <span class="toc-text">默认路由（IndexRoute）与 IndexLink</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%BB%98%E8%AE%A4%E8%B7%AF%E7%94%B1%EF%BC%88IndexRoute%EF%BC%89"><span class="toc-number">5.1.</span> <span class="toc-text">默认路由（IndexRoute）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Index-Links"><span class="toc-number">5.2.</span> <span class="toc-text">Index Links</span></a></li></ol></li></ol></details></div><div class="container post-content"><p><a target="_blank" rel="noopener" href="https://react-guide.github.io/react-router-cn/index.html">https://react-guide.github.io/react-router-cn/index.html</a></p>
<h1 id="快速入门"><a href="#快速入门" class="headerlink" title="快速入门"></a>快速入门</h1><h2 id="简单路由"><a href="#简单路由" class="headerlink" title="简单路由"></a>简单路由</h2><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  BrowserRouter <span class="keyword">as</span> Router,</span><br><span class="line">  Switch,</span><br><span class="line">  Route,</span><br><span class="line">  Link</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Home</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>Home<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">About</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>About<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Users</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>Users<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;Router&gt;</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;nav&gt;</span><br><span class="line">          &lt;ul&gt;</span><br><span class="line">            &lt;li&gt;</span><br><span class="line">              &lt;Link to=&quot;/&quot;&gt;Home&lt;/Link&gt;</span><br><span class="line">            &lt;/li&gt;</span><br><span class="line">            &lt;li&gt;</span><br><span class="line">              &lt;Link to=&quot;/about&quot;&gt;About&lt;/Link&gt;</span><br><span class="line">            &lt;/li&gt;</span><br><span class="line">            &lt;li&gt;</span><br><span class="line">              &lt;Link to=&quot;/users&quot;&gt;Users&lt;/Link&gt;</span><br><span class="line">            &lt;/li&gt;</span><br><span class="line">          &lt;/ul&gt;</span><br><span class="line">        &lt;/nav&gt;</span><br><span class="line"></span><br><span class="line">        &#123;/* &lt;Switch&gt;检查它的子节点&lt;Route&gt;，并呈现与当前URL匹配的第一个子节点。 */&#125;</span><br><span class="line">        &lt;Switch&gt;</span><br><span class="line">          &lt;Route path=&quot;/about&quot;&gt;&lt;About /&gt;&lt;/Route&gt;</span><br><span class="line">          &lt;Route path=&quot;/users&quot;&gt;&lt;Users /&gt;&lt;/Route&gt;</span><br><span class="line">          &lt;Route path=&quot;/&quot;&gt;&lt;Home /&gt;&lt;/Route&gt;</span><br><span class="line">        &lt;/Switch&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/Router&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="嵌套路由"><a href="#嵌套路由" class="headerlink" title="嵌套路由"></a>嵌套路由</h2><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&quot;react&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123;</span><br><span class="line">  BrowserRouter <span class="keyword">as</span> Router,</span><br><span class="line">  Switch,</span><br><span class="line">  Route,</span><br><span class="line">  Link,</span><br><span class="line">  useRouteMatch,</span><br><span class="line">  useParams</span><br><span class="line">&#125; <span class="keyword">from</span> <span class="string">&quot;react-router-dom&quot;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Home</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>Home<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">About</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>About<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Topics</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> match = useRouteMatch();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;h2&gt;Topics&lt;/h2&gt;</span><br><span class="line"></span><br><span class="line">      &lt;ul&gt;</span><br><span class="line">        &lt;li&gt;</span><br><span class="line">          &lt;Link to=&#123;`$&#123;match.url&#125;/components`&#125;&gt;Components&lt;/Link&gt;</span><br><span class="line">        &lt;/li&gt;</span><br><span class="line">        &lt;li&gt;</span><br><span class="line">          &lt;Link to=&#123;`$&#123;match.url&#125;/props-v-state`&#125;&gt;</span><br><span class="line">            Props v. State</span><br><span class="line">          &lt;/Link&gt;</span><br><span class="line">        &lt;/li&gt;</span><br><span class="line">      &lt;/ul&gt;</span><br><span class="line"></span><br><span class="line">      &#123;/* The Topics page has its own &lt;Switch&gt; with more routes</span><br><span class="line">          that build on the /topics URL path. You can think of the</span><br><span class="line">          2nd &lt;Route&gt; here as an &quot;index&quot; page for all topics, or</span><br><span class="line">          the page that is shown when no topic is selected */&#125;</span><br><span class="line">      &lt;Switch&gt;</span><br><span class="line">        &lt;Route path=&#123;`$&#123;match.path&#125;/:topicId`&#125;&gt;&lt;Topic /&gt;&lt;/Route&gt;</span><br><span class="line">        &lt;Route path=&#123;match.path&#125;&gt;&lt;h3&gt;Please select a topic.&lt;/h3&gt;&lt;/Route&gt;</span><br><span class="line">      &lt;/Switch&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function Topic() &#123;</span><br><span class="line">  let &#123; topicId &#125; = useParams();</span><br><span class="line">  return &lt;h3&gt;Requested topic ID: &#123;topicId&#125;&lt;/h3&gt;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export default function App() &#123;</span><br><span class="line">  return (</span><br><span class="line">    &lt;Router&gt;</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &lt;ul&gt;</span><br><span class="line">          &lt;li&gt;</span><br><span class="line">            &lt;Link to=&quot;/&quot;&gt;Home&lt;/Link&gt;</span><br><span class="line">          &lt;/li&gt;</span><br><span class="line">          &lt;li&gt;</span><br><span class="line">            &lt;Link to=&quot;/about&quot;&gt;About&lt;/Link&gt;</span><br><span class="line">          &lt;/li&gt;</span><br><span class="line">          &lt;li&gt;</span><br><span class="line">            &lt;Link to=&quot;/topics&quot;&gt;Topics&lt;/Link&gt;</span><br><span class="line">          &lt;/li&gt;</span><br><span class="line">        &lt;/ul&gt;</span><br><span class="line"></span><br><span class="line">        &lt;Switch&gt;</span><br><span class="line">          &lt;Route path=&quot;/about&quot;&gt;&lt;About /&gt;&lt;/Route&gt;</span><br><span class="line">          &lt;Route path=&quot;/topics&quot;&gt;&lt;Topics /&gt;&lt;/Route&gt;</span><br><span class="line">          &lt;Route path=&quot;/&quot;&gt;&lt;Home /&gt;&lt;/Route&gt;</span><br><span class="line">        &lt;/Switch&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/Router&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="路由配置"><a href="#路由配置" class="headerlink" title="路由配置"></a>路由配置</h1><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; Router, Route, Link &#125; <span class="keyword">from</span> <span class="string">&#x27;react-router&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> App = React.createClass(&#123;</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>App<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">&quot;/about&quot;</span>&gt;</span>About<span class="tag">&lt;/<span class="name">Link</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="xml">          <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">Link</span> <span class="attr">to</span>=<span class="string">&quot;/inbox&quot;</span>&gt;</span>Inbox<span class="tag">&lt;/<span class="name">Link</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span></span><br><span class="line"><span class="xml">        &#123;this.props.children&#125;</span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> About = React.createClass(&#123;</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>About<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Inbox = React.createClass(&#123;</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">h2</span>&gt;</span>Inbox<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line"><span class="xml">        &#123;this.props.children || &quot;Welcome to your Inbox&quot;&#125;</span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Message = React.createClass(&#123;</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>Message &#123;this.props.params.id&#125;<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">React.render((</span><br><span class="line">  <span class="xml"><span class="tag">&lt;<span class="name">Router</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;/&quot;</span> <span class="attr">component</span>=<span class="string">&#123;App&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;about&quot;</span> <span class="attr">component</span>=<span class="string">&#123;About&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;inbox&quot;</span> <span class="attr">component</span>=<span class="string">&#123;Inbox&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;messages/:id&quot;</span> <span class="attr">component</span>=<span class="string">&#123;Message&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">Route</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">Route</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">Router</span>&gt;</span></span></span><br><span class="line">), <span class="built_in">document</span>.body)</span><br></pre></td></tr></table></figure>

<p>通过上面的配置，这个应用知道如何渲染下面四个 URL：</p>
<table>
<thead>
<tr>
<th>URL</th>
<th>组件</th>
</tr>
</thead>
<tbody><tr>
<td><code>/</code></td>
<td><code>App</code></td>
</tr>
<tr>
<td><code>/about</code></td>
<td><code>App -&gt; About</code></td>
</tr>
<tr>
<td><code>/inbox</code></td>
<td><code>App -&gt; Inbox</code></td>
</tr>
<tr>
<td><code>/inbox/messages/:id</code></td>
<td><code>App -&gt; Inbox -&gt; Message</code></td>
</tr>
</tbody></table>
<h2 id="添加首页"><a href="#添加首页" class="headerlink" title="添加首页"></a>添加首页</h2><p>想象一下当 URL 为 <code>/</code> 时，我们想渲染一个在 <code>App</code> 中的组件。不过在此时，<code>App</code> 的 <code>render</code> 中的 <code>this.props.children</code> 还是 <code>undefined</code>。这种情况我们可以使用 <a target="_blank" rel="noopener" href="https://react-guide.github.io/react-router-cn/docs/guides/basics/docs/API.md#indexroute"><code>IndexRoute</code></a> 来设置一个默认页面。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; IndexRoute &#125; <span class="keyword">from</span> <span class="string">&#x27;react-router&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Dashboard = React.createClass(&#123;</span><br><span class="line">  <span class="function"><span class="title">render</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">div</span>&gt;</span>Welcome to the app!<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">React.render((</span><br><span class="line">  <span class="xml"><span class="tag">&lt;<span class="name">Router</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;/&quot;</span> <span class="attr">component</span>=<span class="string">&#123;App&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">      &#123;/* 当 url 为/时渲染 Dashboard */&#125;</span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">IndexRoute</span> <span class="attr">component</span>=<span class="string">&#123;Dashboard&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;about&quot;</span> <span class="attr">component</span>=<span class="string">&#123;About&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;inbox&quot;</span> <span class="attr">component</span>=<span class="string">&#123;Inbox&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;messages/:id&quot;</span> <span class="attr">component</span>=<span class="string">&#123;Message&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">Route</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">Route</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">Router</span>&gt;</span></span></span><br><span class="line">), <span class="built_in">document</span>.body)</span><br></pre></td></tr></table></figure>

<p>现在，<code>App</code> 的 <code>render</code> 中的 <code>this.props.children</code> 将会是 <code>&lt;Dashboard&gt;</code>这个元素。这个功能类似 Apache 的<a target="_blank" rel="noopener" href="http://httpd.apache.org/docs/2.4/mod/mod_dir.html#directoryindex"><code>DirectoryIndex</code></a> 以及 nginx的 <a target="_blank" rel="noopener" href="http://nginx.org/en/docs/http/ngx_http_index_module.html#index"><code>index</code></a>指令，上述功能都是在当请求的 URL 匹配某个目录时，允许你制定一个类似<code>index.html</code>的入口文件。</p>
<p>我们的 sitemap 现在看起来如下：</p>
<table>
<thead>
<tr>
<th>URL</th>
<th>组件</th>
</tr>
</thead>
<tbody><tr>
<td><code>/</code></td>
<td><code>App -&gt; Dashboard</code></td>
</tr>
<tr>
<td><code>/about</code></td>
<td><code>App -&gt; About</code></td>
</tr>
<tr>
<td><code>/inbox</code></td>
<td><code>App -&gt; Inbox</code></td>
</tr>
<tr>
<td><code>/inbox/messages/:id</code></td>
<td><code>App -&gt; Inbox -&gt; Message</code></td>
</tr>
</tbody></table>
<h2 id="让-UI-从-URL-中解耦出来-绝对路径"><a href="#让-UI-从-URL-中解耦出来-绝对路径" class="headerlink" title="让 UI 从 URL 中解耦出来(绝对路径)"></a>让 UI 从 URL 中解耦出来(绝对路径)</h2><p>如果我们可以将 <code>/inbox</code> 从 <code>/inbox/messages/:id</code> 中去除，并且还能够让 <code>Message</code> 嵌套在 <code>App -&gt; Inbox</code> 中渲染，那会非常赞。绝对路径可以让我们做到这一点。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">React.render((</span><br><span class="line">  <span class="xml"><span class="tag">&lt;<span class="name">Router</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;/&quot;</span> <span class="attr">component</span>=<span class="string">&#123;App&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">IndexRoute</span> <span class="attr">component</span>=<span class="string">&#123;Dashboard&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;about&quot;</span> <span class="attr">component</span>=<span class="string">&#123;About&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;inbox&quot;</span> <span class="attr">component</span>=<span class="string">&#123;Inbox&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">        &#123;/* 使用 /messages/:id 替换 messages/:id */&#125;</span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;/messages/:id&quot;</span> <span class="attr">component</span>=<span class="string">&#123;Message&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">Route</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">Route</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">Router</span>&gt;</span></span></span><br><span class="line">), <span class="built_in">document</span>.body)</span><br></pre></td></tr></table></figure>

<p>在多层嵌套路由中使用绝对路径的能力让我们对 URL 拥有绝对的掌控。我们无需在 URL 中添加更多的层级，从而可以使用更简洁的 URL。</p>
<p>我们现在的 URL 对应关系如下：</p>
<table>
<thead>
<tr>
<th>URL</th>
<th>组件</th>
</tr>
</thead>
<tbody><tr>
<td><code>/</code></td>
<td><code>App -&gt; Dashboard</code></td>
</tr>
<tr>
<td><code>/about</code></td>
<td><code>App -&gt; About</code></td>
</tr>
<tr>
<td><code>/inbox</code></td>
<td><code>App -&gt; Inbox</code></td>
</tr>
<tr>
<td><code>/messages/:id</code></td>
<td><code>App -&gt; Inbox -&gt; Message</code></td>
</tr>
</tbody></table>
<h2 id="兼容旧的-URL"><a href="#兼容旧的-URL" class="headerlink" title="兼容旧的 URL"></a>兼容旧的 URL</h2><p>等一下，我们刚刚改变了一个 URL! <a target="_blank" rel="noopener" href="http://www.w3.org/Provider/Style/URI.html">这样不好</a>。 现在任何人访问 <code>/inbox/messages/5</code> 都会看到一个错误页面。:(</p>
<p>不要担心。我们可以使用 <a target="_blank" rel="noopener" href="https://react-guide.github.io/react-router-cn/docs/guides/basics/docs/API.md#redirect"><code>&lt;Redirect&gt;</code></a> 使这个 URL 重新正常工作。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Redirect &#125; <span class="keyword">from</span> <span class="string">&#x27;react-router&#x27;</span></span><br><span class="line"></span><br><span class="line">React.render((</span><br><span class="line">  <span class="xml"><span class="tag">&lt;<span class="name">Router</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;/&quot;</span> <span class="attr">component</span>=<span class="string">&#123;App&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">IndexRoute</span> <span class="attr">component</span>=<span class="string">&#123;Dashboard&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;about&quot;</span> <span class="attr">component</span>=<span class="string">&#123;About&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;inbox&quot;</span> <span class="attr">component</span>=<span class="string">&#123;Inbox&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;/messages/:id&quot;</span> <span class="attr">component</span>=<span class="string">&#123;Message&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">        &#123;/* 跳转 /inbox/messages/:id 到 /messages/:id */&#125;</span></span><br><span class="line"><span class="xml">        <span class="tag">&lt;<span class="name">Redirect</span> <span class="attr">from</span>=<span class="string">&quot;messages/:id&quot;</span> <span class="attr">to</span>=<span class="string">&quot;/messages/:id&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;/<span class="name">Route</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">Route</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">Router</span>&gt;</span></span></span><br><span class="line">), <span class="built_in">document</span>.body)</span><br></pre></td></tr></table></figure>

<p>现在当有人点击 <code>/inbox/messages/5</code> 这个链接，他们会被自动跳转到 <code>/messages/5</code>。</p>
<h2 id="进入和离开的Hook"><a href="#进入和离开的Hook" class="headerlink" title="进入和离开的Hook"></a>进入和离开的Hook</h2><p><a target="_blank" rel="noopener" href="https://react-guide.github.io/react-router-cn/docs/guides/basics/docs/Glossary.md#route">Route</a> 可以定义 <a target="_blank" rel="noopener" href="https://react-guide.github.io/react-router-cn/docs/guides/basics/docs/Glossary.md#enterhook"><code>onEnter</code></a> 和 <a target="_blank" rel="noopener" href="https://react-guide.github.io/react-router-cn/docs/guides/basics/docs/Glossary.md#leavehook"><code>onLeave</code></a> 两个 hook ，这些hook会在页面跳转<a target="_blank" rel="noopener" href="https://react-guide.github.io/react-router-cn/docs/guides/basics/docs/guides/advanced/ConfirmingNavigation.md">确认</a>时触发一次。这些 hook 对于一些情况非常的有用，例如<a target="_blank" rel="noopener" href="https://github.com/rackt/react-router/tree/master/examples/auth-flow">权限验证</a>或者在路由跳转前将一些数据持久化保存起来。</p>
<p>在路由跳转过程中，</p>
<ul>
<li> <a target="_blank" rel="noopener" href="https://react-guide.github.io/react-router-cn/docs/guides/basics/docs/Glossary.md#leavehook"><code>onLeave</code> hook</a> 会在所有将离开的路由中触发，从最下层的子路由开始直到最外层父路由结束。</li>
<li>然后<a target="_blank" rel="noopener" href="https://react-guide.github.io/react-router-cn/docs/guides/basics/docs/Glossary.md#enterhook"><code>onEnter</code> hook</a>会从最外层的父路由开始直到最下层子路由结束。</li>
</ul>
<p>继续我们上面的例子，如果一个用户点击链接，从 <code>/messages/5</code> 跳转到 <code>/about</code>，下面是这些 hook 的执行顺序：</p>
<ul>
<li><code>/messages/:id</code> 的 <code>onLeave</code></li>
<li><code>/inbox</code> 的 <code>onLeave</code></li>
<li><code>/about</code> 的 <code>onEnter</code></li>
</ul>
<h2 id="替换的配置方式"><a href="#替换的配置方式" class="headerlink" title="替换的配置方式"></a>替换的配置方式</h2><p>因为 <a target="_blank" rel="noopener" href="https://react-guide.github.io/react-router-cn/docs/guides/basics/docs/Glossary.md#route">route</a> 一般被嵌套使用，所以使用 <a target="_blank" rel="noopener" href="https://facebook.github.io/jsx/">JSX</a> 这种天然具有简洁嵌套型语法的结构来描述它们的关系非常方便。然而，如果你不想使用 JSX，也可以直接使用原生 <a target="_blank" rel="noopener" href="https://react-guide.github.io/react-router-cn/docs/guides/basics/docs/Glossary.md#route">route</a> 数组对象。</p>
<p>上面我们讨论的路由配置可以被写成下面这个样子：</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> routeConfig = [</span><br><span class="line">  &#123; <span class="attr">path</span>: <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">    <span class="attr">component</span>: App,</span><br><span class="line">    <span class="attr">indexRoute</span>: &#123; <span class="attr">component</span>: Dashboard &#125;,</span><br><span class="line">    <span class="attr">childRoutes</span>: [</span><br><span class="line">      &#123; <span class="attr">path</span>: <span class="string">&#x27;about&#x27;</span>, <span class="attr">component</span>: About &#125;,</span><br><span class="line">      &#123; <span class="attr">path</span>: <span class="string">&#x27;inbox&#x27;</span>,</span><br><span class="line">        <span class="attr">component</span>: Inbox,</span><br><span class="line">        <span class="attr">childRoutes</span>: [</span><br><span class="line">          &#123; <span class="attr">path</span>: <span class="string">&#x27;/messages/:id&#x27;</span>, <span class="attr">component</span>: Message &#125;,</span><br><span class="line">          &#123; <span class="attr">path</span>: <span class="string">&#x27;messages/:id&#x27;</span>,</span><br><span class="line">            <span class="attr">onEnter</span>: <span class="function"><span class="keyword">function</span> (<span class="params">nextState, replaceState</span>) </span>&#123;</span><br><span class="line">              replaceState(<span class="literal">null</span>, <span class="string">&#x27;/messages/&#x27;</span> + nextState.params.id)</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">React.render(<span class="xml"><span class="tag">&lt;<span class="name">Router</span> <span class="attr">routes</span>=<span class="string">&#123;routeConfig&#125;</span> /&gt;</span></span>, <span class="built_in">document</span>.body)</span><br></pre></td></tr></table></figure>



<h1 id="路由匹配原理"><a href="#路由匹配原理" class="headerlink" title="路由匹配原理"></a>路由匹配原理</h1><p><a target="_blank" rel="noopener" href="https://react-guide.github.io/react-router-cn/docs/guides/basics/docs/Glossary.md#route">路由</a>拥有三个属性来决定是否“匹配“一个 URL：</p>
<ol>
<li><a target="_blank" rel="noopener" href="https://react-guide.github.io/react-router-cn/docs/guides/basics/RouteMatching.html#nesting">嵌套关系</a> 和</li>
<li>它的 <a target="_blank" rel="noopener" href="https://react-guide.github.io/react-router-cn/docs/guides/basics/RouteMatching.html#path-syntax"><code>路径语法</code></a></li>
<li>它的 <a target="_blank" rel="noopener" href="https://react-guide.github.io/react-router-cn/docs/guides/basics/RouteMatching.html#precedence">优先级</a></li>
</ol>
<h2 id="嵌套关系"><a href="#嵌套关系" class="headerlink" title="嵌套关系"></a>嵌套关系</h2><p>React Router 使用路由嵌套的概念来让你定义 view 的嵌套集合，当一个给定的 URL 被调用时，整个集合中（命中的部分）都会被渲染。嵌套路由被描述成一种树形结构。React Router 会深度优先遍历整个<a target="_blank" rel="noopener" href="https://react-guide.github.io/react-router-cn/docs/guides/basics/docs/Glossary.md#routeconfig">路由配置</a>来寻找一个与给定的 URL 相匹配的路由。</p>
<h2 id="路径语法"><a href="#路径语法" class="headerlink" title="路径语法"></a>路径语法</h2><p>路由路径是匹配一个（或一部分）URL 的 <a target="_blank" rel="noopener" href="https://react-guide.github.io/react-router-cn/docs/guides/basics/docs/Glossary.md#routepattern">一个字符串模式</a>。大部分的路由路径都可以直接按照字面量理解，除了以下几个特殊的符号：</p>
<ul>
<li><code>:paramName</code> – 匹配一段位于 <code>/</code>、<code>?</code> 或 <code>#</code> 之后的 URL。 命中的部分将被作为一个<a target="_blank" rel="noopener" href="https://react-guide.github.io/react-router-cn/docs/guides/basics/docs/Glossary.md#params">参数</a></li>
<li><code>()</code> – 在它内部的内容被认为是可选的</li>
<li><code>*</code> – 匹配任意字符（非贪婪的）直到命中下一个字符或者整个 URL 的末尾，并创建一个 <code>splat</code> <a target="_blank" rel="noopener" href="https://react-guide.github.io/react-router-cn/docs/guides/basics/docs/Glossary.md#params">参数</a></li>
</ul>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;Route path=<span class="string">&quot;/hello/:name&quot;</span>&gt;         <span class="comment">// 匹配 /hello/michael 和 /hello/ryan</span></span><br><span class="line">&lt;Route path=&quot;/hello(/:name)&quot;&gt;       // 匹配 /hello, /hello/michael 和 /hello/ryan</span><br><span class="line">&lt;Route path=&quot;/files/*.*&quot;&gt;           // 匹配 /files/hello.jpg 和 /files/path/to/hello.jpg</span><br></pre></td></tr></table></figure>

<p>如果一个路由使用了相对<code>路径</code>，那么完整的路径将由它的所有祖先节点的<code>路径</code>和自身指定的相对<code>路径</code>拼接而成。<a target="_blank" rel="noopener" href="https://react-guide.github.io/react-router-cn/docs/guides/basics/RouteConfiguration.html#decoupling-the-ui-from-the-url">使用绝对<code>路径</code></a>可以使路由匹配行为忽略嵌套关系。</p>
<h2 id="优先级"><a href="#优先级" class="headerlink" title="优先级"></a>优先级</h2><p>最后，路由算法会根据定义的顺序自顶向下匹配路由。因此，当你拥有两个兄弟路由节点配置时，你必须确认前一个路由不会匹配后一个路由中的<code>路径</code>。例如，千万<strong>不要</strong>这么做：</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;Route path=<span class="string">&quot;/comments&quot;</span> ... /&gt;</span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">Redirect</span> <span class="attr">from</span>=<span class="string">&quot;/comments&quot;</span> <span class="attr">...</span> /&gt;</span></span></span><br></pre></td></tr></table></figure>



<h1 id="Histories"><a href="#Histories" class="headerlink" title="Histories"></a>Histories</h1><p>React Router 是建立在 <a target="_blank" rel="noopener" href="https://github.com/rackt/history">history</a> 之上的。 简而言之，一个 history 知道如何去监听浏览器地址栏的变化， 并解析这个 URL 转化为 <code>location</code> 对象， 然后 router 使用它匹配到路由，最后正确地渲染对应的组件。</p>
<p>常用的 history 有三种形式， 但是你也可以使用 React Router 实现自定义的 history。</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://react-guide.github.io/react-router-cn/docs/guides/basics/Histories.html#browserHistory"><code>browserHistory</code></a></li>
<li><a target="_blank" rel="noopener" href="https://react-guide.github.io/react-router-cn/docs/guides/basics/Histories.html#hashHistory"><code>hashHistory</code></a></li>
<li><a target="_blank" rel="noopener" href="https://react-guide.github.io/react-router-cn/docs/guides/basics/Histories.html#creatememoryhistory"><code>createMemoryHistory</code></a></li>
</ul>
<p>你可以从 React Router 中引入它们：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// JavaScript 模块导入（译者注：ES6 形式）</span></span><br><span class="line"><span class="keyword">import</span> &#123; browserHistory &#125; <span class="keyword">from</span> <span class="string">&#x27;react-router&#x27;</span></span><br></pre></td></tr></table></figure>

<p>然后将它们传递给<code>&lt;Router&gt;</code>:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">render(</span><br><span class="line">  <span class="xml"><span class="tag">&lt;<span class="name">Router</span> <span class="attr">history</span>=<span class="string">&#123;browserHistory&#125;</span> <span class="attr">routes</span>=<span class="string">&#123;routes&#125;</span> /&gt;</span></span>,</span><br><span class="line">  <span class="built_in">document</span>.getElementById(<span class="string">&#x27;app&#x27;</span>)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h2 id="browserHistory"><a href="#browserHistory" class="headerlink" title="browserHistory"></a><code>browserHistory</code></h2><p>Browser history 是使用 React Router 的应用推荐的 history。它使用浏览器中的 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/API/History">History</a> API 用于处理 URL，创建一个像<code>example.com/some/path</code>这样真实的 URL 。</p>
<h4 id="服务器配置"><a href="#服务器配置" class="headerlink" title="服务器配置"></a>服务器配置</h4><p>服务器需要做好处理 URL 的准备。处理应用启动最初的 <code>/</code> 这样的请求应该没问题，但当用户来回跳转并在 <code>/accounts/123</code> 刷新时，服务器就会收到来自 <code>/accounts/123</code> 的请求，这时你需要处理这个 URL 并在响应中包含 JavaScript 应用代码。</p>
<p>一个 express 的应用可能看起来像这样的：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> port = process.env.PORT || <span class="number">8080</span></span><br><span class="line"><span class="keyword">const</span> app = express()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 通常用于加载静态资源</span></span><br><span class="line">app.use(express.static(__dirname + <span class="string">&#x27;/public&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在你应用 JavaScript 文件中包含了一个 script 标签</span></span><br><span class="line"><span class="comment">// 的 index.html 中处理任何一个 route</span></span><br><span class="line">app.get(<span class="string">&#x27;*&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">request, response</span>)</span>&#123;</span><br><span class="line">  response.sendFile(path.resolve(__dirname, <span class="string">&#x27;public&#x27;</span>, <span class="string">&#x27;index.html&#x27;</span>))</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.listen(port)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;server started on port &quot;</span> + port)</span><br></pre></td></tr></table></figure>

<p>如果你的服务器是 nginx，请使用 <a target="_blank" rel="noopener" href="http://nginx.org/en/docs/http/ngx_http_core_module.html#try_files"><code>try_files</code> 指令</a>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">  ...</span><br><span class="line">  location / &#123;</span><br><span class="line">    try_files $uri /index.html</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>当在服务器上找不到其他文件时，这可以让 nginx 服务器提供静态文件服务并指向<code>index.html</code> 文件。</p>
<p>对于Apache服务器也有类似的方式，创建一个<code>.htaccess</code>文件在你的文件根目录下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">RewriteBase /</span><br><span class="line">RewriteRule ^index\.html$ - [L]</span><br><span class="line">RewriteCond %&#123;REQUEST_FILENAME&#125; !-f</span><br><span class="line">RewriteCond %&#123;REQUEST_FILENAME&#125; !-d</span><br><span class="line">RewriteRule . /index.html [L]</span><br></pre></td></tr></table></figure>

<h4 id="IE8-IE9-支持情况"><a href="#IE8-IE9-支持情况" class="headerlink" title="IE8, IE9 支持情况"></a>IE8, IE9 支持情况</h4><p>如果我们能使用浏览器自带的 <code>window.history</code> API，那么我们的特性就可以被浏览器所检测到。如果不能，那么任何调用跳转的应用就会导致 <strong>全页面刷新</strong>，它允许在构建应用和更新浏览器时会有一个更好的用户体验，但仍然支持的是旧版的。</p>
<p>你可能会想为什么我们不后退到 hash history，问题是这些 URL 是不确定的。如果一个访客在 hash history 和 browser history 上共享一个 URL，然后他们也共享同一个后退功能，最后我们会以产生笛卡尔积数量级的、无限多的 URL 而崩溃。</p>
<h2 id="hashHistory"><a href="#hashHistory" class="headerlink" title="hashHistory"></a><code>hashHistory</code></h2><p>Hash history 使用 URL 中的 hash（<code>#</code>）部分去创建形如 <code>example.com/#/some/path</code> 的路由。</p>
<h4 id="我应该使用-createHashHistory吗？"><a href="#我应该使用-createHashHistory吗？" class="headerlink" title="我应该使用 createHashHistory吗？"></a>我应该使用 <code>createHashHistory</code>吗？</h4><p>Hash history 不需要服务器任何配置就可以运行，如果你刚刚入门，那就使用它吧。但是我们不推荐在实际线上环境中用到它，因为每一个 web 应用都应该渴望使用 <code>browserHistory</code>。</p>
<h4 id="像这样-k-ckuvup-没用的在-URL-中是什么？"><a href="#像这样-k-ckuvup-没用的在-URL-中是什么？" class="headerlink" title="像这样 ?_k=ckuvup 没用的在 URL 中是什么？"></a>像这样 <code>?_k=ckuvup</code> 没用的在 URL 中是什么？</h4><p>当一个 history 通过应用程序的 <code>push</code> 或 <code>replace</code> 跳转时，它可以在新的 location 中存储 “location state” 而不显示在 URL 中，这就像是在一个 HTML 中 post 的表单数据。</p>
<p>在 DOM API 中，这些 hash history 通过 <code>window.location.hash = newHash</code> 很简单地被用于跳转，且不用存储它们的location state。但我们想全部的 history 都能够使用location state，因此我们要为每一个 location 创建一个唯一的 key，并把它们的状态存储在 session storage 中。当访客点击“后退”和“前进”时，我们就会有一个机制去恢复这些 location state。</p>
<h2 id="createMemoryHistory"><a href="#createMemoryHistory" class="headerlink" title="createMemoryHistory"></a><code>createMemoryHistory</code></h2><p>Memory history 不会在地址栏被操作或读取。这就解释了我们是如何实现服务器渲染的。同时它也非常适合测试和其他的渲染环境（像 React Native ）。</p>
<p>和另外两种history的一点不同是你必须创建它，这种方式便于测试。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> history = createMemoryHistory(location)</span><br></pre></td></tr></table></figure>

<h2 id="实现示例"><a href="#实现示例" class="headerlink" title="实现示例"></a>实现示例</h2><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; render &#125; <span class="keyword">from</span> <span class="string">&#x27;react-dom&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; browserHistory, Router, Route, IndexRoute &#125; <span class="keyword">from</span> <span class="string">&#x27;react-router&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">&#x27;../components/App&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Home <span class="keyword">from</span> <span class="string">&#x27;../components/Home&#x27;</span></span><br><span class="line"><span class="keyword">import</span> About <span class="keyword">from</span> <span class="string">&#x27;../components/About&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Features <span class="keyword">from</span> <span class="string">&#x27;../components/Features&#x27;</span></span><br><span class="line"></span><br><span class="line">render(</span><br><span class="line">  <span class="xml"><span class="tag">&lt;<span class="name">Router</span> <span class="attr">history</span>=<span class="string">&#123;browserHistory&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&#x27;/&#x27;</span> <span class="attr">component</span>=<span class="string">&#123;App&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">IndexRoute</span> <span class="attr">component</span>=<span class="string">&#123;Home&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&#x27;about&#x27;</span> <span class="attr">component</span>=<span class="string">&#123;About&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">      <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&#x27;features&#x27;</span> <span class="attr">component</span>=<span class="string">&#123;Features&#125;</span> /&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;/<span class="name">Route</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">Router</span>&gt;</span></span>,</span><br><span class="line">  <span class="built_in">document</span>.getElementById(<span class="string">&#x27;app&#x27;</span>)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>



<h1 id="默认路由（IndexRoute）与-IndexLink"><a href="#默认路由（IndexRoute）与-IndexLink" class="headerlink" title="默认路由（IndexRoute）与 IndexLink"></a>默认路由（IndexRoute）与 IndexLink</h1><h2 id="默认路由（IndexRoute）"><a href="#默认路由（IndexRoute）" class="headerlink" title="默认路由（IndexRoute）"></a>默认路由（IndexRoute）</h2><p>在解释 <code>默认路由(IndexRoute)</code> 的用例之前，我们来设想一下，一个不使用默认路由的路由配置是什么样的：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;Router&gt;</span><br><span class="line">  <span class="xml"><span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;/&quot;</span> <span class="attr">component</span>=<span class="string">&#123;App&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;accounts&quot;</span> <span class="attr">component</span>=<span class="string">&#123;Accounts&#125;/</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;statements&quot;</span> <span class="attr">component</span>=<span class="string">&#123;Statements&#125;/</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">Route</span>&gt;</span></span></span><br><span class="line">&lt;/Router&gt;</span><br></pre></td></tr></table></figure>

<p>当用户访问 <code>/</code> 时, App 组件被渲染，但组件内的子元素却没有， <code>App</code> 内部的 <code>this.props.children</code> 为 undefined 。 你可以简单地使用 `{this.props.children ||</p>
<p>}` 来渲染一些默认的 UI 组件。</p>
<p>但现在，<code>Home</code> 无法参与到比如 <code>onEnter</code> hook 这些路由机制中来。 在 <code>Home</code> 的位置，渲染的是 <code>Accounts</code> 和 <code>Statements</code>。 由此，router 允许你使用 <code>IndexRoute</code> ，以使 <code>Home</code> 作为最高层级的路由出现.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;Router&gt;</span><br><span class="line">  <span class="xml"><span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;/&quot;</span> <span class="attr">component</span>=<span class="string">&#123;App&#125;</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">IndexRoute</span> <span class="attr">component</span>=<span class="string">&#123;Home&#125;/</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;accounts&quot;</span> <span class="attr">component</span>=<span class="string">&#123;Accounts&#125;/</span>&gt;</span></span></span><br><span class="line"><span class="xml">    <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">&quot;statements&quot;</span> <span class="attr">component</span>=<span class="string">&#123;Statements&#125;/</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;/<span class="name">Route</span>&gt;</span></span></span><br><span class="line">&lt;/Router&gt;</span><br></pre></td></tr></table></figure>

<p>现在 <code>App</code> 能够渲染 <code>&#123;this.props.children&#125;</code> 了， 我们也有了一个最高层级的路由，使 <code>Home</code> 可以参与进来。</p>
<h2 id="Index-Links"><a href="#Index-Links" class="headerlink" title="Index Links"></a>Index Links</h2><p>如果你在这个 app 中使用 <code>&lt;Link to=&quot;/&quot;&gt;Home&lt;/Link&gt;</code> , 它会一直处于激活状态，因为所有的 URL 的开头都是 <code>/</code> 。 这确实是个问题，因为我们仅仅希望在 <code>Home</code> 被渲染后，激活并链接到它。</p>
<p>如果需要在 <code>Home</code> 路由被渲染后才激活的指向 <code>/</code> 的链接，请使用 <code>&lt;IndexLink to=&quot;/&quot;&gt;Home&lt;/IndexLink&gt;</code></p>
</div></div><div class="post-main post-comment"></div></article><link rel="stylesheet" type="text/css" href="/css/font.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.css"><script src="//cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script><script src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script>$(document).ready(function() {
  $(".fancybox").fancybox();
});
</script></body></html>